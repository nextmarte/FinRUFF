<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.549">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Marcus Ramalho">

<title>Finanças com R - análise e otimização de carteiras - Aula 2 - Análise e otimização de carteiras</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<link href="site_libs/htmltools-fill-0.5.8.1/fill.css" rel="stylesheet">
<script src="site_libs/htmlwidgets-1.6.4/htmlwidgets.js"></script>
<script src="site_libs/plotly-binding-4.10.4/plotly.js"></script>
<script src="site_libs/typedarray-0.1/typedarray.min.js"></script>
<script src="site_libs/jquery-3.5.1/jquery.min.js"></script>
<link href="site_libs/crosstalk-1.2.1/css/crosstalk.min.css" rel="stylesheet">
<script src="site_libs/crosstalk-1.2.1/js/crosstalk.min.js"></script>
<link href="site_libs/plotly-htmlwidgets-css-2.11.1/plotly-htmlwidgets.css" rel="stylesheet">
<script src="site_libs/plotly-main-2.11.1/plotly-latest.min.js"></script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-fixed fullcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">Finanças com R - análise e otimização de carteiras</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="./index.html"> <i class="bi bi-house" role="img">
</i> 
<span class="menu-text">Início</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./apresentacao.html"> <i class="bi bi-easel" role="img">
</i> 
<span class="menu-text">Apresentação</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./aula_1.html"> <i class="bi bi-book" role="img">
</i> 
<span class="menu-text">Aula 1</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link active" href="./aula_2.html" aria-current="page"> <i class="bi bi-book" role="img">
</i> 
<span class="menu-text">Aula 2</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./dashboard.html"> <i class="bi bi-speedometer" role="img">
</i> 
<span class="menu-text">Dashboard</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Aula 2 - Análise e otimização de carteiras</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Professor: </div>
    <div class="quarto-title-meta-contents">
             <p>Marcus Ramalho </p>
          </div>
  </div>
    
  
    
  </div>
  


</header>


<section id="relembrando-alguns-conceitos-sobre-risco" class="level2">
<h2 class="anchored" data-anchor-id="relembrando-alguns-conceitos-sobre-risco">Relembrando alguns conceitos sobre risco</h2>
<p><strong>Risco</strong>: Probabilidade de um resultado adverso em relação ao esperado.</p>
<p><img src="images/paste-2.png" class="img-fluid" width="718"></p>
</section>
<section id="tipos-de-risco" class="level2">
<h2 class="anchored" data-anchor-id="tipos-de-risco">Tipos de risco</h2>
<ul>
<li><strong>Risco conhecido</strong>: Distribuição de probabilidade do evento é conhecida (ex: falha de motor).</li>
<li><strong>Incerteza</strong>: Distribuição de probabilidade desconhecida ou imprevisível (ex: crise econômica).</li>
</ul>
</section>
<section id="atitudes-frente-ao-risco" class="level2">
<h2 class="anchored" data-anchor-id="atitudes-frente-ao-risco">Atitudes frente ao risco</h2>
<ul>
<li><strong>Aversão</strong>: Prefere menor risco para mesmo retorno.</li>
<li><strong>Indiferença</strong>: Não se importa com o risco.</li>
<li><strong>Propensão</strong>: Aceita maior risco por potencial de maior retorno.</li>
</ul>
<p><img src="images/paste-3.png" class="img-fluid" width="723"></p>
<p>O participante de uma apólice de seguros têm que predisposição frente ao risco?</p>
<p>E a companhia de seguros?</p>
</section>
<section id="mensuração-do-risco" class="level2">
<h2 class="anchored" data-anchor-id="mensuração-do-risco">Mensuração do Risco</h2>
<ul>
<li><strong>Desvio padrão (σ)</strong>: Mede a dispersão dos resultados em torno da média.</li>
<li><strong>Coeficiente de variação (CV)</strong>: Mede o risco por unidade de retorno (σ / retorno médio).</li>
</ul>
</section>
<section id="risco-de-carteira" class="level2">
<h2 class="anchored" data-anchor-id="risco-de-carteira">Risco de Carteira</h2>
<ul>
<li><strong>Covariância</strong>: Mede a relação entre os retornos de dois ativos.</li>
<li><strong>Diversificação</strong>: Reduz o risco total da carteira ao combinar ativos com diferentes riscos (Markowitz, 1952) - “Não colocar todos os ovos na mesma cesta”.</li>
</ul>
</section>
<section id="risco-individual-vs.-sistêmico" class="level2">
<h2 class="anchored" data-anchor-id="risco-individual-vs.-sistêmico">Risco individual vs.&nbsp;sistêmico</h2>
<ul>
<li><strong>Individual</strong>: Específico de cada ativo.</li>
<li><strong>Sistêmico</strong>: Afeta todo o mercado.</li>
</ul>
</section>
<section id="índice-sharpe-is" class="level2">
<h2 class="anchored" data-anchor-id="índice-sharpe-is">Índice Sharpe (IS)</h2>
<ul>
<li><strong>Definição</strong>: Mede o retorno adicional por unidade de risco em relação à taxa livre de risco.</li>
<li><strong>Fórmula</strong>: IS = (Retorno médio do portfólio - Taxa livre de risco) / Desvio padrão do excesso de retorno.</li>
<li><strong>interpretação</strong>: IS &gt; 1: Retorno adicional por unidade de risco; IS &lt; 1: Retorno insuficiente por unidade de risco. Quantos mais alto o índice, melhor.</li>
</ul>
</section>
<section id="beta-β" class="level2">
<h2 class="anchored" data-anchor-id="beta-β">Beta (β)</h2>
<ul>
<li><strong>Definição</strong>: Mede a sensibilidade do retorno de um ativo em relação ao retorno do mercado.</li>
<li><strong>Fórmula</strong>: β = Cov(Ri, Rm) / Var(Rm).</li>
<li><strong>Interpretação</strong>: β &gt; 1: Ativo mais volátil que o mercado; β &lt; 1: Ativo menos volátil que o mercado.</li>
<li><strong>Exemplo</strong>: Se β = 1, o ativo se move na mesma direção que o mercado.</li>
</ul>
</section>
<section id="alfa-α" class="level2">
<h2 class="anchored" data-anchor-id="alfa-α">Alfa (α)</h2>
<ul>
<li><strong>Definição</strong>: Mede o retorno adicional de um ativo em relação ao retorno esperado com base no risco.</li>
<li><strong>Fórmula</strong>: α = Retorno do ativo - (Taxa livre de risco + β * (Retorno do mercado - Taxa livre de risco)).</li>
<li><strong>Interpretação</strong>: α &gt; 0: Ativo superou o retorno esperado; α &lt; 0: Ativo ficou aquém do retorno esperado.</li>
<li><strong>Exemplo</strong>: Se α = 0, o ativo teve o retorno esperado com base no risco.</li>
<li><strong>Observação</strong>: O alfa é uma medida de desempenho ajustada ao risco.</li>
</ul>
</section>
<section id="função-de-utilidade-quadrática" class="level2">
<h2 class="anchored" data-anchor-id="função-de-utilidade-quadrática">Função de utilidade quadrática</h2>
<p>A função de utilidade quadrática é usada na otimização de portfólios para encontrar a alocação de ativos que maximiza o retorno esperado e minimiza o risco. A função de utilidade quadrática é dada por:</p>
<p><span class="math inline">\(U = \mu^T w - \lambda \sigma^2\)</span></p>
<p>onde:</p>
<ul>
<li><span class="math inline">\(U\)</span> é a função de utilidade</li>
<li><span class="math inline">\(\mu^T\)</span> é o vetor de retornos esperados</li>
<li><span class="math inline">\(w\)</span> é o vetor de pesos dos ativos</li>
<li><span class="math inline">\(\lambda\)</span> é o fator de aversão ao risco</li>
</ul>
<p>generalizando para o caso de <span class="math inline">\(n\)</span> ativos, a função de utilidade quadrática é dada por:</p>
<p><span class="math inline">\(U = \mu^T w - \lambda w^T \Sigma w\)</span></p>
<p>onde:</p>
<ul>
<li><span class="math inline">\(\Sigma w\)</span> é a matriz de covariância dos retornos dos ativos</li>
<li><span class="math inline">\(w^T\)</span> é o vetor transposto de pesos dos ativos</li>
<li><span class="math inline">\(w\)</span> é o vetor de pesos dos ativos</li>
<li><span class="math inline">\(\lambda\)</span> é o fator de aversão ao risco</li>
<li><span class="math inline">\(\mu\)</span> é o vetor de retornos esperados</li>
<li><span class="math inline">\(U\)</span> é a função de utilidade</li>
</ul>
</section>
<section id="otimização-de-portfólios" class="level2">
<h2 class="anchored" data-anchor-id="otimização-de-portfólios">Otimização de portfólios</h2>
<p>A otimização de portfólios é um problema de maximização da função de utilidade quadrática sujeita a restrições, como a soma dos pesos dos ativos deve ser igual a 1 e os pesos dos ativos devem ser maiores ou iguais a zero.</p>
</section>
<section id="primeiro-vamos-carregar-os-pacotes-necessários" class="level2">
<h2 class="anchored" data-anchor-id="primeiro-vamos-carregar-os-pacotes-necessários">Primeiro vamos carregar os pacotes necessários</h2>
</section>
<section id="ativos-selecionados" class="level2">
<h2 class="anchored" data-anchor-id="ativos-selecionados">Ativos selecionados</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Ativos selecionados</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>tickers <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"VALE3.SA"</span>,<span class="st">"PETR4.SA"</span>,<span class="st">"AZUL4.SA"</span>,<span class="st">"MGLU3.SA"</span>, <span class="st">"CMIG4.SA"</span>)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>prices <span class="ot">&lt;-</span> </span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">getSymbols</span>(tickers, </span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>             <span class="at">src =</span> <span class="st">'yahoo'</span>, </span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>             <span class="at">from =</span> <span class="st">"2019-05-30"</span>,</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>             <span class="at">to =</span> <span class="st">"2024-05-30"</span>,</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>             <span class="at">auto.assign =</span> <span class="cn">TRUE</span>, <span class="co">#obs auto asign carrega os resultados para o ambiente</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>             <span class="at">warnings =</span> <span class="cn">FALSE</span>,) <span class="sc">%&gt;%</span> </span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">map</span>(<span class="sc">~</span><span class="fu">Ad</span>(<span class="fu">get</span>(.))) <span class="sc">%&gt;%</span> </span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">reduce</span>(merge) <span class="sc">%&gt;%</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>  <span class="st">`</span><span class="at">colnames&lt;-</span><span class="st">`</span>(tickers)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="baixando-os-preços-do-benchmark" class="level2">
<h2 class="anchored" data-anchor-id="baixando-os-preços-do-benchmark">Baixando os preços do benchmark</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Baixando os preços do IBOV</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>ibov <span class="ot">&lt;-</span> <span class="fu">getSymbols</span>(<span class="st">"^BVSP"</span>, </span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>                   <span class="at">src =</span> <span class="st">'yahoo'</span>, </span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>                   <span class="at">from =</span> <span class="st">"2019-05-30"</span>,</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>                   <span class="at">to =</span> <span class="st">"2024-05-30"</span>,</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>                   <span class="at">auto.assign =</span> <span class="cn">TRUE</span>, </span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>                   <span class="at">warnings =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">map</span>(<span class="sc">~</span><span class="fu">Ad</span>(<span class="fu">get</span>(.))) <span class="sc">%&gt;%</span> </span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">reduce</span>(merge) <span class="sc">%&gt;%</span> </span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>  <span class="st">`</span><span class="at">colnames&lt;-</span><span class="st">`</span>(<span class="st">"IBOV"</span>)</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(ibov)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>            IBOV
2019-05-30 97457
2019-05-31 97030
2019-06-03 97020
2019-06-04 97380
2019-06-05 95999
2019-06-06 97205</code></pre>
</div>
</div>
</section>
<section id="agora-vamos-converter-os-preços-diários-em-mensais" class="level2">
<h2 class="anchored" data-anchor-id="agora-vamos-converter-os-preços-diários-em-mensais">Agora vamos converter os preços diários em mensais</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>prices_monthly <span class="ot">&lt;-</span> <span class="fu">to.monthly</span>(prices, <span class="at">indexAt =</span> <span class="st">"lastof"</span>, <span class="at">OHLC =</span> <span class="cn">FALSE</span>)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(prices_monthly)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>           VALE3.SA  PETR4.SA AZUL4.SA  MGLU3.SA CMIG4.SA
2019-05-31 31.99329  8.838510    39.20  56.97055 4.504750
2019-06-30 33.83453  9.481940    43.29  61.36543 4.532218
2019-07-31 32.52216  9.021854    51.78  76.65446 4.315526
2019-08-31 29.75376  8.890537    47.10  84.38618 4.504750
2019-09-30 31.17713  9.605266    49.71  86.13017 4.373514
2019-10-31 30.81803 10.595428    52.52 104.00203 4.165978</code></pre>
</div>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>ibov_monthly <span class="ot">&lt;-</span> <span class="fu">to.monthly</span>(ibov, <span class="at">indexAt =</span> <span class="st">"lastof"</span>, <span class="at">OHLC =</span> <span class="cn">FALSE</span>)</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(ibov_monthly)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>             IBOV
2019-05-31  97030
2019-06-30 100967
2019-07-31 101812
2019-08-31 101135
2019-09-30 104745
2019-10-31 107220</code></pre>
</div>
</div>
</section>
<section id="vamos-calcular-os-retornos-mensais" class="level2">
<h2 class="anchored" data-anchor-id="vamos-calcular-os-retornos-mensais">Vamos calcular os retornos mensais</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>asset_returns_xts <span class="ot">&lt;-</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a> PerformanceAnalytics<span class="sc">::</span><span class="fu">Return.calculate</span>(prices_monthly, </span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">method =</span> <span class="st">"discrete"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">na.omit</span>()</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>ibov_returns_xts <span class="ot">&lt;-</span> </span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>  PerformanceAnalytics<span class="sc">::</span><span class="fu">Return.calculate</span>(ibov_monthly, </span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>                   <span class="at">method =</span> <span class="st">"discrete"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">na.omit</span>()</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(asset_returns_xts)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>              VALE3.SA    PETR4.SA    AZUL4.SA    MGLU3.SA     CMIG4.SA
2019-06-30  0.05755088  0.07279855  0.10433674 0.077142847  0.006097504
2019-07-31 -0.03878790 -0.04852233  0.19611914 0.249147333 -0.047811363
2019-08-31 -0.08512362 -0.01455545 -0.09038240 0.100864585  0.043847208
2019-09-30  0.04783854  0.08039203  0.05541403 0.020666841 -0.029132823
2019-10-31 -0.01151825  0.10308532  0.05652789 0.207498210 -0.047452862
2019-11-30  0.05889821 -0.03443152  0.01104337 0.008736513 -0.043956240</code></pre>
</div>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(ibov_returns_xts)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                   IBOV
2019-06-30  0.040575080
2019-07-31  0.008369071
2019-08-31 -0.006649511
2019-09-30  0.035694863
2019-10-31  0.023628813
2019-11-30  0.009447864</code></pre>
</div>
</div>
</section>
<section id="otimização-da-carteira" class="level2">
<h2 class="anchored" data-anchor-id="otimização-da-carteira">Otimização da carteira</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Criando o objeto de otimização</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>portf <span class="ot">&lt;-</span> <span class="fu">portfolio.spec</span>(<span class="at">assets =</span> <span class="fu">colnames</span>(asset_returns_xts))</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Adicionando restrições, como por exemplo, a soma dos pesos dos ativos deve ser igual a 1</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>portf <span class="ot">&lt;-</span> <span class="fu">add.constraint</span>(portf, <span class="at">type =</span> <span class="st">"full_investment"</span>)</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Adicionando restrição de peso mínimo e máximo para cada ativo</span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Neste caso, o peso mínimo é 0 e o peso máximo é 1</span></span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>portf <span class="ot">&lt;-</span> <span class="fu">add.constraint</span>(portf, <span class="at">type =</span> <span class="st">"long_only"</span>)</span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Adiciona a função objetivo, que é minimizar o desvio padrão da carteira</span></span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>portf <span class="ot">&lt;-</span> <span class="fu">add.objective</span>(portf, <span class="at">type =</span> <span class="st">"risk"</span>, <span class="at">name =</span> <span class="st">"StdDev"</span>)</span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Resolve o problema de otimização</span></span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a>opt_portf <span class="ot">&lt;-</span> <span class="fu">optimize.portfolio</span>(asset_returns_xts, portf, <span class="at">optimize_method =</span> <span class="st">"ROI"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="resultados-da-otimização" class="level2">
<h2 class="anchored" data-anchor-id="resultados-da-otimização">Resultados da otimização</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>opt_portf</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>***********************************
PortfolioAnalytics Optimization
***********************************

Call:
optimize.portfolio(R = asset_returns_xts, portfolio = portf, 
    optimize_method = "ROI")

Optimal Weights:
VALE3.SA PETR4.SA AZUL4.SA MGLU3.SA CMIG4.SA 
  0.4881   0.0953   0.0000   0.0428   0.3738 

Objective Measure:
 StdDev 
0.07238 </code></pre>
</div>
</div>
</section>
<section id="extraindo-os-pesos-dos-ativos" class="level2">
<h2 class="anchored" data-anchor-id="extraindo-os-pesos-dos-ativos">Extraindo os pesos dos ativos</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># extraindo os pesos para um data frame</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>weights <span class="ot">&lt;-</span> <span class="fu">extractWeights</span>(opt_portf)</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Adicionando os nomes dos ativos sem colocá-los no índice</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>weights <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">tickers =</span> <span class="fu">colnames</span>(asset_returns_xts), weights, <span class="at">row.names =</span> <span class="cn">NULL</span>)</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>weights</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   tickers    weights
1 VALE3.SA 0.48813419
2 PETR4.SA 0.09528950
3 AZUL4.SA 0.00000000
4 MGLU3.SA 0.04276916
5 CMIG4.SA 0.37380715</code></pre>
</div>
</div>
</section>
<section id="plotando-com-o-portfolioanalytics" class="level2">
<h2 class="anchored" data-anchor-id="plotando-com-o-portfolioanalytics">plotando com o portfolioAnalytics</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">chart.Weights</span>(opt_portf)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="aula_2_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="plotando-com-ggplo2" class="level2">
<h2 class="anchored" data-anchor-id="plotando-com-ggplo2">Plotando com ggplo2</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(weights, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">reorder</span>(tickers, weights), <span class="at">y =</span> weights, <span class="at">fill =</span> tickers)) <span class="sc">+</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">color =</span> <span class="st">"black"</span>, <span class="at">show.legend =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">14</span>) <span class="sc">+</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">90</span>, <span class="at">hjust =</span> <span class="dv">1</span>),</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">size =</span> <span class="dv">20</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">size =</span> <span class="dv">16</span>),</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"none"</span>) <span class="sc">+</span></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_d</span>() <span class="sc">+</span></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Distribuição dos Pesos dos Ativos"</span>,</span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>   <span class="at">x =</span> <span class="st">"Ativos"</span>,</span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>   <span class="at">y =</span> <span class="st">"Pesos"</span>) <span class="sc">+</span></span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="aula_2_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="realizando-otimização-da-função-de-utilidade-com-o-portfolioanalytics" class="level2">
<h2 class="anchored" data-anchor-id="realizando-otimização-da-função-de-utilidade-com-o-portfolioanalytics">Realizando otimização da função de utilidade com o PortfolioAnalytics</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co">#criar o objeto de otimização</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>portf <span class="ot">&lt;-</span> <span class="fu">portfolio.spec</span>(<span class="at">assets =</span> <span class="fu">colnames</span>(asset_returns_xts))</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Adicionando restrições, como por exemplo, a soma dos pesos dos ativos deve ser igual a 1</span></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>portf <span class="ot">&lt;-</span> <span class="fu">add.constraint</span>(portf, <span class="at">type =</span> <span class="st">"full_investment"</span>)</span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Adicionando restrição de peso mínimo e máximo para cada ativo (0-1)</span></span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>portf <span class="ot">&lt;-</span> <span class="fu">add.constraint</span>(portf, <span class="at">type =</span> <span class="st">"long_only"</span>)</span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Adiciona a função objetivo, que é maximizar o retorno esperado</span></span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a>portf <span class="ot">&lt;-</span> <span class="fu">add.objective</span>(portf, <span class="at">type =</span> <span class="st">"return"</span>, <span class="at">name =</span> <span class="st">"mean"</span>)</span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Adiciona a função objetivo, que é minimizar a variância da carteira</span></span>
<span id="cb19-18"><a href="#cb19-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-19"><a href="#cb19-19" aria-hidden="true" tabindex="-1"></a>portf <span class="ot">&lt;-</span> <span class="fu">add.objective</span>(portf, <span class="at">type =</span> <span class="st">"risk"</span>, <span class="at">name =</span> <span class="st">"var"</span>)</span>
<span id="cb19-20"><a href="#cb19-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-21"><a href="#cb19-21" aria-hidden="true" tabindex="-1"></a>portf <span class="ot">&lt;-</span> <span class="fu">add.objective</span>(portf, <span class="at">type =</span> <span class="st">"quadratic_utility"</span>, <span class="at">risk_aversion =</span> <span class="dv">10</span>)</span>
<span id="cb19-22"><a href="#cb19-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-23"><a href="#cb19-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Resolve o problema de otimização</span></span>
<span id="cb19-24"><a href="#cb19-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-25"><a href="#cb19-25" aria-hidden="true" tabindex="-1"></a>opt_portf <span class="ot">&lt;-</span> <span class="fu">optimize.portfolio</span>(asset_returns_xts, portf, <span class="at">optimize_method =</span> <span class="st">"ROI"</span>)</span>
<span id="cb19-26"><a href="#cb19-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-27"><a href="#cb19-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Extraindo os pesos dos ativos</span></span>
<span id="cb19-28"><a href="#cb19-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-29"><a href="#cb19-29" aria-hidden="true" tabindex="-1"></a><span class="fu">extractWeights</span>(opt_portf)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   VALE3.SA    PETR4.SA    AZUL4.SA    MGLU3.SA    CMIG4.SA 
0.478117553 0.193941113 0.000000000 0.007504452 0.320436882 </code></pre>
</div>
</div>
</section>
<section id="pesos" class="level2">
<h2 class="anchored" data-anchor-id="pesos">Pesos</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">extractWeights</span>(opt_portf)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   VALE3.SA    PETR4.SA    AZUL4.SA    MGLU3.SA    CMIG4.SA 
0.478117553 0.193941113 0.000000000 0.007504452 0.320436882 </code></pre>
</div>
</div>
</section>
<section id="entendendo-a-especificação-do-portfólio" class="level2">
<h2 class="anchored" data-anchor-id="entendendo-a-especificação-do-portfólio">Entendendo a especificação do portfólio</h2>
<p>O objeto de portfólio é uma lista que contém as seguintes informações:</p>
<ul>
<li><strong>assets</strong>: vetor de nomes dos ativos</li>
<li><strong>constraints</strong>: lista de restrições
<ul>
<li><strong>weight_sum</strong>: restrição de que a soma dos pesos dos ativos deve ser igual a um valor específico</li>
<li><strong>full_investment</strong>: restrição de que a soma dos pesos dos ativos deve ser igual a 1</li>
<li><strong>dollar_neutral</strong>: restrição de que a soma dos pesos dos ativos deve ser igual a zero</li>
<li><strong>box</strong>: restrição de que os pesos dos ativos devem estar dentro de um intervalo específico</li>
<li><strong>long_only</strong>: restrição de que os pesos dos ativos devem ser maiores ou iguais a zero e menores ou iguais a um (caso especial da restrição box)</li>
<li><strong>group</strong>: restrição de que os pesos dos ativos de um grupo específico devem ser iguais</li>
<li><strong>turnover</strong>: restrição de que o turnover da carteira deve ser menor ou igual a um valor específico a partir de uma carteira inicial</li>
<li><strong>diversification</strong>: Especifica um valor de diversificação para a carteira</li>
<li><strong>position_limit</strong>: Permite ao usuário definir o número máximo de posições (ativos com pesos não nulos) e o número máximo de posições compradas e vendidas.</li>
<li><strong>return</strong>: Especifica o retorno médio esperado da carteira</li>
<li><strong>factor_exposure</strong>: Especifica a exposição da carteira a fatores de risco</li>
<li><strong>leverage_exposure</strong>: Especifica a alavancagem maxima da carteira onde a alavancagem é definida como a soma dos pesos absolutos dos ativos</li>
</ul></li>
<li><strong>objectives</strong>:
<ul>
<li><strong>type</strong>: ‘return’,‘risk’, ‘risk_budget’, ‘quadratic_utility’, or ’weight_concentration</li>
</ul></li>
</ul>
</section>
<section id="passo-a-passo-da-otimização-de-portfólios" class="level2">
<h2 class="anchored" data-anchor-id="passo-a-passo-da-otimização-de-portfólios">Passo a passo da otimização de portfólios</h2>
<ol type="1">
<li>Carregar os preços dos ativos e do benchmark</li>
<li>Converter os preços diários em preços mensais</li>
<li>Calcular os retornos mensais dos ativos e do benchmark</li>
<li><strong>Criar o objeto de portfólio</strong></li>
<li><strong>Adicionar restrições ao objeto de portfólio</strong></li>
<li><strong>Adicionar a função objetivo ao objeto de portfólio</strong></li>
<li><strong>Resolver o problema de otimização</strong></li>
<li><strong>Exibir os resultados da otimização</strong></li>
<li><strong>Exibir os pesos dos ativos na carteira otimizada</strong></li>
<li><strong>Plotar a distribuição dos pesos dos ativos na carteira otimizada</strong></li>
</ol>
</section>
<section id="criando-um-objeto-para-as-especificações-do-portfólio" class="level2">
<h2 class="anchored" data-anchor-id="criando-um-objeto-para-as-especificações-do-portfólio">Criando um objeto para as especificações do portfólio</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Criando o objeto de portfólio, aqui estamos apenas especificando os ativos que serão utilizados na otimização</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>port_spec <span class="ot">&lt;-</span> <span class="fu">portfolio.spec</span>(<span class="at">assets =</span> <span class="fu">colnames</span>(asset_returns_xts))</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(port_spec)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "portfolio.spec" "portfolio"     </code></pre>
</div>
</div>
</section>
<section id="adicionando-restrições-ao-objeto-de-portfólio" class="level2">
<h2 class="anchored" data-anchor-id="adicionando-restrições-ao-objeto-de-portfólio">Adicionando restrições ao objeto de portfólio</h2>
<p>As restrições são condições que devem ser satisfeitas durante a otimização da carteira. Algumas restrições comuns são relacionadas ao peso dos ativos e ao retorno esperado da carteira.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Adicionando restrições, como por exemplo, a soma dos pesos dos ativos deve ser igual a 1</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>port_spec  <span class="ot">&lt;-</span> <span class="fu">add.constraint</span>(port_spec, <span class="at">type =</span> <span class="st">"weight_sum"</span>, <span class="at">min_sum =</span> <span class="dv">1</span>, <span class="at">max_sum =</span> <span class="dv">1</span>)</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a><span class="co"># adicionnando uma restrição de caixas para os pesos dos ativos</span></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>port_spec <span class="ot">&lt;-</span> <span class="fu">add.constraint</span>(port_spec, <span class="at">type =</span> <span class="st">"box"</span>, <span class="at">min =</span> <span class="fu">c</span>(<span class="fl">0.2</span>, <span class="fl">0.1</span>, <span class="fl">0.1</span>, <span class="fl">0.1</span>, <span class="fl">0.1</span>), <span class="at">max =</span> <span class="fl">0.4</span>)</span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(port_spec)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>**************************************************
PortfolioAnalytics Portfolio Specification 
**************************************************

Call:
portfolio.spec(assets = colnames(asset_returns_xts))

Number of assets: 5 
Asset Names
[1] "VALE3.SA" "PETR4.SA" "AZUL4.SA" "MGLU3.SA" "CMIG4.SA"

Constraints
Enabled constraint types
        - weight_sum 
        - box </code></pre>
</div>
</div>
</section>
<section id="adicionando-a-função-objetivo-ao-objeto-de-portfólio" class="level2">
<h2 class="anchored" data-anchor-id="adicionando-a-função-objetivo-ao-objeto-de-portfólio">Adicionando a função objetivo ao objeto de portfólio</h2>
<p>A função objetivo é a função que será otimizada durante o processo de otimização da carteira. Um objetivo comum é maximizar o retorno esperado da carteira e minimizar a volatilidade e o risco.</p>
<p>Lembre-se que o desvio padrão é a raiz quadrada da variância. E que a variância é a média dos quadrados dos desvios em relação à média. A variancia é geralmente usada para denotar o risco, quanto maior a variancia, maior o risco. Já geralmente denota a volatilidade, quanto maior o desvio padrão, maior a volatilidade. Ambas são medidas que servem como indicadores de risco.</p>
<p>No portfolioAnalytics, a função objetivo é adicionada ao objeto de portfólio usando a função <code>add.objective()</code>. Os objetivos mais usado são:</p>
<ul>
<li><strong>return</strong>: Maximizar o retorno esperado da carteira</li>
<li><strong>risk</strong>: Minimizar o risco da carteira</li>
<li><strong>risk_budget</strong>: Minimizar a contribuição marginal do risco de cada ativo para o risco total da carteira</li>
<li><strong>quadratic_utility</strong>: Maximizar a função de utilidade quadrática da carteira</li>
<li><strong>weight_concentration</strong>: Minimizar a concentração dos pesos dos ativos na carteira</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Adiciona a função objetivo, que é maximizar o retorno médio esperado da carteira</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>port_spec <span class="ot">&lt;-</span> <span class="fu">add.objective</span>(port_spec, <span class="at">type =</span> <span class="st">"return"</span>, <span class="at">name =</span> <span class="st">"mean"</span>)</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Adiciona a função objetivo, que é minimizar o desvio padrão da carteira</span></span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>port_spec <span class="ot">&lt;-</span> <span class="fu">add.objective</span>(port_spec, <span class="at">type =</span> <span class="st">"risk"</span>, <span class="at">name =</span> <span class="st">"StdDev"</span>)</span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Adiciona um objetivo para minimizar a contribuição marginal do risco de cada ativo para o risco total da carteira</span></span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a>port_spec <span class="ot">&lt;-</span> <span class="fu">add.objective</span>(port_spec, <span class="at">type =</span> <span class="st">"risk_budget"</span>, <span class="at">name =</span> <span class="st">"var"</span>, <span class="at">min_prisk =</span> <span class="fl">0.05</span>, <span class="at">max_prisk =</span> <span class="fl">0.1</span>)</span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(port_spec)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>**************************************************
PortfolioAnalytics Portfolio Specification 
**************************************************

Call:
portfolio.spec(assets = colnames(asset_returns_xts))

Number of assets: 5 
Asset Names
[1] "VALE3.SA" "PETR4.SA" "AZUL4.SA" "MGLU3.SA" "CMIG4.SA"

Constraints
Enabled constraint types
        - weight_sum 
        - box 

Objectives:
Enabled objective names
        - mean 
        - StdDev 
        - var </code></pre>
</div>
</div>
</section>
<section id="resolvendo-o-problema-de-otimização" class="level2">
<h2 class="anchored" data-anchor-id="resolvendo-o-problema-de-otimização">Resolvendo o problema de otimização</h2>
<p>Existem duas funções principais para resolver o problema de otimização da carteira: <code>optimize.portfolio()</code> e <code>optimize.portfolio.rebalancing()</code>. A função <code>optimize.portfolio()</code> é usada para otimizar a carteira sem rebalanceamento, enquanto a função <code>optimize.portfolio.rebalancing()</code> é usada para otimizar a carteira com rebalanceamento.</p>
<p>Lembre-se que o rebalanceamento é o processo de ajustar os pesos dos ativos na carteira para manter a alocação desejada ao longo do tempo.</p>
<p>O pacote suporta diversos métodos de otimização, como:</p>
<ul>
<li><strong>DEoptim</strong>: Differential Evolution</li>
<li><strong>random</strong>: Random Portfolios</li>
<li><strong>GenSA</strong>: Generalized Simulated Annealing</li>
<li><strong>pso</strong>: Particle Swarm Optimization</li>
<li><strong>ROI</strong>: R Optimization Infrastructure</li>
</ul>
<p>O método a ser usado irá depender do problema.</p>
<p>Vamos fazer fazer uma otimização usando o método de portifolios aleatórios. Nosso objetivo é maximizar o retorno esperado da carteira e minimizar o risco onde o risco minimo é 5% e o risco maximo é 10% sujeito a restrições de peso e de grupo.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co"># .storage &lt;&lt;- new.env()</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>rp <span class="ot">&lt;-</span> <span class="fu">random_portfolios</span>(port_spec, <span class="at">permutations =</span> <span class="dv">1000</span>, <span class="at">rp_method =</span> <span class="st">'simplex'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: executing %dopar% sequentially: no parallel backend registered</code></pre>
</div>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co"># rp &lt;- random_portfolios(port_spec, permutations = 1000, rp_method = 'sample')</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="co"># rp &lt;- random_portfolios(port_spec, permutations = 1000, rp_method = 'grid') </span></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(rp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        VALE3.SA  PETR4.SA  AZUL4.SA  MGLU3.SA  CMIG4.SA
  [1,] 0.2089505 0.1896753 0.3245342 0.1398775 0.1369627
  [2,] 0.2043223 0.2042920 0.1069130 0.2086187 0.2758540
  [3,] 0.2533984 0.1873023 0.1230938 0.2536222 0.1825833
  [4,] 0.2174764 0.2887529 0.2193919 0.1239582 0.1504207
  [5,] 0.2712863 0.1934513 0.1228296 0.1849327 0.2275001
  [6,] 0.2535869 0.2306946 0.1762151 0.2177348 0.1217686
  [7,] 0.3218483 0.2218455 0.1806175 0.1712163 0.1044724
  [8,] 0.3239940 0.1420282 0.1223811 0.1061791 0.3054177
  [9,] 0.2564097 0.1842998 0.2068090 0.2243272 0.1281543
 [10,] 0.2229653 0.2930324 0.1311023 0.2148440 0.1380561
 [11,] 0.3790379 0.1879465 0.1386561 0.1456753 0.1486841
 [12,] 0.2832781 0.1593667 0.1591891 0.1312537 0.2669125
 [13,] 0.2637003 0.1661370 0.1641422 0.3029690 0.1030516
 [14,] 0.3749924 0.1286400 0.1442429 0.2507696 0.1013550
 [15,] 0.3017938 0.1807950 0.1101722 0.1658281 0.2414110
 [16,] 0.2322386 0.1672834 0.2525799 0.1136631 0.2342350
 [17,] 0.2436313 0.1032691 0.1457349 0.2500165 0.2573481
 [18,] 0.2316410 0.2930038 0.1645625 0.1191614 0.1916314
 [19,] 0.2022671 0.2025682 0.1719524 0.1513900 0.2718223
 [20,] 0.3726608 0.1416822 0.1847889 0.1143924 0.1864757
 [21,] 0.2422277 0.1758002 0.1255960 0.1875300 0.2688461
 [22,] 0.2670436 0.2432800 0.1203013 0.1375126 0.2318625
 [23,] 0.2959150 0.1295771 0.3364117 0.1333364 0.1047598
 [24,] 0.2251189 0.2687641 0.1553679 0.1310280 0.2197211
 [25,] 0.3197887 0.1485519 0.1872463 0.1901720 0.1542410
 [26,] 0.2129089 0.2148436 0.1176786 0.3507572 0.1038118
 [27,] 0.2195698 0.2032039 0.1445551 0.1576839 0.2749873
 [28,] 0.2330727 0.1882215 0.1918560 0.2389925 0.1478573
 [29,] 0.3031339 0.1135884 0.2005930 0.2748944 0.1077904
 [30,] 0.2645196 0.1402509 0.2908913 0.1786338 0.1257045
 [31,] 0.2634871 0.1228360 0.2501510 0.1128302 0.2506957
 [32,] 0.2954529 0.1389202 0.2236613 0.2070768 0.1348888
 [33,] 0.3211852 0.1727435 0.1139574 0.2767499 0.1153640
 [34,] 0.2189044 0.1626546 0.2738256 0.2114635 0.1331520
 [35,] 0.2014029 0.1609090 0.2479508 0.1067842 0.2829531
 [36,] 0.2129366 0.1834915 0.2969869 0.1858543 0.1207308
 [37,] 0.2061005 0.1796991 0.1927373 0.2698422 0.1516210
 [38,] 0.3099373 0.2839222 0.1163279 0.1143065 0.1755061
 [39,] 0.3409129 0.2609767 0.1503960 0.1217351 0.1259792
 [40,] 0.3256725 0.1999144 0.1140233 0.1531230 0.2072667
 [41,] 0.2116175 0.1438849 0.1901860 0.3029707 0.1513408
 [42,] 0.3047489 0.1700950 0.1465191 0.2432997 0.1353373
 [43,] 0.3682738 0.1116968 0.1100502 0.1754007 0.2345786
 [44,] 0.2256548 0.1153123 0.1549689 0.3004674 0.2035967
 [45,] 0.2842174 0.2205216 0.1452878 0.1089446 0.2410286
 [46,] 0.2137430 0.2726171 0.2578180 0.1425963 0.1132255
 [47,] 0.2126260 0.1040709 0.3861256 0.1789572 0.1182204
 [48,] 0.2085132 0.1700464 0.2802431 0.1302164 0.2109808
 [49,] 0.2398437 0.2245211 0.2704471 0.1019673 0.1632207
 [50,] 0.2072859 0.3567293 0.1043395 0.1892904 0.1423549
 [51,] 0.3391830 0.2236287 0.1070298 0.1835620 0.1465965
 [52,] 0.3395228 0.1783636 0.2222412 0.1240470 0.1358254
 [53,] 0.3183303 0.1238146 0.2467619 0.1809438 0.1301495
 [54,] 0.2525936 0.1154644 0.1311060 0.1128425 0.3879934
 [55,] 0.2223216 0.2288503 0.1475465 0.1977047 0.2035769
 [56,] 0.2562405 0.1364257 0.1352479 0.2811220 0.1909638
 [57,] 0.2815937 0.1128599 0.2291524 0.1354237 0.2409703
 [58,] 0.3944945 0.1161701 0.1412003 0.1768122 0.1713228
 [59,] 0.2389671 0.2421270 0.1225201 0.1109493 0.2854366
 [60,] 0.2458657 0.1765764 0.1416075 0.1660626 0.2698878
 [61,] 0.2414924 0.3695540 0.1615357 0.1238983 0.1035196
 [62,] 0.3494510 0.2061593 0.1318183 0.1932513 0.1193201
 [63,] 0.2377609 0.2294008 0.2367019 0.1007811 0.1953553
 [64,] 0.2444631 0.1927937 0.1437776 0.3025542 0.1164115
 [65,] 0.3279736 0.2082149 0.1661087 0.1508713 0.1468316
 [66,] 0.2098041 0.1160984 0.1701753 0.1381347 0.3657875
 [67,] 0.3429370 0.1123406 0.2466620 0.1650984 0.1329620
 [68,] 0.3623211 0.1201381 0.2682156 0.1189882 0.1303370
 [69,] 0.2659450 0.3083468 0.2088259 0.1022188 0.1146635
 [70,] 0.2547639 0.2621739 0.1309132 0.1405547 0.2115943
 [71,] 0.3007773 0.1465579 0.1172150 0.2945752 0.1408746
 [72,] 0.2788313 0.1437808 0.2686003 0.1994774 0.1093101
 [73,] 0.2440692 0.1670610 0.1000835 0.2362608 0.2525255
 [74,] 0.3040817 0.1122387 0.1268902 0.2202636 0.2365258
 [75,] 0.2146343 0.2255504 0.1387572 0.1073685 0.3136896
 [76,] 0.3100544 0.1246725 0.2708671 0.1386262 0.1557798
 [77,] 0.2947862 0.2154361 0.1284467 0.1946390 0.1666921
 [78,] 0.2536886 0.1082392 0.2161469 0.1240853 0.2978400
 [79,] 0.3559718 0.1820211 0.1962368 0.1474219 0.1183484
 [80,] 0.2440179 0.2207014 0.1282873 0.2990498 0.1079436
 [81,] 0.2431691 0.1568244 0.2657553 0.1405017 0.1937495
 [82,] 0.3150464 0.1446069 0.1854747 0.1570737 0.1977982
 [83,] 0.3084639 0.1287979 0.1919884 0.1940431 0.1767067
 [84,] 0.2158440 0.1292160 0.1987238 0.2359669 0.2202493
 [85,] 0.2023790 0.2463765 0.1202318 0.2443967 0.1866160
 [86,] 0.2687930 0.1408916 0.1406762 0.2699576 0.1796817
 [87,] 0.2078377 0.1518361 0.1292541 0.1348163 0.3762558
 [88,] 0.2193023 0.1694126 0.3022514 0.1266946 0.1823391
 [89,] 0.2708280 0.1423762 0.2230460 0.2635825 0.1001672
 [90,] 0.2386449 0.1482894 0.1104062 0.2179692 0.2846904
 [91,] 0.3117945 0.3743758 0.1013673 0.1117590 0.1007034
 [92,] 0.2001392 0.1810705 0.1003562 0.1879367 0.3304973
 [93,] 0.2275323 0.1735930 0.1051496 0.3278730 0.1658521
 [94,] 0.2022919 0.3673558 0.2069675 0.1043074 0.1190774
 [95,] 0.2286463 0.2703987 0.1579473 0.2382805 0.1047273
 [96,] 0.2704633 0.1740530 0.1147090 0.1719110 0.2688637
 [97,] 0.3438515 0.2438448 0.1629700 0.1491399 0.1001938
 [98,] 0.2648160 0.1329388 0.1327419 0.1091290 0.3603744
 [99,] 0.3003006 0.1631873 0.1010016 0.1419454 0.2935652
[100,] 0.2088354 0.1384849 0.2979110 0.1015870 0.2531816
[101,] 0.2148524 0.1000834 0.1163191 0.2755818 0.2931632
[102,] 0.2078240 0.3911137 0.1325755 0.1028694 0.1656174
[103,] 0.2092928 0.1163384 0.1075336 0.3839730 0.1828621
[104,] 0.2862369 0.1272008 0.1104909 0.1014715 0.3745999
[105,] 0.2160811 0.1518159 0.1059083 0.1690934 0.3571012
[106,] 0.3408732 0.1057959 0.1080322 0.3029214 0.1423773
[107,] 0.2406488 0.2856538 0.1037272 0.1127258 0.2572445
[108,] 0.2053163 0.3399752 0.1258299 0.1081118 0.2207669
[109,] 0.3621778 0.1266423 0.1860307 0.1918974 0.1332518
[110,] 0.2112405 0.1799826 0.1867086 0.2985317 0.1235366
[111,] 0.2339358 0.1132077 0.3970627 0.1504074 0.1053863
[112,] 0.2944153 0.1156969 0.2584640 0.2188103 0.1126135
[113,] 0.2000133 0.1251012 0.2481038 0.1003114 0.3264703
[114,] 0.2003201 0.1546398 0.1739796 0.3481383 0.1229221
[115,] 0.2928173 0.3597807 0.1020474 0.1015718 0.1437827
[116,] 0.2048012 0.1017104 0.1220418 0.3931570 0.1782897
[117,] 0.2185333 0.1026306 0.1047704 0.1766346 0.3974311
[118,] 0.2002007 0.3434408 0.2307565 0.1245605 0.1010415
[119,] 0.3268779 0.1570819 0.2533692 0.1000391 0.1626319
[120,] 0.2005718 0.1387129 0.3563309 0.1072039 0.1971805
[121,] 0.2126632 0.2236830 0.3317411 0.1000309 0.1318818
[122,] 0.3766735 0.2393919 0.1004507 0.1636820 0.1198019
[123,] 0.3828619 0.2458228 0.1056863 0.1580267 0.1076022
[124,] 0.3835949 0.1579161 0.2409307 0.1054537 0.1121047
[125,] 0.3217419 0.1415688 0.1002322 0.2456494 0.1908077
[126,] 0.3610270 0.1004617 0.1175268 0.2699466 0.1510379
[127,] 0.3285503 0.1052068 0.2977460 0.1601517 0.1083453
[128,] 0.2669020 0.2547772 0.1006763 0.2408473 0.1367972
[129,] 0.3007706 0.1341874 0.1002999 0.3463110 0.1184311
[130,] 0.2003264 0.1070452 0.1011507 0.3190667 0.2724110
[131,] 0.3693767 0.1029880 0.1638342 0.2417662 0.1220349
[132,] 0.2270273 0.1113376 0.1106163 0.3803153 0.1707036
[133,] 0.2107060 0.2424239 0.1035758 0.1008453 0.3424490
[134,] 0.3377859 0.2187405 0.1321035 0.2094632 0.1019069
[135,] 0.2124122 0.2457598 0.2626721 0.1000053 0.1791506
[136,] 0.3788259 0.1291936 0.1455421 0.1018105 0.2446279
[137,] 0.3723504 0.1012847 0.2814506 0.1357490 0.1091654
[138,] 0.2160935 0.1372666 0.1000001 0.2538585 0.2927813
[139,] 0.2014541 0.1280041 0.1241071 0.2208699 0.3255648
[140,] 0.2013555 0.1997704 0.1095076 0.1003437 0.3890229
[141,] 0.2576515 0.3633273 0.1001788 0.1061810 0.1726615
[142,] 0.3041450 0.1052342 0.3510386 0.1128288 0.1267533
[143,] 0.2205299 0.1004835 0.1960813 0.1041317 0.3787736
[144,] 0.2846284 0.1195314 0.2371527 0.2540554 0.1046321
[145,] 0.3415019 0.3224239 0.1248299 0.1096655 0.1015788
[146,] 0.2135993 0.2022545 0.1056162 0.3780872 0.1004429
[147,] 0.3497533 0.1225131 0.1826620 0.1368556 0.2082161
[148,] 0.2022926 0.1077956 0.1890124 0.2688392 0.2320602
[149,] 0.2411940 0.1147458 0.2243254 0.3197346 0.1000002
[150,] 0.2327556 0.2770551 0.1075399 0.2488076 0.1338418
[151,] 0.2114965 0.1179510 0.1008336 0.2071324 0.3625865
[152,] 0.2246728 0.1728675 0.1002595 0.1497157 0.3524845
[153,] 0.2447794 0.1494581 0.1019513 0.1466384 0.3571728
[154,] 0.3732937 0.2732777 0.1332063 0.1202220 0.1000003
[155,] 0.2055977 0.2555314 0.3313009 0.1000016 0.1075684
[156,] 0.2094119 0.1469424 0.2209737 0.3220879 0.1005840
[157,] 0.3170117 0.1003661 0.3826198 0.1000022 0.1000002
[158,] 0.2755261 0.1299743 0.1000075 0.1132086 0.3812835
[159,] 0.2004864 0.1092287 0.3440610 0.1000157 0.2462082
[160,] 0.2002781 0.1012399 0.2422010 0.1052801 0.3510009
[161,] 0.2108311 0.3259363 0.1000911 0.1010616 0.2620799
[162,] 0.2009357 0.1473774 0.1556806 0.3919036 0.1041027
[163,] 0.2062451 0.1001045 0.2953947 0.1000104 0.2982452
[164,] 0.2734491 0.1020302 0.3069016 0.2163082 0.1013109
[165,] 0.2000000 0.1034125 0.2188011 0.1000005 0.3777859
[166,] 0.3469933 0.3503489 0.1024048 0.1000832 0.1001698
[167,] 0.2841236 0.1168681 0.1032722 0.3946465 0.1010896
[168,] 0.2304378 0.2276630 0.1025453 0.1000039 0.3393501
[169,] 0.2000094 0.3349509 0.2641603 0.1008712 0.1000081
[170,] 0.3796810 0.1000015 0.1021287 0.3001383 0.1180505
[171,] 0.3113864 0.1001827 0.3635731 0.1243883 0.1004694
[172,] 0.2360781 0.2930988 0.1000037 0.2599052 0.1109143
[173,] 0.2271915 0.2178653 0.1000000 0.1003342 0.3546090
[174,] 0.3009063 0.1000331 0.1119920 0.3827384 0.1043303
[175,] 0.2246553 0.1000152 0.2547723 0.1008759 0.3196813
[176,] 0.3260028 0.2603860 0.1019930 0.1198008 0.1918173
[177,] 0.3856144 0.1000440 0.3140804 0.1000348 0.1002265
[178,] 0.2016580 0.1088904 0.1000000 0.2515403 0.3379112
[179,] 0.2571714 0.1030452 0.2501600 0.2894522 0.1001713
[180,] 0.3140776 0.3818633 0.1035126 0.1005323 0.1000142
[181,] 0.3711136 0.1008503 0.1885270 0.1967056 0.1428034
[182,] 0.2103387 0.1013247 0.1941706 0.3941660 0.1000000
[183,] 0.3951077 0.2950716 0.1071639 0.1026568 0.1000000
[184,] 0.2001611 0.2244042 0.3751400 0.1000000 0.1002946
[185,] 0.2000012 0.1004204 0.3940503 0.1000000 0.2055281
[186,] 0.2000083 0.1000000 0.1000121 0.2622764 0.3377032
[187,] 0.2006060 0.3636887 0.1000000 0.1000058 0.2356994
[188,] 0.2002012 0.1000001 0.2970044 0.1000000 0.3027943
[189,] 0.3025398 0.3974326 0.1000274 0.1000000 0.1000001
[190,] 0.2000000 0.3687818 0.2312145 0.1000037 0.1000000
[191,] 0.3236323 0.1050650 0.3639614 0.1000000 0.1073413
[192,] 0.3186302 0.1016125 0.1000000 0.3430353 0.1367220
[193,] 0.3777066 0.1000000 0.1000249 0.3204750 0.1017934
[194,] 0.2081001 0.3320383 0.1000000 0.2591203 0.1007413
[195,] 0.2000000 0.1000003 0.1000000 0.3890866 0.2109131
[196,] 0.2033390 0.1000000 0.2315764 0.1000042 0.3650804
[197,] 0.3793412 0.1000000 0.3203254 0.1003320 0.1000014
[198,] 0.3716559 0.1000000 0.3283438 0.1000000 0.1000003
[199,] 0.2000138 0.1003969 0.1000000 0.2153298 0.3842594
[200,] 0.2580809 0.3810636 0.1000038 0.1573630 0.1034887
[201,] 0.2211839 0.1000601 0.2461358 0.3326201 0.1000002
[202,] 0.2000000 0.1000013 0.1212883 0.3755705 0.2031400
[203,] 0.2000000 0.3092252 0.1000000 0.2876297 0.1031450
[204,] 0.2003121 0.3664054 0.1000009 0.2329260 0.1003556
[205,] 0.3575200 0.1000000 0.1000000 0.3424639 0.1000160
[206,] 0.2003313 0.3718348 0.1000000 0.2278312 0.1000028
[207,] 0.2000000 0.2171593 0.3819550 0.1000000 0.1008857
[208,] 0.3594082 0.1000000 0.3405913 0.1000005 0.1000000
[209,] 0.3023630 0.3687129 0.1000000 0.1000624 0.1288617
[210,] 0.3444281 0.1000000 0.3555719 0.1000000 0.1000000
[211,] 0.2000000 0.3216746 0.1000000 0.2782753 0.1000501
[212,] 0.2000000 0.1000000 0.2884264 0.1000000 0.3115736
[213,] 0.3187185 0.1000000 0.1000000 0.3812815 0.1000000
[214,] 0.3220286 0.1000000 0.3779714 0.1000000 0.1000000</code></pre>
</div>
</div>
<p>Simplex: Distribui pesos aleatoriamente em um espaço triangular, garantindo que a soma seja sempre 1. Sample: Seleciona pesos aleatórios de uma distribuição de probabilidade específica. Grid: Gera pesos em pontos pré-definidos de uma grade regular.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>opt  <span class="ot">&lt;-</span>  <span class="fu">optimize.portfolio</span>(<span class="at">R =</span> asset_returns_xts, port_spec, <span class="at">rp =</span> rp, <span class="at">optimize_method =</span> <span class="st">"random"</span>, <span class="at">trace =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Leverage constraint min_sum and max_sum are restrictive, 
              consider relaxing. e.g. 'full_investment' constraint should be min_sum=0.99 and max_sum=1.01</code></pre>
</div>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(opt)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>***********************************
PortfolioAnalytics Optimization
***********************************

Call:
optimize.portfolio(R = asset_returns_xts, portfolio = port_spec, 
    optimize_method = "random", trace = TRUE, rp = rp)

Optimal Weights:
VALE3.SA PETR4.SA AZUL4.SA MGLU3.SA CMIG4.SA 
  0.2755   0.1300   0.1000   0.1132   0.3813 

Objective Measures:
   mean 
0.01474 


 StdDev 
0.08328 

contribution :
VALE3.SA PETR4.SA AZUL4.SA MGLU3.SA CMIG4.SA 
 0.01361  0.01082  0.01648  0.01376  0.02861 

pct_contrib_StdDev :
VALE3.SA PETR4.SA AZUL4.SA MGLU3.SA CMIG4.SA 
  0.1634   0.1299   0.1979   0.1652   0.3436 </code></pre>
</div>
</div>
</section>
<section id="otimizando-a-carteira-com-rebalanceamento" class="level2">
<h2 class="anchored" data-anchor-id="otimizando-a-carteira-com-rebalanceamento">Otimizando a carteira com rebalanceamento</h2>
<p>A função <code>optimize.portfolio.rebalancing()</code> é usada para otimizar a carteira com rebalanceamento. O rebalanceamento é o processo de ajustar os pesos dos ativos na carteira para manter a alocação desejada ao longo do tempo. O rebalanceamento é importante para garantir que a carteira permaneça alinhada com os objetivos de investimento (restrições e objetivos) ao longo do tempo.</p>
<p><code>optimize.portfolio.rebalancing()</code> suporta otimização de carteiras com rebalanceamento em diferentes janelas de tempo. O backtest é o processo de testar uma estratégia de investimento em dados históricos para avaliar seu desempenho.</p>
<p>OBS: Dependendo do método de otimização, o processo pode ser demorado.</p>
<p>Exemplo de otimização com rebalanceamento:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Criar o objeto de portfólio</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>port_specr <span class="ot">&lt;-</span> <span class="fu">portfolio.spec</span>(<span class="at">assets =</span> <span class="fu">colnames</span>(asset_returns_xts))</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Adicionar restrições - full investment com soma de pesos igual a 1</span></span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>port_specr <span class="ot">&lt;-</span> <span class="fu">add.constraint</span>(port_specr, <span class="at">type =</span> <span class="st">"long_only"</span>)</span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a><span class="co"># restrição para a soma dos pesos</span></span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a>port_specr <span class="ot">&lt;-</span> <span class="fu">add.constraint</span>(port_specr, <span class="at">type =</span> <span class="st">"weight_sum"</span>, <span class="at">min_sum =</span> <span class="fl">0.99</span>, <span class="at">max_sum =</span> <span class="fl">1.01</span>)</span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-12"><a href="#cb37-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Adicionar a função objetivo - maximizar o retorno esperado</span></span>
<span id="cb37-13"><a href="#cb37-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-14"><a href="#cb37-14" aria-hidden="true" tabindex="-1"></a>port_specr <span class="ot">&lt;-</span> <span class="fu">add.objective</span>(port_specr, <span class="at">type =</span> <span class="st">"return"</span>, <span class="at">name =</span> <span class="st">"mean"</span>)</span>
<span id="cb37-15"><a href="#cb37-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-16"><a href="#cb37-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Adicionar a função objetivo - minimizar o risco</span></span>
<span id="cb37-17"><a href="#cb37-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-18"><a href="#cb37-18" aria-hidden="true" tabindex="-1"></a>port_specr <span class="ot">&lt;-</span> <span class="fu">add.objective</span>(port_specr, <span class="at">type =</span> <span class="st">"risk"</span>, <span class="at">name =</span> <span class="st">"StdDev"</span>)</span>
<span id="cb37-19"><a href="#cb37-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-20"><a href="#cb37-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Adicionar a função objetivo - minimizar a contribuição marginal do risco de cada ativo para o risco total da carteira</span></span>
<span id="cb37-21"><a href="#cb37-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-22"><a href="#cb37-22" aria-hidden="true" tabindex="-1"></a>port_specr <span class="ot">&lt;-</span> <span class="fu">add.objective</span>(port_specr, <span class="at">type =</span> <span class="st">"risk_budget"</span>, <span class="at">name =</span> <span class="st">"StdDev"</span>, <span class="at">min_prisk =</span> <span class="fl">0.05</span>, <span class="at">max_prisk =</span> <span class="fl">0.1</span>)</span>
<span id="cb37-23"><a href="#cb37-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-24"><a href="#cb37-24" aria-hidden="true" tabindex="-1"></a>rp <span class="ot">&lt;-</span> <span class="fu">random_portfolios</span>(port_specr, <span class="at">permutations =</span> <span class="dv">50</span>, <span class="at">rp_method =</span> <span class="st">'simplex'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="otimização" class="level2">
<h2 class="anchored" data-anchor-id="otimização">Otimização</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Otimização com rebalanceamento mensal</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>opt_rebal <span class="ot">&lt;-</span> <span class="fu">optimize.portfolio.rebalancing</span>(<span class="at">R =</span> asset_returns_xts, </span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>                      <span class="at">portfolio =</span> port_specr, </span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>                      <span class="at">optimize_method =</span> <span class="st">"random"</span>,</span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>                      <span class="at">rp =</span> rp,</span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a>                      <span class="at">trace =</span> <span class="cn">TRUE</span>,</span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a>                      <span class="at">search_size =</span> <span class="dv">1000</span>,</span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a>                      <span class="at">rebalance_on =</span> <span class="st">"months"</span>,</span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a>                      <span class="at">training_period =</span> <span class="dv">12</span>,</span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a>                      <span class="at">rolling_window =</span> <span class="dv">12</span>)</span>
<span id="cb38-12"><a href="#cb38-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-13"><a href="#cb38-13" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(opt_rebal)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>**************************************************
PortfolioAnalytics Optimization with Rebalancing
**************************************************

Call:
optimize.portfolio.rebalancing(R = asset_returns_xts, portfolio = port_specr, 
    optimize_method = "random", search_size = 1000, trace = TRUE, 
    rp = rp, rebalance_on = "months", training_period = 12, rolling_window = 12)

Number of rebalancing dates:  49 
First rebalance date:
[1] "2020-05-31"
Last rebalance date:
[1] "2024-05-31"

Annualized Portfolio Rebalancing Return:
[1] 0.09741241

Annualized Portfolio Standard Deviation:
[1] 0.290587</code></pre>
</div>
</div>
</section>
<section id="analise-dos-resultados" class="level2">
<h2 class="anchored" data-anchor-id="analise-dos-resultados">Analise dos resultados</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="fu">extractObjectiveMeasures</span>(opt_rebal)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                    mean     StdDev StdDev.contribution.VALE3.SA
2020-05-31  0.0097181966 0.10984877                  0.017072679
2020-06-30  0.0164759658 0.10795771                  0.016846266
2020-07-31  0.0177288008 0.10856870                  0.017345975
2020-08-31  0.0164936306 0.10853665                  0.017559902
2020-09-30  0.0170231678 0.10837384                  0.016551101
2020-10-31  0.0153513953 0.10825444                  0.016474354
2020-11-30  0.0332593794 0.13016030                  0.027625668
2020-12-31  0.0414077801 0.13169174                  0.028485769
2021-01-31  0.0344669070 0.13197962                  0.028529816
2021-02-28  0.0303704375 0.13342929                  0.027497245
2021-03-31  0.0531643530 0.10258306                  0.032893357
2021-04-30  0.0723543704 0.07230702                  0.032005713
2021-05-31  0.0676919947 0.07077144                  0.034236404
2021-06-30  0.0438771851 0.06085068                  0.014269858
2021-07-31  0.0344517992 0.06370632                  0.016785336
2021-08-31  0.0250475034 0.06378887                  0.019393219
2021-09-30  0.0197913819 0.09100418                  0.010615556
2021-10-31  0.0099800128 0.10208433                  0.011043364
2021-11-30  0.0038464931 0.10434854                  0.011205274
2021-12-31  0.0008755856 0.06567743                  0.022789918
2022-01-31 -0.0035040539 0.05915060                  0.020025935
2022-02-28 -0.0013752803 0.05930832                  0.021013851
2022-03-31 -0.0084409431 0.06899576                  0.005955588
2022-04-30 -0.0165462008 0.07557684                  0.007478636
2022-05-31 -0.0057800162 0.06820773                  0.024200866
2022-06-30 -0.0257106206 0.07593119                  0.025362415
2022-07-31 -0.0233503499 0.07747860                  0.022979187
2022-08-31 -0.0051834804 0.09631281                  0.017970828
2022-09-30 -0.0045769275 0.09629385                  0.017861444
2022-10-31  0.0013791638 0.09373330                  0.014968250
2022-11-30  0.0119590223 0.08743259                  0.014792613
2022-12-31  0.0116955491 0.08759806                  0.013738815
2023-01-31  0.0181830759 0.09409775                  0.012997922
2023-02-28  0.0037850767 0.10181943                  0.016583267
2023-03-31  0.0075329683 0.10317226                  0.015225997
2023-04-30  0.0006471459 0.10012083                  0.013843442
2023-05-31  0.0126461874 0.09559294                  0.009090564
2023-06-30  0.0184848936 0.09738082                  0.009377839
2023-07-31  0.0235706709 0.06330341                  0.032336586
2023-08-31  0.0256161152 0.08256449                  0.004596109
2023-09-30  0.0110770482 0.06694667                  0.008128517
2023-10-31  0.0057798689 0.07082673                  0.007825321
2023-11-30  0.0168059561 0.08027917                  0.009811045
2023-12-31  0.0127336826 0.06248417                  0.023164594
2024-01-31  0.0179722263 0.08106221                  0.012938360
2024-02-29  0.0008667443 0.05751552                  0.025772343
2024-03-31  0.0153248399 0.06032568                  0.007808823
2024-04-30  0.0061682477 0.04771068                  0.024580943
2024-05-31  0.0061987658 0.04769482                  0.022603711
           StdDev.contribution.PETR4.SA StdDev.contribution.AZUL4.SA
2020-05-31                  0.029967356                  0.018672103
2020-06-30                  0.028618178                  0.020681469
2020-07-31                  0.028275640                  0.020269858
2020-08-31                  0.028374382                  0.020013099
2020-09-30                  0.028744285                  0.019551664
2020-10-31                  0.028571338                  0.019471904
2020-11-30                  0.032817356                  0.028695817
2020-12-31                  0.033372790                  0.028385347
2021-01-31                  0.033557111                  0.028091501
2021-02-28                  0.034446144                  0.027846840
2021-03-31                  0.017683844                  0.016022610
2021-04-30                  0.011541247                  0.008147965
2021-05-31                  0.010257425                  0.008738180
2021-06-30                  0.015197764                  0.005259727
2021-07-31                  0.016090224                  0.005097168
2021-08-31                  0.015545753                  0.005522845
2021-09-30                  0.028863065                  0.032920692
2021-10-31                  0.025969295                  0.038648269
2021-11-30                  0.024847555                  0.038795686
2021-12-31                  0.010058269                  0.008905973
2022-01-31                  0.009580826                  0.010909929
2022-02-28                  0.009398226                  0.010631798
2022-03-31                  0.008560720                  0.019681952
2022-04-30                  0.009572742                  0.019046412
2022-05-31                  0.006763918                  0.009530848
2022-06-30                  0.007613290                  0.012561016
2022-07-31                  0.009337263                  0.012143270
2022-08-31                  0.011096026                  0.018942900
2022-09-30                  0.011080951                  0.018951769
2022-10-31                  0.010749432                  0.019569503
2022-11-30                  0.010117098                  0.016974801
2022-12-31                  0.011570865                  0.017198691
2023-01-31                  0.011013348                  0.017120007
2023-02-28                  0.010714228                  0.019237701
2023-03-31                  0.009769702                  0.023031107
2023-04-30                  0.010458500                  0.024035158
2023-05-31                  0.010789864                  0.026631428
2023-06-30                  0.012414204                  0.027637052
2023-07-31                  0.004477841                  0.005570898
2023-08-31                  0.009841591                  0.025314521
2023-09-30                  0.005841185                  0.022742589
2023-10-31                  0.005697474                  0.022798254
2023-11-30                  0.005773155                  0.024442655
2023-12-31                  0.004066652                  0.008361911
2024-01-31                  0.003827667                  0.024685294
2024-02-29                  0.003064821                  0.009814141
2024-03-31                  0.003285046                  0.022440232
2024-04-30                  0.002940122                  0.005336520
2024-05-31                  0.004090978                  0.005224537
           StdDev.contribution.MGLU3.SA StdDev.contribution.CMIG4.SA
2020-05-31                  0.020208335                  0.023928298
2020-06-30                  0.019022487                  0.022789309
2020-07-31                  0.019208543                  0.023468687
2020-08-31                  0.018989888                  0.023599381
2020-09-30                  0.019485775                  0.024041019
2020-10-31                  0.019634076                  0.024102768
2020-11-30                  0.012967244                  0.028054212
2020-12-31                  0.012617700                  0.028830133
2021-01-31                  0.012916481                  0.028884714
2021-02-28                  0.013637797                  0.030001263
2021-03-31                  0.024789278                  0.011193971
2021-04-30                  0.013997333                  0.006614759
2021-05-31                  0.010957728                  0.006581702
2021-06-30                  0.010026146                  0.016097187
2021-07-31                  0.009316325                  0.016417266
2021-08-31                  0.009281765                  0.014045286
2021-09-30                  0.007809681                  0.010795187
2021-10-31                  0.014763582                  0.011659817
2021-11-30                  0.017924838                  0.011575185
2021-12-31                  0.011183983                  0.012739288
2022-01-31                  0.009379916                  0.009253991
2022-02-28                  0.009390548                  0.008873900
2022-03-31                  0.027591056                  0.007206444
2022-04-30                  0.031649258                  0.007829796
2022-05-31                  0.015216084                  0.012496019
2022-06-30                  0.017669742                  0.012724726
2022-07-31                  0.018789507                  0.014229374
2022-08-31                  0.035627059                  0.012675995
2022-09-30                  0.035621637                  0.012778045
2022-10-31                  0.035065922                  0.013380195
2022-11-30                  0.033843862                  0.011704215
2022-12-31                  0.033274207                  0.011815480
2023-01-31                  0.042042504                  0.010923968
2023-02-28                  0.042311807                  0.012972431
2023-03-31                  0.041401479                  0.013743971
2023-04-30                  0.041110752                  0.010672982
2023-05-31                  0.039585102                  0.009495983
2023-06-30                  0.037335810                  0.010615911
2023-07-31                  0.015662501                  0.005255582
2023-08-31                  0.034405278                  0.008406987
2023-09-30                  0.022641131                  0.007593246
2023-10-31                  0.026275143                  0.008230536
2023-11-30                  0.034860323                  0.005391997
2023-12-31                  0.021480553                  0.005410458
2024-01-31                  0.033664745                  0.005946146
2024-02-29                  0.013297011                  0.005567205
2024-03-31                  0.024536132                  0.002255449
2024-04-30                  0.013510420                  0.001342671
2024-05-31                  0.013992154                  0.001783439
           StdDev.pct_contrib_StdDev.VALE3.SA
2020-05-31                         0.15541984
2020-06-30                         0.15604505
2020-07-31                         0.15976957
2020-08-31                         0.16178776
2020-09-30                         0.15272228
2020-10-31                         0.15218179
2020-11-30                         0.21224343
2020-12-31                         0.21630642
2021-01-31                         0.21616834
2021-02-28                         0.20608103
2021-03-31                         0.32065096
2021-04-30                         0.44263633
2021-05-31                         0.48376018
2021-06-30                         0.23450613
2021-07-31                         0.26347992
2021-08-31                         0.30402200
2021-09-30                         0.11664910
2021-10-31                         0.10817884
2021-11-30                         0.10738314
2021-12-31                         0.34699771
2022-01-31                         0.33855846
2022-02-28                         0.35431538
2022-03-31                         0.08631817
2022-04-30                         0.09895407
2022-05-31                         0.35481116
2022-06-30                         0.33401840
2022-07-31                         0.29658753
2022-08-31                         0.18658814
2022-09-30                         0.18548894
2022-10-31                         0.15968977
2022-11-30                         0.16918878
2022-12-31                         0.15683927
2023-01-31                         0.13813212
2023-02-28                         0.16286937
2023-03-31                         0.14757841
2023-04-30                         0.13826735
2023-05-31                         0.09509660
2023-06-30                         0.09630068
2023-07-31                         0.51081904
2023-08-31                         0.05566690
2023-09-30                         0.12141779
2023-10-31                         0.11048542
2023-11-30                         0.12221158
2023-12-31                         0.37072742
2024-01-31                         0.15961025
2024-02-29                         0.44809371
2024-03-31                         0.12944443
2024-04-30                         0.51520845
2024-05-31                         0.47392383
           StdDev.pct_contrib_StdDev.PETR4.SA
2020-05-31                         0.27280557
2020-06-30                         0.26508693
2020-07-31                         0.26044006
2020-08-31                         0.26142673
2020-09-30                         0.26523268
2020-10-31                         0.26392763
2020-11-30                         0.25213031
2020-12-31                         0.25341597
2021-01-31                         0.25425979
2021-02-28                         0.25816029
2021-03-31                         0.17238561
2021-04-30                         0.15961448
2021-05-31                         0.14493735
2021-06-30                         0.24975504
2021-07-31                         0.25256872
2021-08-31                         0.24370636
2021-09-30                         0.31716196
2021-10-31                         0.25439061
2021-11-30                         0.23812078
2021-12-31                         0.15314650
2022-01-31                         0.16197344
2022-02-28                         0.15846386
2022-03-31                         0.12407603
2022-04-30                         0.12666237
2022-05-31                         0.09916644
2022-06-30                         0.10026565
2022-07-31                         0.12051409
2022-08-31                         0.11520821
2022-09-30                         0.11507434
2022-10-31                         0.11468103
2022-11-30                         0.11571312
2022-12-31                         0.13209043
2023-01-31                         0.11704156
2023-02-28                         0.10522773
2023-03-31                         0.09469311
2023-04-30                         0.10445878
2023-05-31                         0.11287302
2023-06-30                         0.12748100
2023-07-31                         0.07073618
2023-08-31                         0.11919884
2023-09-30                         0.08725132
2023-10-31                         0.08044243
2023-11-30                         0.07191348
2023-12-31                         0.06508291
2024-01-31                         0.04721888
2024-02-29                         0.05328685
2024-03-31                         0.05445518
2024-04-30                         0.06162398
2024-05-31                         0.08577405
           StdDev.pct_contrib_StdDev.AZUL4.SA
2020-05-31                         0.16998008
2020-06-30                         0.19157010
2020-07-31                         0.18670075
2020-08-31                         0.18439024
2020-09-30                         0.18040943
2020-10-31                         0.17987164
2020-11-30                         0.22046521
2020-12-31                         0.21554387
2021-01-31                         0.21284726
2021-02-28                         0.20870110
2021-03-31                         0.15619158
2021-04-30                         0.11268567
2021-05-31                         0.12347043
2021-06-30                         0.08643661
2021-07-31                         0.08001039
2021-08-31                         0.08658007
2021-09-30                         0.36174923
2021-10-31                         0.37859160
2021-11-30                         0.37178946
2021-12-31                         0.13560173
2022-01-31                         0.18444326
2022-02-28                         0.17926318
2022-03-31                         0.28526321
2022-04-30                         0.25201386
2022-05-31                         0.13973266
2022-06-30                         0.16542630
2022-07-31                         0.15673064
2022-08-31                         0.19668101
2022-09-30                         0.19681184
2022-10-31                         0.20877855
2022-11-30                         0.19414730
2022-12-31                         0.19633644
2023-01-31                         0.18193854
2023-02-28                         0.18893938
2023-03-31                         0.22322965
2023-04-30                         0.24006150
2023-05-31                         0.27859200
2023-06-30                         0.28380387
2023-07-31                         0.08800312
2023-08-31                         0.30660302
2023-09-30                         0.33971203
2023-10-31                         0.32188772
2023-11-30                         0.30447068
2023-12-31                         0.13382447
2024-01-31                         0.30452283
2024-02-29                         0.17063465
2024-03-31                         0.37198472
2024-04-30                         0.11185170
2024-05-31                         0.10954097
           StdDev.pct_contrib_StdDev.MGLU3.SA
2020-05-31                         0.18396505
2020-06-30                         0.17620314
2020-07-31                         0.17692523
2020-08-31                         0.17496290
2020-09-30                         0.17980146
2020-10-31                         0.18136970
2020-11-30                         0.09962519
2020-12-31                         0.09581239
2021-01-31                         0.09786723
2021-02-28                         0.10220992
2021-03-31                         0.24165080
2021-04-30                         0.19358195
2021-05-31                         0.15483263
2021-06-30                         0.16476637
2021-07-31                         0.14623864
2021-08-31                         0.14550759
2021-09-30                         0.08581673
2021-10-31                         0.14462144
2021-11-30                         0.17177853
2021-12-31                         0.17028655
2022-01-31                         0.15857687
2022-02-28                         0.15833441
2022-03-31                         0.39989496
2022-04-30                         0.41876925
2022-05-31                         0.22308443
2022-06-30                         0.23270730
2022-07-31                         0.24251221
2022-08-31                         0.36990988
2022-09-30                         0.36992641
2022-10-31                         0.37410313
2022-11-30                         0.38708522
2022-12-31                         0.37985097
2023-01-31                         0.44679607
2023-02-28                         0.41555728
2023-03-31                         0.40128500
2023-04-30                         0.41061136
2023-05-31                         0.41410068
2023-06-30                         0.38340005
2023-07-31                         0.24741955
2023-08-31                         0.41670796
2023-09-30                         0.33819654
2023-10-31                         0.37097779
2023-11-30                         0.43423868
2023-12-31                         0.34377593
2024-01-31                         0.41529516
2024-02-29                         0.23118996
2024-03-31                         0.40672780
2024-04-30                         0.28317393
2024-05-31                         0.29336843
           StdDev.pct_contrib_StdDev.CMIG4.SA
2020-05-31                         0.21782946
2020-06-30                         0.21109478
2020-07-31                         0.21616438
2020-08-31                         0.21743237
2020-09-30                         0.22183415
2020-10-31                         0.22264924
2020-11-30                         0.21553586
2020-12-31                         0.21892134
2021-01-31                         0.21885738
2021-02-28                         0.22484766
2021-03-31                         0.10912105
2021-04-30                         0.09148156
2021-05-31                         0.09299941
2021-06-30                         0.26453585
2021-07-31                         0.25770232
2021-08-31                         0.22018397
2021-09-30                         0.11862298
2021-10-31                         0.11421750
2021-11-30                         0.11092810
2021-12-31                         0.19396752
2022-01-31                         0.15644797
2022-02-28                         0.14962318
2022-03-31                         0.10444763
2022-04-30                         0.10360046
2022-05-31                         0.18320530
2022-06-30                         0.16758234
2022-07-31                         0.18365553
2022-08-31                         0.13161276
2022-09-30                         0.13269846
2022-10-31                         0.14274751
2022-11-30                         0.13386559
2022-12-31                         0.13488290
2023-01-31                         0.11609170
2023-02-28                         0.12740624
2023-03-31                         0.13321382
2023-04-30                         0.10660101
2023-05-31                         0.09933770
2023-06-30                         0.10901440
2023-07-31                         0.08302210
2023-08-31                         0.10182329
2023-09-30                         0.11342232
2023-10-31                         0.11620664
2023-11-30                         0.06716557
2023-12-31                         0.08658926
2024-01-31                         0.07335288
2024-02-29                         0.09679483
2024-03-31                         0.03738787
2024-04-30                         0.02814193
2024-05-31                         0.03739273</code></pre>
</div>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="fu">extractWeights</span>(opt_rebal)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>            VALE3.SA   PETR4.SA   AZUL4.SA   MGLU3.SA   CMIG4.SA
2020-05-31 0.3411540 0.18188887 0.11393046 0.15090054 0.21212614
2020-06-30 0.3411540 0.18188887 0.11393046 0.15090054 0.21212614
2020-07-31 0.3411540 0.18188887 0.11393046 0.15090054 0.21212614
2020-08-31 0.3411540 0.18188887 0.11393046 0.15090054 0.21212614
2020-09-30 0.3411540 0.18188887 0.11393046 0.15090054 0.21212614
2020-10-31 0.3411540 0.18188887 0.11393046 0.15090054 0.21212614
2020-11-30 0.3411540 0.18188887 0.11393046 0.15090054 0.21212614
2020-12-31 0.3411540 0.18188887 0.11393046 0.15090054 0.21212614
2021-01-31 0.3411540 0.18188887 0.11393046 0.15090054 0.21212614
2021-02-28 0.3411540 0.18188887 0.11393046 0.15090054 0.21212614
2021-03-31 0.4892272 0.09670369 0.07589495 0.25674309 0.08143103
2021-04-30 0.4892272 0.09670369 0.07589495 0.25674309 0.08143103
2021-05-31 0.4892272 0.09670369 0.07589495 0.25674309 0.08143103
2021-06-30 0.2687999 0.14836045 0.03645689 0.35846606 0.18791673
2021-07-31 0.2687999 0.14836045 0.03645689 0.35846606 0.18791673
2021-08-31 0.2687999 0.14836045 0.03645689 0.35846606 0.18791673
2021-09-30 0.1223362 0.26174873 0.18868095 0.28326383 0.14397033
2021-10-31 0.1223362 0.26174873 0.18868095 0.28326383 0.14397033
2021-11-30 0.1223362 0.26174873 0.18868095 0.28326383 0.14397033
2021-12-31 0.3411540 0.18188887 0.11393046 0.15090054 0.21212614
2022-01-31 0.3411540 0.18188887 0.11393046 0.15090054 0.21212614
2022-02-28 0.3411540 0.18188887 0.11393046 0.15090054 0.21212614
2022-03-31 0.1223362 0.26174873 0.18868095 0.28326383 0.14397033
2022-04-30 0.1223362 0.26174873 0.18868095 0.28326383 0.14397033
2022-05-31 0.3411540 0.18188887 0.11393046 0.15090054 0.21212614
2022-06-30 0.3411540 0.18188887 0.11393046 0.15090054 0.21212614
2022-07-31 0.3411540 0.18188887 0.11393046 0.15090054 0.21212614
2022-08-31 0.3411540 0.18188887 0.11393046 0.15090054 0.21212614
2022-09-30 0.3411540 0.18188887 0.11393046 0.15090054 0.21212614
2022-10-31 0.3411540 0.18188887 0.11393046 0.15090054 0.21212614
2022-11-30 0.3411540 0.18188887 0.11393046 0.15090054 0.21212614
2022-12-31 0.3411540 0.18188887 0.11393046 0.15090054 0.21212614
2023-01-31 0.3411540 0.18188887 0.11393046 0.15090054 0.21212614
2023-02-28 0.3411540 0.18188887 0.11393046 0.15090054 0.21212614
2023-03-31 0.3411540 0.18188887 0.11393046 0.15090054 0.21212614
2023-04-30 0.3411540 0.18188887 0.11393046 0.15090054 0.21212614
2023-05-31 0.3411540 0.18188887 0.11393046 0.15090054 0.21212614
2023-06-30 0.3411540 0.18188887 0.11393046 0.15090054 0.21212614
2023-07-31 0.5055466 0.14370521 0.05638194 0.09891039 0.19545585
2023-08-31 0.3411540 0.18188887 0.11393046 0.15090054 0.21212614
2023-09-30 0.3411540 0.18188887 0.11393046 0.15090054 0.21212614
2023-10-31 0.3411540 0.18188887 0.11393046 0.15090054 0.21212614
2023-11-30 0.3411540 0.18188887 0.11393046 0.15090054 0.21212614
2023-12-31 0.5055466 0.14370521 0.05638194 0.09891039 0.19545585
2024-01-31 0.3411540 0.18188887 0.11393046 0.15090054 0.21212614
2024-02-29 0.5055466 0.14370521 0.05638194 0.09891039 0.19545585
2024-03-31 0.3411540 0.18188887 0.11393046 0.15090054 0.21212614
2024-04-30 0.5055466 0.14370521 0.05638194 0.09891039 0.19545585
2024-05-31 0.5055466 0.14370521 0.05638194 0.09891039 0.19545585</code></pre>
</div>
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="fu">chart.Weights</span>(opt)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="aula_2_files/figure-html/unnamed-chunk-20-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="fu">chart.Weights</span>(opt_rebal)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="aula_2_files/figure-html/unnamed-chunk-20-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="plotando-os-pesos-ao-longo-do-tempo-com-ggplot2" class="level2">
<h2 class="anchored" data-anchor-id="plotando-os-pesos-ao-longo-do-tempo-com-ggplot2">Plotando os pesos ao longo do tempo com ggplot2</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Extraindo os pesos dos ativos ao longo do tempo</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>weights_xts <span class="ot">&lt;-</span> <span class="fu">extractWeights</span>(opt_rebal)</span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Convertendo os pesos para um data frame</span></span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a>weights_df <span class="ot">&lt;-</span> weights_xts <span class="sc">%&gt;%</span> </span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a>              <span class="fu">tk_tbl</span>(<span class="at">preserve_index =</span> <span class="cn">TRUE</span>, <span class="at">rename_index =</span> <span class="st">"Date"</span>)</span>
<span id="cb46-9"><a href="#cb46-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-10"><a href="#cb46-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-11"><a href="#cb46-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Colocando o data frame em formato longo</span></span>
<span id="cb46-12"><a href="#cb46-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-13"><a href="#cb46-13" aria-hidden="true" tabindex="-1"></a>weights_long_df <span class="ot">&lt;-</span> weights_df <span class="sc">%&gt;%</span> </span>
<span id="cb46-14"><a href="#cb46-14" aria-hidden="true" tabindex="-1"></a>                <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="sc">-</span>Date, <span class="at">names_to =</span> <span class="st">"Asset"</span>, <span class="at">values_to =</span> <span class="st">"Weight"</span>)</span>
<span id="cb46-15"><a href="#cb46-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-16"><a href="#cb46-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-17"><a href="#cb46-17" aria-hidden="true" tabindex="-1"></a>plotly<span class="sc">::</span><span class="fu">ggplotly</span>(<span class="fu">ggplot</span>(weights_long_df) <span class="sc">+</span></span>
<span id="cb46-18"><a href="#cb46-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x =</span> Date, <span class="at">y =</span> Weight, <span class="at">colour =</span> Asset) <span class="sc">+</span></span>
<span id="cb46-19"><a href="#cb46-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">se =</span> <span class="cn">FALSE</span> ) <span class="sc">+</span></span>
<span id="cb46-20"><a href="#cb46-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_hue</span>(<span class="at">direction =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb46-21"><a href="#cb46-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb46-22"><a href="#cb46-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Data"</span>,</span>
<span id="cb46-23"><a href="#cb46-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Peso"</span>,</span>
<span id="cb46-24"><a href="#cb46-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Peso dos ativos rebalanceados ao longo do tempo"</span>,</span>
<span id="cb46-25"><a href="#cb46-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">colour =</span> <span class="st">"Ativos"</span></span>
<span id="cb46-26"><a href="#cb46-26" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb46-27"><a href="#cb46-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb46-28"><a href="#cb46-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb46-29"><a href="#cb46-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">16</span>L,</span>
<span id="cb46-30"><a href="#cb46-30" aria-hidden="true" tabindex="-1"></a>    <span class="at">face =</span> <span class="st">"bold"</span>,</span>
<span id="cb46-31"><a href="#cb46-31" aria-hidden="true" tabindex="-1"></a>    <span class="at">hjust =</span> <span class="fl">0.5</span>)</span>
<span id="cb46-32"><a href="#cb46-32" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb46-33"><a href="#cb46-33" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`geom_smooth()` using method = 'loess' and formula = 'y ~ x'</code></pre>
</div>
<div class="cell-output-display">
<div class="plotly html-widget html-fill-item" id="htmlwidget-05064a0d9de555778d7d" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-05064a0d9de555778d7d">{"x":{"data":[{"x":[18413,18431.493670886077,18449.98734177215,18468.481012658227,18486.974683544304,18505.468354430381,18523.962025316454,18542.455696202531,18560.949367088608,18579.443037974685,18597.936708860758,18616.430379746835,18634.924050632912,18653.417721518988,18671.911392405062,18690.405063291139,18708.898734177215,18727.392405063292,18745.886075949365,18764.379746835442,18782.873417721519,18801.367088607596,18819.860759493669,18838.354430379746,18856.848101265823,18875.3417721519,18893.835443037973,18912.32911392405,18930.822784810127,18949.316455696204,18967.810126582277,18986.303797468354,19004.797468354431,19023.291139240508,19041.784810126581,19060.278481012658,19078.772151898735,19097.265822784811,19115.759493670885,19134.253164556962,19152.746835443038,19171.240506329115,19189.734177215189,19208.227848101265,19226.721518987342,19245.215189873419,19263.708860759492,19282.202531645569,19300.696202531646,19319.189873417723,19337.683544303796,19356.177215189873,19374.67088607595,19393.164556962027,19411.6582278481,19430.151898734177,19448.645569620254,19467.139240506331,19485.632911392404,19504.126582278481,19522.620253164558,19541.113924050635,19559.607594936708,19578.101265822785,19596.594936708861,19615.088607594938,19633.582278481012,19652.075949367088,19670.569620253165,19689.063291139242,19707.556962025315,19726.050632911392,19744.544303797469,19763.037974683546,19781.531645569619,19800.025316455696,19818.518987341773,19837.012658227846,19855.506329113923,19874],"y":[0.11833158660299978,0.11614166707946885,0.1140858550024571,0.11217136859327985,0.11040542607325356,0.10879524566369431,0.1073480455859185,0.10607104406124164,0.10497145931098009,0.10405650955644999,0.10333384373153566,0.10284932813962376,0.10260762458642761,0.10257666823075923,0.10272439423143054,0.10301873774725354,0.10342763393704023,0.10391901795960257,0.10446082497375238,0.10502099013830189,0.10558889941787482,0.10654202192222258,0.10794996528268645,0.10970823890252762,0.1117123521850064,0.11385781453338333,0.1160401353509186,0.11815482404087364,0.12009739000650854,0.12176334265108392,0.12310515251618488,0.12463367045930297,0.12641155794553741,0.12833378518679187,0.13029532239496966,0.13219113978197536,0.13391620755971223,0.13536549594008399,0.13643397513499417,0.1370166153563469,0.13696485494585911,0.13604807609044398,0.13439685389898126,0.13218730280799651,0.12959553725401618,0.12679767167356643,0.12396982050317401,0.12128809817936392,0.11892861913866294,0.11706749781759726,0.11575354976910762,0.11460329458395463,0.11354642893327453,0.11255120164082542,0.11158586153036572,0.11061865742565322,0.10961783815044623,0.10855165252850296,0.1073883493835818,0.10609617753944041,0.10470294155436777,0.10331543952560564,0.1019278357064179,0.10053027417954584,0.099112899027731585,0.097665854333716912,0.096179284180244046,0.094643332650054146,0.093048143825889398,0.0913838617904916,0.089651239511597744,0.087863436465441286,0.086022909045438065,0.084131990768269937,0.082193015150619081,0.080208315709166589,0.078180225960594707,0.076111079421585653,0.074003209608820467,0.071858950038981365],"text":["Date: 18413.00<br />Weight: 0.11833159<br />Asset: AZUL4.SA","Date: 18431.49<br />Weight: 0.11614167<br />Asset: AZUL4.SA","Date: 18449.99<br />Weight: 0.11408586<br />Asset: AZUL4.SA","Date: 18468.48<br />Weight: 0.11217137<br />Asset: AZUL4.SA","Date: 18486.97<br />Weight: 0.11040543<br />Asset: AZUL4.SA","Date: 18505.47<br />Weight: 0.10879525<br />Asset: AZUL4.SA","Date: 18523.96<br />Weight: 0.10734805<br />Asset: AZUL4.SA","Date: 18542.46<br />Weight: 0.10607104<br />Asset: AZUL4.SA","Date: 18560.95<br />Weight: 0.10497146<br />Asset: AZUL4.SA","Date: 18579.44<br />Weight: 0.10405651<br />Asset: AZUL4.SA","Date: 18597.94<br />Weight: 0.10333384<br />Asset: AZUL4.SA","Date: 18616.43<br />Weight: 0.10284933<br />Asset: AZUL4.SA","Date: 18634.92<br />Weight: 0.10260762<br />Asset: AZUL4.SA","Date: 18653.42<br />Weight: 0.10257667<br />Asset: AZUL4.SA","Date: 18671.91<br />Weight: 0.10272439<br />Asset: AZUL4.SA","Date: 18690.41<br />Weight: 0.10301874<br />Asset: AZUL4.SA","Date: 18708.90<br />Weight: 0.10342763<br />Asset: AZUL4.SA","Date: 18727.39<br />Weight: 0.10391902<br />Asset: AZUL4.SA","Date: 18745.89<br />Weight: 0.10446082<br />Asset: AZUL4.SA","Date: 18764.38<br />Weight: 0.10502099<br />Asset: AZUL4.SA","Date: 18782.87<br />Weight: 0.10558890<br />Asset: AZUL4.SA","Date: 18801.37<br />Weight: 0.10654202<br />Asset: AZUL4.SA","Date: 18819.86<br />Weight: 0.10794997<br />Asset: AZUL4.SA","Date: 18838.35<br />Weight: 0.10970824<br />Asset: AZUL4.SA","Date: 18856.85<br />Weight: 0.11171235<br />Asset: AZUL4.SA","Date: 18875.34<br />Weight: 0.11385781<br />Asset: AZUL4.SA","Date: 18893.84<br />Weight: 0.11604014<br />Asset: AZUL4.SA","Date: 18912.33<br />Weight: 0.11815482<br />Asset: AZUL4.SA","Date: 18930.82<br />Weight: 0.12009739<br />Asset: AZUL4.SA","Date: 18949.32<br />Weight: 0.12176334<br />Asset: AZUL4.SA","Date: 18967.81<br />Weight: 0.12310515<br />Asset: AZUL4.SA","Date: 18986.30<br />Weight: 0.12463367<br />Asset: AZUL4.SA","Date: 19004.80<br />Weight: 0.12641156<br />Asset: AZUL4.SA","Date: 19023.29<br />Weight: 0.12833379<br />Asset: AZUL4.SA","Date: 19041.78<br />Weight: 0.13029532<br />Asset: AZUL4.SA","Date: 19060.28<br />Weight: 0.13219114<br />Asset: AZUL4.SA","Date: 19078.77<br />Weight: 0.13391621<br />Asset: AZUL4.SA","Date: 19097.27<br />Weight: 0.13536550<br />Asset: AZUL4.SA","Date: 19115.76<br />Weight: 0.13643398<br />Asset: AZUL4.SA","Date: 19134.25<br />Weight: 0.13701662<br />Asset: AZUL4.SA","Date: 19152.75<br />Weight: 0.13696485<br />Asset: AZUL4.SA","Date: 19171.24<br />Weight: 0.13604808<br />Asset: AZUL4.SA","Date: 19189.73<br />Weight: 0.13439685<br />Asset: AZUL4.SA","Date: 19208.23<br />Weight: 0.13218730<br />Asset: AZUL4.SA","Date: 19226.72<br />Weight: 0.12959554<br />Asset: AZUL4.SA","Date: 19245.22<br />Weight: 0.12679767<br />Asset: AZUL4.SA","Date: 19263.71<br />Weight: 0.12396982<br />Asset: AZUL4.SA","Date: 19282.20<br />Weight: 0.12128810<br />Asset: AZUL4.SA","Date: 19300.70<br />Weight: 0.11892862<br />Asset: AZUL4.SA","Date: 19319.19<br />Weight: 0.11706750<br />Asset: AZUL4.SA","Date: 19337.68<br />Weight: 0.11575355<br />Asset: AZUL4.SA","Date: 19356.18<br />Weight: 0.11460329<br />Asset: AZUL4.SA","Date: 19374.67<br />Weight: 0.11354643<br />Asset: AZUL4.SA","Date: 19393.16<br />Weight: 0.11255120<br />Asset: AZUL4.SA","Date: 19411.66<br />Weight: 0.11158586<br />Asset: AZUL4.SA","Date: 19430.15<br />Weight: 0.11061866<br />Asset: AZUL4.SA","Date: 19448.65<br />Weight: 0.10961784<br />Asset: AZUL4.SA","Date: 19467.14<br />Weight: 0.10855165<br />Asset: AZUL4.SA","Date: 19485.63<br />Weight: 0.10738835<br />Asset: AZUL4.SA","Date: 19504.13<br />Weight: 0.10609618<br />Asset: AZUL4.SA","Date: 19522.62<br />Weight: 0.10470294<br />Asset: AZUL4.SA","Date: 19541.11<br />Weight: 0.10331544<br />Asset: AZUL4.SA","Date: 19559.61<br />Weight: 0.10192784<br />Asset: AZUL4.SA","Date: 19578.10<br />Weight: 0.10053027<br />Asset: AZUL4.SA","Date: 19596.59<br />Weight: 0.09911290<br />Asset: AZUL4.SA","Date: 19615.09<br />Weight: 0.09766585<br />Asset: AZUL4.SA","Date: 19633.58<br />Weight: 0.09617928<br />Asset: AZUL4.SA","Date: 19652.08<br />Weight: 0.09464333<br />Asset: AZUL4.SA","Date: 19670.57<br />Weight: 0.09304814<br />Asset: AZUL4.SA","Date: 19689.06<br />Weight: 0.09138386<br />Asset: AZUL4.SA","Date: 19707.56<br />Weight: 0.08965124<br />Asset: AZUL4.SA","Date: 19726.05<br />Weight: 0.08786344<br />Asset: AZUL4.SA","Date: 19744.54<br />Weight: 0.08602291<br />Asset: AZUL4.SA","Date: 19763.04<br />Weight: 0.08413199<br />Asset: AZUL4.SA","Date: 19781.53<br />Weight: 0.08219302<br />Asset: AZUL4.SA","Date: 19800.03<br />Weight: 0.08020832<br />Asset: AZUL4.SA","Date: 19818.52<br />Weight: 0.07818023<br />Asset: AZUL4.SA","Date: 19837.01<br />Weight: 0.07611108<br />Asset: AZUL4.SA","Date: 19855.51<br />Weight: 0.07400321<br />Asset: AZUL4.SA","Date: 19874.00<br />Weight: 0.07185895<br />Asset: AZUL4.SA"],"type":"scatter","mode":"lines","name":"(AZUL4.SA,1)","line":{"width":3.7795275590551185,"color":"rgba(248,118,109,1)","dash":"solid"},"hoveron":"points","legendgroup":"(AZUL4.SA,1)","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[18413,18431.493670886077,18449.98734177215,18468.481012658227,18486.974683544304,18505.468354430381,18523.962025316454,18542.455696202531,18560.949367088608,18579.443037974685,18597.936708860758,18616.430379746835,18634.924050632912,18653.417721518988,18671.911392405062,18690.405063291139,18708.898734177215,18727.392405063292,18745.886075949365,18764.379746835442,18782.873417721519,18801.367088607596,18819.860759493669,18838.354430379746,18856.848101265823,18875.3417721519,18893.835443037973,18912.32911392405,18930.822784810127,18949.316455696204,18967.810126582277,18986.303797468354,19004.797468354431,19023.291139240508,19041.784810126581,19060.278481012658,19078.772151898735,19097.265822784811,19115.759493670885,19134.253164556962,19152.746835443038,19171.240506329115,19189.734177215189,19208.227848101265,19226.721518987342,19245.215189873419,19263.708860759492,19282.202531645569,19300.696202531646,19319.189873417723,19337.683544303796,19356.177215189873,19374.67088607595,19393.164556962027,19411.6582278481,19430.151898734177,19448.645569620254,19467.139240506331,19485.632911392404,19504.126582278481,19522.620253164558,19541.113924050635,19559.607594936708,19578.101265822785,19596.594936708861,19615.088607594938,19633.582278481012,19652.075949367088,19670.569620253165,19689.063291139242,19707.556962025315,19726.050632911392,19744.544303797469,19763.037974683546,19781.531645569619,19800.025316455696,19818.518987341773,19837.012658227846,19855.506329113923,19874],"y":[0.23442004430325059,0.2282008835466332,0.22224223332950077,0.21654655014489124,0.21111629048584613,0.20595391084540554,0.2010618677166108,0.19644261759250012,0.1920986169661148,0.18803232233049505,0.18424632787053444,0.18075538681737463,0.17756088953204305,0.17465244708526784,0.17201967054777739,0.16965217099029881,0.16753955948356061,0.16567144709829082,0.16403744490521779,0.16262716397506899,0.16143692900357334,0.16058536392183514,0.1600967652125109,0.15994122514488296,0.16008883598823395,0.16050969001184631,0.1611738794850025,0.16205149667698521,0.16311263385707675,0.16432738329455973,0.16573070797356609,0.16793760237496266,0.17094132508362164,0.17453224352792915,0.17850072513627052,0.18263713733703366,0.18673184755860378,0.19057522322936715,0.19395763177770925,0.19666944063201769,0.19862543182395767,0.20036987212988988,0.20199815860050319,0.20351342577575363,0.20491880819559644,0.20621744039998718,0.20741245692888108,0.20850699232223413,0.2095041811200016,0.21040715786213907,0.21120672647157182,0.21186501548282519,0.21239035953724839,0.21279549972993031,0.21309317715595988,0.21329613291042632,0.21341710808841838,0.2134688437850252,0.21346408109533571,0.2134155611144388,0.21331141800155429,0.2131072162967817,0.21280511680197228,0.21240894229027898,0.21192251553485461,0.21134965930885202,0.21069419638542428,0.20995994953772382,0.20915074153890378,0.20827039516211701,0.20731889988357086,0.20629156397268913,0.20518743065752812,0.20400558695940385,0.20274511989963254,0.20140511649952961,0.1999846637804113,0.19848284876359393,0.19689875847039287,0.19523147992212433],"text":["Date: 18413.00<br />Weight: 0.23442004<br />Asset: CMIG4.SA","Date: 18431.49<br />Weight: 0.22820088<br />Asset: CMIG4.SA","Date: 18449.99<br />Weight: 0.22224223<br />Asset: CMIG4.SA","Date: 18468.48<br />Weight: 0.21654655<br />Asset: CMIG4.SA","Date: 18486.97<br />Weight: 0.21111629<br />Asset: CMIG4.SA","Date: 18505.47<br />Weight: 0.20595391<br />Asset: CMIG4.SA","Date: 18523.96<br />Weight: 0.20106187<br />Asset: CMIG4.SA","Date: 18542.46<br />Weight: 0.19644262<br />Asset: CMIG4.SA","Date: 18560.95<br />Weight: 0.19209862<br />Asset: CMIG4.SA","Date: 18579.44<br />Weight: 0.18803232<br />Asset: CMIG4.SA","Date: 18597.94<br />Weight: 0.18424633<br />Asset: CMIG4.SA","Date: 18616.43<br />Weight: 0.18075539<br />Asset: CMIG4.SA","Date: 18634.92<br />Weight: 0.17756089<br />Asset: CMIG4.SA","Date: 18653.42<br />Weight: 0.17465245<br />Asset: CMIG4.SA","Date: 18671.91<br />Weight: 0.17201967<br />Asset: CMIG4.SA","Date: 18690.41<br />Weight: 0.16965217<br />Asset: CMIG4.SA","Date: 18708.90<br />Weight: 0.16753956<br />Asset: CMIG4.SA","Date: 18727.39<br />Weight: 0.16567145<br />Asset: CMIG4.SA","Date: 18745.89<br />Weight: 0.16403744<br />Asset: CMIG4.SA","Date: 18764.38<br />Weight: 0.16262716<br />Asset: CMIG4.SA","Date: 18782.87<br />Weight: 0.16143693<br />Asset: CMIG4.SA","Date: 18801.37<br />Weight: 0.16058536<br />Asset: CMIG4.SA","Date: 18819.86<br />Weight: 0.16009677<br />Asset: CMIG4.SA","Date: 18838.35<br />Weight: 0.15994123<br />Asset: CMIG4.SA","Date: 18856.85<br />Weight: 0.16008884<br />Asset: CMIG4.SA","Date: 18875.34<br />Weight: 0.16050969<br />Asset: CMIG4.SA","Date: 18893.84<br />Weight: 0.16117388<br />Asset: CMIG4.SA","Date: 18912.33<br />Weight: 0.16205150<br />Asset: CMIG4.SA","Date: 18930.82<br />Weight: 0.16311263<br />Asset: CMIG4.SA","Date: 18949.32<br />Weight: 0.16432738<br />Asset: CMIG4.SA","Date: 18967.81<br />Weight: 0.16573071<br />Asset: CMIG4.SA","Date: 18986.30<br />Weight: 0.16793760<br />Asset: CMIG4.SA","Date: 19004.80<br />Weight: 0.17094133<br />Asset: CMIG4.SA","Date: 19023.29<br />Weight: 0.17453224<br />Asset: CMIG4.SA","Date: 19041.78<br />Weight: 0.17850073<br />Asset: CMIG4.SA","Date: 19060.28<br />Weight: 0.18263714<br />Asset: CMIG4.SA","Date: 19078.77<br />Weight: 0.18673185<br />Asset: CMIG4.SA","Date: 19097.27<br />Weight: 0.19057522<br />Asset: CMIG4.SA","Date: 19115.76<br />Weight: 0.19395763<br />Asset: CMIG4.SA","Date: 19134.25<br />Weight: 0.19666944<br />Asset: CMIG4.SA","Date: 19152.75<br />Weight: 0.19862543<br />Asset: CMIG4.SA","Date: 19171.24<br />Weight: 0.20036987<br />Asset: CMIG4.SA","Date: 19189.73<br />Weight: 0.20199816<br />Asset: CMIG4.SA","Date: 19208.23<br />Weight: 0.20351343<br />Asset: CMIG4.SA","Date: 19226.72<br />Weight: 0.20491881<br />Asset: CMIG4.SA","Date: 19245.22<br />Weight: 0.20621744<br />Asset: CMIG4.SA","Date: 19263.71<br />Weight: 0.20741246<br />Asset: CMIG4.SA","Date: 19282.20<br />Weight: 0.20850699<br />Asset: CMIG4.SA","Date: 19300.70<br />Weight: 0.20950418<br />Asset: CMIG4.SA","Date: 19319.19<br />Weight: 0.21040716<br />Asset: CMIG4.SA","Date: 19337.68<br />Weight: 0.21120673<br />Asset: CMIG4.SA","Date: 19356.18<br />Weight: 0.21186502<br />Asset: CMIG4.SA","Date: 19374.67<br />Weight: 0.21239036<br />Asset: CMIG4.SA","Date: 19393.16<br />Weight: 0.21279550<br />Asset: CMIG4.SA","Date: 19411.66<br />Weight: 0.21309318<br />Asset: CMIG4.SA","Date: 19430.15<br />Weight: 0.21329613<br />Asset: CMIG4.SA","Date: 19448.65<br />Weight: 0.21341711<br />Asset: CMIG4.SA","Date: 19467.14<br />Weight: 0.21346884<br />Asset: CMIG4.SA","Date: 19485.63<br />Weight: 0.21346408<br />Asset: CMIG4.SA","Date: 19504.13<br />Weight: 0.21341556<br />Asset: CMIG4.SA","Date: 19522.62<br />Weight: 0.21331142<br />Asset: CMIG4.SA","Date: 19541.11<br />Weight: 0.21310722<br />Asset: CMIG4.SA","Date: 19559.61<br />Weight: 0.21280512<br />Asset: CMIG4.SA","Date: 19578.10<br />Weight: 0.21240894<br />Asset: CMIG4.SA","Date: 19596.59<br />Weight: 0.21192252<br />Asset: CMIG4.SA","Date: 19615.09<br />Weight: 0.21134966<br />Asset: CMIG4.SA","Date: 19633.58<br />Weight: 0.21069420<br />Asset: CMIG4.SA","Date: 19652.08<br />Weight: 0.20995995<br />Asset: CMIG4.SA","Date: 19670.57<br />Weight: 0.20915074<br />Asset: CMIG4.SA","Date: 19689.06<br />Weight: 0.20827040<br />Asset: CMIG4.SA","Date: 19707.56<br />Weight: 0.20731890<br />Asset: CMIG4.SA","Date: 19726.05<br />Weight: 0.20629156<br />Asset: CMIG4.SA","Date: 19744.54<br />Weight: 0.20518743<br />Asset: CMIG4.SA","Date: 19763.04<br />Weight: 0.20400559<br />Asset: CMIG4.SA","Date: 19781.53<br />Weight: 0.20274512<br />Asset: CMIG4.SA","Date: 19800.03<br />Weight: 0.20140512<br />Asset: CMIG4.SA","Date: 19818.52<br />Weight: 0.19998466<br />Asset: CMIG4.SA","Date: 19837.01<br />Weight: 0.19848285<br />Asset: CMIG4.SA","Date: 19855.51<br />Weight: 0.19689876<br />Asset: CMIG4.SA","Date: 19874.00<br />Weight: 0.19523148<br />Asset: CMIG4.SA"],"type":"scatter","mode":"lines","name":"(CMIG4.SA,1)","line":{"width":3.7795275590551185,"color":"rgba(163,165,0,1)","dash":"solid"},"hoveron":"points","legendgroup":"(CMIG4.SA,1)","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[18413,18431.493670886077,18449.98734177215,18468.481012658227,18486.974683544304,18505.468354430381,18523.962025316454,18542.455696202531,18560.949367088608,18579.443037974685,18597.936708860758,18616.430379746835,18634.924050632912,18653.417721518988,18671.911392405062,18690.405063291139,18708.898734177215,18727.392405063292,18745.886075949365,18764.379746835442,18782.873417721519,18801.367088607596,18819.860759493669,18838.354430379746,18856.848101265823,18875.3417721519,18893.835443037973,18912.32911392405,18930.822784810127,18949.316455696204,18967.810126582277,18986.303797468354,19004.797468354431,19023.291139240508,19041.784810126581,19060.278481012658,19078.772151898735,19097.265822784811,19115.759493670885,19134.253164556962,19152.746835443038,19171.240506329115,19189.734177215189,19208.227848101265,19226.721518987342,19245.215189873419,19263.708860759492,19282.202531645569,19300.696202531646,19319.189873417723,19337.683544303796,19356.177215189873,19374.67088607595,19393.164556962027,19411.6582278481,19430.151898734177,19448.645569620254,19467.139240506331,19485.632911392404,19504.126582278481,19522.620253164558,19541.113924050635,19559.607594936708,19578.101265822785,19596.594936708861,19615.088607594938,19633.582278481012,19652.075949367088,19670.569620253165,19689.063291139242,19707.556962025315,19726.050632911392,19744.544303797469,19763.037974683546,19781.531645569619,19800.025316455696,19818.518987341773,19837.012658227846,19855.506329113923,19874],"y":[0.096647453972157571,0.10922571606490918,0.12131217765800351,0.13290662990307481,0.14400886395175011,0.15461867095565893,0.16473584206642874,0.17436016843569299,0.18349144121507913,0.19212945155621658,0.2002737860868567,0.2079030480929408,0.21500616314687274,0.22158763400815801,0.22765196343630098,0.23320365419080943,0.23824720903118776,0.24278713071694133,0.24682792200757492,0.25037408566259561,0.25343579186758464,0.25611895574049132,0.25843173461812807,0.26033398156049642,0.26178554962759604,0.26274629187942761,0.26317606137599148,0.26303471117728833,0.26228209434331834,0.26087806393408192,0.25865213671969961,0.25432462492830321,0.24797690726216814,0.24010998197702488,0.23122484732860585,0.22182250157263825,0.21240394296485415,0.20347016976098417,0.19552218021676027,0.18906097258790994,0.18428780379708687,0.17989774346124948,0.17568261072260424,0.17165750015904713,0.16783750634847674,0.16423772386879085,0.16087324729788768,0.1577591712136637,0.15491059019401734,0.15234259881684631,0.15011535323146247,0.14836041523014448,0.14700034177701513,0.1459398863742,0.14508380252382475,0.14433684372801478,0.1436037634888957,0.14278931530859318,0.14179825268923293,0.14053532913294017,0.13906860719498054,0.13769277733547219,0.13640226739720904,0.13518061849976853,0.13401137176272895,0.1328780683056682,0.13176424924816452,0.13065345570979536,0.12952922881013906,0.12837510966877344,0.12719291216736128,0.12600537964257297,0.124816527123738,0.12363015665514671,0.12245007028108967,0.12128007004585684,0.12012395799373883,0.11898553616902625,0.11786860661600902,0.11677697137897776],"text":["Date: 18413.00<br />Weight: 0.09664745<br />Asset: MGLU3.SA","Date: 18431.49<br />Weight: 0.10922572<br />Asset: MGLU3.SA","Date: 18449.99<br />Weight: 0.12131218<br />Asset: MGLU3.SA","Date: 18468.48<br />Weight: 0.13290663<br />Asset: MGLU3.SA","Date: 18486.97<br />Weight: 0.14400886<br />Asset: MGLU3.SA","Date: 18505.47<br />Weight: 0.15461867<br />Asset: MGLU3.SA","Date: 18523.96<br />Weight: 0.16473584<br />Asset: MGLU3.SA","Date: 18542.46<br />Weight: 0.17436017<br />Asset: MGLU3.SA","Date: 18560.95<br />Weight: 0.18349144<br />Asset: MGLU3.SA","Date: 18579.44<br />Weight: 0.19212945<br />Asset: MGLU3.SA","Date: 18597.94<br />Weight: 0.20027379<br />Asset: MGLU3.SA","Date: 18616.43<br />Weight: 0.20790305<br />Asset: MGLU3.SA","Date: 18634.92<br />Weight: 0.21500616<br />Asset: MGLU3.SA","Date: 18653.42<br />Weight: 0.22158763<br />Asset: MGLU3.SA","Date: 18671.91<br />Weight: 0.22765196<br />Asset: MGLU3.SA","Date: 18690.41<br />Weight: 0.23320365<br />Asset: MGLU3.SA","Date: 18708.90<br />Weight: 0.23824721<br />Asset: MGLU3.SA","Date: 18727.39<br />Weight: 0.24278713<br />Asset: MGLU3.SA","Date: 18745.89<br />Weight: 0.24682792<br />Asset: MGLU3.SA","Date: 18764.38<br />Weight: 0.25037409<br />Asset: MGLU3.SA","Date: 18782.87<br />Weight: 0.25343579<br />Asset: MGLU3.SA","Date: 18801.37<br />Weight: 0.25611896<br />Asset: MGLU3.SA","Date: 18819.86<br />Weight: 0.25843173<br />Asset: MGLU3.SA","Date: 18838.35<br />Weight: 0.26033398<br />Asset: MGLU3.SA","Date: 18856.85<br />Weight: 0.26178555<br />Asset: MGLU3.SA","Date: 18875.34<br />Weight: 0.26274629<br />Asset: MGLU3.SA","Date: 18893.84<br />Weight: 0.26317606<br />Asset: MGLU3.SA","Date: 18912.33<br />Weight: 0.26303471<br />Asset: MGLU3.SA","Date: 18930.82<br />Weight: 0.26228209<br />Asset: MGLU3.SA","Date: 18949.32<br />Weight: 0.26087806<br />Asset: MGLU3.SA","Date: 18967.81<br />Weight: 0.25865214<br />Asset: MGLU3.SA","Date: 18986.30<br />Weight: 0.25432462<br />Asset: MGLU3.SA","Date: 19004.80<br />Weight: 0.24797691<br />Asset: MGLU3.SA","Date: 19023.29<br />Weight: 0.24010998<br />Asset: MGLU3.SA","Date: 19041.78<br />Weight: 0.23122485<br />Asset: MGLU3.SA","Date: 19060.28<br />Weight: 0.22182250<br />Asset: MGLU3.SA","Date: 19078.77<br />Weight: 0.21240394<br />Asset: MGLU3.SA","Date: 19097.27<br />Weight: 0.20347017<br />Asset: MGLU3.SA","Date: 19115.76<br />Weight: 0.19552218<br />Asset: MGLU3.SA","Date: 19134.25<br />Weight: 0.18906097<br />Asset: MGLU3.SA","Date: 19152.75<br />Weight: 0.18428780<br />Asset: MGLU3.SA","Date: 19171.24<br />Weight: 0.17989774<br />Asset: MGLU3.SA","Date: 19189.73<br />Weight: 0.17568261<br />Asset: MGLU3.SA","Date: 19208.23<br />Weight: 0.17165750<br />Asset: MGLU3.SA","Date: 19226.72<br />Weight: 0.16783751<br />Asset: MGLU3.SA","Date: 19245.22<br />Weight: 0.16423772<br />Asset: MGLU3.SA","Date: 19263.71<br />Weight: 0.16087325<br />Asset: MGLU3.SA","Date: 19282.20<br />Weight: 0.15775917<br />Asset: MGLU3.SA","Date: 19300.70<br />Weight: 0.15491059<br />Asset: MGLU3.SA","Date: 19319.19<br />Weight: 0.15234260<br />Asset: MGLU3.SA","Date: 19337.68<br />Weight: 0.15011535<br />Asset: MGLU3.SA","Date: 19356.18<br />Weight: 0.14836042<br />Asset: MGLU3.SA","Date: 19374.67<br />Weight: 0.14700034<br />Asset: MGLU3.SA","Date: 19393.16<br />Weight: 0.14593989<br />Asset: MGLU3.SA","Date: 19411.66<br />Weight: 0.14508380<br />Asset: MGLU3.SA","Date: 19430.15<br />Weight: 0.14433684<br />Asset: MGLU3.SA","Date: 19448.65<br />Weight: 0.14360376<br />Asset: MGLU3.SA","Date: 19467.14<br />Weight: 0.14278932<br />Asset: MGLU3.SA","Date: 19485.63<br />Weight: 0.14179825<br />Asset: MGLU3.SA","Date: 19504.13<br />Weight: 0.14053533<br />Asset: MGLU3.SA","Date: 19522.62<br />Weight: 0.13906861<br />Asset: MGLU3.SA","Date: 19541.11<br />Weight: 0.13769278<br />Asset: MGLU3.SA","Date: 19559.61<br />Weight: 0.13640227<br />Asset: MGLU3.SA","Date: 19578.10<br />Weight: 0.13518062<br />Asset: MGLU3.SA","Date: 19596.59<br />Weight: 0.13401137<br />Asset: MGLU3.SA","Date: 19615.09<br />Weight: 0.13287807<br />Asset: MGLU3.SA","Date: 19633.58<br />Weight: 0.13176425<br />Asset: MGLU3.SA","Date: 19652.08<br />Weight: 0.13065346<br />Asset: MGLU3.SA","Date: 19670.57<br />Weight: 0.12952923<br />Asset: MGLU3.SA","Date: 19689.06<br />Weight: 0.12837511<br />Asset: MGLU3.SA","Date: 19707.56<br />Weight: 0.12719291<br />Asset: MGLU3.SA","Date: 19726.05<br />Weight: 0.12600538<br />Asset: MGLU3.SA","Date: 19744.54<br />Weight: 0.12481653<br />Asset: MGLU3.SA","Date: 19763.04<br />Weight: 0.12363016<br />Asset: MGLU3.SA","Date: 19781.53<br />Weight: 0.12245007<br />Asset: MGLU3.SA","Date: 19800.03<br />Weight: 0.12128007<br />Asset: MGLU3.SA","Date: 19818.52<br />Weight: 0.12012396<br />Asset: MGLU3.SA","Date: 19837.01<br />Weight: 0.11898554<br />Asset: MGLU3.SA","Date: 19855.51<br />Weight: 0.11786861<br />Asset: MGLU3.SA","Date: 19874.00<br />Weight: 0.11677697<br />Asset: MGLU3.SA"],"type":"scatter","mode":"lines","name":"(MGLU3.SA,1)","line":{"width":3.7795275590551185,"color":"rgba(0,191,125,1)","dash":"solid"},"hoveron":"points","legendgroup":"(MGLU3.SA,1)","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[18413,18431.493670886077,18449.98734177215,18468.481012658227,18486.974683544304,18505.468354430381,18523.962025316454,18542.455696202531,18560.949367088608,18579.443037974685,18597.936708860758,18616.430379746835,18634.924050632912,18653.417721518988,18671.911392405062,18690.405063291139,18708.898734177215,18727.392405063292,18745.886075949365,18764.379746835442,18782.873417721519,18801.367088607596,18819.860759493669,18838.354430379746,18856.848101265823,18875.3417721519,18893.835443037973,18912.32911392405,18930.822784810127,18949.316455696204,18967.810126582277,18986.303797468354,19004.797468354431,19023.291139240508,19041.784810126581,19060.278481012658,19078.772151898735,19097.265822784811,19115.759493670885,19134.253164556962,19152.746835443038,19171.240506329115,19189.734177215189,19208.227848101265,19226.721518987342,19245.215189873419,19263.708860759492,19282.202531645569,19300.696202531646,19319.189873417723,19337.683544303796,19356.177215189873,19374.67088607595,19393.164556962027,19411.6582278481,19430.151898734177,19448.645569620254,19467.139240506331,19485.632911392404,19504.126582278481,19522.620253164558,19541.113924050635,19559.607594936708,19578.101265822785,19596.594936708861,19615.088607594938,19633.582278481012,19652.075949367088,19670.569620253165,19689.063291139242,19707.556962025315,19726.050632911392,19744.544303797469,19763.037974683546,19781.531645569619,19800.025316455696,19818.518987341773,19837.012658227846,19855.506329113923,19874],"y":[0.18316486815291683,0.18100483400969972,0.1789911157360575,0.17713278531340743,0.1754389147231678,0.17391857594675647,0.1725808409655917,0.17143478176109081,0.17048947031467201,0.16975397860775329,0.16923785618683199,0.16899212861041518,0.16901920564495632,0.16928018514794999,0.16973616497689048,0.1703482429892724,0.17107751704259025,0.17188508499433841,0.17273204470201114,0.1735794940231033,0.17441706167307761,0.17574897441945037,0.1776661736942369,0.18002750446621454,0.18269181170415932,0.18551794037684777,0.18836473545305579,0.19109104190156101,0.19355570469113931,0.19561756879056716,0.1971913944742596,0.19876201854530989,0.20041803385245624,0.20208810016300272,0.20370087724425318,0.20518502486351264,0.20646920278808481,0.20748207078527392,0.20815228862238405,0.20840851606671973,0.20810000209842369,0.20683579585009781,0.20475013318208046,0.20205163977110205,0.19894894129389418,0.19565066342718807,0.19236543184771548,0.1893018722322064,0.18666861025739273,0.18467427160000563,0.18336877636171808,0.18227147784980621,0.18130225334536726,0.18042947067488599,0.17962149766484728,0.17884670214173581,0.17807345193203647,0.17727011486223412,0.17640505875881374,0.17544665144825977,0.17442184025748322,0.17343587777735836,0.17248374934353369,0.17155649431913578,0.17064515206729172,0.16974076195112839,0.168834363333773,0.16791699557835199,0.16697969804799256,0.1660135101058216,0.16501906897275032,0.16400826643572419,0.16298333148766242,0.16194638204771664,0.16089953603503876,0.15984491136878004,0.15878462596809254,0.15772079775212805,0.15665554464003789,0.15559098455097398],"text":["Date: 18413.00<br />Weight: 0.18316487<br />Asset: PETR4.SA","Date: 18431.49<br />Weight: 0.18100483<br />Asset: PETR4.SA","Date: 18449.99<br />Weight: 0.17899112<br />Asset: PETR4.SA","Date: 18468.48<br />Weight: 0.17713279<br />Asset: PETR4.SA","Date: 18486.97<br />Weight: 0.17543891<br />Asset: PETR4.SA","Date: 18505.47<br />Weight: 0.17391858<br />Asset: PETR4.SA","Date: 18523.96<br />Weight: 0.17258084<br />Asset: PETR4.SA","Date: 18542.46<br />Weight: 0.17143478<br />Asset: PETR4.SA","Date: 18560.95<br />Weight: 0.17048947<br />Asset: PETR4.SA","Date: 18579.44<br />Weight: 0.16975398<br />Asset: PETR4.SA","Date: 18597.94<br />Weight: 0.16923786<br />Asset: PETR4.SA","Date: 18616.43<br />Weight: 0.16899213<br />Asset: PETR4.SA","Date: 18634.92<br />Weight: 0.16901921<br />Asset: PETR4.SA","Date: 18653.42<br />Weight: 0.16928019<br />Asset: PETR4.SA","Date: 18671.91<br />Weight: 0.16973616<br />Asset: PETR4.SA","Date: 18690.41<br />Weight: 0.17034824<br />Asset: PETR4.SA","Date: 18708.90<br />Weight: 0.17107752<br />Asset: PETR4.SA","Date: 18727.39<br />Weight: 0.17188508<br />Asset: PETR4.SA","Date: 18745.89<br />Weight: 0.17273204<br />Asset: PETR4.SA","Date: 18764.38<br />Weight: 0.17357949<br />Asset: PETR4.SA","Date: 18782.87<br />Weight: 0.17441706<br />Asset: PETR4.SA","Date: 18801.37<br />Weight: 0.17574897<br />Asset: PETR4.SA","Date: 18819.86<br />Weight: 0.17766617<br />Asset: PETR4.SA","Date: 18838.35<br />Weight: 0.18002750<br />Asset: PETR4.SA","Date: 18856.85<br />Weight: 0.18269181<br />Asset: PETR4.SA","Date: 18875.34<br />Weight: 0.18551794<br />Asset: PETR4.SA","Date: 18893.84<br />Weight: 0.18836474<br />Asset: PETR4.SA","Date: 18912.33<br />Weight: 0.19109104<br />Asset: PETR4.SA","Date: 18930.82<br />Weight: 0.19355570<br />Asset: PETR4.SA","Date: 18949.32<br />Weight: 0.19561757<br />Asset: PETR4.SA","Date: 18967.81<br />Weight: 0.19719139<br />Asset: PETR4.SA","Date: 18986.30<br />Weight: 0.19876202<br />Asset: PETR4.SA","Date: 19004.80<br />Weight: 0.20041803<br />Asset: PETR4.SA","Date: 19023.29<br />Weight: 0.20208810<br />Asset: PETR4.SA","Date: 19041.78<br />Weight: 0.20370088<br />Asset: PETR4.SA","Date: 19060.28<br />Weight: 0.20518502<br />Asset: PETR4.SA","Date: 19078.77<br />Weight: 0.20646920<br />Asset: PETR4.SA","Date: 19097.27<br />Weight: 0.20748207<br />Asset: PETR4.SA","Date: 19115.76<br />Weight: 0.20815229<br />Asset: PETR4.SA","Date: 19134.25<br />Weight: 0.20840852<br />Asset: PETR4.SA","Date: 19152.75<br />Weight: 0.20810000<br />Asset: PETR4.SA","Date: 19171.24<br />Weight: 0.20683580<br />Asset: PETR4.SA","Date: 19189.73<br />Weight: 0.20475013<br />Asset: PETR4.SA","Date: 19208.23<br />Weight: 0.20205164<br />Asset: PETR4.SA","Date: 19226.72<br />Weight: 0.19894894<br />Asset: PETR4.SA","Date: 19245.22<br />Weight: 0.19565066<br />Asset: PETR4.SA","Date: 19263.71<br />Weight: 0.19236543<br />Asset: PETR4.SA","Date: 19282.20<br />Weight: 0.18930187<br />Asset: PETR4.SA","Date: 19300.70<br />Weight: 0.18666861<br />Asset: PETR4.SA","Date: 19319.19<br />Weight: 0.18467427<br />Asset: PETR4.SA","Date: 19337.68<br />Weight: 0.18336878<br />Asset: PETR4.SA","Date: 19356.18<br />Weight: 0.18227148<br />Asset: PETR4.SA","Date: 19374.67<br />Weight: 0.18130225<br />Asset: PETR4.SA","Date: 19393.16<br />Weight: 0.18042947<br />Asset: PETR4.SA","Date: 19411.66<br />Weight: 0.17962150<br />Asset: PETR4.SA","Date: 19430.15<br />Weight: 0.17884670<br />Asset: PETR4.SA","Date: 19448.65<br />Weight: 0.17807345<br />Asset: PETR4.SA","Date: 19467.14<br />Weight: 0.17727011<br />Asset: PETR4.SA","Date: 19485.63<br />Weight: 0.17640506<br />Asset: PETR4.SA","Date: 19504.13<br />Weight: 0.17544665<br />Asset: PETR4.SA","Date: 19522.62<br />Weight: 0.17442184<br />Asset: PETR4.SA","Date: 19541.11<br />Weight: 0.17343588<br />Asset: PETR4.SA","Date: 19559.61<br />Weight: 0.17248375<br />Asset: PETR4.SA","Date: 19578.10<br />Weight: 0.17155649<br />Asset: PETR4.SA","Date: 19596.59<br />Weight: 0.17064515<br />Asset: PETR4.SA","Date: 19615.09<br />Weight: 0.16974076<br />Asset: PETR4.SA","Date: 19633.58<br />Weight: 0.16883436<br />Asset: PETR4.SA","Date: 19652.08<br />Weight: 0.16791700<br />Asset: PETR4.SA","Date: 19670.57<br />Weight: 0.16697970<br />Asset: PETR4.SA","Date: 19689.06<br />Weight: 0.16601351<br />Asset: PETR4.SA","Date: 19707.56<br />Weight: 0.16501907<br />Asset: PETR4.SA","Date: 19726.05<br />Weight: 0.16400827<br />Asset: PETR4.SA","Date: 19744.54<br />Weight: 0.16298333<br />Asset: PETR4.SA","Date: 19763.04<br />Weight: 0.16194638<br />Asset: PETR4.SA","Date: 19781.53<br />Weight: 0.16089954<br />Asset: PETR4.SA","Date: 19800.03<br />Weight: 0.15984491<br />Asset: PETR4.SA","Date: 19818.52<br />Weight: 0.15878463<br />Asset: PETR4.SA","Date: 19837.01<br />Weight: 0.15772080<br />Asset: PETR4.SA","Date: 19855.51<br />Weight: 0.15665554<br />Asset: PETR4.SA","Date: 19874.00<br />Weight: 0.15559098<br />Asset: PETR4.SA"],"type":"scatter","mode":"lines","name":"(PETR4.SA,1)","line":{"width":3.7795275590551185,"color":"rgba(0,176,246,1)","dash":"solid"},"hoveron":"points","legendgroup":"(PETR4.SA,1)","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[18413,18431.493670886077,18449.98734177215,18468.481012658227,18486.974683544304,18505.468354430381,18523.962025316454,18542.455696202531,18560.949367088608,18579.443037974685,18597.936708860758,18616.430379746835,18634.924050632912,18653.417721518988,18671.911392405062,18690.405063291139,18708.898734177215,18727.392405063292,18745.886075949365,18764.379746835442,18782.873417721519,18801.367088607596,18819.860759493669,18838.354430379746,18856.848101265823,18875.3417721519,18893.835443037973,18912.32911392405,18930.822784810127,18949.316455696204,18967.810126582277,18986.303797468354,19004.797468354431,19023.291139240508,19041.784810126581,19060.278481012658,19078.772151898735,19097.265822784811,19115.759493670885,19134.253164556962,19152.746835443038,19171.240506329115,19189.734177215189,19208.227848101265,19226.721518987342,19245.215189873419,19263.708860759492,19282.202531645569,19300.696202531646,19319.189873417723,19337.683544303796,19356.177215189873,19374.67088607595,19393.164556962027,19411.6582278481,19430.151898734177,19448.645569620254,19467.139240506331,19485.632911392404,19504.126582278481,19522.620253164558,19541.113924050635,19559.607594936708,19578.101265822785,19596.594936708861,19615.088607594938,19633.582278481012,19652.075949367088,19670.569620253165,19689.063291139242,19707.556962025315,19726.050632911392,19744.544303797469,19763.037974683546,19781.531645569619,19800.025316455696,19818.518987341773,19837.012658227846,19855.506329113923,19874],"y":[0.36743604696867577,0.36542689929928968,0.36336861827398154,0.36124266604534699,0.35903050476598269,0.35671359658848489,0.35427340366545051,0.35169138814947454,0.34894901219315394,0.34602773794908498,0.34290818612424123,0.33950010833964572,0.33580611708970026,0.33190306552786497,0.32786780680760075,0.32377719408236583,0.31970808050562138,0.31573731923082715,0.31194176341144403,0.30839826620093053,0.30512131803788983,0.30100468399600094,0.29585536119243794,0.28998904992587887,0.28372145049500458,0.27736826319849522,0.27124518833503181,0.26566792620329216,0.26095217710195728,0.25741364132970734,0.25532060831629,0.25434208369212141,0.2542521758562169,0.25493588914525162,0.25627822789590077,0.25816419644484018,0.26047879912874505,0.26310704028429083,0.26593392424815221,0.26884445535700574,0.27202190733467263,0.27684851246831871,0.28317224359583071,0.29059013148610047,0.29869920690801627,0.30709650063046745,0.31537904342234174,0.32314386605253176,0.32998799928992523,0.33550847390341149,0.33955559416613995,0.34289979685326943,0.34576061640709482,0.34828394158015846,0.35061566112500242,0.35290166379417015,0.3552878383402035,0.35792007351564498,0.36094425807303637,0.3645062807649212,0.3684951929916146,0.37244868906478262,0.37638103075086748,0.38032367071127127,0.38430806160739356,0.38836565610063478,0.39252790685239464,0.39682626652407488,0.40129218777707548,0.40595712327279676,0.41081787946472015,0.41583135348357264,0.42098980168563371,0.42628588356946329,0.43171225863362034,0.43726158637666718,0.44292652629716289,0.4486997378936663,0.45457388066473997,0.46054161410894273],"text":["Date: 18413.00<br />Weight: 0.36743605<br />Asset: VALE3.SA","Date: 18431.49<br />Weight: 0.36542690<br />Asset: VALE3.SA","Date: 18449.99<br />Weight: 0.36336862<br />Asset: VALE3.SA","Date: 18468.48<br />Weight: 0.36124267<br />Asset: VALE3.SA","Date: 18486.97<br />Weight: 0.35903050<br />Asset: VALE3.SA","Date: 18505.47<br />Weight: 0.35671360<br />Asset: VALE3.SA","Date: 18523.96<br />Weight: 0.35427340<br />Asset: VALE3.SA","Date: 18542.46<br />Weight: 0.35169139<br />Asset: VALE3.SA","Date: 18560.95<br />Weight: 0.34894901<br />Asset: VALE3.SA","Date: 18579.44<br />Weight: 0.34602774<br />Asset: VALE3.SA","Date: 18597.94<br />Weight: 0.34290819<br />Asset: VALE3.SA","Date: 18616.43<br />Weight: 0.33950011<br />Asset: VALE3.SA","Date: 18634.92<br />Weight: 0.33580612<br />Asset: VALE3.SA","Date: 18653.42<br />Weight: 0.33190307<br />Asset: VALE3.SA","Date: 18671.91<br />Weight: 0.32786781<br />Asset: VALE3.SA","Date: 18690.41<br />Weight: 0.32377719<br />Asset: VALE3.SA","Date: 18708.90<br />Weight: 0.31970808<br />Asset: VALE3.SA","Date: 18727.39<br />Weight: 0.31573732<br />Asset: VALE3.SA","Date: 18745.89<br />Weight: 0.31194176<br />Asset: VALE3.SA","Date: 18764.38<br />Weight: 0.30839827<br />Asset: VALE3.SA","Date: 18782.87<br />Weight: 0.30512132<br />Asset: VALE3.SA","Date: 18801.37<br />Weight: 0.30100468<br />Asset: VALE3.SA","Date: 18819.86<br />Weight: 0.29585536<br />Asset: VALE3.SA","Date: 18838.35<br />Weight: 0.28998905<br />Asset: VALE3.SA","Date: 18856.85<br />Weight: 0.28372145<br />Asset: VALE3.SA","Date: 18875.34<br />Weight: 0.27736826<br />Asset: VALE3.SA","Date: 18893.84<br />Weight: 0.27124519<br />Asset: VALE3.SA","Date: 18912.33<br />Weight: 0.26566793<br />Asset: VALE3.SA","Date: 18930.82<br />Weight: 0.26095218<br />Asset: VALE3.SA","Date: 18949.32<br />Weight: 0.25741364<br />Asset: VALE3.SA","Date: 18967.81<br />Weight: 0.25532061<br />Asset: VALE3.SA","Date: 18986.30<br />Weight: 0.25434208<br />Asset: VALE3.SA","Date: 19004.80<br />Weight: 0.25425218<br />Asset: VALE3.SA","Date: 19023.29<br />Weight: 0.25493589<br />Asset: VALE3.SA","Date: 19041.78<br />Weight: 0.25627823<br />Asset: VALE3.SA","Date: 19060.28<br />Weight: 0.25816420<br />Asset: VALE3.SA","Date: 19078.77<br />Weight: 0.26047880<br />Asset: VALE3.SA","Date: 19097.27<br />Weight: 0.26310704<br />Asset: VALE3.SA","Date: 19115.76<br />Weight: 0.26593392<br />Asset: VALE3.SA","Date: 19134.25<br />Weight: 0.26884446<br />Asset: VALE3.SA","Date: 19152.75<br />Weight: 0.27202191<br />Asset: VALE3.SA","Date: 19171.24<br />Weight: 0.27684851<br />Asset: VALE3.SA","Date: 19189.73<br />Weight: 0.28317224<br />Asset: VALE3.SA","Date: 19208.23<br />Weight: 0.29059013<br />Asset: VALE3.SA","Date: 19226.72<br />Weight: 0.29869921<br />Asset: VALE3.SA","Date: 19245.22<br />Weight: 0.30709650<br />Asset: VALE3.SA","Date: 19263.71<br />Weight: 0.31537904<br />Asset: VALE3.SA","Date: 19282.20<br />Weight: 0.32314387<br />Asset: VALE3.SA","Date: 19300.70<br />Weight: 0.32998800<br />Asset: VALE3.SA","Date: 19319.19<br />Weight: 0.33550847<br />Asset: VALE3.SA","Date: 19337.68<br />Weight: 0.33955559<br />Asset: VALE3.SA","Date: 19356.18<br />Weight: 0.34289980<br />Asset: VALE3.SA","Date: 19374.67<br />Weight: 0.34576062<br />Asset: VALE3.SA","Date: 19393.16<br />Weight: 0.34828394<br />Asset: VALE3.SA","Date: 19411.66<br />Weight: 0.35061566<br />Asset: VALE3.SA","Date: 19430.15<br />Weight: 0.35290166<br />Asset: VALE3.SA","Date: 19448.65<br />Weight: 0.35528784<br />Asset: VALE3.SA","Date: 19467.14<br />Weight: 0.35792007<br />Asset: VALE3.SA","Date: 19485.63<br />Weight: 0.36094426<br />Asset: VALE3.SA","Date: 19504.13<br />Weight: 0.36450628<br />Asset: VALE3.SA","Date: 19522.62<br />Weight: 0.36849519<br />Asset: VALE3.SA","Date: 19541.11<br />Weight: 0.37244869<br />Asset: VALE3.SA","Date: 19559.61<br />Weight: 0.37638103<br />Asset: VALE3.SA","Date: 19578.10<br />Weight: 0.38032367<br />Asset: VALE3.SA","Date: 19596.59<br />Weight: 0.38430806<br />Asset: VALE3.SA","Date: 19615.09<br />Weight: 0.38836566<br />Asset: VALE3.SA","Date: 19633.58<br />Weight: 0.39252791<br />Asset: VALE3.SA","Date: 19652.08<br />Weight: 0.39682627<br />Asset: VALE3.SA","Date: 19670.57<br />Weight: 0.40129219<br />Asset: VALE3.SA","Date: 19689.06<br />Weight: 0.40595712<br />Asset: VALE3.SA","Date: 19707.56<br />Weight: 0.41081788<br />Asset: VALE3.SA","Date: 19726.05<br />Weight: 0.41583135<br />Asset: VALE3.SA","Date: 19744.54<br />Weight: 0.42098980<br />Asset: VALE3.SA","Date: 19763.04<br />Weight: 0.42628588<br />Asset: VALE3.SA","Date: 19781.53<br />Weight: 0.43171226<br />Asset: VALE3.SA","Date: 19800.03<br />Weight: 0.43726159<br />Asset: VALE3.SA","Date: 19818.52<br />Weight: 0.44292653<br />Asset: VALE3.SA","Date: 19837.01<br />Weight: 0.44869974<br />Asset: VALE3.SA","Date: 19855.51<br />Weight: 0.45457388<br />Asset: VALE3.SA","Date: 19874.00<br />Weight: 0.46054161<br />Asset: VALE3.SA"],"type":"scatter","mode":"lines","name":"(VALE3.SA,1)","line":{"width":3.7795275590551185,"color":"rgba(231,107,243,1)","dash":"solid"},"hoveron":"points","legendgroup":"(VALE3.SA,1)","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null}],"layout":{"margin":{"t":47.481942714819425,"r":7.3059360730593621,"b":40.182648401826491,"l":43.105022831050235},"font":{"color":"rgba(0,0,0,1)","family":"","size":14.611872146118724},"title":{"text":"<b> Peso dos ativos rebalanceados ao longo do tempo <\/b>","font":{"color":"rgba(0,0,0,1)","family":"","size":21.253632212536321},"x":0.5,"xref":"paper"},"xaxis":{"domain":[0,1],"automargin":true,"type":"linear","autorange":false,"range":[18339.950000000001,19947.049999999999],"tickmode":"array","ticktext":["2021","2022","2023","2024"],"tickvals":[18628,18993,19358,19723],"categoryorder":"array","categoryarray":["2021","2022","2023","2024"],"nticks":null,"ticks":"","tickcolor":null,"ticklen":3.6529680365296811,"tickwidth":0,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.68949771689498},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"gridcolor":"rgba(235,235,235,1)","gridwidth":0.66417600664176002,"zeroline":false,"anchor":"y","title":{"text":"Data","font":{"color":"rgba(0,0,0,1)","family":"","size":14.611872146118724}},"hoverformat":".2f"},"yaxis":{"domain":[0,1],"automargin":true,"type":"linear","autorange":false,"range":[0.052424816835483293,0.4799757473124408],"tickmode":"array","ticktext":["0.1","0.2","0.3","0.4"],"tickvals":[0.10000000000000001,0.20000000000000001,0.3000000000000001,0.40000000000000002],"categoryorder":"array","categoryarray":["0.1","0.2","0.3","0.4"],"nticks":null,"ticks":"","tickcolor":null,"ticklen":3.6529680365296811,"tickwidth":0,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.68949771689498},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"gridcolor":"rgba(235,235,235,1)","gridwidth":0.66417600664176002,"zeroline":false,"anchor":"x","title":{"text":"Peso","font":{"color":"rgba(0,0,0,1)","family":"","size":14.611872146118724}},"hoverformat":".2f"},"shapes":[{"type":"rect","fillcolor":null,"line":{"color":null,"width":0,"linetype":[]},"yref":"paper","xref":"paper","x0":0,"x1":1,"y0":0,"y1":1}],"showlegend":true,"legend":{"bgcolor":null,"bordercolor":null,"borderwidth":0,"font":{"color":"rgba(0,0,0,1)","family":"","size":11.68949771689498},"title":{"text":"Ativos","font":{"color":"rgba(0,0,0,1)","family":"","size":14.611872146118724}}},"hovermode":"closest","barmode":"relative"},"config":{"doubleClick":"reset","modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"source":"A","attrs":{"824ac718bb639":{"x":{},"y":{},"colour":{},"type":"scatter"}},"cur_data":"824ac718bb639","visdat":{"824ac718bb639":["function (y) ","x"]},"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</section>
<section id="plotando-o-retorno-do-portfólio-ao-longo-do-tempo" class="level2">
<h2 class="anchored" data-anchor-id="plotando-o-retorno-do-portfólio-ao-longo-do-tempo">Plotando o retorno do portfólio ao longo do tempo</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculando o retorno do portfólio otimizado e adicionando o retorno do IBOV</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>opt_returns_long_df <span class="ot">&lt;-</span> <span class="fu">Return.portfolio</span>(<span class="at">R =</span> asset_returns_xts, <span class="at">weights =</span> <span class="fu">extractWeights</span>(opt_rebal)) <span class="sc">%&gt;%</span></span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tk_tbl</span>(<span class="at">preserve_index =</span> <span class="cn">TRUE</span>, <span class="at">rename_index =</span> <span class="st">"Date"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(ibov_returns_xts <span class="sc">%&gt;%</span> <span class="fu">tk_tbl</span>(<span class="at">preserve_index =</span> <span class="cn">TRUE</span>, <span class="at">rename_index =</span> <span class="st">"Date"</span>), <span class="at">by =</span> <span class="st">"Date"</span>, <span class="at">suffix =</span> <span class="fu">c</span>(<span class="st">"_Portfolio"</span>, <span class="st">"_IBOV"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="sc">-</span>Date, <span class="at">names_to =</span> <span class="st">"Portfolio"</span>, <span class="at">values_to =</span> <span class="st">"Return"</span>)</span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a>plotly<span class="sc">::</span><span class="fu">ggplotly</span>(<span class="fu">ggplot</span>(opt_returns_long_df) <span class="sc">+</span></span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x =</span> Date, <span class="at">y =</span> Return, <span class="at">colour =</span> Portfolio) <span class="sc">+</span></span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb48-10"><a href="#cb48-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_hue</span>(<span class="at">direction =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb48-11"><a href="#cb48-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb48-12"><a href="#cb48-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Data"</span>,</span>
<span id="cb48-13"><a href="#cb48-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Retorno"</span>,</span>
<span id="cb48-14"><a href="#cb48-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Retorno do portifólio vs IBOV ao longo do tempo"</span>,</span>
<span id="cb48-15"><a href="#cb48-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">colour =</span> <span class="st">"Portfólio"</span></span>
<span id="cb48-16"><a href="#cb48-16" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb48-17"><a href="#cb48-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb48-18"><a href="#cb48-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb48-19"><a href="#cb48-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">16</span>L,</span>
<span id="cb48-20"><a href="#cb48-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">face =</span> <span class="st">"bold"</span>,</span>
<span id="cb48-21"><a href="#cb48-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">hjust =</span> <span class="fl">0.5</span>)</span>
<span id="cb48-22"><a href="#cb48-22" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb48-23"><a href="#cb48-23" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="plotly html-widget html-fill-item" id="htmlwidget-ca57a782b44f8d85c92b" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-ca57a782b44f8d85c92b">{"x":{"data":[{"x":[18443,18474,18505,18535,18566,18596,18627,18658,18686,18717,18747,18778,18808,18839,18870,18900,18931,18961,18992,19023,19051,19082,19112,19143,19173,19204,19235,19265,19296,19326,19357,19388,19416,19447,19477,19508,19538,19569,19600,19630,19661,19691,19722,19753,19782,19813,19843,19874],"y":[0.087559923572417375,0.082646019188688857,-0.034427472014925353,-0.047962644285441169,-0.0068813885394755081,0.1589747956403269,0.095676291235030408,-0.027651584999916157,-0.051479652089960082,0.059971827145908208,0.019376854090573881,0.061584268339865744,0.0046428345059263965,-0.039439441018280452,-0.024794541916733026,-0.065683905675150034,-0.067382117337514313,-0.015323523444217946,0.028523769808173505,0.072179504302531949,0.0067089013061891745,0.060605257110533772,-0.10102584188201569,0.032212911120174992,-0.11503264452048023,0.046914006210549752,0.061629428585276091,0.0046930781662299914,0.054527113607241162,-0.030602307884554092,-0.021824938214533351,0.031818305750197728,-0.075749568403621903,-0.029066443029771682,0.02502895506566416,0.037373601961084635,0.090017076660358963,0.032653890775445227,-0.050851627399686739,0.0071106426362081976,-0.029348432205207442,0.12538888496075806,0.053828211511729229,-0.047941275105265135,0.0099254806186988009,-0.0070841729964347122,-0.017032769737561071,-0.025547155427082968],"text":["Date: 2020-06-30<br />Return:  0.0875599236<br />Portfolio: IBOV","Date: 2020-07-31<br />Return:  0.0826460192<br />Portfolio: IBOV","Date: 2020-08-31<br />Return: -0.0344274720<br />Portfolio: IBOV","Date: 2020-09-30<br />Return: -0.0479626443<br />Portfolio: IBOV","Date: 2020-10-31<br />Return: -0.0068813885<br />Portfolio: IBOV","Date: 2020-11-30<br />Return:  0.1589747956<br />Portfolio: IBOV","Date: 2020-12-31<br />Return:  0.0956762912<br />Portfolio: IBOV","Date: 2021-01-31<br />Return: -0.0276515850<br />Portfolio: IBOV","Date: 2021-02-28<br />Return: -0.0514796521<br />Portfolio: IBOV","Date: 2021-03-31<br />Return:  0.0599718271<br />Portfolio: IBOV","Date: 2021-04-30<br />Return:  0.0193768541<br />Portfolio: IBOV","Date: 2021-05-31<br />Return:  0.0615842683<br />Portfolio: IBOV","Date: 2021-06-30<br />Return:  0.0046428345<br />Portfolio: IBOV","Date: 2021-07-31<br />Return: -0.0394394410<br />Portfolio: IBOV","Date: 2021-08-31<br />Return: -0.0247945419<br />Portfolio: IBOV","Date: 2021-09-30<br />Return: -0.0656839057<br />Portfolio: IBOV","Date: 2021-10-31<br />Return: -0.0673821173<br />Portfolio: IBOV","Date: 2021-11-30<br />Return: -0.0153235234<br />Portfolio: IBOV","Date: 2021-12-31<br />Return:  0.0285237698<br />Portfolio: IBOV","Date: 2022-01-31<br />Return:  0.0721795043<br />Portfolio: IBOV","Date: 2022-02-28<br />Return:  0.0067089013<br />Portfolio: IBOV","Date: 2022-03-31<br />Return:  0.0606052571<br />Portfolio: IBOV","Date: 2022-04-30<br />Return: -0.1010258419<br />Portfolio: IBOV","Date: 2022-05-31<br />Return:  0.0322129111<br />Portfolio: IBOV","Date: 2022-06-30<br />Return: -0.1150326445<br />Portfolio: IBOV","Date: 2022-07-31<br />Return:  0.0469140062<br />Portfolio: IBOV","Date: 2022-08-31<br />Return:  0.0616294286<br />Portfolio: IBOV","Date: 2022-09-30<br />Return:  0.0046930782<br />Portfolio: IBOV","Date: 2022-10-31<br />Return:  0.0545271136<br />Portfolio: IBOV","Date: 2022-11-30<br />Return: -0.0306023079<br />Portfolio: IBOV","Date: 2022-12-31<br />Return: -0.0218249382<br />Portfolio: IBOV","Date: 2023-01-31<br />Return:  0.0318183058<br />Portfolio: IBOV","Date: 2023-02-28<br />Return: -0.0757495684<br />Portfolio: IBOV","Date: 2023-03-31<br />Return: -0.0290664430<br />Portfolio: IBOV","Date: 2023-04-30<br />Return:  0.0250289551<br />Portfolio: IBOV","Date: 2023-05-31<br />Return:  0.0373736020<br />Portfolio: IBOV","Date: 2023-06-30<br />Return:  0.0900170767<br />Portfolio: IBOV","Date: 2023-07-31<br />Return:  0.0326538908<br />Portfolio: IBOV","Date: 2023-08-31<br />Return: -0.0508516274<br />Portfolio: IBOV","Date: 2023-09-30<br />Return:  0.0071106426<br />Portfolio: IBOV","Date: 2023-10-31<br />Return: -0.0293484322<br />Portfolio: IBOV","Date: 2023-11-30<br />Return:  0.1253888850<br />Portfolio: IBOV","Date: 2023-12-31<br />Return:  0.0538282115<br />Portfolio: IBOV","Date: 2024-01-31<br />Return: -0.0479412751<br />Portfolio: IBOV","Date: 2024-02-29<br />Return:  0.0099254806<br />Portfolio: IBOV","Date: 2024-03-31<br />Return: -0.0070841730<br />Portfolio: IBOV","Date: 2024-04-30<br />Return: -0.0170327697<br />Portfolio: IBOV","Date: 2024-05-31<br />Return: -0.0255471554<br />Portfolio: IBOV"],"type":"scatter","mode":"lines","line":{"width":1.8897637795275593,"color":"rgba(248,118,109,1)","dash":"solid"},"hoveron":"points","name":"(IBOV,1)","legendgroup":"(IBOV,1)","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[18443,18474,18505,18535,18566,18596,18627,18658,18686,18717,18747,18778,18808,18839,18870,18900,18931,18961,18992,19023,19051,19082,19112,19143,19173,19204,19235,19265,19296,19326,19357,19388,19416,19447,19477,19508,19538,19569,19600,19630,19661,19691,19722,19753,19782,19813,19843,19874],"y":[0.09756919649346063,0.073983282518158333,0.011682841504130792,-0.010579402003635052,0.012461830317722411,0.27531021784072185,0.11301211062450345,-0.012225796052729887,-0.037557646991418836,0.030266517777135959,0.060145099781580003,0.061467108419799743,0.017708534041781965,-0.039517773414943114,-0.031894797972862432,-0.11002294119423528,-0.14953041926641986,-0.068126354292276425,0.029143791644404171,0.056076796147237484,0.015448260784761247,0.090427172066694705,-0.11935595619942574,-0.038229201131759538,-0.171074092826904,0.037231226939780315,0.18697561857534972,-0.0037163923972095558,-0.00058891220891910123,0.025642208746787576,-0.040620189202954626,0.14112505467281111,-0.13109719265326403,0.064170850644063693,0.00091148203964275254,0.050554203426702138,0.08078975047611392,0.010263765787788648,-0.038904400861657362,-0.0020322522481120986,-0.072579723478466973,0.14275022137964943,0.046733141063256989,-0.059492856993426879,0.0032441348322815866,-0.031222626306732892,-0.015578530136311053,-0.016498268257925552],"text":["Date: 2020-06-30<br />Return:  0.0975691965<br />Portfolio: portfolio.returns","Date: 2020-07-31<br />Return:  0.0739832825<br />Portfolio: portfolio.returns","Date: 2020-08-31<br />Return:  0.0116828415<br />Portfolio: portfolio.returns","Date: 2020-09-30<br />Return: -0.0105794020<br />Portfolio: portfolio.returns","Date: 2020-10-31<br />Return:  0.0124618303<br />Portfolio: portfolio.returns","Date: 2020-11-30<br />Return:  0.2753102178<br />Portfolio: portfolio.returns","Date: 2020-12-31<br />Return:  0.1130121106<br />Portfolio: portfolio.returns","Date: 2021-01-31<br />Return: -0.0122257961<br />Portfolio: portfolio.returns","Date: 2021-02-28<br />Return: -0.0375576470<br />Portfolio: portfolio.returns","Date: 2021-03-31<br />Return:  0.0302665178<br />Portfolio: portfolio.returns","Date: 2021-04-30<br />Return:  0.0601450998<br />Portfolio: portfolio.returns","Date: 2021-05-31<br />Return:  0.0614671084<br />Portfolio: portfolio.returns","Date: 2021-06-30<br />Return:  0.0177085340<br />Portfolio: portfolio.returns","Date: 2021-07-31<br />Return: -0.0395177734<br />Portfolio: portfolio.returns","Date: 2021-08-31<br />Return: -0.0318947980<br />Portfolio: portfolio.returns","Date: 2021-09-30<br />Return: -0.1100229412<br />Portfolio: portfolio.returns","Date: 2021-10-31<br />Return: -0.1495304193<br />Portfolio: portfolio.returns","Date: 2021-11-30<br />Return: -0.0681263543<br />Portfolio: portfolio.returns","Date: 2021-12-31<br />Return:  0.0291437916<br />Portfolio: portfolio.returns","Date: 2022-01-31<br />Return:  0.0560767961<br />Portfolio: portfolio.returns","Date: 2022-02-28<br />Return:  0.0154482608<br />Portfolio: portfolio.returns","Date: 2022-03-31<br />Return:  0.0904271721<br />Portfolio: portfolio.returns","Date: 2022-04-30<br />Return: -0.1193559562<br />Portfolio: portfolio.returns","Date: 2022-05-31<br />Return: -0.0382292011<br />Portfolio: portfolio.returns","Date: 2022-06-30<br />Return: -0.1710740928<br />Portfolio: portfolio.returns","Date: 2022-07-31<br />Return:  0.0372312269<br />Portfolio: portfolio.returns","Date: 2022-08-31<br />Return:  0.1869756186<br />Portfolio: portfolio.returns","Date: 2022-09-30<br />Return: -0.0037163924<br />Portfolio: portfolio.returns","Date: 2022-10-31<br />Return: -0.0005889122<br />Portfolio: portfolio.returns","Date: 2022-11-30<br />Return:  0.0256422087<br />Portfolio: portfolio.returns","Date: 2022-12-31<br />Return: -0.0406201892<br />Portfolio: portfolio.returns","Date: 2023-01-31<br />Return:  0.1411250547<br />Portfolio: portfolio.returns","Date: 2023-02-28<br />Return: -0.1310971927<br />Portfolio: portfolio.returns","Date: 2023-03-31<br />Return:  0.0641708506<br />Portfolio: portfolio.returns","Date: 2023-04-30<br />Return:  0.0009114820<br />Portfolio: portfolio.returns","Date: 2023-05-31<br />Return:  0.0505542034<br />Portfolio: portfolio.returns","Date: 2023-06-30<br />Return:  0.0807897505<br />Portfolio: portfolio.returns","Date: 2023-07-31<br />Return:  0.0102637658<br />Portfolio: portfolio.returns","Date: 2023-08-31<br />Return: -0.0389044009<br />Portfolio: portfolio.returns","Date: 2023-09-30<br />Return: -0.0020322522<br />Portfolio: portfolio.returns","Date: 2023-10-31<br />Return: -0.0725797235<br />Portfolio: portfolio.returns","Date: 2023-11-30<br />Return:  0.1427502214<br />Portfolio: portfolio.returns","Date: 2023-12-31<br />Return:  0.0467331411<br />Portfolio: portfolio.returns","Date: 2024-01-31<br />Return: -0.0594928570<br />Portfolio: portfolio.returns","Date: 2024-02-29<br />Return:  0.0032441348<br />Portfolio: portfolio.returns","Date: 2024-03-31<br />Return: -0.0312226263<br />Portfolio: portfolio.returns","Date: 2024-04-30<br />Return: -0.0155785301<br />Portfolio: portfolio.returns","Date: 2024-05-31<br />Return: -0.0164982683<br />Portfolio: portfolio.returns"],"type":"scatter","mode":"lines","line":{"width":1.8897637795275593,"color":"rgba(0,191,196,1)","dash":"solid"},"hoveron":"points","name":"(portfolio.returns,1)","legendgroup":"(portfolio.returns,1)","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null}],"layout":{"margin":{"t":47.481942714819425,"r":7.3059360730593621,"b":40.182648401826491,"l":48.949771689497723},"font":{"color":"rgba(0,0,0,1)","family":"","size":14.611872146118724},"title":{"text":"<b> Retorno do portifólio vs IBOV ao longo do tempo <\/b>","font":{"color":"rgba(0,0,0,1)","family":"","size":21.253632212536321},"x":0.5,"xref":"paper"},"xaxis":{"domain":[0,1],"automargin":true,"type":"linear","autorange":false,"range":[18371.450000000001,19945.549999999999],"tickmode":"array","ticktext":["2021","2022","2023","2024"],"tickvals":[18628,18993,19358,19723],"categoryorder":"array","categoryarray":["2021","2022","2023","2024"],"nticks":null,"ticks":"","tickcolor":null,"ticklen":3.6529680365296811,"tickwidth":0,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.68949771689498},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"gridcolor":"rgba(235,235,235,1)","gridwidth":0.66417600664176002,"zeroline":false,"anchor":"y","title":{"text":"Data","font":{"color":"rgba(0,0,0,1)","family":"","size":14.611872146118724}},"hoverformat":".2f"},"yaxis":{"domain":[0,1],"automargin":true,"type":"linear","autorange":false,"range":[-0.19339330836028529,0.29762943337410314],"tickmode":"array","ticktext":["-0.1","0.0","0.1","0.2"],"tickvals":[-0.10000000000000001,0,0.10000000000000003,0.20000000000000001],"categoryorder":"array","categoryarray":["-0.1","0.0","0.1","0.2"],"nticks":null,"ticks":"","tickcolor":null,"ticklen":3.6529680365296811,"tickwidth":0,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.68949771689498},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"gridcolor":"rgba(235,235,235,1)","gridwidth":0.66417600664176002,"zeroline":false,"anchor":"x","title":{"text":"Retorno","font":{"color":"rgba(0,0,0,1)","family":"","size":14.611872146118724}},"hoverformat":".2f"},"shapes":[{"type":"rect","fillcolor":null,"line":{"color":null,"width":0,"linetype":[]},"yref":"paper","xref":"paper","x0":0,"x1":1,"y0":0,"y1":1}],"showlegend":true,"legend":{"bgcolor":null,"bordercolor":null,"borderwidth":0,"font":{"color":"rgba(0,0,0,1)","family":"","size":11.68949771689498},"title":{"text":"Portfólio","font":{"color":"rgba(0,0,0,1)","family":"","size":14.611872146118724}}},"hovermode":"closest","barmode":"relative"},"config":{"doubleClick":"reset","modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"source":"A","attrs":{"824ac3ca4c118":{"x":{},"y":{},"colour":{},"type":"scatter"}},"cur_data":"824ac3ca4c118","visdat":{"824ac3ca4c118":["function (y) ","x"]},"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</section>
<section id="bonus-plotando-a-fronteira-eficiente" class="level2">
<h2 class="anchored" data-anchor-id="bonus-plotando-a-fronteira-eficiente">Bonus: Plotando a fronteira eficiente</h2>
<p>A fronteira eficiente é uma curva que mostra a combinação ótima de ativos em uma carteira que maximiza o retorno esperado para um determinado nível de risco. Note que o indice de Sharpe é a inclinação da linha tangente a fronteira eficiente, o intercepto com o eixo y é o retorno livre de risco e o ponto de tangência é o ponto com o maior indice de Sharpe.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculando a fronteira eficiente</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>frontier <span class="ot">&lt;-</span> <span class="fu">create.EfficientFrontier</span>(<span class="at">R =</span> asset_returns_xts, <span class="at">portfolio =</span> port_spec, <span class="at">type =</span> <span class="st">"mean-StdDev"</span>)</span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Plotando a fronteira eficiente</span></span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a><span class="fu">chart.EfficientFrontier</span>(frontier, <span class="at">match.col =</span> <span class="st">"StdDev"</span>,<span class="at">n.portfolios =</span> <span class="dv">30</span>, <span class="at">main =</span> <span class="st">"Fronteira eficiente"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="aula_2_files/figure-html/unnamed-chunk-23-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="dashboards-interativos-com-quarto" class="level2">
<h2 class="anchored" data-anchor-id="dashboards-interativos-com-quarto">Dashboards interativos com QUARTO</h2>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://quarto.org/docs/dashboards/.png" class="img-fluid figure-img"></p>
<figcaption>Clique aqui!!</figcaption>
</figure>
</div>
</section>
<section id="exercício" class="level2">
<h2 class="anchored" data-anchor-id="exercício">Exercício</h2>
<ul>
<li>Crie uma carteira com 5 ativos de sua escolha</li>
<li>Baixe os preços dos ativos</li>
<li>Calcule os retornos mensais</li>
<li>Crie um vetor de pesos para a carteira</li>
<li>Calcule o retorno da carteira</li>
<li>Faça a otimização da carteira com o objetivo de maximizar o retorno esperado e minimizar o risco</li>
<li>Opcionalmente faça a otimização com rebalanceamento</li>
<li>Visualize o retorno da carteira e dos ativos</li>
<li>Compare o retorno da carteira com o índice do mercado</li>
<li>Salve o seu dashboard e compartilhe com o professor</li>
</ul>
</section>
<section id="dica-use-o-arquivo-das-aulas-anteriores-como-referência-para-criar-o-seu-dashboard" class="level2">
<h2 class="anchored" data-anchor-id="dica-use-o-arquivo-das-aulas-anteriores-como-referência-para-criar-o-seu-dashboard">Dica: Use o arquivo das aulas anteriores como referência para criar o seu dashboard</h2>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>