<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.549">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Marcus Ramalho">

<title>Finanças com R - análise e otimização de carteiras - Aula 2 - Análise e otimização de carteiras</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<link href="site_libs/htmltools-fill-0.5.8.1/fill.css" rel="stylesheet">
<script src="site_libs/htmlwidgets-1.6.4/htmlwidgets.js"></script>
<script src="site_libs/plotly-binding-4.10.4/plotly.js"></script>
<script src="site_libs/typedarray-0.1/typedarray.min.js"></script>
<script src="site_libs/jquery-3.5.1/jquery.min.js"></script>
<link href="site_libs/crosstalk-1.2.1/css/crosstalk.min.css" rel="stylesheet">
<script src="site_libs/crosstalk-1.2.1/js/crosstalk.min.js"></script>
<link href="site_libs/plotly-htmlwidgets-css-2.11.1/plotly-htmlwidgets.css" rel="stylesheet">
<script src="site_libs/plotly-main-2.11.1/plotly-latest.min.js"></script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-fixed fullcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">Finanças com R - análise e otimização de carteiras</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="./index.html"> <i class="bi bi-house" role="img">
</i> 
<span class="menu-text">Início</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./apresentacao.html"> <i class="bi bi-easel" role="img">
</i> 
<span class="menu-text">Apresentação</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./aula_1.html"> <i class="bi bi-book" role="img">
</i> 
<span class="menu-text">Aula 1</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link active" href="./aula_2.html" aria-current="page"> <i class="bi bi-book" role="img">
</i> 
<span class="menu-text">Aula 2</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./dashboard.html"> <i class="bi bi-speedometer" role="img">
</i> 
<span class="menu-text">Dashboard</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Aula 2 - Análise e otimização de carteiras</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Professor: </div>
    <div class="quarto-title-meta-contents">
             <p>Marcus Ramalho </p>
          </div>
  </div>
    
  
    
  </div>
  


</header>


<section id="relembrando-alguns-conceitos-sobre-risco" class="level2">
<h2 class="anchored" data-anchor-id="relembrando-alguns-conceitos-sobre-risco">Relembrando alguns conceitos sobre risco</h2>
<p><strong>Risco</strong>: Probabilidade de um resultado adverso em relação ao esperado.</p>
<p><img src="images/paste-2.png" class="img-fluid" width="718"></p>
</section>
<section id="tipos-de-risco" class="level2">
<h2 class="anchored" data-anchor-id="tipos-de-risco">Tipos de risco</h2>
<ul>
<li><strong>Risco conhecido</strong>: Distribuição de probabilidade do evento é conhecida (ex: falha de motor).</li>
<li><strong>Incerteza</strong>: Distribuição de probabilidade desconhecida ou imprevisível (ex: crise econômica).</li>
</ul>
</section>
<section id="atitudes-frente-ao-risco" class="level2">
<h2 class="anchored" data-anchor-id="atitudes-frente-ao-risco">Atitudes frente ao risco</h2>
<ul>
<li><strong>Aversão</strong>: Prefere menor risco para mesmo retorno.</li>
<li><strong>Indiferença</strong>: Não se importa com o risco.</li>
<li><strong>Propensão</strong>: Aceita maior risco por potencial de maior retorno.</li>
</ul>
<p><img src="images/paste-3.png" class="img-fluid" width="723"></p>
<p>O participante de uma apólice de seguros têm que predisposição frente ao risco?</p>
<p>E a companhia de seguros?</p>
</section>
<section id="mensuração-do-risco" class="level2">
<h2 class="anchored" data-anchor-id="mensuração-do-risco">Mensuração do Risco</h2>
<ul>
<li><strong>Desvio padrão (σ)</strong>: Mede a dispersão dos resultados em torno da média.</li>
<li><strong>Coeficiente de variação (CV)</strong>: Mede o risco por unidade de retorno (σ / retorno médio).</li>
</ul>
</section>
<section id="risco-de-carteira" class="level2">
<h2 class="anchored" data-anchor-id="risco-de-carteira">Risco de Carteira</h2>
<ul>
<li><strong>Covariância</strong>: Mede a relação entre os retornos de dois ativos.</li>
<li><strong>Diversificação</strong>: Reduz o risco total da carteira ao combinar ativos com diferentes riscos (Markowitz, 1952) - “Não colocar todos os ovos na mesma cesta”.</li>
</ul>
</section>
<section id="risco-individual-vs.-sistêmico" class="level2">
<h2 class="anchored" data-anchor-id="risco-individual-vs.-sistêmico">Risco individual vs.&nbsp;sistêmico</h2>
<ul>
<li><strong>Individual</strong>: Específico de cada ativo.</li>
<li><strong>Sistêmico</strong>: Afeta todo o mercado.</li>
</ul>
</section>
<section id="índice-sharpe-is" class="level2">
<h2 class="anchored" data-anchor-id="índice-sharpe-is">Índice Sharpe (IS)</h2>
<ul>
<li><strong>Definição</strong>: Mede o retorno adicional por unidade de risco em relação à taxa livre de risco.</li>
<li><strong>Fórmula</strong>: IS = (Retorno médio do portfólio - Taxa livre de risco) / Desvio padrão do excesso de retorno.</li>
<li><strong>interpretação</strong>: IS &gt; 1: Retorno adicional por unidade de risco; IS &lt; 1: Retorno insuficiente por unidade de risco. Quantos mais alto o índice, melhor.</li>
</ul>
</section>
<section id="beta-β" class="level2">
<h2 class="anchored" data-anchor-id="beta-β">Beta (β)</h2>
<ul>
<li><strong>Definição</strong>: Mede a sensibilidade do retorno de um ativo em relação ao retorno do mercado.</li>
<li><strong>Fórmula</strong>: β = Cov(Ri, Rm) / Var(Rm).</li>
<li><strong>Interpretação</strong>: β &gt; 1: Ativo mais volátil que o mercado; β &lt; 1: Ativo menos volátil que o mercado.</li>
<li><strong>Exemplo</strong>: Se β = 1, o ativo se move na mesma direção que o mercado.</li>
</ul>
</section>
<section id="alfa-α" class="level2">
<h2 class="anchored" data-anchor-id="alfa-α">Alfa (α)</h2>
<ul>
<li><strong>Definição</strong>: Mede o retorno adicional de um ativo em relação ao retorno esperado com base no risco.</li>
<li><strong>Fórmula</strong>: α = Retorno do ativo - (Taxa livre de risco + β * (Retorno do mercado - Taxa livre de risco)).</li>
<li><strong>Interpretação</strong>: α &gt; 0: Ativo superou o retorno esperado; α &lt; 0: Ativo ficou aquém do retorno esperado.</li>
<li><strong>Exemplo</strong>: Se α = 0, o ativo teve o retorno esperado com base no risco.</li>
<li><strong>Observação</strong>: O alfa é uma medida de desempenho ajustada ao risco.</li>
</ul>
</section>
<section id="função-de-utilidade-quadrática" class="level2">
<h2 class="anchored" data-anchor-id="função-de-utilidade-quadrática">Função de utilidade quadrática</h2>
<p>A função de utilidade quadrática é usada na otimização de portfólios para encontrar a alocação de ativos que maximiza o retorno esperado e minimiza o risco. A função de utilidade quadrática é dada por:</p>
<p><span class="math inline">\(U = \mu^T w - \lambda \sigma^2\)</span></p>
<p>onde:</p>
<ul>
<li><span class="math inline">\(U\)</span> é a função de utilidade</li>
<li><span class="math inline">\(\mu^T\)</span> é o vetor de retornos esperados</li>
<li><span class="math inline">\(w\)</span> é o vetor de pesos dos ativos</li>
<li><span class="math inline">\(\lambda\)</span> é o fator de aversão ao risco</li>
</ul>
<p>generalizando para o caso de <span class="math inline">\(n\)</span> ativos, a função de utilidade quadrática é dada por:</p>
<p><span class="math inline">\(U = \mu^T w - \lambda w^T \Sigma w\)</span></p>
<p>onde:</p>
<ul>
<li><span class="math inline">\(\Sigma w\)</span> é a matriz de covariância dos retornos dos ativos</li>
<li><span class="math inline">\(w^T\)</span> é o vetor transposto de pesos dos ativos</li>
<li><span class="math inline">\(w\)</span> é o vetor de pesos dos ativos</li>
<li><span class="math inline">\(\lambda\)</span> é o fator de aversão ao risco</li>
<li><span class="math inline">\(\mu\)</span> é o vetor de retornos esperados</li>
<li><span class="math inline">\(U\)</span> é a função de utilidade</li>
</ul>
</section>
<section id="otimização-de-portfólios" class="level2">
<h2 class="anchored" data-anchor-id="otimização-de-portfólios">Otimização de portfólios</h2>
<p>A otimização de portfólios é um problema de maximização da função de utilidade quadrática sujeita a restrições, como a soma dos pesos dos ativos deve ser igual a 1 e os pesos dos ativos devem ser maiores ou iguais a zero.</p>
</section>
<section id="primeiro-vamos-carregar-os-pacotes-necessários" class="level2">
<h2 class="anchored" data-anchor-id="primeiro-vamos-carregar-os-pacotes-necessários">Primeiro vamos carregar os pacotes necessários</h2>
</section>
<section id="ativos-selecionados" class="level2">
<h2 class="anchored" data-anchor-id="ativos-selecionados">Ativos selecionados</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Ativos selecionados</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>tickers <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"VALE3.SA"</span>,<span class="st">"PETR4.SA"</span>,<span class="st">"AZUL4.SA"</span>,<span class="st">"MGLU3.SA"</span>, <span class="st">"CMIG4.SA"</span>)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>prices <span class="ot">&lt;-</span> </span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">getSymbols</span>(tickers, </span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>             <span class="at">src =</span> <span class="st">'yahoo'</span>, </span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>             <span class="at">from =</span> <span class="st">"2019-05-30"</span>,</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>             <span class="at">to =</span> <span class="st">"2024-05-30"</span>,</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>             <span class="at">auto.assign =</span> <span class="cn">TRUE</span>, <span class="co">#obs auto asign carrega os resultados para o ambiente</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>             <span class="at">warnings =</span> <span class="cn">FALSE</span>,) <span class="sc">%&gt;%</span> </span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">map</span>(<span class="sc">~</span><span class="fu">Ad</span>(<span class="fu">get</span>(.))) <span class="sc">%&gt;%</span> </span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">reduce</span>(merge) <span class="sc">%&gt;%</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>  <span class="st">`</span><span class="at">colnames&lt;-</span><span class="st">`</span>(tickers)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="baixando-os-preços-do-benchmark" class="level2">
<h2 class="anchored" data-anchor-id="baixando-os-preços-do-benchmark">Baixando os preços do benchmark</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Baixando os preços do IBOV</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>ibov <span class="ot">&lt;-</span> <span class="fu">getSymbols</span>(<span class="st">"^BVSP"</span>, </span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>                   <span class="at">src =</span> <span class="st">'yahoo'</span>, </span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>                   <span class="at">from =</span> <span class="st">"2019-05-30"</span>,</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>                   <span class="at">to =</span> <span class="st">"2024-05-30"</span>,</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>                   <span class="at">auto.assign =</span> <span class="cn">TRUE</span>, </span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>                   <span class="at">warnings =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">map</span>(<span class="sc">~</span><span class="fu">Ad</span>(<span class="fu">get</span>(.))) <span class="sc">%&gt;%</span> </span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">reduce</span>(merge) <span class="sc">%&gt;%</span> </span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>  <span class="st">`</span><span class="at">colnames&lt;-</span><span class="st">`</span>(<span class="st">"IBOV"</span>)</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(ibov)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>            IBOV
2019-05-30 97457
2019-05-31 97030
2019-06-03 97020
2019-06-04 97380
2019-06-05 95999
2019-06-06 97205</code></pre>
</div>
</div>
</section>
<section id="agora-vamos-converter-os-preços-diários-em-mensais" class="level2">
<h2 class="anchored" data-anchor-id="agora-vamos-converter-os-preços-diários-em-mensais">Agora vamos converter os preços diários em mensais</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>prices_monthly <span class="ot">&lt;-</span> <span class="fu">to.monthly</span>(prices, <span class="at">indexAt =</span> <span class="st">"lastof"</span>, <span class="at">OHLC =</span> <span class="cn">FALSE</span>)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(prices_monthly)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>           VALE3.SA  PETR4.SA AZUL4.SA  MGLU3.SA CMIG4.SA
2019-05-31 31.99329  8.838511    39.20  56.97055 4.504750
2019-06-30 33.83452  9.481941    43.29  61.36542 4.532218
2019-07-31 32.52215  9.021853    51.78  76.65446 4.315526
2019-08-31 29.75375  8.890536    47.10  84.38617 4.504750
2019-09-30 31.17713  9.605266    49.71  86.13017 4.373514
2019-10-31 30.81802 10.595428    52.52 104.00203 4.165978</code></pre>
</div>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>ibov_monthly <span class="ot">&lt;-</span> <span class="fu">to.monthly</span>(ibov, <span class="at">indexAt =</span> <span class="st">"lastof"</span>, <span class="at">OHLC =</span> <span class="cn">FALSE</span>)</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(ibov_monthly)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>             IBOV
2019-05-31  97030
2019-06-30 100967
2019-07-31 101812
2019-08-31 101135
2019-09-30 104745
2019-10-31 107220</code></pre>
</div>
</div>
</section>
<section id="vamos-calcular-os-retornos-mensais" class="level2">
<h2 class="anchored" data-anchor-id="vamos-calcular-os-retornos-mensais">Vamos calcular os retornos mensais</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>asset_returns_xts <span class="ot">&lt;-</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a> PerformanceAnalytics<span class="sc">::</span><span class="fu">Return.calculate</span>(prices_monthly, </span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">method =</span> <span class="st">"discrete"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">na.omit</span>()</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>ibov_returns_xts <span class="ot">&lt;-</span> </span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>  PerformanceAnalytics<span class="sc">::</span><span class="fu">Return.calculate</span>(ibov_monthly, </span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>                   <span class="at">method =</span> <span class="st">"discrete"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">na.omit</span>()</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(asset_returns_xts)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>              VALE3.SA    PETR4.SA    AZUL4.SA    MGLU3.SA     CMIG4.SA
2019-06-30  0.05755070  0.07279843  0.10433674 0.077142780  0.006097609
2019-07-31 -0.03878791 -0.04852253  0.19611914 0.249147410 -0.047811357
2019-08-31 -0.08512358 -0.01455545 -0.09038240 0.100864485  0.043847093
2019-09-30  0.04783874  0.08039215  0.05541403 0.020666842 -0.029132823
2019-10-31 -0.01151831  0.10308532  0.05652789 0.207498317 -0.047452862
2019-11-30  0.05889827 -0.03443152  0.01104337 0.008736513 -0.043956126</code></pre>
</div>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(ibov_returns_xts)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                   IBOV
2019-06-30  0.040575080
2019-07-31  0.008369071
2019-08-31 -0.006649511
2019-09-30  0.035694863
2019-10-31  0.023628813
2019-11-30  0.009447864</code></pre>
</div>
</div>
</section>
<section id="otimização-da-carteira" class="level2">
<h2 class="anchored" data-anchor-id="otimização-da-carteira">Otimização da carteira</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Criando o objeto de otimização</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>portf <span class="ot">&lt;-</span> <span class="fu">portfolio.spec</span>(<span class="at">assets =</span> <span class="fu">colnames</span>(asset_returns_xts))</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Adicionando restrições, como por exemplo, a soma dos pesos dos ativos deve ser igual a 1</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>portf <span class="ot">&lt;-</span> <span class="fu">add.constraint</span>(portf, <span class="at">type =</span> <span class="st">"full_investment"</span>)</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Adicionando restrição de peso mínimo e máximo para cada ativo</span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Neste caso, o peso mínimo é 0 e o peso máximo é 1</span></span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>portf <span class="ot">&lt;-</span> <span class="fu">add.constraint</span>(portf, <span class="at">type =</span> <span class="st">"long_only"</span>)</span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Adiciona a função objetivo, que é minimizar o desvio padrão da carteira</span></span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>portf <span class="ot">&lt;-</span> <span class="fu">add.objective</span>(portf, <span class="at">type =</span> <span class="st">"risk"</span>, <span class="at">name =</span> <span class="st">"StdDev"</span>)</span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Resolve o problema de otimização</span></span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a>opt_portf <span class="ot">&lt;-</span> <span class="fu">optimize.portfolio</span>(asset_returns_xts, portf, <span class="at">optimize_method =</span> <span class="st">"ROI"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="resultados-da-otimização" class="level2">
<h2 class="anchored" data-anchor-id="resultados-da-otimização">Resultados da otimização</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>opt_portf</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>***********************************
PortfolioAnalytics Optimization
***********************************

Call:
optimize.portfolio(R = asset_returns_xts, portfolio = portf, 
    optimize_method = "ROI")

Optimal Weights:
VALE3.SA PETR4.SA AZUL4.SA MGLU3.SA CMIG4.SA 
  0.4881   0.0953   0.0000   0.0428   0.3738 

Objective Measure:
 StdDev 
0.07238 </code></pre>
</div>
</div>
</section>
<section id="extraindo-os-pesos-dos-ativos" class="level2">
<h2 class="anchored" data-anchor-id="extraindo-os-pesos-dos-ativos">Extraindo os pesos dos ativos</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># extraindo os pesos para um data frame</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>weights <span class="ot">&lt;-</span> <span class="fu">extractWeights</span>(opt_portf)</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Adicionando os nomes dos ativos sem colocá-los no índice</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>weights <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">tickers =</span> <span class="fu">colnames</span>(asset_returns_xts), weights, <span class="at">row.names =</span> <span class="cn">NULL</span>)</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>weights</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   tickers    weights
1 VALE3.SA 0.48813408
2 PETR4.SA 0.09528915
3 AZUL4.SA 0.00000000
4 MGLU3.SA 0.04276915
5 CMIG4.SA 0.37380763</code></pre>
</div>
</div>
</section>
<section id="plotando-com-o-portfolioanalytics" class="level2">
<h2 class="anchored" data-anchor-id="plotando-com-o-portfolioanalytics">plotando com o portfolioAnalytics</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">chart.Weights</span>(opt_portf)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="aula_2_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="plotando-com-ggplo2" class="level2">
<h2 class="anchored" data-anchor-id="plotando-com-ggplo2">Plotando com ggplo2</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(weights, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">reorder</span>(tickers, weights), <span class="at">y =</span> weights, <span class="at">fill =</span> tickers)) <span class="sc">+</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">color =</span> <span class="st">"black"</span>, <span class="at">show.legend =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">14</span>) <span class="sc">+</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">90</span>, <span class="at">hjust =</span> <span class="dv">1</span>),</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">size =</span> <span class="dv">20</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">size =</span> <span class="dv">16</span>),</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"none"</span>) <span class="sc">+</span></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_d</span>() <span class="sc">+</span></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Distribuição dos Pesos dos Ativos"</span>,</span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>   <span class="at">x =</span> <span class="st">"Ativos"</span>,</span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>   <span class="at">y =</span> <span class="st">"Pesos"</span>) <span class="sc">+</span></span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="aula_2_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="realizando-otimização-da-função-de-utilidade-com-o-portfolioanalytics" class="level2">
<h2 class="anchored" data-anchor-id="realizando-otimização-da-função-de-utilidade-com-o-portfolioanalytics">Realizando otimização da função de utilidade com o PortfolioAnalytics</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co">#criar o objeto de otimização</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>portf <span class="ot">&lt;-</span> <span class="fu">portfolio.spec</span>(<span class="at">assets =</span> <span class="fu">colnames</span>(asset_returns_xts))</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Adicionando restrições, como por exemplo, a soma dos pesos dos ativos deve ser igual a 1</span></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>portf <span class="ot">&lt;-</span> <span class="fu">add.constraint</span>(portf, <span class="at">type =</span> <span class="st">"full_investment"</span>)</span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Adicionando restrição de peso mínimo e máximo para cada ativo (0-1)</span></span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>portf <span class="ot">&lt;-</span> <span class="fu">add.constraint</span>(portf, <span class="at">type =</span> <span class="st">"long_only"</span>)</span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Adiciona a função objetivo, que é maximizar o retorno esperado</span></span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a>portf <span class="ot">&lt;-</span> <span class="fu">add.objective</span>(portf, <span class="at">type =</span> <span class="st">"return"</span>, <span class="at">name =</span> <span class="st">"mean"</span>)</span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Adiciona a função objetivo, que é minimizar a variância da carteira</span></span>
<span id="cb19-18"><a href="#cb19-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-19"><a href="#cb19-19" aria-hidden="true" tabindex="-1"></a>portf <span class="ot">&lt;-</span> <span class="fu">add.objective</span>(portf, <span class="at">type =</span> <span class="st">"risk"</span>, <span class="at">name =</span> <span class="st">"var"</span>)</span>
<span id="cb19-20"><a href="#cb19-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-21"><a href="#cb19-21" aria-hidden="true" tabindex="-1"></a>portf <span class="ot">&lt;-</span> <span class="fu">add.objective</span>(portf, <span class="at">type =</span> <span class="st">"quadratic_utility"</span>, <span class="at">risk_aversion =</span> <span class="dv">10</span>)</span>
<span id="cb19-22"><a href="#cb19-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-23"><a href="#cb19-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Resolve o problema de otimização</span></span>
<span id="cb19-24"><a href="#cb19-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-25"><a href="#cb19-25" aria-hidden="true" tabindex="-1"></a>opt_portf <span class="ot">&lt;-</span> <span class="fu">optimize.portfolio</span>(asset_returns_xts, portf, <span class="at">optimize_method =</span> <span class="st">"ROI"</span>)</span>
<span id="cb19-26"><a href="#cb19-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-27"><a href="#cb19-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Extraindo os pesos dos ativos</span></span>
<span id="cb19-28"><a href="#cb19-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-29"><a href="#cb19-29" aria-hidden="true" tabindex="-1"></a><span class="fu">extractWeights</span>(opt_portf)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   VALE3.SA    PETR4.SA    AZUL4.SA    MGLU3.SA    CMIG4.SA 
0.478117434 0.193940744 0.000000000 0.007504457 0.320437365 </code></pre>
</div>
</div>
</section>
<section id="pesos" class="level2">
<h2 class="anchored" data-anchor-id="pesos">Pesos</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">extractWeights</span>(opt_portf)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   VALE3.SA    PETR4.SA    AZUL4.SA    MGLU3.SA    CMIG4.SA 
0.478117434 0.193940744 0.000000000 0.007504457 0.320437365 </code></pre>
</div>
</div>
</section>
<section id="entendendo-a-especificação-do-portfólio" class="level2">
<h2 class="anchored" data-anchor-id="entendendo-a-especificação-do-portfólio">Entendendo a especificação do portfólio</h2>
<p>O objeto de portfólio é uma lista que contém as seguintes informações:</p>
<ul>
<li><strong>assets</strong>: vetor de nomes dos ativos</li>
<li><strong>constraints</strong>: lista de restrições
<ul>
<li><strong>weight_sum</strong>: restrição de que a soma dos pesos dos ativos deve ser igual a um valor específico</li>
<li><strong>full_investment</strong>: restrição de que a soma dos pesos dos ativos deve ser igual a 1</li>
<li><strong>dollar_neutral</strong>: restrição de que a soma dos pesos dos ativos deve ser igual a zero</li>
<li><strong>box</strong>: restrição de que os pesos dos ativos devem estar dentro de um intervalo específico</li>
<li><strong>long_only</strong>: restrição de que os pesos dos ativos devem ser maiores ou iguais a zero e menores ou iguais a um (caso especial da restrição box)</li>
<li><strong>group</strong>: restrição de que os pesos dos ativos de um grupo específico devem ser iguais</li>
<li><strong>turnover</strong>: restrição de que o turnover da carteira deve ser menor ou igual a um valor específico a partir de uma carteira inicial</li>
<li><strong>diversification</strong>: Especifica um valor de diversificação para a carteira</li>
<li><strong>position_limit</strong>: Permite ao usuário definir o número máximo de posições (ativos com pesos não nulos) e o número máximo de posições compradas e vendidas.</li>
<li><strong>return</strong>: Especifica o retorno médio esperado da carteira</li>
<li><strong>factor_exposure</strong>: Especifica a exposição da carteira a fatores de risco</li>
<li><strong>leverage_exposure</strong>: Especifica a alavancagem maxima da carteira onde a alavancagem é definida como a soma dos pesos absolutos dos ativos</li>
</ul></li>
<li><strong>objectives</strong>:
<ul>
<li><strong>type</strong>: ‘return’,‘risk’, ‘risk_budget’, ‘quadratic_utility’, or ’weight_concentration</li>
</ul></li>
</ul>
</section>
<section id="passo-a-passo-da-otimização-de-portfólios" class="level2">
<h2 class="anchored" data-anchor-id="passo-a-passo-da-otimização-de-portfólios">Passo a passo da otimização de portfólios</h2>
<ol type="1">
<li>Carregar os preços dos ativos e do benchmark</li>
<li>Converter os preços diários em preços mensais</li>
<li>Calcular os retornos mensais dos ativos e do benchmark</li>
<li><strong>Criar o objeto de portfólio</strong></li>
<li><strong>Adicionar restrições ao objeto de portfólio</strong></li>
<li><strong>Adicionar a função objetivo ao objeto de portfólio</strong></li>
<li><strong>Resolver o problema de otimização</strong></li>
<li><strong>Exibir os resultados da otimização</strong></li>
<li><strong>Exibir os pesos dos ativos na carteira otimizada</strong></li>
<li><strong>Plotar a distribuição dos pesos dos ativos na carteira otimizada</strong></li>
</ol>
</section>
<section id="criando-um-objeto-para-as-especificações-do-portfólio" class="level2">
<h2 class="anchored" data-anchor-id="criando-um-objeto-para-as-especificações-do-portfólio">Criando um objeto para as especificações do portfólio</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Criando o objeto de portfólio, aqui estamos apenas especificando os ativos que serão utilizados na otimização</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>port_spec <span class="ot">&lt;-</span> <span class="fu">portfolio.spec</span>(<span class="at">assets =</span> <span class="fu">colnames</span>(asset_returns_xts))</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(port_spec)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "portfolio.spec" "portfolio"     </code></pre>
</div>
</div>
</section>
<section id="adicionando-restrições-ao-objeto-de-portfólio" class="level2">
<h2 class="anchored" data-anchor-id="adicionando-restrições-ao-objeto-de-portfólio">Adicionando restrições ao objeto de portfólio</h2>
<p>As restrições são condições que devem ser satisfeitas durante a otimização da carteira. Algumas restrições comuns são relacionadas ao peso dos ativos e ao retorno esperado da carteira.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Adicionando restrições, como por exemplo, a soma dos pesos dos ativos deve ser igual a 1</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>port_spec  <span class="ot">&lt;-</span> <span class="fu">add.constraint</span>(port_spec, <span class="at">type =</span> <span class="st">"weight_sum"</span>, <span class="at">min_sum =</span> <span class="dv">1</span>, <span class="at">max_sum =</span> <span class="dv">1</span>)</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a><span class="co"># adicionnando uma restrição de caixas para os pesos dos ativos</span></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>port_spec <span class="ot">&lt;-</span> <span class="fu">add.constraint</span>(port_spec, <span class="at">type =</span> <span class="st">"box"</span>, <span class="at">min =</span> <span class="fu">c</span>(<span class="fl">0.2</span>, <span class="fl">0.1</span>, <span class="fl">0.1</span>, <span class="fl">0.1</span>, <span class="fl">0.1</span>), <span class="at">max =</span> <span class="fl">0.4</span>)</span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(port_spec)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>**************************************************
PortfolioAnalytics Portfolio Specification 
**************************************************

Call:
portfolio.spec(assets = colnames(asset_returns_xts))

Number of assets: 5 
Asset Names
[1] "VALE3.SA" "PETR4.SA" "AZUL4.SA" "MGLU3.SA" "CMIG4.SA"

Constraints
Enabled constraint types
        - weight_sum 
        - box </code></pre>
</div>
</div>
</section>
<section id="adicionando-a-função-objetivo-ao-objeto-de-portfólio" class="level2">
<h2 class="anchored" data-anchor-id="adicionando-a-função-objetivo-ao-objeto-de-portfólio">Adicionando a função objetivo ao objeto de portfólio</h2>
<p>A função objetivo é a função que será otimizada durante o processo de otimização da carteira. Um objetivo comum é maximizar o retorno esperado da carteira e minimizar a volatilidade e o risco.</p>
<p>Lembre-se que o desvio padrão é a raiz quadrada da variância. E que a variância é a média dos quadrados dos desvios em relação à média. A variancia é geralmente usada para denotar o risco, quanto maior a variancia, maior o risco. Já geralmente denota a volatilidade, quanto maior o desvio padrão, maior a volatilidade. Ambas são medidas que servem como indicadores de risco.</p>
<p>No portfolioAnalytics, a função objetivo é adicionada ao objeto de portfólio usando a função <code>add.objective()</code>. Os objetivos mais usado são:</p>
<ul>
<li><strong>return</strong>: Maximizar o retorno esperado da carteira</li>
<li><strong>risk</strong>: Minimizar o risco da carteira</li>
<li><strong>risk_budget</strong>: Minimizar a contribuição marginal do risco de cada ativo para o risco total da carteira</li>
<li><strong>quadratic_utility</strong>: Maximizar a função de utilidade quadrática da carteira</li>
<li><strong>weight_concentration</strong>: Minimizar a concentração dos pesos dos ativos na carteira</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Adiciona a função objetivo, que é maximizar o retorno médio esperado da carteira</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>port_spec <span class="ot">&lt;-</span> <span class="fu">add.objective</span>(port_spec, <span class="at">type =</span> <span class="st">"return"</span>, <span class="at">name =</span> <span class="st">"mean"</span>)</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Adiciona a função objetivo, que é minimizar o desvio padrão da carteira</span></span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>port_spec <span class="ot">&lt;-</span> <span class="fu">add.objective</span>(port_spec, <span class="at">type =</span> <span class="st">"risk"</span>, <span class="at">name =</span> <span class="st">"StdDev"</span>)</span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Adiciona um objetivo para minimizar a contribuição marginal do risco de cada ativo para o risco total da carteira</span></span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a>port_spec <span class="ot">&lt;-</span> <span class="fu">add.objective</span>(port_spec, <span class="at">type =</span> <span class="st">"risk_budget"</span>, <span class="at">name =</span> <span class="st">"var"</span>, <span class="at">min_prisk =</span> <span class="fl">0.05</span>, <span class="at">max_prisk =</span> <span class="fl">0.1</span>)</span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(port_spec)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>**************************************************
PortfolioAnalytics Portfolio Specification 
**************************************************

Call:
portfolio.spec(assets = colnames(asset_returns_xts))

Number of assets: 5 
Asset Names
[1] "VALE3.SA" "PETR4.SA" "AZUL4.SA" "MGLU3.SA" "CMIG4.SA"

Constraints
Enabled constraint types
        - weight_sum 
        - box 

Objectives:
Enabled objective names
        - mean 
        - StdDev 
        - var </code></pre>
</div>
</div>
</section>
<section id="resolvendo-o-problema-de-otimização" class="level2">
<h2 class="anchored" data-anchor-id="resolvendo-o-problema-de-otimização">Resolvendo o problema de otimização</h2>
<p>Existem duas funções principais para resolver o problema de otimização da carteira: <code>optimize.portfolio()</code> e <code>optimize.portfolio.rebalancing()</code>. A função <code>optimize.portfolio()</code> é usada para otimizar a carteira sem rebalanceamento, enquanto a função <code>optimize.portfolio.rebalancing()</code> é usada para otimizar a carteira com rebalanceamento.</p>
<p>Lembre-se que o rebalanceamento é o processo de ajustar os pesos dos ativos na carteira para manter a alocação desejada ao longo do tempo.</p>
<p>O pacote suporta diversos métodos de otimização, como:</p>
<ul>
<li><strong>DEoptim</strong>: Differential Evolution</li>
<li><strong>random</strong>: Random Portfolios</li>
<li><strong>GenSA</strong>: Generalized Simulated Annealing</li>
<li><strong>pso</strong>: Particle Swarm Optimization</li>
<li><strong>ROI</strong>: R Optimization Infrastructure</li>
</ul>
<p>O método a ser usado irá depender do problema.</p>
<p>Vamos fazer fazer uma otimização usando o método de portifolios aleatórios. Nosso objetivo é maximizar o retorno esperado da carteira e minimizar o risco onde o risco minimo é 5% e o risco maximo é 10% sujeito a restrições de peso e de grupo.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co"># .storage &lt;&lt;- new.env()</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>rp <span class="ot">&lt;-</span> <span class="fu">random_portfolios</span>(port_spec, <span class="at">permutations =</span> <span class="dv">1000</span>, <span class="at">rp_method =</span> <span class="st">'simplex'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: executing %dopar% sequentially: no parallel backend registered</code></pre>
</div>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co"># rp &lt;- random_portfolios(port_spec, permutations = 1000, rp_method = 'sample')</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="co"># rp &lt;- random_portfolios(port_spec, permutations = 1000, rp_method = 'grid') </span></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(rp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        VALE3.SA  PETR4.SA  AZUL4.SA  MGLU3.SA  CMIG4.SA
  [1,] 0.2553009 0.2823164 0.1085020 0.1968331 0.1570475
  [2,] 0.2637727 0.2583768 0.1186960 0.1679108 0.1912437
  [3,] 0.2747598 0.1906997 0.2299317 0.1415284 0.1630804
  [4,] 0.3328999 0.2451973 0.1482747 0.1381504 0.1354777
  [5,] 0.2125909 0.1681378 0.2107804 0.3072961 0.1011947
  [6,] 0.2455285 0.1591820 0.2902476 0.2036628 0.1013790
  [7,] 0.3280805 0.1545148 0.1316195 0.2072264 0.1785587
  [8,] 0.2581695 0.2916692 0.1021978 0.2074828 0.1404808
  [9,] 0.2000922 0.2801524 0.1254651 0.1009459 0.2933443
 [10,] 0.2926551 0.2070047 0.1431385 0.2246330 0.1325686
 [11,] 0.2506786 0.1466149 0.2658735 0.2239481 0.1128850
 [12,] 0.2428221 0.1449187 0.1705210 0.1908108 0.2509274
 [13,] 0.3327045 0.1703014 0.1030826 0.1234005 0.2705110
 [14,] 0.2171687 0.1827312 0.1754881 0.2453442 0.1792677
 [15,] 0.2257164 0.1486769 0.1622588 0.2173474 0.2460005
 [16,] 0.2570721 0.1034595 0.3238138 0.1893788 0.1262757
 [17,] 0.3671481 0.1057263 0.2018429 0.1470259 0.1782567
 [18,] 0.3111680 0.1994173 0.1688262 0.1925750 0.1280136
 [19,] 0.2478094 0.2648789 0.1312733 0.1006854 0.2553531
 [20,] 0.2811220 0.1075483 0.1692586 0.1665123 0.2755589
 [21,] 0.2522119 0.1661344 0.1664183 0.1780681 0.2371674
 [22,] 0.2081215 0.1677437 0.1004077 0.1307302 0.3929970
 [23,] 0.3837084 0.1605094 0.1436714 0.1183882 0.1937226
 [24,] 0.3158096 0.1166440 0.2467311 0.1762966 0.1445187
 [25,] 0.3499356 0.2344423 0.1447660 0.1484544 0.1224017
 [26,] 0.2079306 0.1534375 0.1163242 0.2219905 0.3003172
 [27,] 0.2094659 0.1851841 0.2561776 0.1142177 0.2349548
 [28,] 0.2871887 0.2723706 0.1552011 0.1293793 0.1558604
 [29,] 0.2409767 0.1385711 0.1687103 0.2110074 0.2407345
 [30,] 0.2997559 0.1566999 0.1316640 0.1379617 0.2739186
 [31,] 0.2944719 0.2726381 0.1749655 0.1151233 0.1428012
 [32,] 0.2417184 0.2971791 0.1026340 0.2584065 0.1000619
 [33,] 0.3248174 0.1720860 0.1398373 0.2579564 0.1053030
 [34,] 0.2749064 0.1383099 0.1749657 0.1844656 0.2273524
 [35,] 0.3054662 0.1612389 0.2175354 0.1616936 0.1540659
 [36,] 0.2550820 0.3282879 0.1147852 0.1507110 0.1511339
 [37,] 0.3011346 0.1254154 0.1250130 0.3164970 0.1319400
 [38,] 0.2564772 0.3019424 0.1195082 0.2004924 0.1215798
 [39,] 0.3964474 0.1160164 0.1424304 0.1214244 0.2236814
 [40,] 0.2727912 0.1361121 0.1347505 0.1036277 0.3527185
 [41,] 0.3359341 0.2169228 0.1663871 0.1757514 0.1050046
 [42,] 0.2241485 0.1465224 0.1205128 0.1959685 0.3128478
 [43,] 0.2338197 0.1031142 0.3349378 0.1296950 0.1984333
 [44,] 0.2857209 0.1160320 0.2964738 0.1925416 0.1092318
 [45,] 0.3158520 0.1236643 0.2119880 0.1859700 0.1625257
 [46,] 0.2384696 0.1373802 0.2943904 0.1301503 0.1996095
 [47,] 0.2526917 0.1832929 0.1430033 0.1965821 0.2244300
 [48,] 0.2614739 0.2115974 0.1728423 0.1530338 0.2010525
 [49,] 0.3442160 0.2620979 0.1137480 0.1098424 0.1700957
 [50,] 0.2444947 0.1692208 0.2467352 0.1362864 0.2032629
 [51,] 0.2502153 0.2624935 0.2381567 0.1093868 0.1397477
 [52,] 0.2299436 0.1872620 0.1962084 0.1886651 0.1979209
 [53,] 0.3517834 0.1582709 0.1096794 0.2573744 0.1228919
 [54,] 0.2745543 0.1773329 0.2466799 0.1058486 0.1955843
 [55,] 0.2624664 0.1806514 0.1736401 0.1535698 0.2296724
 [56,] 0.3852185 0.1974852 0.1446944 0.1066599 0.1659420
 [57,] 0.2363033 0.1597109 0.2244626 0.2260970 0.1534263
 [58,] 0.2207823 0.3534642 0.1544158 0.1647998 0.1065379
 [59,] 0.2687693 0.2098320 0.1218424 0.1182050 0.2813512
 [60,] 0.2191471 0.1471640 0.2085465 0.2486880 0.1764545
 [61,] 0.3285129 0.1503422 0.1168968 0.1972617 0.2069864
 [62,] 0.2369286 0.2918974 0.1336234 0.1568846 0.1806659
 [63,] 0.2466962 0.2151179 0.1346203 0.2249045 0.1786611
 [64,] 0.2946940 0.1187738 0.2557979 0.1572229 0.1735113
 [65,] 0.2651671 0.3201304 0.1412211 0.1047638 0.1687176
 [66,] 0.2116211 0.1223136 0.2775948 0.2216211 0.1668495
 [67,] 0.2631060 0.1354136 0.2460399 0.1915579 0.1638826
 [68,] 0.2005719 0.1473103 0.3944707 0.1325617 0.1250854
 [69,] 0.2012760 0.1310165 0.1962468 0.3520939 0.1193667
 [70,] 0.3062470 0.1847835 0.2480499 0.1053082 0.1556114
 [71,] 0.2246889 0.1545891 0.2155852 0.1018023 0.3033344
 [72,] 0.2442485 0.1432860 0.1756282 0.3172506 0.1195868
 [73,] 0.2175765 0.1706556 0.1405927 0.2251913 0.2459838
 [74,] 0.2538262 0.1552738 0.1055389 0.1667397 0.3186213
 [75,] 0.2179859 0.2590343 0.1092824 0.1552084 0.2584890
 [76,] 0.2172175 0.3274900 0.1192121 0.2308713 0.1052092
 [77,] 0.2307458 0.1762087 0.1603696 0.1222881 0.3103879
 [78,] 0.2137513 0.2221876 0.3175902 0.1290944 0.1173765
 [79,] 0.2195031 0.2319250 0.1569274 0.2727251 0.1189194
 [80,] 0.3214032 0.1643253 0.1428639 0.1473363 0.2240713
 [81,] 0.2456977 0.2263519 0.1710248 0.1769601 0.1799655
 [82,] 0.3385127 0.1050680 0.1321725 0.1674757 0.2567710
 [83,] 0.2574675 0.2909212 0.1106966 0.1844433 0.1564715
 [84,] 0.2932549 0.1034349 0.2053246 0.2658788 0.1321068
 [85,] 0.2677158 0.1569009 0.2555072 0.1085389 0.2113372
 [86,] 0.3685641 0.1005734 0.1324141 0.1264244 0.2720240
 [87,] 0.2683362 0.1846058 0.1541308 0.1296314 0.2632958
 [88,] 0.3522859 0.1576975 0.1105129 0.2530093 0.1264944
 [89,] 0.3593816 0.1462422 0.1372076 0.2252190 0.1319496
 [90,] 0.3622750 0.1394562 0.1303135 0.2093512 0.1586041
 [91,] 0.2249644 0.3713364 0.1005901 0.1765428 0.1265662
 [92,] 0.2105494 0.1017538 0.3140111 0.1255434 0.2481423
 [93,] 0.2614154 0.1903969 0.2855117 0.1189510 0.1437251
 [94,] 0.3212810 0.1189223 0.1014534 0.3583146 0.1000286
 [95,] 0.2010529 0.1799178 0.3588094 0.1493543 0.1108656
 [96,] 0.2564023 0.2634177 0.2638740 0.1060371 0.1102689
 [97,] 0.2672515 0.1516668 0.1970132 0.1741914 0.2098771
 [98,] 0.2157879 0.1266770 0.3756737 0.1818470 0.1000145
 [99,] 0.2000000 0.2841771 0.1036800 0.1000051 0.3121378
[100,] 0.2892177 0.2189920 0.1193394 0.2614277 0.1110233
[101,] 0.2214992 0.1181896 0.3303178 0.2286036 0.1013898
[102,] 0.2184062 0.1202527 0.1499190 0.1827757 0.3286464
[103,] 0.2037157 0.1693920 0.1048159 0.2760456 0.2460308
[104,] 0.2436327 0.1080588 0.1518525 0.1223267 0.3741293
[105,] 0.3360523 0.2088104 0.1521499 0.1943481 0.1086394
[106,] 0.2167503 0.2992167 0.1071671 0.1000034 0.2768625
[107,] 0.2563914 0.1004882 0.1411039 0.1379088 0.3641077
[108,] 0.2299399 0.1480358 0.1484493 0.1669357 0.3066393
[109,] 0.2264396 0.1934014 0.1083957 0.1461368 0.3256265
[110,] 0.2151724 0.3783160 0.1002613 0.1798336 0.1264166
[111,] 0.2935613 0.3725959 0.1144118 0.1030926 0.1163385
[112,] 0.2007309 0.2077940 0.3162664 0.1414594 0.1337494
[113,] 0.2685715 0.3680092 0.1274865 0.1077858 0.1281469
[114,] 0.2628985 0.2336738 0.2286994 0.1100841 0.1646442
[115,] 0.2260699 0.2659541 0.1361996 0.1661083 0.2056681
[116,] 0.2868015 0.1280423 0.1087454 0.1125702 0.3638406
[117,] 0.2769236 0.3568786 0.1484370 0.1019713 0.1157895
[118,] 0.2072201 0.1141713 0.2173021 0.3317524 0.1295542
[119,] 0.2105931 0.3366393 0.1000422 0.2527253 0.1000000
[120,] 0.3316351 0.1439059 0.1134091 0.3108122 0.1002376
[121,] 0.2622550 0.1162839 0.1623535 0.1791582 0.2799493
[122,] 0.3256242 0.1423547 0.2560213 0.1429861 0.1330137
[123,] 0.2044136 0.1559370 0.3678064 0.1007166 0.1711264
[124,] 0.2016387 0.1657914 0.3727239 0.1001780 0.1596681
[125,] 0.3746529 0.2292161 0.1416568 0.1542375 0.1002367
[126,] 0.3066816 0.1748286 0.1042635 0.1361300 0.2780963
[127,] 0.2535806 0.1018742 0.3814773 0.1624465 0.1006215
[128,] 0.3419409 0.1059222 0.2326306 0.1781618 0.1413445
[129,] 0.2114954 0.1108535 0.3935195 0.1070611 0.1770705
[130,] 0.3956468 0.1976503 0.1713005 0.1337700 0.1016324
[131,] 0.2031859 0.2220068 0.1626697 0.2656991 0.1464385
[132,] 0.2196590 0.1475792 0.3138025 0.1130747 0.2058846
[133,] 0.2203022 0.3125896 0.2536786 0.1007094 0.1127202
[134,] 0.3778390 0.1262109 0.1007232 0.2911817 0.1040452
[135,] 0.3148277 0.1320126 0.1314789 0.3216783 0.1000025
[136,] 0.2202419 0.2615355 0.1075658 0.1194354 0.2912214
[137,] 0.2066469 0.1003518 0.1907784 0.3989673 0.1032556
[138,] 0.2374672 0.1955698 0.1037798 0.1026257 0.3605575
[139,] 0.2033355 0.1989853 0.3751142 0.1030691 0.1194959
[140,] 0.3113264 0.1004482 0.1426361 0.3440710 0.1015183
[141,] 0.2034646 0.1210216 0.2113464 0.3089278 0.1552396
[142,] 0.3898669 0.1431961 0.1190617 0.2456125 0.1022628
[143,] 0.2227022 0.2379713 0.1124785 0.2624275 0.1644204
[144,] 0.2848526 0.1033352 0.3296905 0.1309856 0.1511362
[145,] 0.2010503 0.1038722 0.3452874 0.2150357 0.1347545
[146,] 0.2408155 0.1128536 0.3185884 0.1859163 0.1418262
[147,] 0.3037629 0.1660741 0.3014768 0.1002590 0.1284273
[148,] 0.2041823 0.1204466 0.1916672 0.1000223 0.3836816
[149,] 0.2024021 0.2878055 0.1006398 0.1226327 0.2865199
[150,] 0.2024632 0.3963354 0.1699840 0.1069170 0.1243004
[151,] 0.2017044 0.3975446 0.1021222 0.1984729 0.1001560
[152,] 0.2359814 0.1384424 0.1003002 0.3034847 0.2217912
[153,] 0.2235864 0.2803172 0.1569762 0.1668967 0.1722235
[154,] 0.2263214 0.3905176 0.1009119 0.1568322 0.1254169
[155,] 0.2018784 0.1148084 0.2252450 0.1788601 0.2792080
[156,] 0.2719487 0.1000976 0.1917782 0.3276469 0.1085286
[157,] 0.2412409 0.1291197 0.3174954 0.1006558 0.2114882
[158,] 0.3883902 0.1001597 0.1008192 0.1035545 0.3070764
[159,] 0.2001452 0.1468181 0.1203016 0.3694607 0.1632744
[160,] 0.2227174 0.1023040 0.2337902 0.1007046 0.3404838
[161,] 0.2037458 0.2781767 0.1018141 0.1841802 0.2320832
[162,] 0.2001507 0.1034951 0.3463895 0.1063404 0.2436242
[163,] 0.3828067 0.1262414 0.1008712 0.2845475 0.1055332
[164,] 0.3017844 0.1858478 0.1592182 0.1886176 0.1645319
[165,] 0.3629980 0.3322298 0.1028377 0.1011068 0.1008278
[166,] 0.2529271 0.1312390 0.2101375 0.1644141 0.2412823
[167,] 0.2654141 0.2163602 0.1030737 0.3141534 0.1009986
[168,] 0.2000966 0.1336912 0.1001623 0.3168441 0.2492059
[169,] 0.2002630 0.1033766 0.1090363 0.2140462 0.3732779
[170,] 0.2015740 0.3226510 0.1002882 0.1000000 0.2754868
[171,] 0.2370875 0.2675097 0.2552747 0.1009533 0.1391747
[172,] 0.2060323 0.3444436 0.1116308 0.1387896 0.1991038
[173,] 0.2019734 0.1015493 0.1156015 0.2062886 0.3745872
[174,] 0.3085070 0.1120715 0.1011259 0.3782952 0.1000004
[175,] 0.2000654 0.1000000 0.3534673 0.2464673 0.1000000
[176,] 0.3506470 0.1421800 0.2491352 0.1256600 0.1323777
[177,] 0.2079882 0.1498785 0.1035440 0.1901715 0.3484177
[178,] 0.2000838 0.2229306 0.1324345 0.3267418 0.1178093
[179,] 0.3508298 0.3407366 0.1000125 0.1000033 0.1084178
[180,] 0.2023761 0.3605388 0.2361494 0.1000029 0.1009328
[181,] 0.2010784 0.1777761 0.2149205 0.1829006 0.2233243
[182,] 0.3836598 0.1039895 0.1000030 0.3122526 0.1000950
[183,] 0.2013481 0.1098659 0.2862429 0.2962198 0.1063233
[184,] 0.2000806 0.1029681 0.1832722 0.3931841 0.1204950
[185,] 0.3103251 0.3881554 0.1014319 0.1000001 0.1000875
[186,] 0.2041034 0.2515615 0.1012398 0.3100539 0.1330414
[187,] 0.2000525 0.1137021 0.1014928 0.2350513 0.3497013
[188,] 0.2000456 0.1006420 0.1049623 0.3383538 0.2559963
[189,] 0.2087756 0.1100171 0.1000006 0.3806632 0.2005435
[190,] 0.2048367 0.3826819 0.1282235 0.1389075 0.1453504
[191,] 0.3481365 0.1000003 0.1004312 0.1083425 0.3430896
[192,] 0.2000260 0.1016171 0.2156731 0.1458592 0.3368245
[193,] 0.2000997 0.3255694 0.1000234 0.1503498 0.2239577
[194,] 0.3246168 0.1886487 0.1421818 0.1944613 0.1500914
[195,] 0.2028024 0.2974895 0.2997046 0.1000004 0.1000031
[196,] 0.3953553 0.3046426 0.1000001 0.1000000 0.1000020
[197,] 0.2268736 0.1850339 0.1000593 0.3880269 0.1000063
[198,] 0.2000123 0.3467212 0.1000004 0.1000000 0.2532661
[199,] 0.2000000 0.1000000 0.3998689 0.2001311 0.1000000
[200,] 0.3874738 0.1146971 0.2837300 0.1054392 0.1086599
[201,] 0.2022668 0.3673734 0.1088096 0.1006955 0.2208547
[202,] 0.3126573 0.3869918 0.1000000 0.1000000 0.1003509
[203,] 0.2000113 0.1585327 0.2277913 0.1665000 0.2471647
[204,] 0.2000099 0.1005310 0.2892130 0.3100280 0.1002181
[205,] 0.2000000 0.3027257 0.1000000 0.1000428 0.2972315
[206,] 0.3626157 0.1000000 0.1000000 0.1000000 0.3373843
[207,] 0.3837811 0.1000000 0.1000003 0.1000001 0.3162185
[208,] 0.3907177 0.3092823 0.1000000 0.1000000 0.1000000
[209,] 0.2005512 0.3293958 0.2693668 0.1000000 0.1006862
[210,] 0.2000000 0.1298983 0.2425122 0.1385916 0.2889978
[211,] 0.2000000 0.3054937 0.1000000 0.1000000 0.2945063
[212,] 0.3924218 0.1000000 0.1000000 0.3075782 0.1000000
[213,] 0.3814753 0.3185247 0.1000000 0.1000000 0.1000000
[214,] 0.2000015 0.3588785 0.2411177 0.1000000 0.1000023
[215,] 0.2000000 0.1000000 0.2588490 0.3411510 0.1000000
[216,] 0.3371798 0.1000000 0.1000000 0.1000000 0.3628202</code></pre>
</div>
</div>
<p>Simplex: Distribui pesos aleatoriamente em um espaço triangular, garantindo que a soma seja sempre 1. Sample: Seleciona pesos aleatórios de uma distribuição de probabilidade específica. Grid: Gera pesos em pontos pré-definidos de uma grade regular.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>opt  <span class="ot">&lt;-</span>  <span class="fu">optimize.portfolio</span>(<span class="at">R =</span> asset_returns_xts, port_spec, <span class="at">rp =</span> rp, <span class="at">optimize_method =</span> <span class="st">"random"</span>, <span class="at">trace =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Leverage constraint min_sum and max_sum are restrictive, 
              consider relaxing. e.g. 'full_investment' constraint should be min_sum=0.99 and max_sum=1.01</code></pre>
</div>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(opt)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>***********************************
PortfolioAnalytics Optimization
***********************************

Call:
optimize.portfolio(R = asset_returns_xts, portfolio = port_spec, 
    optimize_method = "random", trace = TRUE, rp = rp)

Optimal Weights:
VALE3.SA PETR4.SA AZUL4.SA MGLU3.SA CMIG4.SA 
  0.3327   0.1703   0.1031   0.1234   0.2705 

Objective Measures:
   mean 
0.01485 


 StdDev 
0.08339 

contribution :
VALE3.SA PETR4.SA AZUL4.SA MGLU3.SA CMIG4.SA 
 0.01781  0.01420  0.01700  0.01574  0.01864 

pct_contrib_StdDev :
VALE3.SA PETR4.SA AZUL4.SA MGLU3.SA CMIG4.SA 
  0.2135   0.1703   0.2039   0.1887   0.2236 </code></pre>
</div>
</div>
</section>
<section id="otimizando-a-carteira-com-rebalanceamento" class="level2">
<h2 class="anchored" data-anchor-id="otimizando-a-carteira-com-rebalanceamento">Otimizando a carteira com rebalanceamento</h2>
<p>A função <code>optimize.portfolio.rebalancing()</code> é usada para otimizar a carteira com rebalanceamento. O rebalanceamento é o processo de ajustar os pesos dos ativos na carteira para manter a alocação desejada ao longo do tempo. O rebalanceamento é importante para garantir que a carteira permaneça alinhada com os objetivos de investimento (restrições e objetivos) ao longo do tempo.</p>
<p><code>optimize.portfolio.rebalancing()</code> suporta otimização de carteiras com rebalanceamento em diferentes janelas de tempo. O backtest é o processo de testar uma estratégia de investimento em dados históricos para avaliar seu desempenho.</p>
<p>OBS: Dependendo do método de otimização, o processo pode ser demorado.</p>
<p>Exemplo de otimização com rebalanceamento:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Criar o objeto de portfólio</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>port_specr <span class="ot">&lt;-</span> <span class="fu">portfolio.spec</span>(<span class="at">assets =</span> <span class="fu">colnames</span>(asset_returns_xts))</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Adicionar restrições - full investment com soma de pesos igual a 1</span></span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>port_specr <span class="ot">&lt;-</span> <span class="fu">add.constraint</span>(port_specr, <span class="at">type =</span> <span class="st">"long_only"</span>)</span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a><span class="co"># restrição para a soma dos pesos</span></span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a>port_specr <span class="ot">&lt;-</span> <span class="fu">add.constraint</span>(port_specr, <span class="at">type =</span> <span class="st">"weight_sum"</span>, <span class="at">min_sum =</span> <span class="fl">0.99</span>, <span class="at">max_sum =</span> <span class="fl">1.01</span>)</span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-12"><a href="#cb37-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Adicionar a função objetivo - maximizar o retorno esperado</span></span>
<span id="cb37-13"><a href="#cb37-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-14"><a href="#cb37-14" aria-hidden="true" tabindex="-1"></a>port_specr <span class="ot">&lt;-</span> <span class="fu">add.objective</span>(port_specr, <span class="at">type =</span> <span class="st">"return"</span>, <span class="at">name =</span> <span class="st">"mean"</span>)</span>
<span id="cb37-15"><a href="#cb37-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-16"><a href="#cb37-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Adicionar a função objetivo - minimizar o risco</span></span>
<span id="cb37-17"><a href="#cb37-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-18"><a href="#cb37-18" aria-hidden="true" tabindex="-1"></a>port_specr <span class="ot">&lt;-</span> <span class="fu">add.objective</span>(port_specr, <span class="at">type =</span> <span class="st">"risk"</span>, <span class="at">name =</span> <span class="st">"StdDev"</span>)</span>
<span id="cb37-19"><a href="#cb37-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-20"><a href="#cb37-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Adicionar a função objetivo - minimizar a contribuição marginal do risco de cada ativo para o risco total da carteira</span></span>
<span id="cb37-21"><a href="#cb37-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-22"><a href="#cb37-22" aria-hidden="true" tabindex="-1"></a>port_specr <span class="ot">&lt;-</span> <span class="fu">add.objective</span>(port_specr, <span class="at">type =</span> <span class="st">"risk_budget"</span>, <span class="at">name =</span> <span class="st">"StdDev"</span>, <span class="at">min_prisk =</span> <span class="fl">0.05</span>, <span class="at">max_prisk =</span> <span class="fl">0.1</span>)</span>
<span id="cb37-23"><a href="#cb37-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-24"><a href="#cb37-24" aria-hidden="true" tabindex="-1"></a>rp <span class="ot">&lt;-</span> <span class="fu">random_portfolios</span>(port_specr, <span class="at">permutations =</span> <span class="dv">50</span>, <span class="at">rp_method =</span> <span class="st">'simplex'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="otimização" class="level2">
<h2 class="anchored" data-anchor-id="otimização">Otimização</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Otimização com rebalanceamento mensal</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>opt_rebal <span class="ot">&lt;-</span> <span class="fu">optimize.portfolio.rebalancing</span>(<span class="at">R =</span> asset_returns_xts, </span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>                      <span class="at">portfolio =</span> port_specr, </span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>                      <span class="at">optimize_method =</span> <span class="st">"random"</span>,</span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>                      <span class="at">rp =</span> rp,</span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a>                      <span class="at">trace =</span> <span class="cn">TRUE</span>,</span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a>                      <span class="at">search_size =</span> <span class="dv">1000</span>,</span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a>                      <span class="at">rebalance_on =</span> <span class="st">"months"</span>,</span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a>                      <span class="at">training_period =</span> <span class="dv">12</span>,</span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a>                      <span class="at">rolling_window =</span> <span class="dv">12</span>)</span>
<span id="cb38-12"><a href="#cb38-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-13"><a href="#cb38-13" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(opt_rebal)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>**************************************************
PortfolioAnalytics Optimization with Rebalancing
**************************************************

Call:
optimize.portfolio.rebalancing(R = asset_returns_xts, portfolio = port_specr, 
    optimize_method = "random", search_size = 1000, trace = TRUE, 
    rp = rp, rebalance_on = "months", training_period = 12, rolling_window = 12)

Number of rebalancing dates:  49 
First rebalance date:
[1] "2020-05-31"
Last rebalance date:
[1] "2024-05-31"

Annualized Portfolio Rebalancing Return:
[1] 0.2340044

Annualized Portfolio Standard Deviation:
[1] 0.3050197</code></pre>
</div>
</div>
</section>
<section id="analise-dos-resultados" class="level2">
<h2 class="anchored" data-anchor-id="analise-dos-resultados">Analise dos resultados</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="fu">extractObjectiveMeasures</span>(opt_rebal)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                    mean     StdDev StdDev.contribution.VALE3.SA
2020-05-31  0.0009788476 0.12798291                 0.0091131963
2020-06-30  0.0131056921 0.13010166                 0.0091521580
2020-07-31  0.0125969018 0.12988116                 0.0093309351
2020-08-31  0.0099048924 0.12899814                 0.0097650802
2020-09-30  0.0122299229 0.12857961                 0.0091918914
2020-10-31  0.0089620546 0.12837500                 0.0091230927
2020-11-30  0.0312098612 0.15856976                 0.0175060080
2020-12-31  0.0382432343 0.15933991                 0.0179681387
2021-01-31  0.0316659508 0.15925396                 0.0179621205
2021-02-28  0.0272302795 0.16037942                 0.0175439811
2021-03-31  0.0384908370 0.15245085                 0.0143149891
2021-04-30  0.0639055618 0.09357413                 0.0065724213
2021-05-31  0.0534441310 0.08503570                 0.0125833238
2021-06-30  0.0444643828 0.07812293                 0.0111199075
2021-07-31  0.0333524313 0.08183438                 0.0128603366
2021-08-31  0.0273602909 0.08188605                 0.0138397455
2021-09-30  0.0188412745 0.08724862                 0.0169201793
2021-10-31  0.0150734873 0.09129106                 0.0181305263
2021-11-30  0.0157164596 0.11965288                 0.0221196737
2021-12-31 -0.0070447045 0.06957363                 0.0140586161
2022-01-31 -0.0079824699 0.06812868                 0.0117955625
2022-02-28 -0.0091918182 0.06822764                 0.0113192263
2022-03-31 -0.0017375726 0.07022277                 0.0124784094
2022-04-30 -0.0100296175 0.07559717                 0.0149134636
2022-05-31 -0.0146822782 0.07399614                 0.0135958695
2022-06-30 -0.0386401190 0.08562833                 0.0145550155
2022-07-31 -0.0372584794 0.08669287                 0.0129843372
2022-08-31 -0.0129674896 0.11771167                 0.0091983454
2022-09-30  0.0181725483 0.07333650                 0.0197841255
2022-10-31  0.0214963296 0.07072373                 0.0168420622
2022-11-30  0.0308090463 0.06705397                 0.0190751793
2022-12-31  0.0269604242 0.06911665                 0.0180244715
2023-01-31  0.0260244968 0.06835790                 0.0167585240
2023-02-28  0.0126711186 0.07284946                 0.0206839810
2023-03-31  0.0092831127 0.07161078                 0.0184650431
2023-04-30  0.0075124965 0.07074168                 0.0163989049
2023-05-31  0.0151348849 0.06738787                 0.0120601595
2023-06-30  0.0199311212 0.07276695                 0.0111037909
2023-07-31  0.0315858108 0.06034016                 0.0062370586
2023-08-31  0.0258669982 0.05966875                 0.0089340940
2023-09-30  0.0201173860 0.05280884                 0.0126064802
2023-10-31  0.0206386303 0.05241069                 0.0149623665
2023-11-30  0.0279733228 0.05427893                 0.0152195427
2023-12-31  0.0264886243 0.05354063                 0.0105826041
2024-01-31  0.0276789701 0.05234317                 0.0150974166
2024-02-29  0.0213795003 0.05150574                 0.0130618781
2024-03-31  0.0254977973 0.04341779                 0.0106733255
2024-04-30  0.0294129602 0.04451035                 0.0114741408
2024-05-31  0.0190808192 0.06276341                -0.0001573955
           StdDev.contribution.PETR4.SA StdDev.contribution.AZUL4.SA
2020-05-31                  0.028120726                  0.053371066
2020-06-30                  0.026312553                  0.060144408
2020-07-31                  0.026073101                  0.059269905
2020-08-31                  0.026541894                  0.057859386
2020-09-30                  0.026637642                  0.057456542
2020-10-31                  0.026440670                  0.057291148
2020-11-30                  0.030528916                  0.079053904
2020-12-31                  0.030968350                  0.078700978
2021-01-31                  0.031113040                  0.078223081
2021-02-28                  0.031886197                  0.077794524
2021-03-31                  0.031358392                  0.074825947
2021-04-30                  0.009110745                  0.048357066
2021-05-31                  0.050921384                  0.005339483
2021-06-30                  0.050709616                  0.007495548
2021-07-31                  0.052889649                  0.007352824
2021-08-31                  0.052091840                  0.007636473
2021-09-30                  0.050264403                  0.007607954
2021-10-31                  0.046217382                  0.009226213
2021-11-30                  0.016359682                  0.060398564
2021-12-31                  0.008943787                  0.025517094
2022-01-31                  0.008831490                  0.031059600
2022-02-28                  0.008826822                  0.031475985
2022-03-31                  0.006374088                  0.030423161
2022-04-30                  0.006909716                  0.029855614
2022-05-31                  0.007341881                  0.029672445
2022-06-30                  0.008090103                  0.036834810
2022-07-31                  0.009665332                  0.035490994
2022-08-31                  0.011209264                  0.051905025
2022-09-30                  0.032485698                  0.009884266
2022-10-31                  0.032605449                  0.009979531
2022-11-30                  0.030209392                  0.008027880
2022-12-31                  0.033218147                  0.008078937
2023-01-31                  0.032752832                  0.008215957
2023-02-28                  0.030463413                  0.009208045
2023-03-31                  0.030104006                  0.009792952
2023-04-30                  0.032479354                  0.009904895
2023-05-31                  0.033373197                  0.010820773
2023-06-30                  0.038000382                  0.012378433
2023-07-31                  0.036247355                  0.009025010
2023-08-31                  0.031607463                  0.010284252
2023-09-30                  0.025958914                  0.007844295
2023-10-31                  0.023107057                  0.007818955
2023-11-30                  0.022716534                  0.009389508
2023-12-31                  0.024978638                  0.010372580
2024-01-31                  0.019180264                  0.010606151
2024-02-29                  0.021147752                  0.011179552
2024-03-31                  0.023080095                  0.006682865
2024-04-30                  0.023748635                  0.006303103
2024-05-31                  0.006029449                  0.039044490
           StdDev.contribution.MGLU3.SA StdDev.contribution.CMIG4.SA
2020-05-31                  0.020003288                  0.017374632
2020-06-30                  0.018298033                  0.016194504
2020-07-31                  0.018582799                  0.016624417
2020-08-31                  0.017986350                  0.016845431
2020-09-30                  0.018173525                  0.017120012
2020-10-31                  0.018358872                  0.017161214
2020-11-30                  0.011154097                  0.020326833
2020-12-31                  0.010940760                  0.020761682
2021-01-31                  0.011179802                  0.020775921
2021-02-28                  0.011722108                  0.021432607
2021-03-31                  0.010728995                  0.021222530
2021-04-30                  0.004591853                  0.024942042
2021-05-31                  0.010151450                  0.006040061
2021-06-30                  0.002989649                  0.005808212
2021-07-31                  0.002833099                  0.005898468
2021-08-31                  0.002843381                  0.005474609
2021-09-30                  0.007281322                  0.005174763
2021-10-31                  0.012212892                  0.005504043
2021-11-30                  0.008015790                  0.012759172
2021-12-31                  0.012101721                  0.008952414
2022-01-31                  0.010331073                  0.006110957
2022-02-28                  0.010379914                  0.006225698
2022-03-31                  0.013040914                  0.007906193
2022-04-30                  0.015416345                  0.008502033
2022-05-31                  0.015040903                  0.008345042
2022-06-30                  0.017556920                  0.008591482
2022-07-31                  0.018382857                  0.010169354
2022-08-31                  0.036801763                  0.008597276
2022-09-30                  0.003929787                  0.007252619
2022-10-31                  0.003748652                  0.007548033
2022-11-30                  0.003349263                  0.006392259
2022-12-31                  0.003417300                  0.006377798
2023-01-31                  0.004287977                  0.006342610
2023-02-28                  0.004568358                  0.007925664
2023-03-31                  0.004800025                  0.008448753
2023-04-30                  0.004710837                  0.007247688
2023-05-31                  0.004430989                  0.006702748
2023-06-30                  0.004019300                  0.007265039
2023-07-31                  0.003105165                  0.005725574
2023-08-31                  0.003271405                  0.005571537
2023-09-30                  0.001316806                  0.005082349
2023-10-31                  0.001832110                  0.004690206
2023-11-30                  0.002930203                  0.004023145
2023-12-31                  0.003268385                  0.004338425
2024-01-31                  0.002999209                  0.004460134
2024-02-29                  0.001914674                  0.004201888
2024-03-31                  0.001831418                  0.001150091
2024-04-30                  0.001449393                  0.001535080
2024-05-31                  0.005006747                  0.012840119
           StdDev.pct_contrib_StdDev.VALE3.SA
2020-05-31                        0.071206354
2020-06-30                        0.070346207
2020-07-31                        0.071842100
2020-08-31                        0.075699387
2020-09-30                        0.071487939
2020-10-31                        0.071065963
2020-11-30                        0.110399412
2020-12-31                        0.112766091
2021-01-31                        0.112789158
2021-02-28                        0.109390478
2021-03-31                        0.093899042
2021-04-30                        0.070237590
2021-05-31                        0.147976949
2021-06-30                        0.142338584
2021-07-31                        0.157150788
2021-08-31                        0.169012251
2021-09-30                        0.193930622
2021-10-31                        0.198601343
2021-11-30                        0.184865365
2021-12-31                        0.202068165
2022-01-31                        0.173136516
2022-02-28                        0.165903812
2022-03-31                        0.177697494
2022-04-30                        0.197275420
2022-05-31                        0.183737547
2022-06-30                        0.169978970
2022-07-31                        0.149773985
2022-08-31                        0.078143017
2022-09-30                        0.269771896
2022-10-31                        0.238138781
2022-11-30                        0.284475006
2022-12-31                        0.260783337
2023-01-31                        0.245158556
2023-02-28                        0.283927715
2023-03-31                        0.257852845
2023-04-30                        0.231813903
2023-05-31                        0.178966332
2023-06-30                        0.152593886
2023-07-31                        0.103364963
2023-08-31                        0.149728186
2023-09-30                        0.238719112
2023-10-31                        0.285483084
2023-11-30                        0.280395023
2023-12-31                        0.197655571
2024-01-31                        0.288431432
2024-02-29                        0.253600418
2024-03-31                        0.245828366
2024-04-30                        0.257785893
2024-05-31                       -0.002507759
           StdDev.pct_contrib_StdDev.PETR4.SA
2020-05-31                         0.21972251
2020-06-30                         0.20224611
2020-07-31                         0.20074583
2020-08-31                         0.20575408
2020-09-30                         0.20716847
2020-10-31                         0.20596433
2020-11-30                         0.19252672
2020-12-31                         0.19435401
2021-01-31                         0.19536744
2021-02-28                         0.19881726
2021-03-31                         0.20569509
2021-04-30                         0.09736393
2021-05-31                         0.59882358
2021-06-30                         0.64910027
2021-07-31                         0.64630112
2021-08-31                         0.63615037
2021-09-30                         0.57610542
2021-10-31                         0.50626407
2021-11-30                         0.13672619
2021-12-31                         0.12855138
2022-01-31                         0.12962954
2022-02-28                         0.12937310
2022-03-31                         0.09076954
2022-04-30                         0.09140178
2022-05-31                         0.09921978
2022-06-30                         0.09447928
2022-07-31                         0.11148935
2022-08-31                         0.09522645
2022-09-30                         0.44296769
2022-10-31                         0.46102560
2022-11-30                         0.45052352
2022-12-31                         0.48060989
2023-01-31                         0.47913748
2023-02-28                         0.41816936
2023-03-31                         0.42038372
2023-04-30                         0.45912614
2023-05-31                         0.49524044
2023-06-30                         0.52222039
2023-07-31                         0.60071689
2023-08-31                         0.52971551
2023-09-30                         0.49156377
2023-10-31                         0.44088439
2023-11-30                         0.41851475
2023-12-31                         0.46653611
2024-01-31                         0.36643296
2024-02-29                         0.41059017
2024-03-31                         0.53158146
2024-04-30                         0.53355307
2024-05-31                         0.09606630
           StdDev.pct_contrib_StdDev.AZUL4.SA
2020-05-31                         0.41701713
2020-06-30                         0.46228780
2020-07-31                         0.45633952
2020-08-31                         0.44852884
2020-09-30                         0.44685577
2020-10-31                         0.44627965
2020-11-30                         0.49854339
2020-12-31                         0.49391881
2021-01-31                         0.49118451
2021-02-28                         0.48506551
2021-03-31                         0.49082013
2021-04-30                         0.51677816
2021-05-31                         0.06279107
2021-06-30                         0.09594555
2021-07-31                         0.08985006
2021-08-31                         0.09325732
2021-09-30                         0.08719856
2021-10-31                         0.10106371
2021-11-30                         0.50478152
2021-12-31                         0.36676387
2022-01-31                         0.45589609
2022-02-28                         0.46133771
2022-03-31                         0.43323786
2022-04-30                         0.39493031
2022-05-31                         0.40099990
2022-06-30                         0.43017083
2022-07-31                         0.40938767
2022-08-31                         0.44095053
2022-09-30                         0.13477963
2022-10-31                         0.14110585
2022-11-30                         0.11972266
2022-12-31                         0.11688842
2023-01-31                         0.12019031
2023-02-28                         0.12639826
2023-03-31                         0.13675249
2023-04-30                         0.14001499
2023-05-31                         0.16057450
2023-06-30                         0.17011066
2023-07-31                         0.14956888
2023-08-31                         0.17235575
2023-09-30                         0.14854132
2023-10-31                         0.14918625
2023-11-30                         0.17298624
2023-12-31                         0.19373286
2024-01-31                         0.20262720
2024-02-29                         0.21705446
2024-03-31                         0.15391996
2024-04-30                         0.14160983
2024-05-31                         0.62209001
           StdDev.pct_contrib_StdDev.MGLU3.SA
2020-05-31                         0.15629656
2020-06-30                         0.14064412
2020-07-31                         0.14307541
2020-08-31                         0.13943108
2020-09-30                         0.14134064
2020-10-31                         0.14300972
2020-11-30                         0.07034189
2020-12-31                         0.06866303
2021-01-31                         0.07020109
2021-02-28                         0.07308985
2021-03-31                         0.07037674
2021-04-30                         0.04907183
2021-05-31                         0.11937869
2021-06-30                         0.03826851
2021-07-31                         0.03461991
2021-08-31                         0.03472363
2021-09-30                         0.08345486
2021-10-31                         0.13377972
2021-11-30                         0.06699204
2021-12-31                         0.17394120
2022-01-31                         0.15164058
2022-02-28                         0.15213648
2022-03-31                         0.18570778
2022-04-30                         0.20392753
2022-05-31                         0.20326604
2022-06-30                         0.20503635
2022-07-31                         0.21204576
2022-08-31                         0.31264327
2022-09-30                         0.05358569
2022-10-31                         0.05300417
2022-11-30                         0.04994876
2022-12-31                         0.04944250
2023-01-31                         0.06272833
2023-02-28                         0.06270957
2023-03-31                         0.06702937
2023-04-30                         0.06659210
2023-05-31                         0.06575352
2023-06-30                         0.05523525
2023-07-31                         0.05146099
2023-08-31                         0.05482610
2023-09-30                         0.02493532
2023-10-31                         0.03495680
2023-11-30                         0.05398417
2023-12-31                         0.06104494
2024-01-31                         0.05729895
2024-02-29                         0.03717399
2024-03-31                         0.04218127
2024-04-30                         0.03256305
2024-05-31                         0.07977176
           StdDev.pct_contrib_StdDev.CMIG4.SA
2020-05-31                         0.13575744
2020-06-30                         0.12447577
2020-07-31                         0.12799714
2020-08-31                         0.13058662
2020-09-30                         0.13314717
2020-10-31                         0.13368034
2020-11-30                         0.12818858
2020-12-31                         0.13029807
2021-01-31                         0.13045780
2021-02-28                         0.13363689
2021-03-31                         0.13920900
2021-04-30                         0.26654849
2021-05-31                         0.07102971
2021-06-30                         0.07434709
2021-07-31                         0.07207812
2021-08-31                         0.06685643
2021-09-30                         0.05931054
2021-10-31                         0.06029116
2021-11-30                         0.10663489
2021-12-31                         0.12867538
2022-01-31                         0.08969727
2022-02-28                         0.09124890
2022-03-31                         0.11258732
2022-04-30                         0.11246496
2022-05-31                         0.11277672
2022-06-30                         0.10033458
2022-07-31                         0.11730323
2022-08-31                         0.07303673
2022-09-30                         0.09889509
2022-10-31                         0.10672561
2022-11-30                         0.09533006
2022-12-31                         0.09227585
2023-01-31                         0.09278532
2023-02-28                         0.10879509
2023-03-31                         0.11798158
2023-04-30                         0.10245287
2023-05-31                         0.09946521
2023-06-30                         0.09983982
2023-07-31                         0.09488828
2023-08-31                         0.09337445
2023-09-30                         0.09624048
2023-10-31                         0.08948948
2023-11-30                         0.07411982
2023-12-31                         0.08103052
2024-01-31                         0.08520946
2024-02-29                         0.08158096
2024-03-31                         0.02648894
2024-04-30                         0.03448816
2024-05-31                         0.20457969</code></pre>
</div>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="fu">extractWeights</span>(opt_rebal)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>             VALE3.SA   PETR4.SA   AZUL4.SA   MGLU3.SA   CMIG4.SA
2020-05-31 0.23215169 0.17491683 0.28157072 0.15186688 0.15949388
2020-06-30 0.23215169 0.17491683 0.28157072 0.15186688 0.15949388
2020-07-31 0.23215169 0.17491683 0.28157072 0.15186688 0.15949388
2020-08-31 0.23215169 0.17491683 0.28157072 0.15186688 0.15949388
2020-09-30 0.23215169 0.17491683 0.28157072 0.15186688 0.15949388
2020-10-31 0.23215169 0.17491683 0.28157072 0.15186688 0.15949388
2020-11-30 0.23215169 0.17491683 0.28157072 0.15186688 0.15949388
2020-12-31 0.23215169 0.17491683 0.28157072 0.15186688 0.15949388
2021-01-31 0.23215169 0.17491683 0.28157072 0.15186688 0.15949388
2021-02-28 0.23215169 0.17491683 0.28157072 0.15186688 0.15949388
2021-03-31 0.23215169 0.17491683 0.28157072 0.15186688 0.15949388
2021-04-30 0.11262550 0.07936452 0.27228531 0.20267869 0.33304597
2021-05-31 0.20095151 0.43306236 0.04887544 0.24959786 0.06751283
2021-06-30 0.20095151 0.43306236 0.04887544 0.24959786 0.06751283
2021-07-31 0.20095151 0.43306236 0.04887544 0.24959786 0.06751283
2021-08-31 0.20095151 0.43306236 0.04887544 0.24959786 0.06751283
2021-09-30 0.20095151 0.43306236 0.04887544 0.24959786 0.06751283
2021-10-31 0.20095151 0.43306236 0.04887544 0.24959786 0.06751283
2021-11-30 0.23215169 0.17491683 0.28157072 0.15186688 0.15949388
2021-12-31 0.23215169 0.17491683 0.28157072 0.15186688 0.15949388
2022-01-31 0.23215169 0.17491683 0.28157072 0.15186688 0.15949388
2022-02-28 0.23215169 0.17491683 0.28157072 0.15186688 0.15949388
2022-03-31 0.23215169 0.17491683 0.28157072 0.15186688 0.15949388
2022-04-30 0.23215169 0.17491683 0.28157072 0.15186688 0.15949388
2022-05-31 0.23215169 0.17491683 0.28157072 0.15186688 0.15949388
2022-06-30 0.23215169 0.17491683 0.28157072 0.15186688 0.15949388
2022-07-31 0.23215169 0.17491683 0.28157072 0.15186688 0.15949388
2022-08-31 0.23215169 0.17491683 0.28157072 0.15186688 0.15949388
2022-09-30 0.35881561 0.42582628 0.06484418 0.02135875 0.12915518
2022-10-31 0.35881561 0.42582628 0.06484418 0.02135875 0.12915518
2022-11-30 0.35881561 0.42582628 0.06484418 0.02135875 0.12915518
2022-12-31 0.35881561 0.42582628 0.06484418 0.02135875 0.12915518
2023-01-31 0.35881561 0.42582628 0.06484418 0.02135875 0.12915518
2023-02-28 0.35881561 0.42582628 0.06484418 0.02135875 0.12915518
2023-03-31 0.35881561 0.42582628 0.06484418 0.02135875 0.12915518
2023-04-30 0.35881561 0.42582628 0.06484418 0.02135875 0.12915518
2023-05-31 0.35881561 0.42582628 0.06484418 0.02135875 0.12915518
2023-06-30 0.35881561 0.42582628 0.06484418 0.02135875 0.12915518
2023-07-31 0.35881561 0.42582628 0.06484418 0.02135875 0.12915518
2023-08-31 0.35881561 0.42582628 0.06484418 0.02135875 0.12915518
2023-09-30 0.35881561 0.42582628 0.06484418 0.02135875 0.12915518
2023-10-31 0.35881561 0.42582628 0.06484418 0.02135875 0.12915518
2023-11-30 0.35881561 0.42582628 0.06484418 0.02135875 0.12915518
2023-12-31 0.35881561 0.42582628 0.06484418 0.02135875 0.12915518
2024-01-31 0.35881561 0.42582628 0.06484418 0.02135875 0.12915518
2024-02-29 0.35881561 0.42582628 0.06484418 0.02135875 0.12915518
2024-03-31 0.35881561 0.42582628 0.06484418 0.02135875 0.12915518
2024-04-30 0.35881561 0.42582628 0.06484418 0.02135875 0.12915518
2024-05-31 0.02473987 0.17865572 0.19647255 0.04856469 0.55156717</code></pre>
</div>
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="fu">chart.Weights</span>(opt)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="aula_2_files/figure-html/unnamed-chunk-20-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="fu">chart.Weights</span>(opt_rebal)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="aula_2_files/figure-html/unnamed-chunk-20-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="plotando-os-pesos-ao-longo-do-tempo-com-ggplot2" class="level2">
<h2 class="anchored" data-anchor-id="plotando-os-pesos-ao-longo-do-tempo-com-ggplot2">Plotando os pesos ao longo do tempo com ggplot2</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Extraindo os pesos dos ativos ao longo do tempo</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>weights_xts <span class="ot">&lt;-</span> <span class="fu">extractWeights</span>(opt_rebal)</span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Convertendo os pesos para um data frame</span></span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a>weights_df <span class="ot">&lt;-</span> weights_xts <span class="sc">%&gt;%</span> </span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a>              <span class="fu">tk_tbl</span>(<span class="at">preserve_index =</span> <span class="cn">TRUE</span>, <span class="at">rename_index =</span> <span class="st">"Date"</span>)</span>
<span id="cb46-9"><a href="#cb46-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-10"><a href="#cb46-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-11"><a href="#cb46-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Colocando o data frame em formato longo</span></span>
<span id="cb46-12"><a href="#cb46-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-13"><a href="#cb46-13" aria-hidden="true" tabindex="-1"></a>weights_long_df <span class="ot">&lt;-</span> weights_df <span class="sc">%&gt;%</span> </span>
<span id="cb46-14"><a href="#cb46-14" aria-hidden="true" tabindex="-1"></a>                <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="sc">-</span>Date, <span class="at">names_to =</span> <span class="st">"Asset"</span>, <span class="at">values_to =</span> <span class="st">"Weight"</span>)</span>
<span id="cb46-15"><a href="#cb46-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-16"><a href="#cb46-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-17"><a href="#cb46-17" aria-hidden="true" tabindex="-1"></a>plotly<span class="sc">::</span><span class="fu">ggplotly</span>(<span class="fu">ggplot</span>(weights_long_df) <span class="sc">+</span></span>
<span id="cb46-18"><a href="#cb46-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x =</span> Date, <span class="at">y =</span> Weight, <span class="at">colour =</span> Asset) <span class="sc">+</span></span>
<span id="cb46-19"><a href="#cb46-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">se =</span> <span class="cn">FALSE</span> ) <span class="sc">+</span></span>
<span id="cb46-20"><a href="#cb46-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_hue</span>(<span class="at">direction =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb46-21"><a href="#cb46-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb46-22"><a href="#cb46-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Data"</span>,</span>
<span id="cb46-23"><a href="#cb46-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Peso"</span>,</span>
<span id="cb46-24"><a href="#cb46-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Peso dos ativos rebalanceados ao longo do tempo"</span>,</span>
<span id="cb46-25"><a href="#cb46-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">colour =</span> <span class="st">"Ativos"</span></span>
<span id="cb46-26"><a href="#cb46-26" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb46-27"><a href="#cb46-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb46-28"><a href="#cb46-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb46-29"><a href="#cb46-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">16</span>L,</span>
<span id="cb46-30"><a href="#cb46-30" aria-hidden="true" tabindex="-1"></a>    <span class="at">face =</span> <span class="st">"bold"</span>,</span>
<span id="cb46-31"><a href="#cb46-31" aria-hidden="true" tabindex="-1"></a>    <span class="at">hjust =</span> <span class="fl">0.5</span>)</span>
<span id="cb46-32"><a href="#cb46-32" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb46-33"><a href="#cb46-33" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`geom_smooth()` using method = 'loess' and formula = 'y ~ x'</code></pre>
</div>
<div class="cell-output-display">
<div class="plotly html-widget html-fill-item" id="htmlwidget-daa04fbd7fc13ac54f82" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-daa04fbd7fc13ac54f82">{"x":{"data":[{"x":[18413,18431.493670886077,18449.98734177215,18468.481012658227,18486.974683544304,18505.468354430381,18523.962025316454,18542.455696202531,18560.949367088608,18579.443037974685,18597.936708860758,18616.430379746835,18634.924050632912,18653.417721518988,18671.911392405062,18690.405063291139,18708.898734177215,18727.392405063292,18745.886075949365,18764.379746835442,18782.873417721519,18801.367088607596,18819.860759493669,18838.354430379746,18856.848101265823,18875.3417721519,18893.835443037973,18912.32911392405,18930.822784810127,18949.316455696204,18967.810126582277,18986.303797468354,19004.797468354431,19023.291139240508,19041.784810126581,19060.278481012658,19078.772151898735,19097.265822784811,19115.759493670885,19134.253164556962,19152.746835443038,19171.240506329115,19189.734177215189,19208.227848101265,19226.721518987342,19245.215189873419,19263.708860759492,19282.202531645569,19300.696202531646,19319.189873417723,19337.683544303796,19356.177215189873,19374.67088607595,19393.164556962027,19411.6582278481,19430.151898734177,19448.645569620254,19467.139240506331,19485.632911392404,19504.126582278481,19522.620253164558,19541.113924050635,19559.607594936708,19578.101265822785,19596.594936708861,19615.088607594938,19633.582278481012,19652.075949367088,19670.569620253165,19689.063291139242,19707.556962025315,19726.050632911392,19744.544303797469,19763.037974683546,19781.531645569619,19800.025316455696,19818.518987341773,19837.012658227846,19855.506329113923,19874],"y":[0.33228010461469409,0.32067253330125833,0.30948353731566747,0.29872404629783728,0.28840498988769014,0.27853729772514618,0.26913189945012761,0.26019972470255071,0.25175170312233769,0.24379876434940864,0.23635291931752683,0.22952818029737085,0.22335486178313113,0.21777505523481872,0.21273085211244536,0.20816434387602006,0.2040176219855549,0.20023277790106075,0.19675190308254922,0.19351708899002995,0.19050883202845312,0.18840067042779196,0.18731067041999352,0.18704459549263455,0.18740820913329248,0.18820727482954436,0.18924755606896718,0.19033481633913857,0.19127481912763536,0.19187332792203471,0.1921482113849188,0.19408255743225492,0.19776345199071646,0.2026292453161645,0.20811828766445931,0.21366892929146447,0.21871952045304002,0.22270841140504732,0.22507395240334738,0.22525449370380249,0.22269871490926874,0.21733166912185264,0.20966761673251624,0.20025384341061306,0.18963763482550114,0.17836627664653731,0.16698705454308044,0.15604725418448265,0.14609416124010299,0.13767506137929816,0.13065051247878448,0.12293963818639465,0.11462075844316168,0.10600006099361568,0.097383733582288773,0.089077963953707776,0.081388939852404724,0.074622849022909873,0.069085879209754536,0.065084218157466747,0.062415404665685459,0.060163096773097599,0.058339286427718767,0.056989764119014151,0.056160320336450027,0.055896745569492277,0.056244830307606672,0.05725036504025921,0.058959140256915808,0.061416946447042313,0.064604790673916931,0.068439407933976126,0.072910558098490202,0.078008786464124999,0.083724638327545134,0.090048658985418736,0.096971393734410563,0.1044833878711849,0.11257518669241059,0.12123733549475196],"text":["Date: 18413.00<br />Weight: 0.33228010<br />Asset: AZUL4.SA","Date: 18431.49<br />Weight: 0.32067253<br />Asset: AZUL4.SA","Date: 18449.99<br />Weight: 0.30948354<br />Asset: AZUL4.SA","Date: 18468.48<br />Weight: 0.29872405<br />Asset: AZUL4.SA","Date: 18486.97<br />Weight: 0.28840499<br />Asset: AZUL4.SA","Date: 18505.47<br />Weight: 0.27853730<br />Asset: AZUL4.SA","Date: 18523.96<br />Weight: 0.26913190<br />Asset: AZUL4.SA","Date: 18542.46<br />Weight: 0.26019972<br />Asset: AZUL4.SA","Date: 18560.95<br />Weight: 0.25175170<br />Asset: AZUL4.SA","Date: 18579.44<br />Weight: 0.24379876<br />Asset: AZUL4.SA","Date: 18597.94<br />Weight: 0.23635292<br />Asset: AZUL4.SA","Date: 18616.43<br />Weight: 0.22952818<br />Asset: AZUL4.SA","Date: 18634.92<br />Weight: 0.22335486<br />Asset: AZUL4.SA","Date: 18653.42<br />Weight: 0.21777506<br />Asset: AZUL4.SA","Date: 18671.91<br />Weight: 0.21273085<br />Asset: AZUL4.SA","Date: 18690.41<br />Weight: 0.20816434<br />Asset: AZUL4.SA","Date: 18708.90<br />Weight: 0.20401762<br />Asset: AZUL4.SA","Date: 18727.39<br />Weight: 0.20023278<br />Asset: AZUL4.SA","Date: 18745.89<br />Weight: 0.19675190<br />Asset: AZUL4.SA","Date: 18764.38<br />Weight: 0.19351709<br />Asset: AZUL4.SA","Date: 18782.87<br />Weight: 0.19050883<br />Asset: AZUL4.SA","Date: 18801.37<br />Weight: 0.18840067<br />Asset: AZUL4.SA","Date: 18819.86<br />Weight: 0.18731067<br />Asset: AZUL4.SA","Date: 18838.35<br />Weight: 0.18704460<br />Asset: AZUL4.SA","Date: 18856.85<br />Weight: 0.18740821<br />Asset: AZUL4.SA","Date: 18875.34<br />Weight: 0.18820727<br />Asset: AZUL4.SA","Date: 18893.84<br />Weight: 0.18924756<br />Asset: AZUL4.SA","Date: 18912.33<br />Weight: 0.19033482<br />Asset: AZUL4.SA","Date: 18930.82<br />Weight: 0.19127482<br />Asset: AZUL4.SA","Date: 18949.32<br />Weight: 0.19187333<br />Asset: AZUL4.SA","Date: 18967.81<br />Weight: 0.19214821<br />Asset: AZUL4.SA","Date: 18986.30<br />Weight: 0.19408256<br />Asset: AZUL4.SA","Date: 19004.80<br />Weight: 0.19776345<br />Asset: AZUL4.SA","Date: 19023.29<br />Weight: 0.20262925<br />Asset: AZUL4.SA","Date: 19041.78<br />Weight: 0.20811829<br />Asset: AZUL4.SA","Date: 19060.28<br />Weight: 0.21366893<br />Asset: AZUL4.SA","Date: 19078.77<br />Weight: 0.21871952<br />Asset: AZUL4.SA","Date: 19097.27<br />Weight: 0.22270841<br />Asset: AZUL4.SA","Date: 19115.76<br />Weight: 0.22507395<br />Asset: AZUL4.SA","Date: 19134.25<br />Weight: 0.22525449<br />Asset: AZUL4.SA","Date: 19152.75<br />Weight: 0.22269871<br />Asset: AZUL4.SA","Date: 19171.24<br />Weight: 0.21733167<br />Asset: AZUL4.SA","Date: 19189.73<br />Weight: 0.20966762<br />Asset: AZUL4.SA","Date: 19208.23<br />Weight: 0.20025384<br />Asset: AZUL4.SA","Date: 19226.72<br />Weight: 0.18963763<br />Asset: AZUL4.SA","Date: 19245.22<br />Weight: 0.17836628<br />Asset: AZUL4.SA","Date: 19263.71<br />Weight: 0.16698705<br />Asset: AZUL4.SA","Date: 19282.20<br />Weight: 0.15604725<br />Asset: AZUL4.SA","Date: 19300.70<br />Weight: 0.14609416<br />Asset: AZUL4.SA","Date: 19319.19<br />Weight: 0.13767506<br />Asset: AZUL4.SA","Date: 19337.68<br />Weight: 0.13065051<br />Asset: AZUL4.SA","Date: 19356.18<br />Weight: 0.12293964<br />Asset: AZUL4.SA","Date: 19374.67<br />Weight: 0.11462076<br />Asset: AZUL4.SA","Date: 19393.16<br />Weight: 0.10600006<br />Asset: AZUL4.SA","Date: 19411.66<br />Weight: 0.09738373<br />Asset: AZUL4.SA","Date: 19430.15<br />Weight: 0.08907796<br />Asset: AZUL4.SA","Date: 19448.65<br />Weight: 0.08138894<br />Asset: AZUL4.SA","Date: 19467.14<br />Weight: 0.07462285<br />Asset: AZUL4.SA","Date: 19485.63<br />Weight: 0.06908588<br />Asset: AZUL4.SA","Date: 19504.13<br />Weight: 0.06508422<br />Asset: AZUL4.SA","Date: 19522.62<br />Weight: 0.06241540<br />Asset: AZUL4.SA","Date: 19541.11<br />Weight: 0.06016310<br />Asset: AZUL4.SA","Date: 19559.61<br />Weight: 0.05833929<br />Asset: AZUL4.SA","Date: 19578.10<br />Weight: 0.05698976<br />Asset: AZUL4.SA","Date: 19596.59<br />Weight: 0.05616032<br />Asset: AZUL4.SA","Date: 19615.09<br />Weight: 0.05589675<br />Asset: AZUL4.SA","Date: 19633.58<br />Weight: 0.05624483<br />Asset: AZUL4.SA","Date: 19652.08<br />Weight: 0.05725037<br />Asset: AZUL4.SA","Date: 19670.57<br />Weight: 0.05895914<br />Asset: AZUL4.SA","Date: 19689.06<br />Weight: 0.06141695<br />Asset: AZUL4.SA","Date: 19707.56<br />Weight: 0.06460479<br />Asset: AZUL4.SA","Date: 19726.05<br />Weight: 0.06843941<br />Asset: AZUL4.SA","Date: 19744.54<br />Weight: 0.07291056<br />Asset: AZUL4.SA","Date: 19763.04<br />Weight: 0.07800879<br />Asset: AZUL4.SA","Date: 19781.53<br />Weight: 0.08372464<br />Asset: AZUL4.SA","Date: 19800.03<br />Weight: 0.09004866<br />Asset: AZUL4.SA","Date: 19818.52<br />Weight: 0.09697139<br />Asset: AZUL4.SA","Date: 19837.01<br />Weight: 0.10448339<br />Asset: AZUL4.SA","Date: 19855.51<br />Weight: 0.11257519<br />Asset: AZUL4.SA","Date: 19874.00<br />Weight: 0.12123734<br />Asset: AZUL4.SA"],"type":"scatter","mode":"lines","name":"(AZUL4.SA,1)","line":{"width":3.7795275590551185,"color":"rgba(248,118,109,1)","dash":"solid"},"hoveron":"points","legendgroup":"(AZUL4.SA,1)","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[18413,18431.493670886077,18449.98734177215,18468.481012658227,18486.974683544304,18505.468354430381,18523.962025316454,18542.455696202531,18560.949367088608,18579.443037974685,18597.936708860758,18616.430379746835,18634.924050632912,18653.417721518988,18671.911392405062,18690.405063291139,18708.898734177215,18727.392405063292,18745.886075949365,18764.379746835442,18782.873417721519,18801.367088607596,18819.860759493669,18838.354430379746,18856.848101265823,18875.3417721519,18893.835443037973,18912.32911392405,18930.822784810127,18949.316455696204,18967.810126582277,18986.303797468354,19004.797468354431,19023.291139240508,19041.784810126581,19060.278481012658,19078.772151898735,19097.265822784811,19115.759493670885,19134.253164556962,19152.746835443038,19171.240506329115,19189.734177215189,19208.227848101265,19226.721518987342,19245.215189873419,19263.708860759492,19282.202531645569,19300.696202531646,19319.189873417723,19337.683544303796,19356.177215189873,19374.67088607595,19393.164556962027,19411.6582278481,19430.151898734177,19448.645569620254,19467.139240506331,19485.632911392404,19504.126582278481,19522.620253164558,19541.113924050635,19559.607594936708,19578.101265822785,19596.594936708861,19615.088607594938,19633.582278481012,19652.075949367088,19670.569620253165,19689.063291139242,19707.556962025315,19726.050632911392,19744.544303797469,19763.037974683546,19781.531645569619,19800.025316455696,19818.518987341773,19837.012658227846,19855.506329113923,19874],"y":[0.1777058448963264,0.1743992598049029,0.17120399740500572,0.16811948338201779,0.16514514342132391,0.16228040320830822,0.15952468842835549,0.15687742476684871,0.15433803790917267,0.15190595354071146,0.14958074725109877,0.14737789998783773,0.145307040873075,0.14336672715469673,0.14155551608058931,0.13987196489863821,0.1383146308567299,0.13688207120275056,0.13557284318458643,0.13438550405012323,0.13331573087591503,0.13230919128530344,0.13135796301038852,0.13047821250598035,0.1296861062268895,0.12899781062792642,0.1284294921639017,0.12799731728962552,0.1277174524599084,0.12760606412956077,0.12773002795205896,0.12858988344206923,0.13016083431054465,0.13225527553697547,0.13468560210085156,0.1372642089816643,0.13980349115890356,0.1421158436120597,0.14401366132062274,0.14530933926408385,0.14589432605610211,0.14609828039167091,0.14602212188655489,0.14571181377713838,0.14521331929980588,0.14457260169094177,0.14383562418693061,0.1430483500241565,0.14225674243900405,0.14150676466785764,0.14059224074363613,0.13874568463500361,0.13617456592660099,0.13317773411742292,0.13005403870646479,0.12710232919272005,0.12462145507518402,0.12291026585285138,0.12226761102471692,0.122992340089775,0.12487816615200065,0.1270214534179723,0.12945044102165151,0.13222709198349017,0.13541336932393866,0.13907123606344785,0.14326265522246781,0.14804958982145097,0.1534940028808475,0.15965785742110825,0.16652872362988366,0.17401230109386198,0.18209276446351727,0.19075516569489759,0.19998455674404883,0.20976598956702269,0.22008451611986535,0.23092518835862252,0.2422730582393465,0.25411317771808312],"text":["Date: 18413.00<br />Weight: 0.17770584<br />Asset: CMIG4.SA","Date: 18431.49<br />Weight: 0.17439926<br />Asset: CMIG4.SA","Date: 18449.99<br />Weight: 0.17120400<br />Asset: CMIG4.SA","Date: 18468.48<br />Weight: 0.16811948<br />Asset: CMIG4.SA","Date: 18486.97<br />Weight: 0.16514514<br />Asset: CMIG4.SA","Date: 18505.47<br />Weight: 0.16228040<br />Asset: CMIG4.SA","Date: 18523.96<br />Weight: 0.15952469<br />Asset: CMIG4.SA","Date: 18542.46<br />Weight: 0.15687742<br />Asset: CMIG4.SA","Date: 18560.95<br />Weight: 0.15433804<br />Asset: CMIG4.SA","Date: 18579.44<br />Weight: 0.15190595<br />Asset: CMIG4.SA","Date: 18597.94<br />Weight: 0.14958075<br />Asset: CMIG4.SA","Date: 18616.43<br />Weight: 0.14737790<br />Asset: CMIG4.SA","Date: 18634.92<br />Weight: 0.14530704<br />Asset: CMIG4.SA","Date: 18653.42<br />Weight: 0.14336673<br />Asset: CMIG4.SA","Date: 18671.91<br />Weight: 0.14155552<br />Asset: CMIG4.SA","Date: 18690.41<br />Weight: 0.13987196<br />Asset: CMIG4.SA","Date: 18708.90<br />Weight: 0.13831463<br />Asset: CMIG4.SA","Date: 18727.39<br />Weight: 0.13688207<br />Asset: CMIG4.SA","Date: 18745.89<br />Weight: 0.13557284<br />Asset: CMIG4.SA","Date: 18764.38<br />Weight: 0.13438550<br />Asset: CMIG4.SA","Date: 18782.87<br />Weight: 0.13331573<br />Asset: CMIG4.SA","Date: 18801.37<br />Weight: 0.13230919<br />Asset: CMIG4.SA","Date: 18819.86<br />Weight: 0.13135796<br />Asset: CMIG4.SA","Date: 18838.35<br />Weight: 0.13047821<br />Asset: CMIG4.SA","Date: 18856.85<br />Weight: 0.12968611<br />Asset: CMIG4.SA","Date: 18875.34<br />Weight: 0.12899781<br />Asset: CMIG4.SA","Date: 18893.84<br />Weight: 0.12842949<br />Asset: CMIG4.SA","Date: 18912.33<br />Weight: 0.12799732<br />Asset: CMIG4.SA","Date: 18930.82<br />Weight: 0.12771745<br />Asset: CMIG4.SA","Date: 18949.32<br />Weight: 0.12760606<br />Asset: CMIG4.SA","Date: 18967.81<br />Weight: 0.12773003<br />Asset: CMIG4.SA","Date: 18986.30<br />Weight: 0.12858988<br />Asset: CMIG4.SA","Date: 19004.80<br />Weight: 0.13016083<br />Asset: CMIG4.SA","Date: 19023.29<br />Weight: 0.13225528<br />Asset: CMIG4.SA","Date: 19041.78<br />Weight: 0.13468560<br />Asset: CMIG4.SA","Date: 19060.28<br />Weight: 0.13726421<br />Asset: CMIG4.SA","Date: 19078.77<br />Weight: 0.13980349<br />Asset: CMIG4.SA","Date: 19097.27<br />Weight: 0.14211584<br />Asset: CMIG4.SA","Date: 19115.76<br />Weight: 0.14401366<br />Asset: CMIG4.SA","Date: 19134.25<br />Weight: 0.14530934<br />Asset: CMIG4.SA","Date: 19152.75<br />Weight: 0.14589433<br />Asset: CMIG4.SA","Date: 19171.24<br />Weight: 0.14609828<br />Asset: CMIG4.SA","Date: 19189.73<br />Weight: 0.14602212<br />Asset: CMIG4.SA","Date: 19208.23<br />Weight: 0.14571181<br />Asset: CMIG4.SA","Date: 19226.72<br />Weight: 0.14521332<br />Asset: CMIG4.SA","Date: 19245.22<br />Weight: 0.14457260<br />Asset: CMIG4.SA","Date: 19263.71<br />Weight: 0.14383562<br />Asset: CMIG4.SA","Date: 19282.20<br />Weight: 0.14304835<br />Asset: CMIG4.SA","Date: 19300.70<br />Weight: 0.14225674<br />Asset: CMIG4.SA","Date: 19319.19<br />Weight: 0.14150676<br />Asset: CMIG4.SA","Date: 19337.68<br />Weight: 0.14059224<br />Asset: CMIG4.SA","Date: 19356.18<br />Weight: 0.13874568<br />Asset: CMIG4.SA","Date: 19374.67<br />Weight: 0.13617457<br />Asset: CMIG4.SA","Date: 19393.16<br />Weight: 0.13317773<br />Asset: CMIG4.SA","Date: 19411.66<br />Weight: 0.13005404<br />Asset: CMIG4.SA","Date: 19430.15<br />Weight: 0.12710233<br />Asset: CMIG4.SA","Date: 19448.65<br />Weight: 0.12462146<br />Asset: CMIG4.SA","Date: 19467.14<br />Weight: 0.12291027<br />Asset: CMIG4.SA","Date: 19485.63<br />Weight: 0.12226761<br />Asset: CMIG4.SA","Date: 19504.13<br />Weight: 0.12299234<br />Asset: CMIG4.SA","Date: 19522.62<br />Weight: 0.12487817<br />Asset: CMIG4.SA","Date: 19541.11<br />Weight: 0.12702145<br />Asset: CMIG4.SA","Date: 19559.61<br />Weight: 0.12945044<br />Asset: CMIG4.SA","Date: 19578.10<br />Weight: 0.13222709<br />Asset: CMIG4.SA","Date: 19596.59<br />Weight: 0.13541337<br />Asset: CMIG4.SA","Date: 19615.09<br />Weight: 0.13907124<br />Asset: CMIG4.SA","Date: 19633.58<br />Weight: 0.14326266<br />Asset: CMIG4.SA","Date: 19652.08<br />Weight: 0.14804959<br />Asset: CMIG4.SA","Date: 19670.57<br />Weight: 0.15349400<br />Asset: CMIG4.SA","Date: 19689.06<br />Weight: 0.15965786<br />Asset: CMIG4.SA","Date: 19707.56<br />Weight: 0.16652872<br />Asset: CMIG4.SA","Date: 19726.05<br />Weight: 0.17401230<br />Asset: CMIG4.SA","Date: 19744.54<br />Weight: 0.18209276<br />Asset: CMIG4.SA","Date: 19763.04<br />Weight: 0.19075517<br />Asset: CMIG4.SA","Date: 19781.53<br />Weight: 0.19998456<br />Asset: CMIG4.SA","Date: 19800.03<br />Weight: 0.20976599<br />Asset: CMIG4.SA","Date: 19818.52<br />Weight: 0.22008452<br />Asset: CMIG4.SA","Date: 19837.01<br />Weight: 0.23092519<br />Asset: CMIG4.SA","Date: 19855.51<br />Weight: 0.24227306<br />Asset: CMIG4.SA","Date: 19874.00<br />Weight: 0.25411318<br />Asset: CMIG4.SA"],"type":"scatter","mode":"lines","name":"(CMIG4.SA,1)","line":{"width":3.7795275590551185,"color":"rgba(163,165,0,1)","dash":"solid"},"hoveron":"points","legendgroup":"(CMIG4.SA,1)","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[18413,18431.493670886077,18449.98734177215,18468.481012658227,18486.974683544304,18505.468354430381,18523.962025316454,18542.455696202531,18560.949367088608,18579.443037974685,18597.936708860758,18616.430379746835,18634.924050632912,18653.417721518988,18671.911392405062,18690.405063291139,18708.898734177215,18727.392405063292,18745.886075949365,18764.379746835442,18782.873417721519,18801.367088607596,18819.860759493669,18838.354430379746,18856.848101265823,18875.3417721519,18893.835443037973,18912.32911392405,18930.822784810127,18949.316455696204,18967.810126582277,18986.303797468354,19004.797468354431,19023.291139240508,19041.784810126581,19060.278481012658,19078.772151898735,19097.265822784811,19115.759493670885,19134.253164556962,19152.746835443038,19171.240506329115,19189.734177215189,19208.227848101265,19226.721518987342,19245.215189873419,19263.708860759492,19282.202531645569,19300.696202531646,19319.189873417723,19337.683544303796,19356.177215189873,19374.67088607595,19393.164556962027,19411.6582278481,19430.151898734177,19448.645569620254,19467.139240506331,19485.632911392404,19504.126582278481,19522.620253164558,19541.113924050635,19559.607594936708,19578.101265822785,19596.594936708861,19615.088607594938,19633.582278481012,19652.075949367088,19670.569620253165,19689.063291139242,19707.556962025315,19726.050632911392,19744.544303797469,19763.037974683546,19781.531645569619,19800.025316455696,19818.518987341773,19837.012658227846,19855.506329113923,19874],"y":[0.11737195897517796,0.12513357420646146,0.13254056361201527,0.13959583936852707,0.14630231365268015,0.15266289864115937,0.15868050651064827,0.164358049437834,0.1696984395994002,0.17470458917203158,0.17937948653818986,0.18373139927783197,0.18775647203445064,0.19144337771678641,0.19478078923357925,0.19775737949357089,0.20036182140550135,0.2025827878781111,0.20440895182014027,0.20582898614033027,0.20684998061348686,0.20780351498866897,0.20873580020431318,0.20954061578593469,0.21011174125904797,0.21034295614916773,0.2101280399818089,0.20936077228248609,0.207934932576714,0.20574430039000741,0.20261750147855287,0.19787987309114827,0.19163909817133007,0.18422353693225402,0.17596154958707777,0.16718149634895391,0.15821173743103981,0.14938063304649141,0.14101654340846603,0.13344782873011635,0.12668480461105189,0.11930203425781866,0.11127770219042418,0.10284248226317927,0.094227048330399507,0.085662074246398878,0.077378233865492987,0.069606201041992541,0.062576649630213241,0.056520253484469089,0.051436880050649551,0.046619655039796662,0.042022186543201411,0.037671906110520306,0.033596245291410684,0.029822635635527481,0.026378508692528058,0.023291296012068967,0.020588429143807239,0.018297339637398345,0.016398533568478875,0.014808333741714849,0.013530144036179985,0.012570509350224301,0.01193597458219859,0.01163308463045337,0.011668384393339117,0.012048418769206355,0.012779732656405633,0.013868870953287461,0.015309969281053024,0.017086622071823244,0.019197592881263492,0.021641801117772426,0.024418166189748097,0.027525607505590247,0.030963044473697018,0.034729396502466273,0.038823583000298159,0.043244523375590593],"text":["Date: 18413.00<br />Weight: 0.11737196<br />Asset: MGLU3.SA","Date: 18431.49<br />Weight: 0.12513357<br />Asset: MGLU3.SA","Date: 18449.99<br />Weight: 0.13254056<br />Asset: MGLU3.SA","Date: 18468.48<br />Weight: 0.13959584<br />Asset: MGLU3.SA","Date: 18486.97<br />Weight: 0.14630231<br />Asset: MGLU3.SA","Date: 18505.47<br />Weight: 0.15266290<br />Asset: MGLU3.SA","Date: 18523.96<br />Weight: 0.15868051<br />Asset: MGLU3.SA","Date: 18542.46<br />Weight: 0.16435805<br />Asset: MGLU3.SA","Date: 18560.95<br />Weight: 0.16969844<br />Asset: MGLU3.SA","Date: 18579.44<br />Weight: 0.17470459<br />Asset: MGLU3.SA","Date: 18597.94<br />Weight: 0.17937949<br />Asset: MGLU3.SA","Date: 18616.43<br />Weight: 0.18373140<br />Asset: MGLU3.SA","Date: 18634.92<br />Weight: 0.18775647<br />Asset: MGLU3.SA","Date: 18653.42<br />Weight: 0.19144338<br />Asset: MGLU3.SA","Date: 18671.91<br />Weight: 0.19478079<br />Asset: MGLU3.SA","Date: 18690.41<br />Weight: 0.19775738<br />Asset: MGLU3.SA","Date: 18708.90<br />Weight: 0.20036182<br />Asset: MGLU3.SA","Date: 18727.39<br />Weight: 0.20258279<br />Asset: MGLU3.SA","Date: 18745.89<br />Weight: 0.20440895<br />Asset: MGLU3.SA","Date: 18764.38<br />Weight: 0.20582899<br />Asset: MGLU3.SA","Date: 18782.87<br />Weight: 0.20684998<br />Asset: MGLU3.SA","Date: 18801.37<br />Weight: 0.20780351<br />Asset: MGLU3.SA","Date: 18819.86<br />Weight: 0.20873580<br />Asset: MGLU3.SA","Date: 18838.35<br />Weight: 0.20954062<br />Asset: MGLU3.SA","Date: 18856.85<br />Weight: 0.21011174<br />Asset: MGLU3.SA","Date: 18875.34<br />Weight: 0.21034296<br />Asset: MGLU3.SA","Date: 18893.84<br />Weight: 0.21012804<br />Asset: MGLU3.SA","Date: 18912.33<br />Weight: 0.20936077<br />Asset: MGLU3.SA","Date: 18930.82<br />Weight: 0.20793493<br />Asset: MGLU3.SA","Date: 18949.32<br />Weight: 0.20574430<br />Asset: MGLU3.SA","Date: 18967.81<br />Weight: 0.20261750<br />Asset: MGLU3.SA","Date: 18986.30<br />Weight: 0.19787987<br />Asset: MGLU3.SA","Date: 19004.80<br />Weight: 0.19163910<br />Asset: MGLU3.SA","Date: 19023.29<br />Weight: 0.18422354<br />Asset: MGLU3.SA","Date: 19041.78<br />Weight: 0.17596155<br />Asset: MGLU3.SA","Date: 19060.28<br />Weight: 0.16718150<br />Asset: MGLU3.SA","Date: 19078.77<br />Weight: 0.15821174<br />Asset: MGLU3.SA","Date: 19097.27<br />Weight: 0.14938063<br />Asset: MGLU3.SA","Date: 19115.76<br />Weight: 0.14101654<br />Asset: MGLU3.SA","Date: 19134.25<br />Weight: 0.13344783<br />Asset: MGLU3.SA","Date: 19152.75<br />Weight: 0.12668480<br />Asset: MGLU3.SA","Date: 19171.24<br />Weight: 0.11930203<br />Asset: MGLU3.SA","Date: 19189.73<br />Weight: 0.11127770<br />Asset: MGLU3.SA","Date: 19208.23<br />Weight: 0.10284248<br />Asset: MGLU3.SA","Date: 19226.72<br />Weight: 0.09422705<br />Asset: MGLU3.SA","Date: 19245.22<br />Weight: 0.08566207<br />Asset: MGLU3.SA","Date: 19263.71<br />Weight: 0.07737823<br />Asset: MGLU3.SA","Date: 19282.20<br />Weight: 0.06960620<br />Asset: MGLU3.SA","Date: 19300.70<br />Weight: 0.06257665<br />Asset: MGLU3.SA","Date: 19319.19<br />Weight: 0.05652025<br />Asset: MGLU3.SA","Date: 19337.68<br />Weight: 0.05143688<br />Asset: MGLU3.SA","Date: 19356.18<br />Weight: 0.04661966<br />Asset: MGLU3.SA","Date: 19374.67<br />Weight: 0.04202219<br />Asset: MGLU3.SA","Date: 19393.16<br />Weight: 0.03767191<br />Asset: MGLU3.SA","Date: 19411.66<br />Weight: 0.03359625<br />Asset: MGLU3.SA","Date: 19430.15<br />Weight: 0.02982264<br />Asset: MGLU3.SA","Date: 19448.65<br />Weight: 0.02637851<br />Asset: MGLU3.SA","Date: 19467.14<br />Weight: 0.02329130<br />Asset: MGLU3.SA","Date: 19485.63<br />Weight: 0.02058843<br />Asset: MGLU3.SA","Date: 19504.13<br />Weight: 0.01829734<br />Asset: MGLU3.SA","Date: 19522.62<br />Weight: 0.01639853<br />Asset: MGLU3.SA","Date: 19541.11<br />Weight: 0.01480833<br />Asset: MGLU3.SA","Date: 19559.61<br />Weight: 0.01353014<br />Asset: MGLU3.SA","Date: 19578.10<br />Weight: 0.01257051<br />Asset: MGLU3.SA","Date: 19596.59<br />Weight: 0.01193597<br />Asset: MGLU3.SA","Date: 19615.09<br />Weight: 0.01163308<br />Asset: MGLU3.SA","Date: 19633.58<br />Weight: 0.01166838<br />Asset: MGLU3.SA","Date: 19652.08<br />Weight: 0.01204842<br />Asset: MGLU3.SA","Date: 19670.57<br />Weight: 0.01277973<br />Asset: MGLU3.SA","Date: 19689.06<br />Weight: 0.01386887<br />Asset: MGLU3.SA","Date: 19707.56<br />Weight: 0.01530997<br />Asset: MGLU3.SA","Date: 19726.05<br />Weight: 0.01708662<br />Asset: MGLU3.SA","Date: 19744.54<br />Weight: 0.01919759<br />Asset: MGLU3.SA","Date: 19763.04<br />Weight: 0.02164180<br />Asset: MGLU3.SA","Date: 19781.53<br />Weight: 0.02441817<br />Asset: MGLU3.SA","Date: 19800.03<br />Weight: 0.02752561<br />Asset: MGLU3.SA","Date: 19818.52<br />Weight: 0.03096304<br />Asset: MGLU3.SA","Date: 19837.01<br />Weight: 0.03472940<br />Asset: MGLU3.SA","Date: 19855.51<br />Weight: 0.03882358<br />Asset: MGLU3.SA","Date: 19874.00<br />Weight: 0.04324452<br />Asset: MGLU3.SA"],"type":"scatter","mode":"lines","name":"(MGLU3.SA,1)","line":{"width":3.7795275590551185,"color":"rgba(0,191,125,1)","dash":"solid"},"hoveron":"points","legendgroup":"(MGLU3.SA,1)","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[18413,18431.493670886077,18449.98734177215,18468.481012658227,18486.974683544304,18505.468354430381,18523.962025316454,18542.455696202531,18560.949367088608,18579.443037974685,18597.936708860758,18616.430379746835,18634.924050632912,18653.417721518988,18671.911392405062,18690.405063291139,18708.898734177215,18727.392405063292,18745.886075949365,18764.379746835442,18782.873417721519,18801.367088607596,18819.860759493669,18838.354430379746,18856.848101265823,18875.3417721519,18893.835443037973,18912.32911392405,18930.822784810127,18949.316455696204,18967.810126582277,18986.303797468354,19004.797468354431,19023.291139240508,19041.784810126581,19060.278481012658,19078.772151898735,19097.265822784811,19115.759493670885,19134.253164556962,19152.746835443038,19171.240506329115,19189.734177215189,19208.227848101265,19226.721518987342,19245.215189873419,19263.708860759492,19282.202531645569,19300.696202531646,19319.189873417723,19337.683544303796,19356.177215189873,19374.67088607595,19393.164556962027,19411.6582278481,19430.151898734177,19448.645569620254,19467.139240506331,19485.632911392404,19504.126582278481,19522.620253164558,19541.113924050635,19559.607594936708,19578.101265822785,19596.594936708861,19615.088607594938,19633.582278481012,19652.075949367088,19670.569620253165,19689.063291139242,19707.556962025315,19726.050632911392,19744.544303797469,19763.037974683546,19781.531645569619,19800.025316455696,19818.518987341773,19837.012658227846,19855.506329113923,19874],"y":[0.12209876299601501,0.13374086783457281,0.14498126728170968,0.1558091383297294,0.16621365797092899,0.17618400319760785,0.18570935100206348,0.19477887837659894,0.20338176231351165,0.21150717980510098,0.21914316276408954,0.22616910877304447,0.23255104289900846,0.23834801302745545,0.24361906704385816,0.24842325283369251,0.25281961828243127,0.25686721127554829,0.2606250796985165,0.26415227143681141,0.26746876870798364,0.26988995838769991,0.27129714976472497,0.27188945335358844,0.27186597966881892,0.27142583922494523,0.27076814253649673,0.27009200011800194,0.26959652248399008,0.26948082014898989,0.26972246358178315,0.26824772769266597,0.26496589772010559,0.26046413748050717,0.25532961079027727,0.25014948146581922,0.24551091332353944,0.24200107017984332,0.2402071158511363,0.24071621415382322,0.24412076364152596,0.25057534604258147,0.25952981500098493,0.27038560143821949,0.28254413627576352,0.29540685043509662,0.30837517483769611,0.32085054040504685,0.33223437805862621,0.34192811871991358,0.35013219540966029,0.35926908545751474,0.3692048100282459,0.37953839393844713,0.38986886200471033,0.39979523904363329,0.40891654987180764,0.41683181930582719,0.42314007216228444,0.42744033325777553,0.43000004695041555,0.43202170487565217,0.43348523539053069,0.43432610993376486,0.43447979994406716,0.43388177686015034,0.43246751212072793,0.43017247716451196,0.42693214343021585,0.42268198235655213,0.41744580294528855,0.41133686667332553,0.40437006881603388,0.39655923918900982,0.3879182076078514,0.37846080388815134,0.36820085784550777,0.35715219929551928,0.34532865805377755,0.33274406393588118],"text":["Date: 18413.00<br />Weight: 0.12209876<br />Asset: PETR4.SA","Date: 18431.49<br />Weight: 0.13374087<br />Asset: PETR4.SA","Date: 18449.99<br />Weight: 0.14498127<br />Asset: PETR4.SA","Date: 18468.48<br />Weight: 0.15580914<br />Asset: PETR4.SA","Date: 18486.97<br />Weight: 0.16621366<br />Asset: PETR4.SA","Date: 18505.47<br />Weight: 0.17618400<br />Asset: PETR4.SA","Date: 18523.96<br />Weight: 0.18570935<br />Asset: PETR4.SA","Date: 18542.46<br />Weight: 0.19477888<br />Asset: PETR4.SA","Date: 18560.95<br />Weight: 0.20338176<br />Asset: PETR4.SA","Date: 18579.44<br />Weight: 0.21150718<br />Asset: PETR4.SA","Date: 18597.94<br />Weight: 0.21914316<br />Asset: PETR4.SA","Date: 18616.43<br />Weight: 0.22616911<br />Asset: PETR4.SA","Date: 18634.92<br />Weight: 0.23255104<br />Asset: PETR4.SA","Date: 18653.42<br />Weight: 0.23834801<br />Asset: PETR4.SA","Date: 18671.91<br />Weight: 0.24361907<br />Asset: PETR4.SA","Date: 18690.41<br />Weight: 0.24842325<br />Asset: PETR4.SA","Date: 18708.90<br />Weight: 0.25281962<br />Asset: PETR4.SA","Date: 18727.39<br />Weight: 0.25686721<br />Asset: PETR4.SA","Date: 18745.89<br />Weight: 0.26062508<br />Asset: PETR4.SA","Date: 18764.38<br />Weight: 0.26415227<br />Asset: PETR4.SA","Date: 18782.87<br />Weight: 0.26746877<br />Asset: PETR4.SA","Date: 18801.37<br />Weight: 0.26988996<br />Asset: PETR4.SA","Date: 18819.86<br />Weight: 0.27129715<br />Asset: PETR4.SA","Date: 18838.35<br />Weight: 0.27188945<br />Asset: PETR4.SA","Date: 18856.85<br />Weight: 0.27186598<br />Asset: PETR4.SA","Date: 18875.34<br />Weight: 0.27142584<br />Asset: PETR4.SA","Date: 18893.84<br />Weight: 0.27076814<br />Asset: PETR4.SA","Date: 18912.33<br />Weight: 0.27009200<br />Asset: PETR4.SA","Date: 18930.82<br />Weight: 0.26959652<br />Asset: PETR4.SA","Date: 18949.32<br />Weight: 0.26948082<br />Asset: PETR4.SA","Date: 18967.81<br />Weight: 0.26972246<br />Asset: PETR4.SA","Date: 18986.30<br />Weight: 0.26824773<br />Asset: PETR4.SA","Date: 19004.80<br />Weight: 0.26496590<br />Asset: PETR4.SA","Date: 19023.29<br />Weight: 0.26046414<br />Asset: PETR4.SA","Date: 19041.78<br />Weight: 0.25532961<br />Asset: PETR4.SA","Date: 19060.28<br />Weight: 0.25014948<br />Asset: PETR4.SA","Date: 19078.77<br />Weight: 0.24551091<br />Asset: PETR4.SA","Date: 19097.27<br />Weight: 0.24200107<br />Asset: PETR4.SA","Date: 19115.76<br />Weight: 0.24020712<br />Asset: PETR4.SA","Date: 19134.25<br />Weight: 0.24071621<br />Asset: PETR4.SA","Date: 19152.75<br />Weight: 0.24412076<br />Asset: PETR4.SA","Date: 19171.24<br />Weight: 0.25057535<br />Asset: PETR4.SA","Date: 19189.73<br />Weight: 0.25952982<br />Asset: PETR4.SA","Date: 19208.23<br />Weight: 0.27038560<br />Asset: PETR4.SA","Date: 19226.72<br />Weight: 0.28254414<br />Asset: PETR4.SA","Date: 19245.22<br />Weight: 0.29540685<br />Asset: PETR4.SA","Date: 19263.71<br />Weight: 0.30837517<br />Asset: PETR4.SA","Date: 19282.20<br />Weight: 0.32085054<br />Asset: PETR4.SA","Date: 19300.70<br />Weight: 0.33223438<br />Asset: PETR4.SA","Date: 19319.19<br />Weight: 0.34192812<br />Asset: PETR4.SA","Date: 19337.68<br />Weight: 0.35013220<br />Asset: PETR4.SA","Date: 19356.18<br />Weight: 0.35926909<br />Asset: PETR4.SA","Date: 19374.67<br />Weight: 0.36920481<br />Asset: PETR4.SA","Date: 19393.16<br />Weight: 0.37953839<br />Asset: PETR4.SA","Date: 19411.66<br />Weight: 0.38986886<br />Asset: PETR4.SA","Date: 19430.15<br />Weight: 0.39979524<br />Asset: PETR4.SA","Date: 19448.65<br />Weight: 0.40891655<br />Asset: PETR4.SA","Date: 19467.14<br />Weight: 0.41683182<br />Asset: PETR4.SA","Date: 19485.63<br />Weight: 0.42314007<br />Asset: PETR4.SA","Date: 19504.13<br />Weight: 0.42744033<br />Asset: PETR4.SA","Date: 19522.62<br />Weight: 0.43000005<br />Asset: PETR4.SA","Date: 19541.11<br />Weight: 0.43202170<br />Asset: PETR4.SA","Date: 19559.61<br />Weight: 0.43348524<br />Asset: PETR4.SA","Date: 19578.10<br />Weight: 0.43432611<br />Asset: PETR4.SA","Date: 19596.59<br />Weight: 0.43447980<br />Asset: PETR4.SA","Date: 19615.09<br />Weight: 0.43388178<br />Asset: PETR4.SA","Date: 19633.58<br />Weight: 0.43246751<br />Asset: PETR4.SA","Date: 19652.08<br />Weight: 0.43017248<br />Asset: PETR4.SA","Date: 19670.57<br />Weight: 0.42693214<br />Asset: PETR4.SA","Date: 19689.06<br />Weight: 0.42268198<br />Asset: PETR4.SA","Date: 19707.56<br />Weight: 0.41744580<br />Asset: PETR4.SA","Date: 19726.05<br />Weight: 0.41133687<br />Asset: PETR4.SA","Date: 19744.54<br />Weight: 0.40437007<br />Asset: PETR4.SA","Date: 19763.04<br />Weight: 0.39655924<br />Asset: PETR4.SA","Date: 19781.53<br />Weight: 0.38791821<br />Asset: PETR4.SA","Date: 19800.03<br />Weight: 0.37846080<br />Asset: PETR4.SA","Date: 19818.52<br />Weight: 0.36820086<br />Asset: PETR4.SA","Date: 19837.01<br />Weight: 0.35715220<br />Asset: PETR4.SA","Date: 19855.51<br />Weight: 0.34532866<br />Asset: PETR4.SA","Date: 19874.00<br />Weight: 0.33274406<br />Asset: PETR4.SA"],"type":"scatter","mode":"lines","name":"(PETR4.SA,1)","line":{"width":3.7795275590551185,"color":"rgba(0,176,246,1)","dash":"solid"},"hoveron":"points","legendgroup":"(PETR4.SA,1)","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[18413,18431.493670886077,18449.98734177215,18468.481012658227,18486.974683544304,18505.468354430381,18523.962025316454,18542.455696202531,18560.949367088608,18579.443037974685,18597.936708860758,18616.430379746835,18634.924050632912,18653.417721518988,18671.911392405062,18690.405063291139,18708.898734177215,18727.392405063292,18745.886075949365,18764.379746835442,18782.873417721519,18801.367088607596,18819.860759493669,18838.354430379746,18856.848101265823,18875.3417721519,18893.835443037973,18912.32911392405,18930.822784810127,18949.316455696204,18967.810126582277,18986.303797468354,19004.797468354431,19023.291139240508,19041.784810126581,19060.278481012658,19078.772151898735,19097.265822784811,19115.759493670885,19134.253164556962,19152.746835443038,19171.240506329115,19189.734177215189,19208.227848101265,19226.721518987342,19245.215189873419,19263.708860759492,19282.202531645569,19300.696202531646,19319.189873417723,19337.683544303796,19356.177215189873,19374.67088607595,19393.164556962027,19411.6582278481,19430.151898734177,19448.645569620254,19467.139240506331,19485.632911392404,19504.126582278481,19522.620253164558,19541.113924050635,19559.607594936708,19578.101265822785,19596.594936708861,19615.088607594938,19633.582278481012,19652.075949367088,19670.569620253165,19689.063291139242,19707.556962025315,19726.050632911392,19744.544303797469,19763.037974683546,19781.531645569619,19800.025316455696,19818.518987341773,19837.012658227846,19855.506329113923,19874],"y":[0.25054332851778682,0.24605376485280467,0.24179063438560203,0.23775149262188863,0.23393389506737694,0.23033539722777846,0.22695355460880537,0.22378592271616776,0.22083005705557798,0.21808351313274746,0.21554368412909514,0.21319341166391512,0.21103058241033482,0.20906682686624284,0.20731377552952812,0.20578305889807841,0.20448630746978266,0.20343515174252955,0.20264122221420763,0.2021161493827052,0.20185668777416152,0.20159666491053593,0.20129841660057993,0.20104712286186219,0.2009279637119514,0.20102611916841631,0.20142676924882558,0.20221509397074802,0.20347627335175231,0.20529548740940715,0.20778179560268642,0.21119995834186164,0.21547071780730345,0.2204278047340989,0.22590494985733395,0.23173588391209807,0.23775433763347706,0.24379404175655819,0.2496887270164273,0.25527212414817396,0.26060139078205108,0.26669267018607606,0.27350274418951959,0.2808062591108495,0.28837786126852966,0.29599219698102525,0.30342391256679968,0.3104476543443212,0.31683806863205338,0.32236980174846125,0.32718817131726946,0.33242593668129022,0.33797767905879028,0.34361190483999415,0.34909712041512564,0.35420183217441176,0.35869454650807608,0.36234376980634325,0.36491800845943767,0.36618576885758503,0.36630784866342014,0.36598541119156391,0.36519489312391973,0.36388652461350712,0.36201053581334625,0.35951715687645663,0.35635661795585905,0.35247914920457191,0.34783498077561575,0.34237434282201029,0.33611071346985832,0.32912480222701357,0.32142901574069555,0.31303500753419577,0.30395443113080717,0.29419894005381741,0.28378018782651965,0.27270982797220739,0.26099951401416754,0.24866089947569353],"text":["Date: 18413.00<br />Weight: 0.25054333<br />Asset: VALE3.SA","Date: 18431.49<br />Weight: 0.24605376<br />Asset: VALE3.SA","Date: 18449.99<br />Weight: 0.24179063<br />Asset: VALE3.SA","Date: 18468.48<br />Weight: 0.23775149<br />Asset: VALE3.SA","Date: 18486.97<br />Weight: 0.23393390<br />Asset: VALE3.SA","Date: 18505.47<br />Weight: 0.23033540<br />Asset: VALE3.SA","Date: 18523.96<br />Weight: 0.22695355<br />Asset: VALE3.SA","Date: 18542.46<br />Weight: 0.22378592<br />Asset: VALE3.SA","Date: 18560.95<br />Weight: 0.22083006<br />Asset: VALE3.SA","Date: 18579.44<br />Weight: 0.21808351<br />Asset: VALE3.SA","Date: 18597.94<br />Weight: 0.21554368<br />Asset: VALE3.SA","Date: 18616.43<br />Weight: 0.21319341<br />Asset: VALE3.SA","Date: 18634.92<br />Weight: 0.21103058<br />Asset: VALE3.SA","Date: 18653.42<br />Weight: 0.20906683<br />Asset: VALE3.SA","Date: 18671.91<br />Weight: 0.20731378<br />Asset: VALE3.SA","Date: 18690.41<br />Weight: 0.20578306<br />Asset: VALE3.SA","Date: 18708.90<br />Weight: 0.20448631<br />Asset: VALE3.SA","Date: 18727.39<br />Weight: 0.20343515<br />Asset: VALE3.SA","Date: 18745.89<br />Weight: 0.20264122<br />Asset: VALE3.SA","Date: 18764.38<br />Weight: 0.20211615<br />Asset: VALE3.SA","Date: 18782.87<br />Weight: 0.20185669<br />Asset: VALE3.SA","Date: 18801.37<br />Weight: 0.20159666<br />Asset: VALE3.SA","Date: 18819.86<br />Weight: 0.20129842<br />Asset: VALE3.SA","Date: 18838.35<br />Weight: 0.20104712<br />Asset: VALE3.SA","Date: 18856.85<br />Weight: 0.20092796<br />Asset: VALE3.SA","Date: 18875.34<br />Weight: 0.20102612<br />Asset: VALE3.SA","Date: 18893.84<br />Weight: 0.20142677<br />Asset: VALE3.SA","Date: 18912.33<br />Weight: 0.20221509<br />Asset: VALE3.SA","Date: 18930.82<br />Weight: 0.20347627<br />Asset: VALE3.SA","Date: 18949.32<br />Weight: 0.20529549<br />Asset: VALE3.SA","Date: 18967.81<br />Weight: 0.20778180<br />Asset: VALE3.SA","Date: 18986.30<br />Weight: 0.21119996<br />Asset: VALE3.SA","Date: 19004.80<br />Weight: 0.21547072<br />Asset: VALE3.SA","Date: 19023.29<br />Weight: 0.22042780<br />Asset: VALE3.SA","Date: 19041.78<br />Weight: 0.22590495<br />Asset: VALE3.SA","Date: 19060.28<br />Weight: 0.23173588<br />Asset: VALE3.SA","Date: 19078.77<br />Weight: 0.23775434<br />Asset: VALE3.SA","Date: 19097.27<br />Weight: 0.24379404<br />Asset: VALE3.SA","Date: 19115.76<br />Weight: 0.24968873<br />Asset: VALE3.SA","Date: 19134.25<br />Weight: 0.25527212<br />Asset: VALE3.SA","Date: 19152.75<br />Weight: 0.26060139<br />Asset: VALE3.SA","Date: 19171.24<br />Weight: 0.26669267<br />Asset: VALE3.SA","Date: 19189.73<br />Weight: 0.27350274<br />Asset: VALE3.SA","Date: 19208.23<br />Weight: 0.28080626<br />Asset: VALE3.SA","Date: 19226.72<br />Weight: 0.28837786<br />Asset: VALE3.SA","Date: 19245.22<br />Weight: 0.29599220<br />Asset: VALE3.SA","Date: 19263.71<br />Weight: 0.30342391<br />Asset: VALE3.SA","Date: 19282.20<br />Weight: 0.31044765<br />Asset: VALE3.SA","Date: 19300.70<br />Weight: 0.31683807<br />Asset: VALE3.SA","Date: 19319.19<br />Weight: 0.32236980<br />Asset: VALE3.SA","Date: 19337.68<br />Weight: 0.32718817<br />Asset: VALE3.SA","Date: 19356.18<br />Weight: 0.33242594<br />Asset: VALE3.SA","Date: 19374.67<br />Weight: 0.33797768<br />Asset: VALE3.SA","Date: 19393.16<br />Weight: 0.34361190<br />Asset: VALE3.SA","Date: 19411.66<br />Weight: 0.34909712<br />Asset: VALE3.SA","Date: 19430.15<br />Weight: 0.35420183<br />Asset: VALE3.SA","Date: 19448.65<br />Weight: 0.35869455<br />Asset: VALE3.SA","Date: 19467.14<br />Weight: 0.36234377<br />Asset: VALE3.SA","Date: 19485.63<br />Weight: 0.36491801<br />Asset: VALE3.SA","Date: 19504.13<br />Weight: 0.36618577<br />Asset: VALE3.SA","Date: 19522.62<br />Weight: 0.36630785<br />Asset: VALE3.SA","Date: 19541.11<br />Weight: 0.36598541<br />Asset: VALE3.SA","Date: 19559.61<br />Weight: 0.36519489<br />Asset: VALE3.SA","Date: 19578.10<br />Weight: 0.36388652<br />Asset: VALE3.SA","Date: 19596.59<br />Weight: 0.36201054<br />Asset: VALE3.SA","Date: 19615.09<br />Weight: 0.35951716<br />Asset: VALE3.SA","Date: 19633.58<br />Weight: 0.35635662<br />Asset: VALE3.SA","Date: 19652.08<br />Weight: 0.35247915<br />Asset: VALE3.SA","Date: 19670.57<br />Weight: 0.34783498<br />Asset: VALE3.SA","Date: 19689.06<br />Weight: 0.34237434<br />Asset: VALE3.SA","Date: 19707.56<br />Weight: 0.33611071<br />Asset: VALE3.SA","Date: 19726.05<br />Weight: 0.32912480<br />Asset: VALE3.SA","Date: 19744.54<br />Weight: 0.32142902<br />Asset: VALE3.SA","Date: 19763.04<br />Weight: 0.31303501<br />Asset: VALE3.SA","Date: 19781.53<br />Weight: 0.30395443<br />Asset: VALE3.SA","Date: 19800.03<br />Weight: 0.29419894<br />Asset: VALE3.SA","Date: 19818.52<br />Weight: 0.28378019<br />Asset: VALE3.SA","Date: 19837.01<br />Weight: 0.27270983<br />Asset: VALE3.SA","Date: 19855.51<br />Weight: 0.26099951<br />Asset: VALE3.SA","Date: 19874.00<br />Weight: 0.24866090<br />Asset: VALE3.SA"],"type":"scatter","mode":"lines","name":"(VALE3.SA,1)","line":{"width":3.7795275590551185,"color":"rgba(231,107,243,1)","dash":"solid"},"hoveron":"points","legendgroup":"(VALE3.SA,1)","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null}],"layout":{"margin":{"t":47.481942714819425,"r":7.3059360730593621,"b":40.182648401826491,"l":43.105022831050235},"font":{"color":"rgba(0,0,0,1)","family":"","size":14.611872146118724},"title":{"text":"<b> Peso dos ativos rebalanceados ao longo do tempo <\/b>","font":{"color":"rgba(0,0,0,1)","family":"","size":21.253632212536321},"x":0.5,"xref":"paper"},"xaxis":{"domain":[0,1],"automargin":true,"type":"linear","autorange":false,"range":[18339.950000000001,19947.049999999999],"tickmode":"array","ticktext":["2021","2022","2023","2024"],"tickvals":[18628,18993,19358,19723],"categoryorder":"array","categoryarray":["2021","2022","2023","2024"],"nticks":null,"ticks":"","tickcolor":null,"ticklen":3.6529680365296811,"tickwidth":0,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.68949771689498},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"gridcolor":"rgba(235,235,235,1)","gridwidth":0.66417600664176002,"zeroline":false,"anchor":"y","title":{"text":"Data","font":{"color":"rgba(0,0,0,1)","family":"","size":14.611872146118724}},"hoverformat":".2f"},"yaxis":{"domain":[0,1],"automargin":true,"type":"linear","autorange":false,"range":[-0.0095092511352273205,0.45562213570974786],"tickmode":"array","ticktext":["0.0","0.1","0.2","0.3","0.4"],"tickvals":[0,0.10000000000000001,0.20000000000000001,0.30000000000000004,0.40000000000000002],"categoryorder":"array","categoryarray":["0.0","0.1","0.2","0.3","0.4"],"nticks":null,"ticks":"","tickcolor":null,"ticklen":3.6529680365296811,"tickwidth":0,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.68949771689498},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"gridcolor":"rgba(235,235,235,1)","gridwidth":0.66417600664176002,"zeroline":false,"anchor":"x","title":{"text":"Peso","font":{"color":"rgba(0,0,0,1)","family":"","size":14.611872146118724}},"hoverformat":".2f"},"shapes":[{"type":"rect","fillcolor":null,"line":{"color":null,"width":0,"linetype":[]},"yref":"paper","xref":"paper","x0":0,"x1":1,"y0":0,"y1":1}],"showlegend":true,"legend":{"bgcolor":null,"bordercolor":null,"borderwidth":0,"font":{"color":"rgba(0,0,0,1)","family":"","size":11.68949771689498},"title":{"text":"Ativos","font":{"color":"rgba(0,0,0,1)","family":"","size":14.611872146118724}}},"hovermode":"closest","barmode":"relative"},"config":{"doubleClick":"reset","modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"source":"A","attrs":{"8382715eb018b":{"x":{},"y":{},"colour":{},"type":"scatter"}},"cur_data":"8382715eb018b","visdat":{"8382715eb018b":["function (y) ","x"]},"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</section>
<section id="plotando-o-retorno-do-portfólio-ao-longo-do-tempo" class="level2">
<h2 class="anchored" data-anchor-id="plotando-o-retorno-do-portfólio-ao-longo-do-tempo">Plotando o retorno do portfólio ao longo do tempo</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculando o retorno do portfólio otimizado e adicionando o retorno do IBOV</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>opt_returns_long_df <span class="ot">&lt;-</span> <span class="fu">Return.portfolio</span>(<span class="at">R =</span> asset_returns_xts, <span class="at">weights =</span> <span class="fu">extractWeights</span>(opt_rebal)) <span class="sc">%&gt;%</span></span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tk_tbl</span>(<span class="at">preserve_index =</span> <span class="cn">TRUE</span>, <span class="at">rename_index =</span> <span class="st">"Date"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(ibov_returns_xts <span class="sc">%&gt;%</span> <span class="fu">tk_tbl</span>(<span class="at">preserve_index =</span> <span class="cn">TRUE</span>, <span class="at">rename_index =</span> <span class="st">"Date"</span>), <span class="at">by =</span> <span class="st">"Date"</span>, <span class="at">suffix =</span> <span class="fu">c</span>(<span class="st">"_Portfolio"</span>, <span class="st">"_IBOV"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="sc">-</span>Date, <span class="at">names_to =</span> <span class="st">"Portfolio"</span>, <span class="at">values_to =</span> <span class="st">"Return"</span>)</span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a>plotly<span class="sc">::</span><span class="fu">ggplotly</span>(<span class="fu">ggplot</span>(opt_returns_long_df) <span class="sc">+</span></span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x =</span> Date, <span class="at">y =</span> Return, <span class="at">colour =</span> Portfolio) <span class="sc">+</span></span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb48-10"><a href="#cb48-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_hue</span>(<span class="at">direction =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb48-11"><a href="#cb48-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb48-12"><a href="#cb48-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Data"</span>,</span>
<span id="cb48-13"><a href="#cb48-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Retorno"</span>,</span>
<span id="cb48-14"><a href="#cb48-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Retorno do portifólio vs IBOV ao longo do tempo"</span>,</span>
<span id="cb48-15"><a href="#cb48-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">colour =</span> <span class="st">"Portfólio"</span></span>
<span id="cb48-16"><a href="#cb48-16" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb48-17"><a href="#cb48-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb48-18"><a href="#cb48-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb48-19"><a href="#cb48-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">16</span>L,</span>
<span id="cb48-20"><a href="#cb48-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">face =</span> <span class="st">"bold"</span>,</span>
<span id="cb48-21"><a href="#cb48-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">hjust =</span> <span class="fl">0.5</span>)</span>
<span id="cb48-22"><a href="#cb48-22" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb48-23"><a href="#cb48-23" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="plotly html-widget html-fill-item" id="htmlwidget-76b0e14d541c0d0e74a1" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-76b0e14d541c0d0e74a1">{"x":{"data":[{"x":[18443,18474,18505,18535,18566,18596,18627,18658,18686,18717,18747,18778,18808,18839,18870,18900,18931,18961,18992,19023,19051,19082,19112,19143,19173,19204,19235,19265,19296,19326,19357,19388,19416,19447,19477,19508,19538,19569,19600,19630,19661,19691,19722,19753,19782,19813,19843,19874],"y":[0.087559923572417375,0.082646019188688857,-0.034427472014925353,-0.047962644285441169,-0.0068813885394755081,0.1589747956403269,0.095676291235030408,-0.027651584999916157,-0.051479652089960082,0.059971827145908208,0.019376854090573881,0.061584268339865744,0.0046428345059263965,-0.039439441018280452,-0.024794541916733026,-0.065683905675150034,-0.067382117337514313,-0.015323523444217946,0.028523769808173505,0.072179504302531949,0.0067089013061891745,0.060605257110533772,-0.10102584188201569,0.032212911120174992,-0.11503264452048023,0.046914006210549752,0.061629428585276091,0.0046930781662299914,0.054527113607241162,-0.030602307884554092,-0.021824938214533351,0.031818305750197728,-0.075749568403621903,-0.029066443029771682,0.02502895506566416,0.037373601961084635,0.090017076660358963,0.032653890775445227,-0.050851627399686739,0.0071106426362081976,-0.029348432205207442,0.12538888496075806,0.053828211511729229,-0.047941275105265135,0.0099254806186988009,-0.0070841729964347122,-0.017032769737561071,-0.025547155427082968],"text":["Date: 2020-06-30<br />Return:  0.087559924<br />Portfolio: IBOV","Date: 2020-07-31<br />Return:  0.082646019<br />Portfolio: IBOV","Date: 2020-08-31<br />Return: -0.034427472<br />Portfolio: IBOV","Date: 2020-09-30<br />Return: -0.047962644<br />Portfolio: IBOV","Date: 2020-10-31<br />Return: -0.006881389<br />Portfolio: IBOV","Date: 2020-11-30<br />Return:  0.158974796<br />Portfolio: IBOV","Date: 2020-12-31<br />Return:  0.095676291<br />Portfolio: IBOV","Date: 2021-01-31<br />Return: -0.027651585<br />Portfolio: IBOV","Date: 2021-02-28<br />Return: -0.051479652<br />Portfolio: IBOV","Date: 2021-03-31<br />Return:  0.059971827<br />Portfolio: IBOV","Date: 2021-04-30<br />Return:  0.019376854<br />Portfolio: IBOV","Date: 2021-05-31<br />Return:  0.061584268<br />Portfolio: IBOV","Date: 2021-06-30<br />Return:  0.004642835<br />Portfolio: IBOV","Date: 2021-07-31<br />Return: -0.039439441<br />Portfolio: IBOV","Date: 2021-08-31<br />Return: -0.024794542<br />Portfolio: IBOV","Date: 2021-09-30<br />Return: -0.065683906<br />Portfolio: IBOV","Date: 2021-10-31<br />Return: -0.067382117<br />Portfolio: IBOV","Date: 2021-11-30<br />Return: -0.015323523<br />Portfolio: IBOV","Date: 2021-12-31<br />Return:  0.028523770<br />Portfolio: IBOV","Date: 2022-01-31<br />Return:  0.072179504<br />Portfolio: IBOV","Date: 2022-02-28<br />Return:  0.006708901<br />Portfolio: IBOV","Date: 2022-03-31<br />Return:  0.060605257<br />Portfolio: IBOV","Date: 2022-04-30<br />Return: -0.101025842<br />Portfolio: IBOV","Date: 2022-05-31<br />Return:  0.032212911<br />Portfolio: IBOV","Date: 2022-06-30<br />Return: -0.115032645<br />Portfolio: IBOV","Date: 2022-07-31<br />Return:  0.046914006<br />Portfolio: IBOV","Date: 2022-08-31<br />Return:  0.061629429<br />Portfolio: IBOV","Date: 2022-09-30<br />Return:  0.004693078<br />Portfolio: IBOV","Date: 2022-10-31<br />Return:  0.054527114<br />Portfolio: IBOV","Date: 2022-11-30<br />Return: -0.030602308<br />Portfolio: IBOV","Date: 2022-12-31<br />Return: -0.021824938<br />Portfolio: IBOV","Date: 2023-01-31<br />Return:  0.031818306<br />Portfolio: IBOV","Date: 2023-02-28<br />Return: -0.075749568<br />Portfolio: IBOV","Date: 2023-03-31<br />Return: -0.029066443<br />Portfolio: IBOV","Date: 2023-04-30<br />Return:  0.025028955<br />Portfolio: IBOV","Date: 2023-05-31<br />Return:  0.037373602<br />Portfolio: IBOV","Date: 2023-06-30<br />Return:  0.090017077<br />Portfolio: IBOV","Date: 2023-07-31<br />Return:  0.032653891<br />Portfolio: IBOV","Date: 2023-08-31<br />Return: -0.050851627<br />Portfolio: IBOV","Date: 2023-09-30<br />Return:  0.007110643<br />Portfolio: IBOV","Date: 2023-10-31<br />Return: -0.029348432<br />Portfolio: IBOV","Date: 2023-11-30<br />Return:  0.125388885<br />Portfolio: IBOV","Date: 2023-12-31<br />Return:  0.053828212<br />Portfolio: IBOV","Date: 2024-01-31<br />Return: -0.047941275<br />Portfolio: IBOV","Date: 2024-02-29<br />Return:  0.009925481<br />Portfolio: IBOV","Date: 2024-03-31<br />Return: -0.007084173<br />Portfolio: IBOV","Date: 2024-04-30<br />Return: -0.017032770<br />Portfolio: IBOV","Date: 2024-05-31<br />Return: -0.025547155<br />Portfolio: IBOV"],"type":"scatter","mode":"lines","line":{"width":1.8897637795275593,"color":"rgba(248,118,109,1)","dash":"solid"},"hoveron":"points","name":"(IBOV,1)","legendgroup":"(IBOV,1)","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[18443,18474,18505,18535,18566,18596,18627,18658,18686,18717,18747,18778,18808,18839,18870,18900,18931,18961,18992,19023,19051,19082,19112,19143,19173,19204,19235,19265,19296,19326,19357,19388,19416,19447,19477,19508,19538,19569,19600,19630,19661,19691,19722,19753,19782,19813,19843,19874],"y":[0.15862782617319859,0.06154602440610546,0.032944822341752777,0.0047801005236240979,-0.0032194345051294038,0.34443912738250537,0.096510075775136039,-0.005876330988063061,-0.036814472680308574,0.0043939008302846805,0.041644790314362634,0.098174204224077855,0.04855624384782975,-0.057977656642774655,-0.0092441786245064383,-0.081411583081103411,-0.095942813169320851,-0.039355491432464196,0.048543993379551731,0.084319125149459939,-0.02159785886675436,0.060090720169011957,-0.10340268252470508,-0.018839798727684154,-0.21815734758491379,0.032310861956047265,0.25324825790349403,-0.028719664312516935,-0.01082712315785006,0.061627285269134191,-0.029814869739464678,0.071847478284501998,-0.089370707938815186,0.013331609944907896,0.029137913268236115,0.032818614505879973,0.12125615714630622,0.036010048960268382,-0.0019430329071729036,0.047557215581745416,-0.013328395791298298,0.084523879191549911,0.042326205119990412,-0.014340374021965197,-0.010045629322221084,-0.03583284700742162,0.064228728236860988,-0.027889883300131313],"text":["Date: 2020-06-30<br />Return:  0.158627826<br />Portfolio: portfolio.returns","Date: 2020-07-31<br />Return:  0.061546024<br />Portfolio: portfolio.returns","Date: 2020-08-31<br />Return:  0.032944822<br />Portfolio: portfolio.returns","Date: 2020-09-30<br />Return:  0.004780101<br />Portfolio: portfolio.returns","Date: 2020-10-31<br />Return: -0.003219435<br />Portfolio: portfolio.returns","Date: 2020-11-30<br />Return:  0.344439127<br />Portfolio: portfolio.returns","Date: 2020-12-31<br />Return:  0.096510076<br />Portfolio: portfolio.returns","Date: 2021-01-31<br />Return: -0.005876331<br />Portfolio: portfolio.returns","Date: 2021-02-28<br />Return: -0.036814473<br />Portfolio: portfolio.returns","Date: 2021-03-31<br />Return:  0.004393901<br />Portfolio: portfolio.returns","Date: 2021-04-30<br />Return:  0.041644790<br />Portfolio: portfolio.returns","Date: 2021-05-31<br />Return:  0.098174204<br />Portfolio: portfolio.returns","Date: 2021-06-30<br />Return:  0.048556244<br />Portfolio: portfolio.returns","Date: 2021-07-31<br />Return: -0.057977657<br />Portfolio: portfolio.returns","Date: 2021-08-31<br />Return: -0.009244179<br />Portfolio: portfolio.returns","Date: 2021-09-30<br />Return: -0.081411583<br />Portfolio: portfolio.returns","Date: 2021-10-31<br />Return: -0.095942813<br />Portfolio: portfolio.returns","Date: 2021-11-30<br />Return: -0.039355491<br />Portfolio: portfolio.returns","Date: 2021-12-31<br />Return:  0.048543993<br />Portfolio: portfolio.returns","Date: 2022-01-31<br />Return:  0.084319125<br />Portfolio: portfolio.returns","Date: 2022-02-28<br />Return: -0.021597859<br />Portfolio: portfolio.returns","Date: 2022-03-31<br />Return:  0.060090720<br />Portfolio: portfolio.returns","Date: 2022-04-30<br />Return: -0.103402683<br />Portfolio: portfolio.returns","Date: 2022-05-31<br />Return: -0.018839799<br />Portfolio: portfolio.returns","Date: 2022-06-30<br />Return: -0.218157348<br />Portfolio: portfolio.returns","Date: 2022-07-31<br />Return:  0.032310862<br />Portfolio: portfolio.returns","Date: 2022-08-31<br />Return:  0.253248258<br />Portfolio: portfolio.returns","Date: 2022-09-30<br />Return: -0.028719664<br />Portfolio: portfolio.returns","Date: 2022-10-31<br />Return: -0.010827123<br />Portfolio: portfolio.returns","Date: 2022-11-30<br />Return:  0.061627285<br />Portfolio: portfolio.returns","Date: 2022-12-31<br />Return: -0.029814870<br />Portfolio: portfolio.returns","Date: 2023-01-31<br />Return:  0.071847478<br />Portfolio: portfolio.returns","Date: 2023-02-28<br />Return: -0.089370708<br />Portfolio: portfolio.returns","Date: 2023-03-31<br />Return:  0.013331610<br />Portfolio: portfolio.returns","Date: 2023-04-30<br />Return:  0.029137913<br />Portfolio: portfolio.returns","Date: 2023-05-31<br />Return:  0.032818615<br />Portfolio: portfolio.returns","Date: 2023-06-30<br />Return:  0.121256157<br />Portfolio: portfolio.returns","Date: 2023-07-31<br />Return:  0.036010049<br />Portfolio: portfolio.returns","Date: 2023-08-31<br />Return: -0.001943033<br />Portfolio: portfolio.returns","Date: 2023-09-30<br />Return:  0.047557216<br />Portfolio: portfolio.returns","Date: 2023-10-31<br />Return: -0.013328396<br />Portfolio: portfolio.returns","Date: 2023-11-30<br />Return:  0.084523879<br />Portfolio: portfolio.returns","Date: 2023-12-31<br />Return:  0.042326205<br />Portfolio: portfolio.returns","Date: 2024-01-31<br />Return: -0.014340374<br />Portfolio: portfolio.returns","Date: 2024-02-29<br />Return: -0.010045629<br />Portfolio: portfolio.returns","Date: 2024-03-31<br />Return: -0.035832847<br />Portfolio: portfolio.returns","Date: 2024-04-30<br />Return:  0.064228728<br />Portfolio: portfolio.returns","Date: 2024-05-31<br />Return: -0.027889883<br />Portfolio: portfolio.returns"],"type":"scatter","mode":"lines","line":{"width":1.8897637795275593,"color":"rgba(0,191,196,1)","dash":"solid"},"hoveron":"points","name":"(portfolio.returns,1)","legendgroup":"(portfolio.returns,1)","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null}],"layout":{"margin":{"t":47.481942714819425,"r":7.3059360730593621,"b":40.182648401826491,"l":48.949771689497723},"font":{"color":"rgba(0,0,0,1)","family":"","size":14.611872146118724},"title":{"text":"<b> Retorno do portifólio vs IBOV ao longo do tempo <\/b>","font":{"color":"rgba(0,0,0,1)","family":"","size":21.253632212536321},"x":0.5,"xref":"paper"},"xaxis":{"domain":[0,1],"automargin":true,"type":"linear","autorange":false,"range":[18371.450000000001,19945.549999999999],"tickmode":"array","ticktext":["2021","2022","2023","2024"],"tickvals":[18628,18993,19358,19723],"categoryorder":"array","categoryarray":["2021","2022","2023","2024"],"nticks":null,"ticks":"","tickcolor":null,"ticklen":3.6529680365296811,"tickwidth":0,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.68949771689498},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"gridcolor":"rgba(235,235,235,1)","gridwidth":0.66417600664176002,"zeroline":false,"anchor":"y","title":{"text":"Data","font":{"color":"rgba(0,0,0,1)","family":"","size":14.611872146118724}},"hoverformat":".2f"},"yaxis":{"domain":[0,1],"automargin":true,"type":"linear","autorange":false,"range":[-0.24628717133328476,0.37256895113087635],"tickmode":"array","ticktext":["-0.2","0.0","0.2"],"tickvals":[-0.20000000000000001,0,0.20000000000000001],"categoryorder":"array","categoryarray":["-0.2","0.0","0.2"],"nticks":null,"ticks":"","tickcolor":null,"ticklen":3.6529680365296811,"tickwidth":0,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.68949771689498},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"gridcolor":"rgba(235,235,235,1)","gridwidth":0.66417600664176002,"zeroline":false,"anchor":"x","title":{"text":"Retorno","font":{"color":"rgba(0,0,0,1)","family":"","size":14.611872146118724}},"hoverformat":".2f"},"shapes":[{"type":"rect","fillcolor":null,"line":{"color":null,"width":0,"linetype":[]},"yref":"paper","xref":"paper","x0":0,"x1":1,"y0":0,"y1":1}],"showlegend":true,"legend":{"bgcolor":null,"bordercolor":null,"borderwidth":0,"font":{"color":"rgba(0,0,0,1)","family":"","size":11.68949771689498},"title":{"text":"Portfólio","font":{"color":"rgba(0,0,0,1)","family":"","size":14.611872146118724}}},"hovermode":"closest","barmode":"relative"},"config":{"doubleClick":"reset","modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"source":"A","attrs":{"838271a1aa9b7":{"x":{},"y":{},"colour":{},"type":"scatter"}},"cur_data":"838271a1aa9b7","visdat":{"838271a1aa9b7":["function (y) ","x"]},"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</section>
<section id="bonus-plotando-a-fronteira-eficiente" class="level2">
<h2 class="anchored" data-anchor-id="bonus-plotando-a-fronteira-eficiente">Bonus: Plotando a fronteira eficiente</h2>
<p>A fronteira eficiente é uma curva que mostra a combinação ótima de ativos em uma carteira que maximiza o retorno esperado para um determinado nível de risco. Note que o indice de Sharpe é a inclinação da linha tangente a fronteira eficiente, o intercepto com o eixo y é o retorno livre de risco e o ponto de tangência é o ponto com o maior indice de Sharpe.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculando a fronteira eficiente</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>frontier <span class="ot">&lt;-</span> <span class="fu">create.EfficientFrontier</span>(<span class="at">R =</span> asset_returns_xts, <span class="at">portfolio =</span> port_spec, <span class="at">type =</span> <span class="st">"mean-StdDev"</span>)</span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Plotando a fronteira eficiente</span></span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a><span class="fu">chart.EfficientFrontier</span>(frontier, <span class="at">match.col =</span> <span class="st">"StdDev"</span>,<span class="at">n.portfolios =</span> <span class="dv">30</span>, <span class="at">main =</span> <span class="st">"Fronteira eficiente"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="aula_2_files/figure-html/unnamed-chunk-23-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="dashboards-interativos-com-quarto" class="level2">
<h2 class="anchored" data-anchor-id="dashboards-interativos-com-quarto">Dashboards interativos com QUARTO</h2>
<p><a href="https://quarto.org/docs/dashboards/">Clique aqui!!</a></p>
</section>
<section id="exercício" class="level2">
<h2 class="anchored" data-anchor-id="exercício">Exercício</h2>
<ul>
<li>Crie uma carteira com 5 ativos de sua escolha</li>
<li>Baixe os preços dos ativos</li>
<li>Calcule os retornos mensais</li>
<li>Crie um vetor de pesos para a carteira</li>
<li>Calcule o retorno da carteira</li>
<li>Faça a otimização da carteira com o objetivo de maximizar o retorno esperado e minimizar o risco</li>
<li>Opcionalmente faça a otimização com rebalanceamento</li>
<li>Visualize o retorno da carteira e dos ativos</li>
<li>Compare o retorno da carteira com o índice do mercado</li>
<li>Salve o seu dashboard e compartilhe com o professor</li>
</ul>
</section>
<section id="dica-use-o-arquivo-das-aulas-anteriores-como-referência-para-criar-o-seu-dashboard" class="level2">
<h2 class="anchored" data-anchor-id="dica-use-o-arquivo-das-aulas-anteriores-como-referência-para-criar-o-seu-dashboard">Dica: Use o arquivo das aulas anteriores como referência para criar o seu dashboard</h2>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>