<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.56">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Marcus Ramalho">

<title>Aula 2 - Análise e otimização de carteiras – Finanças com R - análise e otimização de carteiras</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<link href="site_libs/htmltools-fill-0.5.8.1/fill.css" rel="stylesheet">

<script src="site_libs/htmlwidgets-1.6.4/htmlwidgets.js"></script>

<script src="site_libs/plotly-binding-4.10.4/plotly.js"></script>

<script src="site_libs/typedarray-0.1/typedarray.min.js"></script>

<script src="site_libs/jquery-3.5.1/jquery.min.js"></script>

<link href="site_libs/crosstalk-1.2.1/css/crosstalk.min.css" rel="stylesheet">

<script src="site_libs/crosstalk-1.2.1/js/crosstalk.min.js"></script>

<link href="site_libs/plotly-htmlwidgets-css-2.11.1/plotly-htmlwidgets.css" rel="stylesheet">

<script src="site_libs/plotly-main-2.11.1/plotly-latest.min.js"></script>


  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-fixed fullcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">Finanças com R - análise e otimização de carteiras</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="./index.html"> <i class="bi bi-house" role="img">
</i> 
<span class="menu-text">Início</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./apresentacao.html"> <i class="bi bi-easel" role="img">
</i> 
<span class="menu-text">Apresentação</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./aula_1.html"> <i class="bi bi-book" role="img">
</i> 
<span class="menu-text">Aula 1</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link active" href="./aula_2.html" aria-current="page"> <i class="bi bi-book" role="img">
</i> 
<span class="menu-text">Aula 2</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./dashboard.html"> <i class="bi bi-speedometer" role="img">
</i> 
<span class="menu-text">Dashboard</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Aula 2 - Análise e otimização de carteiras</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Professor: </div>
    <div class="quarto-title-meta-contents">
             <p>Marcus Ramalho </p>
          </div>
  </div>
    
  
    
  </div>
  


</header>


<section id="relembrando-alguns-conceitos-sobre-risco" class="level2">
<h2 class="anchored" data-anchor-id="relembrando-alguns-conceitos-sobre-risco">Relembrando alguns conceitos sobre risco</h2>
<p><strong>Risco</strong>: Probabilidade de um resultado adverso em relação ao esperado.</p>
<p><img src="images/paste-2.png" class="img-fluid" width="718"></p>
</section>
<section id="tipos-de-risco" class="level2">
<h2 class="anchored" data-anchor-id="tipos-de-risco">Tipos de risco</h2>
<ul>
<li><strong>Risco conhecido</strong>: Distribuição de probabilidade do evento é conhecida (ex: falha de motor).</li>
<li><strong>Incerteza</strong>: Distribuição de probabilidade desconhecida ou imprevisível (ex: crise econômica).</li>
</ul>
</section>
<section id="atitudes-frente-ao-risco" class="level2">
<h2 class="anchored" data-anchor-id="atitudes-frente-ao-risco">Atitudes frente ao risco</h2>
<ul>
<li><strong>Aversão</strong>: Prefere menor risco para mesmo retorno.</li>
<li><strong>Indiferença</strong>: Não se importa com o risco.</li>
<li><strong>Propensão</strong>: Aceita maior risco por potencial de maior retorno.</li>
</ul>
<p><img src="images/paste-3.png" class="img-fluid" width="723"></p>
<p>O participante de uma apólice de seguros têm que predisposição frente ao risco?</p>
<p>E a companhia de seguros?</p>
</section>
<section id="mensuração-do-risco" class="level2">
<h2 class="anchored" data-anchor-id="mensuração-do-risco">Mensuração do Risco</h2>
<ul>
<li><strong>Desvio padrão (σ)</strong>: Mede a dispersão dos resultados em torno da média.</li>
<li><strong>Coeficiente de variação (CV)</strong>: Mede o risco por unidade de retorno (σ / retorno médio).</li>
</ul>
</section>
<section id="risco-de-carteira" class="level2">
<h2 class="anchored" data-anchor-id="risco-de-carteira">Risco de Carteira</h2>
<ul>
<li><strong>Covariância</strong>: Mede a relação entre os retornos de dois ativos.</li>
<li><strong>Diversificação</strong>: Reduz o risco total da carteira ao combinar ativos com diferentes riscos (Markowitz, 1952) - “Não colocar todos os ovos na mesma cesta”.</li>
</ul>
</section>
<section id="risco-individual-vs.-sistêmico" class="level2">
<h2 class="anchored" data-anchor-id="risco-individual-vs.-sistêmico">Risco individual vs.&nbsp;sistêmico</h2>
<ul>
<li><strong>Individual</strong>: Específico de cada ativo.</li>
<li><strong>Sistêmico</strong>: Afeta todo o mercado.</li>
</ul>
</section>
<section id="índice-sharpe-is" class="level2">
<h2 class="anchored" data-anchor-id="índice-sharpe-is">Índice Sharpe (IS)</h2>
<ul>
<li><strong>Definição</strong>: Mede o retorno adicional por unidade de risco em relação à taxa livre de risco.</li>
<li><strong>Fórmula</strong>: IS = (Retorno médio do portfólio - Taxa livre de risco) / Desvio padrão do excesso de retorno.</li>
<li><strong>interpretação</strong>: IS &gt; 1: Retorno adicional por unidade de risco; IS &lt; 1: Retorno insuficiente por unidade de risco. Quantos mais alto o índice, melhor.</li>
</ul>
</section>
<section id="beta-β" class="level2">
<h2 class="anchored" data-anchor-id="beta-β">Beta (β)</h2>
<ul>
<li><strong>Definição</strong>: Mede a sensibilidade do retorno de um ativo em relação ao retorno do mercado.</li>
<li><strong>Fórmula</strong>: β = Cov(Ri, Rm) / Var(Rm).</li>
<li><strong>Interpretação</strong>: β &gt; 1: Ativo mais volátil que o mercado; β &lt; 1: Ativo menos volátil que o mercado.</li>
<li><strong>Exemplo</strong>: Se β = 1, o ativo se move na mesma direção que o mercado.</li>
</ul>
</section>
<section id="alfa-α" class="level2">
<h2 class="anchored" data-anchor-id="alfa-α">Alfa (α)</h2>
<ul>
<li><strong>Definição</strong>: Mede o retorno adicional de um ativo em relação ao retorno esperado com base no risco.</li>
<li><strong>Fórmula</strong>: α = Retorno do ativo - (Taxa livre de risco + β * (Retorno do mercado - Taxa livre de risco)).</li>
<li><strong>Interpretação</strong>: α &gt; 0: Ativo superou o retorno esperado; α &lt; 0: Ativo ficou aquém do retorno esperado.</li>
<li><strong>Exemplo</strong>: Se α = 0, o ativo teve o retorno esperado com base no risco.</li>
<li><strong>Observação</strong>: O alfa é uma medida de desempenho ajustada ao risco.</li>
</ul>
</section>
<section id="função-de-utilidade-quadrática" class="level2">
<h2 class="anchored" data-anchor-id="função-de-utilidade-quadrática">Função de utilidade quadrática</h2>
<p>A função de utilidade quadrática é usada na otimização de portfólios para encontrar a alocação de ativos que maximiza o retorno esperado e minimiza o risco. A função de utilidade quadrática é dada por:</p>
<p><span class="math inline">\(U = \mu^T w - \lambda \sigma^2\)</span></p>
<p>onde:</p>
<ul>
<li><span class="math inline">\(U\)</span> é a função de utilidade</li>
<li><span class="math inline">\(\mu^T\)</span> é o vetor de retornos esperados</li>
<li><span class="math inline">\(w\)</span> é o vetor de pesos dos ativos</li>
<li><span class="math inline">\(\lambda\)</span> é o fator de aversão ao risco</li>
</ul>
<p>generalizando para o caso de <span class="math inline">\(n\)</span> ativos, a função de utilidade quadrática é dada por:</p>
<p><span class="math inline">\(U = \mu^T w - \lambda w^T \Sigma w\)</span></p>
<p>onde:</p>
<ul>
<li><span class="math inline">\(\Sigma w\)</span> é a matriz de covariância dos retornos dos ativos</li>
<li><span class="math inline">\(w^T\)</span> é o vetor transposto de pesos dos ativos</li>
<li><span class="math inline">\(w\)</span> é o vetor de pesos dos ativos</li>
<li><span class="math inline">\(\lambda\)</span> é o fator de aversão ao risco</li>
<li><span class="math inline">\(\mu\)</span> é o vetor de retornos esperados</li>
<li><span class="math inline">\(U\)</span> é a função de utilidade</li>
</ul>
</section>
<section id="otimização-de-portfólios" class="level2">
<h2 class="anchored" data-anchor-id="otimização-de-portfólios">Otimização de portfólios</h2>
<p>A otimização de portfólios é um problema de maximização da função de utilidade quadrática sujeita a restrições, como a soma dos pesos dos ativos deve ser igual a 1 e os pesos dos ativos devem ser maiores ou iguais a zero.</p>
</section>
<section id="primeiro-vamos-carregar-os-pacotes-necessários" class="level2">
<h2 class="anchored" data-anchor-id="primeiro-vamos-carregar-os-pacotes-necessários">Primeiro vamos carregar os pacotes necessários</h2>
</section>
<section id="ativos-selecionados" class="level2">
<h2 class="anchored" data-anchor-id="ativos-selecionados">Ativos selecionados</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Ativos selecionados</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>tickers <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"VALE3.SA"</span>,<span class="st">"PETR4.SA"</span>,<span class="st">"AZUL4.SA"</span>,<span class="st">"MGLU3.SA"</span>, <span class="st">"CMIG4.SA"</span>)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>prices <span class="ot">&lt;-</span> </span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">getSymbols</span>(tickers, </span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>             <span class="at">src =</span> <span class="st">'yahoo'</span>, </span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>             <span class="at">from =</span> <span class="st">"2019-05-30"</span>,</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>             <span class="at">to =</span> <span class="st">"2024-05-30"</span>,</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>             <span class="at">auto.assign =</span> <span class="cn">TRUE</span>, <span class="co">#obs auto asign carrega os resultados para o ambiente</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>             <span class="at">warnings =</span> <span class="cn">FALSE</span>,) <span class="sc">%&gt;%</span> </span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">map</span>(<span class="sc">~</span><span class="fu">Ad</span>(<span class="fu">get</span>(.))) <span class="sc">%&gt;%</span> </span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">reduce</span>(merge) <span class="sc">%&gt;%</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>  <span class="st">`</span><span class="at">colnames&lt;-</span><span class="st">`</span>(tickers)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="baixando-os-preços-do-benchmark" class="level2">
<h2 class="anchored" data-anchor-id="baixando-os-preços-do-benchmark">Baixando os preços do benchmark</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Baixando os preços do IBOV</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>ibov <span class="ot">&lt;-</span> <span class="fu">getSymbols</span>(<span class="st">"^BVSP"</span>, </span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>                   <span class="at">src =</span> <span class="st">'yahoo'</span>, </span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>                   <span class="at">from =</span> <span class="st">"2019-05-30"</span>,</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>                   <span class="at">to =</span> <span class="st">"2024-05-30"</span>,</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>                   <span class="at">auto.assign =</span> <span class="cn">TRUE</span>, </span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>                   <span class="at">warnings =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">map</span>(<span class="sc">~</span><span class="fu">Ad</span>(<span class="fu">get</span>(.))) <span class="sc">%&gt;%</span> </span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">reduce</span>(merge) <span class="sc">%&gt;%</span> </span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>  <span class="st">`</span><span class="at">colnames&lt;-</span><span class="st">`</span>(<span class="st">"IBOV"</span>)</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(ibov)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>            IBOV
2019-05-30 97457
2019-05-31 97030
2019-06-03 97020
2019-06-04 97380
2019-06-05 95999
2019-06-06 97205</code></pre>
</div>
</div>
</section>
<section id="agora-vamos-converter-os-preços-diários-em-mensais" class="level2">
<h2 class="anchored" data-anchor-id="agora-vamos-converter-os-preços-diários-em-mensais">Agora vamos converter os preços diários em mensais</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>prices_monthly <span class="ot">&lt;-</span> <span class="fu">to.monthly</span>(prices, <span class="at">indexAt =</span> <span class="st">"lastof"</span>, <span class="at">OHLC =</span> <span class="cn">FALSE</span>)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(prices_monthly)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>           VALE3.SA  PETR4.SA AZUL4.SA  MGLU3.SA CMIG4.SA
2019-05-31 30.86573  8.593929    39.20  56.97055 4.318573
2019-06-30 32.64209  9.219557    43.29  61.36543 4.344906
2019-07-31 31.37597  8.772199    51.78  76.65446 4.137171
2019-08-31 28.70514  8.644517    47.10  84.38617 4.318573
2019-09-30 30.07835  9.339466    49.71  86.13017 4.192761
2019-10-31 29.73190 10.302230    52.52 104.00202 3.993803</code></pre>
</div>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>ibov_monthly <span class="ot">&lt;-</span> <span class="fu">to.monthly</span>(ibov, <span class="at">indexAt =</span> <span class="st">"lastof"</span>, <span class="at">OHLC =</span> <span class="cn">FALSE</span>)</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(ibov_monthly)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>             IBOV
2019-05-31  97030
2019-06-30 100967
2019-07-31 101812
2019-08-31 101135
2019-09-30 104745
2019-10-31 107220</code></pre>
</div>
</div>
</section>
<section id="vamos-calcular-os-retornos-mensais" class="level2">
<h2 class="anchored" data-anchor-id="vamos-calcular-os-retornos-mensais">Vamos calcular os retornos mensais</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>asset_returns_xts <span class="ot">&lt;-</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a> PerformanceAnalytics<span class="sc">::</span><span class="fu">Return.calculate</span>(prices_monthly, </span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">method =</span> <span class="st">"discrete"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">na.omit</span>()</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>ibov_returns_xts <span class="ot">&lt;-</span> </span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>  PerformanceAnalytics<span class="sc">::</span><span class="fu">Return.calculate</span>(ibov_monthly, </span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>                   <span class="at">method =</span> <span class="st">"discrete"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">na.omit</span>()</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(asset_returns_xts)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>              VALE3.SA    PETR4.SA    AZUL4.SA    MGLU3.SA     CMIG4.SA
2019-06-30  0.05755118  0.07279877  0.10433674 0.077142847  0.006097582
2019-07-31 -0.03878804 -0.04852274  0.19611914 0.249147457 -0.047811281
2019-08-31 -0.08512360 -0.01455527 -0.09038240 0.100864375  0.043847038
2019-09-30  0.04783851  0.08039190  0.05541403 0.020666842 -0.029132781
2019-10-31 -0.01151822  0.10308553  0.05652789 0.207498229 -0.047452887
2019-11-30  0.05889816 -0.03443148  0.01104337 0.008736587 -0.043955955</code></pre>
</div>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(ibov_returns_xts)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                   IBOV
2019-06-30  0.040575080
2019-07-31  0.008369071
2019-08-31 -0.006649511
2019-09-30  0.035694863
2019-10-31  0.023628813
2019-11-30  0.009447864</code></pre>
</div>
</div>
</section>
<section id="otimização-da-carteira" class="level2">
<h2 class="anchored" data-anchor-id="otimização-da-carteira">Otimização da carteira</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Criando o objeto de otimização</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>portf <span class="ot">&lt;-</span> <span class="fu">portfolio.spec</span>(<span class="at">assets =</span> <span class="fu">colnames</span>(asset_returns_xts))</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Adicionando restrições, como por exemplo, a soma dos pesos dos ativos deve ser igual a 1</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>portf <span class="ot">&lt;-</span> <span class="fu">add.constraint</span>(portf, <span class="at">type =</span> <span class="st">"full_investment"</span>)</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Adicionando restrição de peso mínimo e máximo para cada ativo</span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Neste caso, o peso mínimo é 0 e o peso máximo é 1</span></span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>portf <span class="ot">&lt;-</span> <span class="fu">add.constraint</span>(portf, <span class="at">type =</span> <span class="st">"long_only"</span>)</span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Adiciona a função objetivo, que é minimizar o desvio padrão da carteira</span></span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>portf <span class="ot">&lt;-</span> <span class="fu">add.objective</span>(portf, <span class="at">type =</span> <span class="st">"risk"</span>, <span class="at">name =</span> <span class="st">"StdDev"</span>)</span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Resolve o problema de otimização</span></span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a>opt_portf <span class="ot">&lt;-</span> <span class="fu">optimize.portfolio</span>(asset_returns_xts, portf, <span class="at">optimize_method =</span> <span class="st">"ROI"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="resultados-da-otimização" class="level2">
<h2 class="anchored" data-anchor-id="resultados-da-otimização">Resultados da otimização</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>opt_portf</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>***********************************
PortfolioAnalytics Optimization
***********************************

Call:
optimize.portfolio(R = asset_returns_xts, portfolio = portf, 
    optimize_method = "ROI")

Optimal Weights:
VALE3.SA PETR4.SA AZUL4.SA MGLU3.SA CMIG4.SA 
  0.4881   0.0953   0.0000   0.0428   0.3738 

Objective Measure:
 StdDev 
0.07238 </code></pre>
</div>
</div>
</section>
<section id="extraindo-os-pesos-dos-ativos" class="level2">
<h2 class="anchored" data-anchor-id="extraindo-os-pesos-dos-ativos">Extraindo os pesos dos ativos</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># extraindo os pesos para um data frame</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>weights <span class="ot">&lt;-</span> <span class="fu">extractWeights</span>(opt_portf)</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Adicionando os nomes dos ativos sem colocá-los no índice</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>weights <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">tickers =</span> <span class="fu">colnames</span>(asset_returns_xts), weights, <span class="at">row.names =</span> <span class="cn">NULL</span>)</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>weights</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   tickers    weights
1 VALE3.SA 0.48813406
2 PETR4.SA 0.09528922
3 AZUL4.SA 0.00000000
4 MGLU3.SA 0.04276910
5 CMIG4.SA 0.37380762</code></pre>
</div>
</div>
</section>
<section id="plotando-com-o-portfolioanalytics" class="level2">
<h2 class="anchored" data-anchor-id="plotando-com-o-portfolioanalytics">plotando com o portfolioAnalytics</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">chart.Weights</span>(opt_portf)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="aula_2_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="plotando-com-ggplo2" class="level2">
<h2 class="anchored" data-anchor-id="plotando-com-ggplo2">Plotando com ggplo2</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(weights, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">reorder</span>(tickers, weights), <span class="at">y =</span> weights, <span class="at">fill =</span> tickers)) <span class="sc">+</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">color =</span> <span class="st">"black"</span>, <span class="at">show.legend =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">14</span>) <span class="sc">+</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">90</span>, <span class="at">hjust =</span> <span class="dv">1</span>),</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">size =</span> <span class="dv">20</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">size =</span> <span class="dv">16</span>),</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"none"</span>) <span class="sc">+</span></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_d</span>() <span class="sc">+</span></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Distribuição dos Pesos dos Ativos"</span>,</span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>   <span class="at">x =</span> <span class="st">"Ativos"</span>,</span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>   <span class="at">y =</span> <span class="st">"Pesos"</span>) <span class="sc">+</span></span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="aula_2_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="realizando-otimização-da-função-de-utilidade-com-o-portfolioanalytics" class="level2">
<h2 class="anchored" data-anchor-id="realizando-otimização-da-função-de-utilidade-com-o-portfolioanalytics">Realizando otimização da função de utilidade com o PortfolioAnalytics</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co">#criar o objeto de otimização</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>portf <span class="ot">&lt;-</span> <span class="fu">portfolio.spec</span>(<span class="at">assets =</span> <span class="fu">colnames</span>(asset_returns_xts))</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Adicionando restrições, como por exemplo, a soma dos pesos dos ativos deve ser igual a 1</span></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>portf <span class="ot">&lt;-</span> <span class="fu">add.constraint</span>(portf, <span class="at">type =</span> <span class="st">"full_investment"</span>)</span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Adicionando restrição de peso mínimo e máximo para cada ativo (0-1)</span></span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>portf <span class="ot">&lt;-</span> <span class="fu">add.constraint</span>(portf, <span class="at">type =</span> <span class="st">"long_only"</span>)</span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Adiciona a função objetivo, que é maximizar o retorno esperado</span></span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a>portf <span class="ot">&lt;-</span> <span class="fu">add.objective</span>(portf, <span class="at">type =</span> <span class="st">"return"</span>, <span class="at">name =</span> <span class="st">"mean"</span>)</span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Adiciona a função objetivo, que é minimizar a variância da carteira</span></span>
<span id="cb19-18"><a href="#cb19-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-19"><a href="#cb19-19" aria-hidden="true" tabindex="-1"></a>portf <span class="ot">&lt;-</span> <span class="fu">add.objective</span>(portf, <span class="at">type =</span> <span class="st">"risk"</span>, <span class="at">name =</span> <span class="st">"var"</span>)</span>
<span id="cb19-20"><a href="#cb19-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-21"><a href="#cb19-21" aria-hidden="true" tabindex="-1"></a>portf <span class="ot">&lt;-</span> <span class="fu">add.objective</span>(portf, <span class="at">type =</span> <span class="st">"quadratic_utility"</span>, <span class="at">risk_aversion =</span> <span class="dv">10</span>)</span>
<span id="cb19-22"><a href="#cb19-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-23"><a href="#cb19-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Resolve o problema de otimização</span></span>
<span id="cb19-24"><a href="#cb19-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-25"><a href="#cb19-25" aria-hidden="true" tabindex="-1"></a>opt_portf <span class="ot">&lt;-</span> <span class="fu">optimize.portfolio</span>(asset_returns_xts, portf, <span class="at">optimize_method =</span> <span class="st">"ROI"</span>)</span>
<span id="cb19-26"><a href="#cb19-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-27"><a href="#cb19-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Extraindo os pesos dos ativos</span></span>
<span id="cb19-28"><a href="#cb19-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-29"><a href="#cb19-29" aria-hidden="true" tabindex="-1"></a><span class="fu">extractWeights</span>(opt_portf)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   VALE3.SA    PETR4.SA    AZUL4.SA    MGLU3.SA    CMIG4.SA 
0.478117455 0.193940795 0.000000000 0.007504405 0.320437344 </code></pre>
</div>
</div>
</section>
<section id="pesos" class="level2">
<h2 class="anchored" data-anchor-id="pesos">Pesos</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">extractWeights</span>(opt_portf)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   VALE3.SA    PETR4.SA    AZUL4.SA    MGLU3.SA    CMIG4.SA 
0.478117455 0.193940795 0.000000000 0.007504405 0.320437344 </code></pre>
</div>
</div>
</section>
<section id="entendendo-a-especificação-do-portfólio" class="level2">
<h2 class="anchored" data-anchor-id="entendendo-a-especificação-do-portfólio">Entendendo a especificação do portfólio</h2>
<p>O objeto de portfólio é uma lista que contém as seguintes informações:</p>
<ul>
<li><strong>assets</strong>: vetor de nomes dos ativos</li>
<li><strong>constraints</strong>: lista de restrições
<ul>
<li><strong>weight_sum</strong>: restrição de que a soma dos pesos dos ativos deve ser igual a um valor específico</li>
<li><strong>full_investment</strong>: restrição de que a soma dos pesos dos ativos deve ser igual a 1</li>
<li><strong>dollar_neutral</strong>: restrição de que a soma dos pesos dos ativos deve ser igual a zero</li>
<li><strong>box</strong>: restrição de que os pesos dos ativos devem estar dentro de um intervalo específico</li>
<li><strong>long_only</strong>: restrição de que os pesos dos ativos devem ser maiores ou iguais a zero e menores ou iguais a um (caso especial da restrição box)</li>
<li><strong>group</strong>: restrição de que os pesos dos ativos de um grupo específico devem ser iguais</li>
<li><strong>turnover</strong>: restrição de que o turnover da carteira deve ser menor ou igual a um valor específico a partir de uma carteira inicial</li>
<li><strong>diversification</strong>: Especifica um valor de diversificação para a carteira</li>
<li><strong>position_limit</strong>: Permite ao usuário definir o número máximo de posições (ativos com pesos não nulos) e o número máximo de posições compradas e vendidas.</li>
<li><strong>return</strong>: Especifica o retorno médio esperado da carteira</li>
<li><strong>factor_exposure</strong>: Especifica a exposição da carteira a fatores de risco</li>
<li><strong>leverage_exposure</strong>: Especifica a alavancagem maxima da carteira onde a alavancagem é definida como a soma dos pesos absolutos dos ativos</li>
</ul></li>
<li><strong>objectives</strong>:
<ul>
<li><strong>type</strong>: ‘return’,‘risk’, ‘risk_budget’, ‘quadratic_utility’, or ’weight_concentration</li>
</ul></li>
</ul>
</section>
<section id="passo-a-passo-da-otimização-de-portfólios" class="level2">
<h2 class="anchored" data-anchor-id="passo-a-passo-da-otimização-de-portfólios">Passo a passo da otimização de portfólios</h2>
<ol type="1">
<li>Carregar os preços dos ativos e do benchmark</li>
<li>Converter os preços diários em preços mensais</li>
<li>Calcular os retornos mensais dos ativos e do benchmark</li>
<li><strong>Criar o objeto de portfólio</strong></li>
<li><strong>Adicionar restrições ao objeto de portfólio</strong></li>
<li><strong>Adicionar a função objetivo ao objeto de portfólio</strong></li>
<li><strong>Resolver o problema de otimização</strong></li>
<li><strong>Exibir os resultados da otimização</strong></li>
<li><strong>Exibir os pesos dos ativos na carteira otimizada</strong></li>
<li><strong>Plotar a distribuição dos pesos dos ativos na carteira otimizada</strong></li>
</ol>
</section>
<section id="criando-um-objeto-para-as-especificações-do-portfólio" class="level2">
<h2 class="anchored" data-anchor-id="criando-um-objeto-para-as-especificações-do-portfólio">Criando um objeto para as especificações do portfólio</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Criando o objeto de portfólio, aqui estamos apenas especificando os ativos que serão utilizados na otimização</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>port_spec <span class="ot">&lt;-</span> <span class="fu">portfolio.spec</span>(<span class="at">assets =</span> <span class="fu">colnames</span>(asset_returns_xts))</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(port_spec)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "portfolio.spec" "portfolio"     </code></pre>
</div>
</div>
</section>
<section id="adicionando-restrições-ao-objeto-de-portfólio" class="level2">
<h2 class="anchored" data-anchor-id="adicionando-restrições-ao-objeto-de-portfólio">Adicionando restrições ao objeto de portfólio</h2>
<p>As restrições são condições que devem ser satisfeitas durante a otimização da carteira. Algumas restrições comuns são relacionadas ao peso dos ativos e ao retorno esperado da carteira.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Adicionando restrições, como por exemplo, a soma dos pesos dos ativos deve ser igual a 1</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>port_spec  <span class="ot">&lt;-</span> <span class="fu">add.constraint</span>(port_spec, <span class="at">type =</span> <span class="st">"weight_sum"</span>, <span class="at">min_sum =</span> <span class="dv">1</span>, <span class="at">max_sum =</span> <span class="dv">1</span>)</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a><span class="co"># adicionnando uma restrição de caixas para os pesos dos ativos</span></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>port_spec <span class="ot">&lt;-</span> <span class="fu">add.constraint</span>(port_spec, <span class="at">type =</span> <span class="st">"box"</span>, <span class="at">min =</span> <span class="fu">c</span>(<span class="fl">0.2</span>, <span class="fl">0.1</span>, <span class="fl">0.1</span>, <span class="fl">0.1</span>, <span class="fl">0.1</span>), <span class="at">max =</span> <span class="fl">0.4</span>)</span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>port_spec</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>**************************************************
PortfolioAnalytics Portfolio Specification 
**************************************************

Call:
portfolio.spec(assets = colnames(asset_returns_xts))

Number of assets: 5 
Asset Names
[1] "VALE3.SA" "PETR4.SA" "AZUL4.SA" "MGLU3.SA" "CMIG4.SA"

Constraints
Enabled constraint types
        - weight_sum 
        - box </code></pre>
</div>
</div>
</section>
<section id="adicionando-a-função-objetivo-ao-objeto-de-portfólio" class="level2">
<h2 class="anchored" data-anchor-id="adicionando-a-função-objetivo-ao-objeto-de-portfólio">Adicionando a função objetivo ao objeto de portfólio</h2>
<p>A função objetivo é a função que será otimizada durante o processo de otimização da carteira. Um objetivo comum é maximizar o retorno esperado da carteira e minimizar a volatilidade e o risco.</p>
<p>Lembre-se que o desvio padrão é a raiz quadrada da variância. E que a variância é a média dos quadrados dos desvios em relação à média. A variancia é geralmente usada para denotar o risco, quanto maior a variancia, maior o risco. Já geralmente denota a volatilidade, quanto maior o desvio padrão, maior a volatilidade. Ambas são medidas que servem como indicadores de risco.</p>
<p>No portfolioAnalytics, a função objetivo é adicionada ao objeto de portfólio usando a função <code>add.objective()</code>. Os objetivos mais usado são:</p>
<ul>
<li><strong>return</strong>: Maximizar o retorno esperado da carteira</li>
<li><strong>risk</strong>: Minimizar o risco da carteira</li>
<li><strong>risk_budget</strong>: Minimizar a contribuição marginal do risco de cada ativo para o risco total da carteira</li>
<li><strong>quadratic_utility</strong>: Maximizar a função de utilidade quadrática da carteira</li>
<li><strong>weight_concentration</strong>: Minimizar a concentração dos pesos dos ativos na carteira</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Adiciona a função objetivo, que é maximizar o retorno médio esperado da carteira</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>port_spec <span class="ot">&lt;-</span> <span class="fu">add.objective</span>(port_spec, <span class="at">type =</span> <span class="st">"return"</span>, <span class="at">name =</span> <span class="st">"mean"</span>)</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Adiciona a função objetivo, que é minimizar o desvio padrão da carteira</span></span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>port_spec <span class="ot">&lt;-</span> <span class="fu">add.objective</span>(port_spec, <span class="at">type =</span> <span class="st">"risk"</span>, <span class="at">name =</span> <span class="st">"StdDev"</span>)</span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Adiciona um objetivo para minimizar a contribuição marginal do risco de cada ativo para o risco total da carteira</span></span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a>port_spec <span class="ot">&lt;-</span> <span class="fu">add.objective</span>(port_spec, <span class="at">type =</span> <span class="st">"risk_budget"</span>, <span class="at">name =</span> <span class="st">"var"</span>, <span class="at">min_prisk =</span> <span class="fl">0.05</span>, <span class="at">max_prisk =</span> <span class="fl">0.1</span>)</span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(port_spec)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>**************************************************
PortfolioAnalytics Portfolio Specification 
**************************************************

Call:
portfolio.spec(assets = colnames(asset_returns_xts))

Number of assets: 5 
Asset Names
[1] "VALE3.SA" "PETR4.SA" "AZUL4.SA" "MGLU3.SA" "CMIG4.SA"

Constraints
Enabled constraint types
        - weight_sum 
        - box 

Objectives:
Enabled objective names
        - mean 
        - StdDev 
        - var </code></pre>
</div>
</div>
</section>
<section id="resolvendo-o-problema-de-otimização" class="level2">
<h2 class="anchored" data-anchor-id="resolvendo-o-problema-de-otimização">Resolvendo o problema de otimização</h2>
<p>Existem duas funções principais para resolver o problema de otimização da carteira: <code>optimize.portfolio()</code> e <code>optimize.portfolio.rebalancing()</code>. A função <code>optimize.portfolio()</code> é usada para otimizar a carteira sem rebalanceamento, enquanto a função <code>optimize.portfolio.rebalancing()</code> é usada para otimizar a carteira com rebalanceamento.</p>
<p>Lembre-se que o rebalanceamento é o processo de ajustar os pesos dos ativos na carteira para manter a alocação desejada ao longo do tempo.</p>
<p>O pacote suporta diversos métodos de otimização, como:</p>
<ul>
<li><strong>DEoptim</strong>: Differential Evolution</li>
<li><strong>random</strong>: Random Portfolios</li>
<li><strong>GenSA</strong>: Generalized Simulated Annealing</li>
<li><strong>pso</strong>: Particle Swarm Optimization</li>
<li><strong>ROI</strong>: R Optimization Infrastructure</li>
</ul>
<p>O método a ser usado irá depender do problema.</p>
<p>Vamos fazer fazer uma otimização usando o método de portifolios aleatórios. Nosso objetivo é maximizar o retorno esperado da carteira e minimizar o risco onde o risco minimo é 5% e o risco maximo é 10% sujeito a restrições de peso e de grupo.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co"># .storage &lt;&lt;- new.env()</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>rp <span class="ot">&lt;-</span> <span class="fu">random_portfolios</span>(port_spec, <span class="at">permutations =</span> <span class="dv">1000</span>, <span class="at">rp_method =</span> <span class="st">'simplex'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: executing %dopar% sequentially: no parallel backend registered</code></pre>
</div>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co"># rp &lt;- random_portfolios(port_spec, permutations = 1000, rp_method = 'sample')</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="co"># rp &lt;- random_portfolios(port_spec, permutations = 1000, rp_method = 'grid') </span></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(rp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      VALE3.SA  PETR4.SA  AZUL4.SA  MGLU3.SA  CMIG4.SA
[1,] 0.2129896 0.1767381 0.3996827 0.1083525 0.1022372
[2,] 0.2091820 0.1943104 0.1462174 0.1970533 0.2532369
[3,] 0.2067608 0.1879881 0.1157554 0.1943518 0.2951439
[4,] 0.2632710 0.1832084 0.2626849 0.1410737 0.1497619
[5,] 0.2044441 0.2579728 0.1180301 0.3187101 0.1008430
[6,] 0.2710928 0.1518522 0.3300403 0.1155672 0.1314476</code></pre>
</div>
</div>
<p>Simplex: Distribui pesos aleatoriamente em um espaço triangular, garantindo que a soma seja sempre 1. Sample: Seleciona pesos aleatórios de uma distribuição de probabilidade específica. Grid: Gera pesos em pontos pré-definidos de uma grade regular.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>opt  <span class="ot">&lt;-</span>  <span class="fu">optimize.portfolio</span>(<span class="at">R =</span> asset_returns_xts, port_spec, <span class="at">rp =</span> rp, <span class="at">optimize_method =</span> <span class="st">"random"</span>, <span class="at">trace =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Leverage constraint min_sum and max_sum are restrictive, 
              consider relaxing. e.g. 'full_investment' constraint should be min_sum=0.99 and max_sum=1.01</code></pre>
</div>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(opt)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>***********************************
PortfolioAnalytics Optimization
***********************************

Call:
optimize.portfolio(R = asset_returns_xts, portfolio = port_spec, 
    optimize_method = "random", trace = TRUE, rp = rp)

Optimal Weights:
VALE3.SA PETR4.SA AZUL4.SA MGLU3.SA CMIG4.SA 
  0.3433   0.1313   0.1042   0.1000   0.3213 

Objective Measures:
   mean 
0.01483 


 StdDev 
0.08163 

contribution :
VALE3.SA PETR4.SA AZUL4.SA MGLU3.SA CMIG4.SA 
 0.01902  0.01069  0.01707  0.01174  0.02311 

pct_contrib_StdDev :
VALE3.SA PETR4.SA AZUL4.SA MGLU3.SA CMIG4.SA 
  0.2330   0.1309   0.2091   0.1439   0.2831 </code></pre>
</div>
</div>
</section>
<section id="otimizando-a-carteira-com-rebalanceamento" class="level2">
<h2 class="anchored" data-anchor-id="otimizando-a-carteira-com-rebalanceamento">Otimizando a carteira com rebalanceamento</h2>
<p>A função <code>optimize.portfolio.rebalancing()</code> é usada para otimizar a carteira com rebalanceamento. O rebalanceamento é o processo de ajustar os pesos dos ativos na carteira para manter a alocação desejada ao longo do tempo. O rebalanceamento é importante para garantir que a carteira permaneça alinhada com os objetivos de investimento (restrições e objetivos) ao longo do tempo.</p>
<p><code>optimize.portfolio.rebalancing()</code> suporta otimização de carteiras com rebalanceamento em diferentes janelas de tempo. O backtest é o processo de testar uma estratégia de investimento em dados históricos para avaliar seu desempenho.</p>
<p>OBS: Dependendo do método de otimização, o processo pode ser demorado.</p>
<p>Exemplo de otimização com rebalanceamento:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Criar o objeto de portfólio</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>port_specr <span class="ot">&lt;-</span> <span class="fu">portfolio.spec</span>(<span class="at">assets =</span> <span class="fu">colnames</span>(asset_returns_xts))</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Adicionar restrições - full investment com soma de pesos igual a 1</span></span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>port_specr <span class="ot">&lt;-</span> <span class="fu">add.constraint</span>(port_specr, <span class="at">type =</span> <span class="st">"long_only"</span>)</span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a><span class="co"># restrição para a soma dos pesos</span></span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a>port_specr <span class="ot">&lt;-</span> <span class="fu">add.constraint</span>(port_specr, <span class="at">type =</span> <span class="st">"weight_sum"</span>, <span class="at">min_sum =</span> <span class="fl">0.99</span>, <span class="at">max_sum =</span> <span class="fl">1.01</span>)</span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-12"><a href="#cb37-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Adicionar a função objetivo - maximizar o retorno esperado</span></span>
<span id="cb37-13"><a href="#cb37-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-14"><a href="#cb37-14" aria-hidden="true" tabindex="-1"></a>port_specr <span class="ot">&lt;-</span> <span class="fu">add.objective</span>(port_specr, <span class="at">type =</span> <span class="st">"return"</span>, <span class="at">name =</span> <span class="st">"mean"</span>)</span>
<span id="cb37-15"><a href="#cb37-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-16"><a href="#cb37-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Adicionar a função objetivo - minimizar o risco</span></span>
<span id="cb37-17"><a href="#cb37-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-18"><a href="#cb37-18" aria-hidden="true" tabindex="-1"></a>port_specr <span class="ot">&lt;-</span> <span class="fu">add.objective</span>(port_specr, <span class="at">type =</span> <span class="st">"risk"</span>, <span class="at">name =</span> <span class="st">"StdDev"</span>)</span>
<span id="cb37-19"><a href="#cb37-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-20"><a href="#cb37-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Adicionar a função objetivo - minimizar a contribuição marginal do risco de cada ativo para o risco total da carteira</span></span>
<span id="cb37-21"><a href="#cb37-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-22"><a href="#cb37-22" aria-hidden="true" tabindex="-1"></a>port_specr <span class="ot">&lt;-</span> <span class="fu">add.objective</span>(port_specr, <span class="at">type =</span> <span class="st">"risk_budget"</span>, <span class="at">name =</span> <span class="st">"StdDev"</span>, <span class="at">min_prisk =</span> <span class="fl">0.05</span>, <span class="at">max_prisk =</span> <span class="fl">0.1</span>)</span>
<span id="cb37-23"><a href="#cb37-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-24"><a href="#cb37-24" aria-hidden="true" tabindex="-1"></a>rp <span class="ot">&lt;-</span> <span class="fu">random_portfolios</span>(port_specr, <span class="at">permutations =</span> <span class="dv">50</span>, <span class="at">rp_method =</span> <span class="st">'simplex'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="otimização" class="level2">
<h2 class="anchored" data-anchor-id="otimização">Otimização</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Otimização com rebalanceamento mensal</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>opt_rebal <span class="ot">&lt;-</span> <span class="fu">optimize.portfolio.rebalancing</span>(<span class="at">R =</span> asset_returns_xts, </span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>                      <span class="at">portfolio =</span> port_specr, </span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>                      <span class="at">optimize_method =</span> <span class="st">"random"</span>,</span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>                      <span class="at">rp =</span> rp,</span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a>                      <span class="at">trace =</span> <span class="cn">TRUE</span>,</span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a>                      <span class="at">search_size =</span> <span class="dv">1000</span>,</span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a>                      <span class="at">rebalance_on =</span> <span class="st">"months"</span>,</span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a>                      <span class="at">training_period =</span> <span class="dv">12</span>,</span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a>                      <span class="at">rolling_window =</span> <span class="dv">12</span>)</span>
<span id="cb38-12"><a href="#cb38-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-13"><a href="#cb38-13" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(opt_rebal)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>**************************************************
PortfolioAnalytics Optimization with Rebalancing
**************************************************

Call:
optimize.portfolio.rebalancing(R = asset_returns_xts, portfolio = port_specr, 
    optimize_method = "random", search_size = 1000, trace = TRUE, 
    rp = rp, rebalance_on = "months", training_period = 12, rolling_window = 12)

Number of rebalancing dates:  49 
First rebalance date:
[1] "2020-05-31"
Last rebalance date:
[1] "2024-05-31"

Annualized Portfolio Rebalancing Return:
[1] 0.07826747

Annualized Portfolio Standard Deviation:
[1] 0.3166047</code></pre>
</div>
</div>
</section>
<section id="analise-dos-resultados" class="level2">
<h2 class="anchored" data-anchor-id="analise-dos-resultados">Analise dos resultados</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="fu">extractObjectiveMeasures</span>(opt_rebal) <span class="sc">|&gt;</span> <span class="fu">head</span>(<span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                  mean    StdDev StdDev.contribution.VALE3.SA
2020-05-31 0.007778412 0.1146587                  0.009231419
           StdDev.contribution.PETR4.SA StdDev.contribution.AZUL4.SA
2020-05-31                   0.01697412                   0.01598271
           StdDev.contribution.MGLU3.SA StdDev.contribution.CMIG4.SA
2020-05-31                   0.02321859                   0.04925188
           StdDev.pct_contrib_StdDev.VALE3.SA
2020-05-31                         0.08051214
           StdDev.pct_contrib_StdDev.PETR4.SA
2020-05-31                          0.1480404
           StdDev.pct_contrib_StdDev.AZUL4.SA
2020-05-31                          0.1393937
           StdDev.pct_contrib_StdDev.MGLU3.SA
2020-05-31                          0.2025017
           StdDev.pct_contrib_StdDev.CMIG4.SA
2020-05-31                           0.429552</code></pre>
</div>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="fu">extractWeights</span>(opt_rebal) <span class="sc">|&gt;</span> <span class="fu">head</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>            VALE3.SA  PETR4.SA   AZUL4.SA  MGLU3.SA  CMIG4.SA
2020-05-31 0.2152079 0.1051845 0.09766879 0.1702039 0.4117349
2020-06-30 0.2152079 0.1051845 0.09766879 0.1702039 0.4117349
2020-07-31 0.2152079 0.1051845 0.09766879 0.1702039 0.4117349
2020-08-31 0.2152079 0.1051845 0.09766879 0.1702039 0.4117349
2020-09-30 0.2152079 0.1051845 0.09766879 0.1702039 0.4117349
2020-10-31 0.2152079 0.1051845 0.09766879 0.1702039 0.4117349</code></pre>
</div>
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="fu">chart.Weights</span>(opt) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="aula_2_files/figure-html/unnamed-chunk-20-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="fu">chart.Weights</span>(opt_rebal)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="aula_2_files/figure-html/unnamed-chunk-20-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="plotando-os-pesos-ao-longo-do-tempo-com-ggplot2" class="level2">
<h2 class="anchored" data-anchor-id="plotando-os-pesos-ao-longo-do-tempo-com-ggplot2">Plotando os pesos ao longo do tempo com ggplot2</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Extraindo os pesos dos ativos ao longo do tempo</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>weights_xts <span class="ot">&lt;-</span> <span class="fu">extractWeights</span>(opt_rebal)</span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Convertendo os pesos para um data frame</span></span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a>weights_df <span class="ot">&lt;-</span> weights_xts <span class="sc">%&gt;%</span> </span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a>              <span class="fu">tk_tbl</span>(<span class="at">preserve_index =</span> <span class="cn">TRUE</span>, <span class="at">rename_index =</span> <span class="st">"Date"</span>)</span>
<span id="cb46-9"><a href="#cb46-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-10"><a href="#cb46-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-11"><a href="#cb46-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Colocando o data frame em formato longo</span></span>
<span id="cb46-12"><a href="#cb46-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-13"><a href="#cb46-13" aria-hidden="true" tabindex="-1"></a>weights_long_df <span class="ot">&lt;-</span> weights_df <span class="sc">%&gt;%</span> </span>
<span id="cb46-14"><a href="#cb46-14" aria-hidden="true" tabindex="-1"></a>                <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="sc">-</span>Date, <span class="at">names_to =</span> <span class="st">"Asset"</span>, <span class="at">values_to =</span> <span class="st">"Weight"</span>)</span>
<span id="cb46-15"><a href="#cb46-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-16"><a href="#cb46-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-17"><a href="#cb46-17" aria-hidden="true" tabindex="-1"></a>plotly<span class="sc">::</span><span class="fu">ggplotly</span>(<span class="fu">ggplot</span>(weights_long_df) <span class="sc">+</span></span>
<span id="cb46-18"><a href="#cb46-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x =</span> Date, <span class="at">y =</span> Weight, <span class="at">colour =</span> Asset) <span class="sc">+</span></span>
<span id="cb46-19"><a href="#cb46-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">se =</span> <span class="cn">FALSE</span> ) <span class="sc">+</span></span>
<span id="cb46-20"><a href="#cb46-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_hue</span>(<span class="at">direction =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb46-21"><a href="#cb46-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb46-22"><a href="#cb46-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Data"</span>,</span>
<span id="cb46-23"><a href="#cb46-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Peso"</span>,</span>
<span id="cb46-24"><a href="#cb46-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Peso dos ativos rebalanceados ao longo do tempo"</span>,</span>
<span id="cb46-25"><a href="#cb46-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">colour =</span> <span class="st">"Ativos"</span></span>
<span id="cb46-26"><a href="#cb46-26" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb46-27"><a href="#cb46-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb46-28"><a href="#cb46-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb46-29"><a href="#cb46-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">16</span>L,</span>
<span id="cb46-30"><a href="#cb46-30" aria-hidden="true" tabindex="-1"></a>    <span class="at">face =</span> <span class="st">"bold"</span>,</span>
<span id="cb46-31"><a href="#cb46-31" aria-hidden="true" tabindex="-1"></a>    <span class="at">hjust =</span> <span class="fl">0.5</span>)</span>
<span id="cb46-32"><a href="#cb46-32" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb46-33"><a href="#cb46-33" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`geom_smooth()` using method = 'loess' and formula = 'y ~ x'</code></pre>
</div>
<div class="cell-output-display">
<div class="plotly html-widget html-fill-item" id="htmlwidget-b00854b5c56c9a4dd512" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-b00854b5c56c9a4dd512">{"x":{"data":[{"x":[18413,18431.493670886077,18449.98734177215,18468.481012658227,18486.974683544304,18505.468354430381,18523.962025316454,18542.455696202531,18560.949367088608,18579.443037974685,18597.936708860758,18616.430379746835,18634.924050632912,18653.417721518988,18671.911392405062,18690.405063291139,18708.898734177215,18727.392405063292,18745.886075949365,18764.379746835442,18782.873417721519,18801.367088607596,18819.860759493669,18838.354430379746,18856.848101265823,18875.3417721519,18893.835443037973,18912.32911392405,18930.822784810127,18949.316455696204,18967.810126582277,18986.303797468354,19004.797468354431,19023.291139240508,19041.784810126581,19060.278481012658,19078.772151898735,19097.265822784811,19115.759493670885,19134.253164556962,19152.746835443038,19171.240506329115,19189.734177215189,19208.227848101265,19226.721518987342,19245.215189873419,19263.708860759492,19282.202531645569,19300.696202531646,19319.189873417723,19337.683544303796,19356.177215189873,19374.67088607595,19393.164556962027,19411.6582278481,19430.151898734177,19448.645569620254,19467.139240506331,19485.632911392404,19504.126582278481,19522.620253164558,19541.113924050635,19559.607594936708,19578.101265822785,19596.594936708861,19615.088607594938,19633.582278481012,19652.075949367088,19670.569620253165,19689.063291139242,19707.556962025315,19726.050632911392,19744.544303797469,19763.037974683546,19781.531645569619,19800.025316455696,19818.518987341773,19837.012658227846,19855.506329113923,19874],"y":[0.070708798667764999,0.075245217328998332,0.079745088401399544,0.084218057278478697,0.088673769353743173,0.093121870020701228,0.097572004672860257,0.10203381870373023,0.10651695750681858,0.11103106647563354,0.11558637050429831,0.12024439741331225,0.1250108568718182,0.12984196831237621,0.13469395116754543,0.13952302486988777,0.14428540885196239,0.1489373225463293,0.15343498538554767,0.15773461680217943,0.16184289805097105,0.16666202880510816,0.17232783787158279,0.17856067736711165,0.18508089940840794,0.19160885611218614,0.19786489959515943,0.2035693819740447,0.20844265536555501,0.21220507188640478,0.21462943611724564,0.21611090524284499,0.21684737488462519,0.21690538412013746,0.21635147202693344,0.21525217768256436,0.2136740401645815,0.21168359855053628,0.20934739191798057,0.20673195934446484,0.20370239527163325,0.1993302357510765,0.19374714021385411,0.18725580220246801,0.18015891525942346,0.17275917292722448,0.16535926874837675,0.15826189626538145,0.15176974902074425,0.14618552055696932,0.14141680392480874,0.13625781288370398,0.13074935903175861,0.12506353834449568,0.11937244679743959,0.11384818036611126,0.1086628350260349,0.10398850675273376,0.099997291521731688,0.096861285308550274,0.094458612437745837,0.092258525980116274,0.09026999105569028,0.088521557325849307,0.087041774451975945,0.085859192095452369,0.085002359917660933,0.08449982757998345,0.084380144743802343,0.084671861070499774,0.085362546500410877,0.086399648415122043,0.087777163297423355,0.089489586092042731,0.091531411743707533,0.0938971351971465,0.096581251397087148,0.099578255288256715,0.10288264181538426,0.1064889059231971],"text":["Date: 18413.00<br />Weight: 0.07070880<br />Asset: AZUL4.SA","Date: 18431.49<br />Weight: 0.07524522<br />Asset: AZUL4.SA","Date: 18449.99<br />Weight: 0.07974509<br />Asset: AZUL4.SA","Date: 18468.48<br />Weight: 0.08421806<br />Asset: AZUL4.SA","Date: 18486.97<br />Weight: 0.08867377<br />Asset: AZUL4.SA","Date: 18505.47<br />Weight: 0.09312187<br />Asset: AZUL4.SA","Date: 18523.96<br />Weight: 0.09757200<br />Asset: AZUL4.SA","Date: 18542.46<br />Weight: 0.10203382<br />Asset: AZUL4.SA","Date: 18560.95<br />Weight: 0.10651696<br />Asset: AZUL4.SA","Date: 18579.44<br />Weight: 0.11103107<br />Asset: AZUL4.SA","Date: 18597.94<br />Weight: 0.11558637<br />Asset: AZUL4.SA","Date: 18616.43<br />Weight: 0.12024440<br />Asset: AZUL4.SA","Date: 18634.92<br />Weight: 0.12501086<br />Asset: AZUL4.SA","Date: 18653.42<br />Weight: 0.12984197<br />Asset: AZUL4.SA","Date: 18671.91<br />Weight: 0.13469395<br />Asset: AZUL4.SA","Date: 18690.41<br />Weight: 0.13952302<br />Asset: AZUL4.SA","Date: 18708.90<br />Weight: 0.14428541<br />Asset: AZUL4.SA","Date: 18727.39<br />Weight: 0.14893732<br />Asset: AZUL4.SA","Date: 18745.89<br />Weight: 0.15343499<br />Asset: AZUL4.SA","Date: 18764.38<br />Weight: 0.15773462<br />Asset: AZUL4.SA","Date: 18782.87<br />Weight: 0.16184290<br />Asset: AZUL4.SA","Date: 18801.37<br />Weight: 0.16666203<br />Asset: AZUL4.SA","Date: 18819.86<br />Weight: 0.17232784<br />Asset: AZUL4.SA","Date: 18838.35<br />Weight: 0.17856068<br />Asset: AZUL4.SA","Date: 18856.85<br />Weight: 0.18508090<br />Asset: AZUL4.SA","Date: 18875.34<br />Weight: 0.19160886<br />Asset: AZUL4.SA","Date: 18893.84<br />Weight: 0.19786490<br />Asset: AZUL4.SA","Date: 18912.33<br />Weight: 0.20356938<br />Asset: AZUL4.SA","Date: 18930.82<br />Weight: 0.20844266<br />Asset: AZUL4.SA","Date: 18949.32<br />Weight: 0.21220507<br />Asset: AZUL4.SA","Date: 18967.81<br />Weight: 0.21462944<br />Asset: AZUL4.SA","Date: 18986.30<br />Weight: 0.21611091<br />Asset: AZUL4.SA","Date: 19004.80<br />Weight: 0.21684737<br />Asset: AZUL4.SA","Date: 19023.29<br />Weight: 0.21690538<br />Asset: AZUL4.SA","Date: 19041.78<br />Weight: 0.21635147<br />Asset: AZUL4.SA","Date: 19060.28<br />Weight: 0.21525218<br />Asset: AZUL4.SA","Date: 19078.77<br />Weight: 0.21367404<br />Asset: AZUL4.SA","Date: 19097.27<br />Weight: 0.21168360<br />Asset: AZUL4.SA","Date: 19115.76<br />Weight: 0.20934739<br />Asset: AZUL4.SA","Date: 19134.25<br />Weight: 0.20673196<br />Asset: AZUL4.SA","Date: 19152.75<br />Weight: 0.20370240<br />Asset: AZUL4.SA","Date: 19171.24<br />Weight: 0.19933024<br />Asset: AZUL4.SA","Date: 19189.73<br />Weight: 0.19374714<br />Asset: AZUL4.SA","Date: 19208.23<br />Weight: 0.18725580<br />Asset: AZUL4.SA","Date: 19226.72<br />Weight: 0.18015892<br />Asset: AZUL4.SA","Date: 19245.22<br />Weight: 0.17275917<br />Asset: AZUL4.SA","Date: 19263.71<br />Weight: 0.16535927<br />Asset: AZUL4.SA","Date: 19282.20<br />Weight: 0.15826190<br />Asset: AZUL4.SA","Date: 19300.70<br />Weight: 0.15176975<br />Asset: AZUL4.SA","Date: 19319.19<br />Weight: 0.14618552<br />Asset: AZUL4.SA","Date: 19337.68<br />Weight: 0.14141680<br />Asset: AZUL4.SA","Date: 19356.18<br />Weight: 0.13625781<br />Asset: AZUL4.SA","Date: 19374.67<br />Weight: 0.13074936<br />Asset: AZUL4.SA","Date: 19393.16<br />Weight: 0.12506354<br />Asset: AZUL4.SA","Date: 19411.66<br />Weight: 0.11937245<br />Asset: AZUL4.SA","Date: 19430.15<br />Weight: 0.11384818<br />Asset: AZUL4.SA","Date: 19448.65<br />Weight: 0.10866284<br />Asset: AZUL4.SA","Date: 19467.14<br />Weight: 0.10398851<br />Asset: AZUL4.SA","Date: 19485.63<br />Weight: 0.09999729<br />Asset: AZUL4.SA","Date: 19504.13<br />Weight: 0.09686129<br />Asset: AZUL4.SA","Date: 19522.62<br />Weight: 0.09445861<br />Asset: AZUL4.SA","Date: 19541.11<br />Weight: 0.09225853<br />Asset: AZUL4.SA","Date: 19559.61<br />Weight: 0.09026999<br />Asset: AZUL4.SA","Date: 19578.10<br />Weight: 0.08852156<br />Asset: AZUL4.SA","Date: 19596.59<br />Weight: 0.08704177<br />Asset: AZUL4.SA","Date: 19615.09<br />Weight: 0.08585919<br />Asset: AZUL4.SA","Date: 19633.58<br />Weight: 0.08500236<br />Asset: AZUL4.SA","Date: 19652.08<br />Weight: 0.08449983<br />Asset: AZUL4.SA","Date: 19670.57<br />Weight: 0.08438014<br />Asset: AZUL4.SA","Date: 19689.06<br />Weight: 0.08467186<br />Asset: AZUL4.SA","Date: 19707.56<br />Weight: 0.08536255<br />Asset: AZUL4.SA","Date: 19726.05<br />Weight: 0.08639965<br />Asset: AZUL4.SA","Date: 19744.54<br />Weight: 0.08777716<br />Asset: AZUL4.SA","Date: 19763.04<br />Weight: 0.08948959<br />Asset: AZUL4.SA","Date: 19781.53<br />Weight: 0.09153141<br />Asset: AZUL4.SA","Date: 19800.03<br />Weight: 0.09389714<br />Asset: AZUL4.SA","Date: 19818.52<br />Weight: 0.09658125<br />Asset: AZUL4.SA","Date: 19837.01<br />Weight: 0.09957826<br />Asset: AZUL4.SA","Date: 19855.51<br />Weight: 0.10288264<br />Asset: AZUL4.SA","Date: 19874.00<br />Weight: 0.10648891<br />Asset: AZUL4.SA"],"type":"scatter","mode":"lines","name":"(AZUL4.SA,1)","line":{"width":3.7795275590551185,"color":"rgba(248,118,109,1)","dash":"solid"},"hoveron":"points","legendgroup":"(AZUL4.SA,1)","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[18413,18431.493670886077,18449.98734177215,18468.481012658227,18486.974683544304,18505.468354430381,18523.962025316454,18542.455696202531,18560.949367088608,18579.443037974685,18597.936708860758,18616.430379746835,18634.924050632912,18653.417721518988,18671.911392405062,18690.405063291139,18708.898734177215,18727.392405063292,18745.886075949365,18764.379746835442,18782.873417721519,18801.367088607596,18819.860759493669,18838.354430379746,18856.848101265823,18875.3417721519,18893.835443037973,18912.32911392405,18930.822784810127,18949.316455696204,18967.810126582277,18986.303797468354,19004.797468354431,19023.291139240508,19041.784810126581,19060.278481012658,19078.772151898735,19097.265822784811,19115.759493670885,19134.253164556962,19152.746835443038,19171.240506329115,19189.734177215189,19208.227848101265,19226.721518987342,19245.215189873419,19263.708860759492,19282.202531645569,19300.696202531646,19319.189873417723,19337.683544303796,19356.177215189873,19374.67088607595,19393.164556962027,19411.6582278481,19430.151898734177,19448.645569620254,19467.139240506331,19485.632911392404,19504.126582278481,19522.620253164558,19541.113924050635,19559.607594936708,19578.101265822785,19596.594936708861,19615.088607594938,19633.582278481012,19652.075949367088,19670.569620253165,19689.063291139242,19707.556962025315,19726.050632911392,19744.544303797469,19763.037974683546,19781.531645569619,19800.025316455696,19818.518987341773,19837.012658227846,19855.506329113923,19874],"y":[0.43976560422519118,0.43530848055425109,0.43085041775677729,0.42637929591765322,0.42188299512176519,0.41734939545399852,0.41276637699923946,0.4081218198423715,0.40340360406828085,0.39859960976185294,0.39369695601676585,0.3886149094867602,0.38334446446172904,0.37794128832844265,0.37246104847367245,0.36695941228418633,0.36149204714675598,0.35611462044815129,0.35088279957514373,0.34585225191450153,0.34101645846531814,0.33526453560239305,0.3284281546449519,0.32085073374581052,0.31287569105778823,0.30484644473370359,0.29710641292637652,0.28999901378862231,0.2838676654732607,0.27905578613311033,0.27582653909284843,0.27354066692938289,0.27195994129701956,0.2710577348376918,0.27080742019333276,0.27118237000587597,0.27215595691725469,0.27370155356940234,0.27579253260425174,0.27840226666373719,0.28170446819500639,0.2866317551041897,0.29301767777964466,0.30052278378506081,0.3088076206841241,0.31753273604052173,0.326358677417939,0.33494599238006645,0.34295522849058946,0.35004693331319509,0.35638450507822134,0.36349889300712102,0.37127500153100884,0.37942812826846023,0.38767357083804882,0.39572662685835341,0.40330259394794771,0.41011676972540695,0.41588445180930556,0.42032093781822111,0.42362543164374639,0.42667272373871645,0.42945136773685905,0.43191771400075085,0.43402811289296678,0.43573891477608218,0.43700647001267245,0.43778712896531341,0.4380372419965804,0.43771315946904882,0.4368290183169527,0.43545815193684645,0.43361000099051844,0.43129331124036502,0.42851682844878264,0.4252892983781667,0.42161946679091389,0.41751607944942132,0.41298788211608367,0.40804362055329785],"text":["Date: 18413.00<br />Weight: 0.43976560<br />Asset: CMIG4.SA","Date: 18431.49<br />Weight: 0.43530848<br />Asset: CMIG4.SA","Date: 18449.99<br />Weight: 0.43085042<br />Asset: CMIG4.SA","Date: 18468.48<br />Weight: 0.42637930<br />Asset: CMIG4.SA","Date: 18486.97<br />Weight: 0.42188300<br />Asset: CMIG4.SA","Date: 18505.47<br />Weight: 0.41734940<br />Asset: CMIG4.SA","Date: 18523.96<br />Weight: 0.41276638<br />Asset: CMIG4.SA","Date: 18542.46<br />Weight: 0.40812182<br />Asset: CMIG4.SA","Date: 18560.95<br />Weight: 0.40340360<br />Asset: CMIG4.SA","Date: 18579.44<br />Weight: 0.39859961<br />Asset: CMIG4.SA","Date: 18597.94<br />Weight: 0.39369696<br />Asset: CMIG4.SA","Date: 18616.43<br />Weight: 0.38861491<br />Asset: CMIG4.SA","Date: 18634.92<br />Weight: 0.38334446<br />Asset: CMIG4.SA","Date: 18653.42<br />Weight: 0.37794129<br />Asset: CMIG4.SA","Date: 18671.91<br />Weight: 0.37246105<br />Asset: CMIG4.SA","Date: 18690.41<br />Weight: 0.36695941<br />Asset: CMIG4.SA","Date: 18708.90<br />Weight: 0.36149205<br />Asset: CMIG4.SA","Date: 18727.39<br />Weight: 0.35611462<br />Asset: CMIG4.SA","Date: 18745.89<br />Weight: 0.35088280<br />Asset: CMIG4.SA","Date: 18764.38<br />Weight: 0.34585225<br />Asset: CMIG4.SA","Date: 18782.87<br />Weight: 0.34101646<br />Asset: CMIG4.SA","Date: 18801.37<br />Weight: 0.33526454<br />Asset: CMIG4.SA","Date: 18819.86<br />Weight: 0.32842815<br />Asset: CMIG4.SA","Date: 18838.35<br />Weight: 0.32085073<br />Asset: CMIG4.SA","Date: 18856.85<br />Weight: 0.31287569<br />Asset: CMIG4.SA","Date: 18875.34<br />Weight: 0.30484644<br />Asset: CMIG4.SA","Date: 18893.84<br />Weight: 0.29710641<br />Asset: CMIG4.SA","Date: 18912.33<br />Weight: 0.28999901<br />Asset: CMIG4.SA","Date: 18930.82<br />Weight: 0.28386767<br />Asset: CMIG4.SA","Date: 18949.32<br />Weight: 0.27905579<br />Asset: CMIG4.SA","Date: 18967.81<br />Weight: 0.27582654<br />Asset: CMIG4.SA","Date: 18986.30<br />Weight: 0.27354067<br />Asset: CMIG4.SA","Date: 19004.80<br />Weight: 0.27195994<br />Asset: CMIG4.SA","Date: 19023.29<br />Weight: 0.27105773<br />Asset: CMIG4.SA","Date: 19041.78<br />Weight: 0.27080742<br />Asset: CMIG4.SA","Date: 19060.28<br />Weight: 0.27118237<br />Asset: CMIG4.SA","Date: 19078.77<br />Weight: 0.27215596<br />Asset: CMIG4.SA","Date: 19097.27<br />Weight: 0.27370155<br />Asset: CMIG4.SA","Date: 19115.76<br />Weight: 0.27579253<br />Asset: CMIG4.SA","Date: 19134.25<br />Weight: 0.27840227<br />Asset: CMIG4.SA","Date: 19152.75<br />Weight: 0.28170447<br />Asset: CMIG4.SA","Date: 19171.24<br />Weight: 0.28663176<br />Asset: CMIG4.SA","Date: 19189.73<br />Weight: 0.29301768<br />Asset: CMIG4.SA","Date: 19208.23<br />Weight: 0.30052278<br />Asset: CMIG4.SA","Date: 19226.72<br />Weight: 0.30880762<br />Asset: CMIG4.SA","Date: 19245.22<br />Weight: 0.31753274<br />Asset: CMIG4.SA","Date: 19263.71<br />Weight: 0.32635868<br />Asset: CMIG4.SA","Date: 19282.20<br />Weight: 0.33494599<br />Asset: CMIG4.SA","Date: 19300.70<br />Weight: 0.34295523<br />Asset: CMIG4.SA","Date: 19319.19<br />Weight: 0.35004693<br />Asset: CMIG4.SA","Date: 19337.68<br />Weight: 0.35638451<br />Asset: CMIG4.SA","Date: 19356.18<br />Weight: 0.36349889<br />Asset: CMIG4.SA","Date: 19374.67<br />Weight: 0.37127500<br />Asset: CMIG4.SA","Date: 19393.16<br />Weight: 0.37942813<br />Asset: CMIG4.SA","Date: 19411.66<br />Weight: 0.38767357<br />Asset: CMIG4.SA","Date: 19430.15<br />Weight: 0.39572663<br />Asset: CMIG4.SA","Date: 19448.65<br />Weight: 0.40330259<br />Asset: CMIG4.SA","Date: 19467.14<br />Weight: 0.41011677<br />Asset: CMIG4.SA","Date: 19485.63<br />Weight: 0.41588445<br />Asset: CMIG4.SA","Date: 19504.13<br />Weight: 0.42032094<br />Asset: CMIG4.SA","Date: 19522.62<br />Weight: 0.42362543<br />Asset: CMIG4.SA","Date: 19541.11<br />Weight: 0.42667272<br />Asset: CMIG4.SA","Date: 19559.61<br />Weight: 0.42945137<br />Asset: CMIG4.SA","Date: 19578.10<br />Weight: 0.43191771<br />Asset: CMIG4.SA","Date: 19596.59<br />Weight: 0.43402811<br />Asset: CMIG4.SA","Date: 19615.09<br />Weight: 0.43573891<br />Asset: CMIG4.SA","Date: 19633.58<br />Weight: 0.43700647<br />Asset: CMIG4.SA","Date: 19652.08<br />Weight: 0.43778713<br />Asset: CMIG4.SA","Date: 19670.57<br />Weight: 0.43803724<br />Asset: CMIG4.SA","Date: 19689.06<br />Weight: 0.43771316<br />Asset: CMIG4.SA","Date: 19707.56<br />Weight: 0.43682902<br />Asset: CMIG4.SA","Date: 19726.05<br />Weight: 0.43545815<br />Asset: CMIG4.SA","Date: 19744.54<br />Weight: 0.43361000<br />Asset: CMIG4.SA","Date: 19763.04<br />Weight: 0.43129331<br />Asset: CMIG4.SA","Date: 19781.53<br />Weight: 0.42851683<br />Asset: CMIG4.SA","Date: 19800.03<br />Weight: 0.42528930<br />Asset: CMIG4.SA","Date: 19818.52<br />Weight: 0.42161947<br />Asset: CMIG4.SA","Date: 19837.01<br />Weight: 0.41751608<br />Asset: CMIG4.SA","Date: 19855.51<br />Weight: 0.41298788<br />Asset: CMIG4.SA","Date: 19874.00<br />Weight: 0.40804362<br />Asset: CMIG4.SA"],"type":"scatter","mode":"lines","name":"(CMIG4.SA,1)","line":{"width":3.7795275590551185,"color":"rgba(163,165,0,1)","dash":"solid"},"hoveron":"points","legendgroup":"(CMIG4.SA,1)","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[18413,18431.493670886077,18449.98734177215,18468.481012658227,18486.974683544304,18505.468354430381,18523.962025316454,18542.455696202531,18560.949367088608,18579.443037974685,18597.936708860758,18616.430379746835,18634.924050632912,18653.417721518988,18671.911392405062,18690.405063291139,18708.898734177215,18727.392405063292,18745.886075949365,18764.379746835442,18782.873417721519,18801.367088607596,18819.860759493669,18838.354430379746,18856.848101265823,18875.3417721519,18893.835443037973,18912.32911392405,18930.822784810127,18949.316455696204,18967.810126582277,18986.303797468354,19004.797468354431,19023.291139240508,19041.784810126581,19060.278481012658,19078.772151898735,19097.265822784811,19115.759493670885,19134.253164556962,19152.746835443038,19171.240506329115,19189.734177215189,19208.227848101265,19226.721518987342,19245.215189873419,19263.708860759492,19282.202531645569,19300.696202531646,19319.189873417723,19337.683544303796,19356.177215189873,19374.67088607595,19393.164556962027,19411.6582278481,19430.151898734177,19448.645569620254,19467.139240506331,19485.632911392404,19504.126582278481,19522.620253164558,19541.113924050635,19559.607594936708,19578.101265822785,19596.594936708861,19615.088607594938,19633.582278481012,19652.075949367088,19670.569620253165,19689.063291139242,19707.556962025315,19726.050632911392,19744.544303797469,19763.037974683546,19781.531645569619,19800.025316455696,19818.518987341773,19837.012658227846,19855.506329113923,19874],"y":[0.14004096448579462,0.14667251735921519,0.15302963934969235,0.15911057781592283,0.16491358011659957,0.17043689361041689,0.17567876565606796,0.18063744361224907,0.18531117483765341,0.18969820669097523,0.19379648438577529,0.19757431205249285,0.20101966897805595,0.20414443854240313,0.20696050412547232,0.20947974910720299,0.21171405686753322,0.21367531078640134,0.21537539424374555,0.21682619061950506,0.21803773959446729,0.21898270303926112,0.21965047621015085,0.22004405163872223,0.22016642185656055,0.22002057939525119,0.21960951678637977,0.21893622656153169,0.21800370125229235,0.21681493339024718,0.21528002618941486,0.21249735195944935,0.20849305033221499,0.20358779704953803,0.19810226785324628,0.19235713848516409,0.18667308468711893,0.18137078220093741,0.17677090676844676,0.17319413413147175,0.17082666344808337,0.16910675075989945,0.1678580442499055,0.16699743628717489,0.16644181924078183,0.16610808547980019,0.16591312737330374,0.16577383729036638,0.16560710760006192,0.16532983067146437,0.16494946861029033,0.16473580798834053,0.16468141522311183,0.16474912382515672,0.1649017673050277,0.16510217917327746,0.16531319294045851,0.16549764211712337,0.16561836021382459,0.16563818074111469,0.16557791147570727,0.16554236552678395,0.16553281125500663,0.1655467008789285,0.16558148661710273,0.16563462068808241,0.16570355531042083,0.16578574270267102,0.16587863508338621,0.16597968467111965,0.16609150542579512,0.16622096547465695,0.16636853612300204,0.16653462344938574,0.16671963353236338,0.16692397245049043,0.16714804628232227,0.16739226110641409,0.16765702300132157,0.16794273804559989],"text":["Date: 18413.00<br />Weight: 0.14004096<br />Asset: MGLU3.SA","Date: 18431.49<br />Weight: 0.14667252<br />Asset: MGLU3.SA","Date: 18449.99<br />Weight: 0.15302964<br />Asset: MGLU3.SA","Date: 18468.48<br />Weight: 0.15911058<br />Asset: MGLU3.SA","Date: 18486.97<br />Weight: 0.16491358<br />Asset: MGLU3.SA","Date: 18505.47<br />Weight: 0.17043689<br />Asset: MGLU3.SA","Date: 18523.96<br />Weight: 0.17567877<br />Asset: MGLU3.SA","Date: 18542.46<br />Weight: 0.18063744<br />Asset: MGLU3.SA","Date: 18560.95<br />Weight: 0.18531117<br />Asset: MGLU3.SA","Date: 18579.44<br />Weight: 0.18969821<br />Asset: MGLU3.SA","Date: 18597.94<br />Weight: 0.19379648<br />Asset: MGLU3.SA","Date: 18616.43<br />Weight: 0.19757431<br />Asset: MGLU3.SA","Date: 18634.92<br />Weight: 0.20101967<br />Asset: MGLU3.SA","Date: 18653.42<br />Weight: 0.20414444<br />Asset: MGLU3.SA","Date: 18671.91<br />Weight: 0.20696050<br />Asset: MGLU3.SA","Date: 18690.41<br />Weight: 0.20947975<br />Asset: MGLU3.SA","Date: 18708.90<br />Weight: 0.21171406<br />Asset: MGLU3.SA","Date: 18727.39<br />Weight: 0.21367531<br />Asset: MGLU3.SA","Date: 18745.89<br />Weight: 0.21537539<br />Asset: MGLU3.SA","Date: 18764.38<br />Weight: 0.21682619<br />Asset: MGLU3.SA","Date: 18782.87<br />Weight: 0.21803774<br />Asset: MGLU3.SA","Date: 18801.37<br />Weight: 0.21898270<br />Asset: MGLU3.SA","Date: 18819.86<br />Weight: 0.21965048<br />Asset: MGLU3.SA","Date: 18838.35<br />Weight: 0.22004405<br />Asset: MGLU3.SA","Date: 18856.85<br />Weight: 0.22016642<br />Asset: MGLU3.SA","Date: 18875.34<br />Weight: 0.22002058<br />Asset: MGLU3.SA","Date: 18893.84<br />Weight: 0.21960952<br />Asset: MGLU3.SA","Date: 18912.33<br />Weight: 0.21893623<br />Asset: MGLU3.SA","Date: 18930.82<br />Weight: 0.21800370<br />Asset: MGLU3.SA","Date: 18949.32<br />Weight: 0.21681493<br />Asset: MGLU3.SA","Date: 18967.81<br />Weight: 0.21528003<br />Asset: MGLU3.SA","Date: 18986.30<br />Weight: 0.21249735<br />Asset: MGLU3.SA","Date: 19004.80<br />Weight: 0.20849305<br />Asset: MGLU3.SA","Date: 19023.29<br />Weight: 0.20358780<br />Asset: MGLU3.SA","Date: 19041.78<br />Weight: 0.19810227<br />Asset: MGLU3.SA","Date: 19060.28<br />Weight: 0.19235714<br />Asset: MGLU3.SA","Date: 19078.77<br />Weight: 0.18667308<br />Asset: MGLU3.SA","Date: 19097.27<br />Weight: 0.18137078<br />Asset: MGLU3.SA","Date: 19115.76<br />Weight: 0.17677091<br />Asset: MGLU3.SA","Date: 19134.25<br />Weight: 0.17319413<br />Asset: MGLU3.SA","Date: 19152.75<br />Weight: 0.17082666<br />Asset: MGLU3.SA","Date: 19171.24<br />Weight: 0.16910675<br />Asset: MGLU3.SA","Date: 19189.73<br />Weight: 0.16785804<br />Asset: MGLU3.SA","Date: 19208.23<br />Weight: 0.16699744<br />Asset: MGLU3.SA","Date: 19226.72<br />Weight: 0.16644182<br />Asset: MGLU3.SA","Date: 19245.22<br />Weight: 0.16610809<br />Asset: MGLU3.SA","Date: 19263.71<br />Weight: 0.16591313<br />Asset: MGLU3.SA","Date: 19282.20<br />Weight: 0.16577384<br />Asset: MGLU3.SA","Date: 19300.70<br />Weight: 0.16560711<br />Asset: MGLU3.SA","Date: 19319.19<br />Weight: 0.16532983<br />Asset: MGLU3.SA","Date: 19337.68<br />Weight: 0.16494947<br />Asset: MGLU3.SA","Date: 19356.18<br />Weight: 0.16473581<br />Asset: MGLU3.SA","Date: 19374.67<br />Weight: 0.16468142<br />Asset: MGLU3.SA","Date: 19393.16<br />Weight: 0.16474912<br />Asset: MGLU3.SA","Date: 19411.66<br />Weight: 0.16490177<br />Asset: MGLU3.SA","Date: 19430.15<br />Weight: 0.16510218<br />Asset: MGLU3.SA","Date: 19448.65<br />Weight: 0.16531319<br />Asset: MGLU3.SA","Date: 19467.14<br />Weight: 0.16549764<br />Asset: MGLU3.SA","Date: 19485.63<br />Weight: 0.16561836<br />Asset: MGLU3.SA","Date: 19504.13<br />Weight: 0.16563818<br />Asset: MGLU3.SA","Date: 19522.62<br />Weight: 0.16557791<br />Asset: MGLU3.SA","Date: 19541.11<br />Weight: 0.16554237<br />Asset: MGLU3.SA","Date: 19559.61<br />Weight: 0.16553281<br />Asset: MGLU3.SA","Date: 19578.10<br />Weight: 0.16554670<br />Asset: MGLU3.SA","Date: 19596.59<br />Weight: 0.16558149<br />Asset: MGLU3.SA","Date: 19615.09<br />Weight: 0.16563462<br />Asset: MGLU3.SA","Date: 19633.58<br />Weight: 0.16570356<br />Asset: MGLU3.SA","Date: 19652.08<br />Weight: 0.16578574<br />Asset: MGLU3.SA","Date: 19670.57<br />Weight: 0.16587864<br />Asset: MGLU3.SA","Date: 19689.06<br />Weight: 0.16597968<br />Asset: MGLU3.SA","Date: 19707.56<br />Weight: 0.16609151<br />Asset: MGLU3.SA","Date: 19726.05<br />Weight: 0.16622097<br />Asset: MGLU3.SA","Date: 19744.54<br />Weight: 0.16636854<br />Asset: MGLU3.SA","Date: 19763.04<br />Weight: 0.16653462<br />Asset: MGLU3.SA","Date: 19781.53<br />Weight: 0.16671963<br />Asset: MGLU3.SA","Date: 19800.03<br />Weight: 0.16692397<br />Asset: MGLU3.SA","Date: 19818.52<br />Weight: 0.16714805<br />Asset: MGLU3.SA","Date: 19837.01<br />Weight: 0.16739226<br />Asset: MGLU3.SA","Date: 19855.51<br />Weight: 0.16765702<br />Asset: MGLU3.SA","Date: 19874.00<br />Weight: 0.16794274<br />Asset: MGLU3.SA"],"type":"scatter","mode":"lines","name":"(MGLU3.SA,1)","line":{"width":3.7795275590551185,"color":"rgba(0,191,125,1)","dash":"solid"},"hoveron":"points","legendgroup":"(MGLU3.SA,1)","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[18413,18431.493670886077,18449.98734177215,18468.481012658227,18486.974683544304,18505.468354430381,18523.962025316454,18542.455696202531,18560.949367088608,18579.443037974685,18597.936708860758,18616.430379746835,18634.924050632912,18653.417721518988,18671.911392405062,18690.405063291139,18708.898734177215,18727.392405063292,18745.886075949365,18764.379746835442,18782.873417721519,18801.367088607596,18819.860759493669,18838.354430379746,18856.848101265823,18875.3417721519,18893.835443037973,18912.32911392405,18930.822784810127,18949.316455696204,18967.810126582277,18986.303797468354,19004.797468354431,19023.291139240508,19041.784810126581,19060.278481012658,19078.772151898735,19097.265822784811,19115.759493670885,19134.253164556962,19152.746835443038,19171.240506329115,19189.734177215189,19208.227848101265,19226.721518987342,19245.215189873419,19263.708860759492,19282.202531645569,19300.696202531646,19319.189873417723,19337.683544303796,19356.177215189873,19374.67088607595,19393.164556962027,19411.6582278481,19430.151898734177,19448.645569620254,19467.139240506331,19485.632911392404,19504.126582278481,19522.620253164558,19541.113924050635,19559.607594936708,19578.101265822785,19596.594936708861,19615.088607594938,19633.582278481012,19652.075949367088,19670.569620253165,19689.063291139242,19707.556962025315,19726.050632911392,19744.544303797469,19763.037974683546,19781.531645569619,19800.025316455696,19818.518987341773,19837.012658227846,19855.506329113923,19874],"y":[0.11389211534403104,0.1115655189827755,0.10938000134500016,0.10733939071819175,0.10544751538983826,0.10370820364742728,0.10212528377844669,0.10070258407038338,0.099443932810725277,0.098353158286959952,0.097434427754103367,0.09672351811939825,0.096228775224336802,0.095930648050519582,0.095809585579547066,0.095846036793019673,0.096020450672538046,0.096313276199702563,0.096704962356113713,0.097175958123372111,0.097722685928628802,0.098627618990525801,0.099936876352302889,0.10156593606284973,0.10343027617105512,0.10544537472580817,0.10752670977599756,0.10958975937051318,0.1115500015582437,0.11332291438807819,0.11489115553870959,0.11687304186407825,0.11931270369217792,0.12205161696538572,0.12493125762607835,0.12779310161663424,0.13047862487942999,0.13282930335684287,0.13468661299124973,0.13589202972502862,0.13631364562087744,0.13604220787826687,0.13520240904138897,0.13390764468580416,0.13227131038707335,0.13040680172075722,0.12842751426241705,0.12644684358761274,0.12457818527190544,0.12293493489085594,0.12146168420479489,0.11964819104942098,0.1175418839275328,0.11524734344006042,0.11286915018793442,0.11051188477208398,0.10828012779343965,0.10627845985293154,0.10461146155149004,0.10338371349004456,0.10252493822789045,0.10171882043625605,0.10096763961043768,0.10028528557235056,0.099685648143910344,0.099182617147032442,0.098790082403632434,0.09852193373562565,0.098392060964927655,0.09841435391345392,0.098584436466573638,0.09887914483573039,0.099295460517039968,0.099830584427240965,0.10048171748307198,0.10124606060127193,0.10212081469857943,0.10310318069173294,0.10419035949747155,0.10537955203253371],"text":["Date: 18413.00<br />Weight: 0.11389212<br />Asset: PETR4.SA","Date: 18431.49<br />Weight: 0.11156552<br />Asset: PETR4.SA","Date: 18449.99<br />Weight: 0.10938000<br />Asset: PETR4.SA","Date: 18468.48<br />Weight: 0.10733939<br />Asset: PETR4.SA","Date: 18486.97<br />Weight: 0.10544752<br />Asset: PETR4.SA","Date: 18505.47<br />Weight: 0.10370820<br />Asset: PETR4.SA","Date: 18523.96<br />Weight: 0.10212528<br />Asset: PETR4.SA","Date: 18542.46<br />Weight: 0.10070258<br />Asset: PETR4.SA","Date: 18560.95<br />Weight: 0.09944393<br />Asset: PETR4.SA","Date: 18579.44<br />Weight: 0.09835316<br />Asset: PETR4.SA","Date: 18597.94<br />Weight: 0.09743443<br />Asset: PETR4.SA","Date: 18616.43<br />Weight: 0.09672352<br />Asset: PETR4.SA","Date: 18634.92<br />Weight: 0.09622878<br />Asset: PETR4.SA","Date: 18653.42<br />Weight: 0.09593065<br />Asset: PETR4.SA","Date: 18671.91<br />Weight: 0.09580959<br />Asset: PETR4.SA","Date: 18690.41<br />Weight: 0.09584604<br />Asset: PETR4.SA","Date: 18708.90<br />Weight: 0.09602045<br />Asset: PETR4.SA","Date: 18727.39<br />Weight: 0.09631328<br />Asset: PETR4.SA","Date: 18745.89<br />Weight: 0.09670496<br />Asset: PETR4.SA","Date: 18764.38<br />Weight: 0.09717596<br />Asset: PETR4.SA","Date: 18782.87<br />Weight: 0.09772269<br />Asset: PETR4.SA","Date: 18801.37<br />Weight: 0.09862762<br />Asset: PETR4.SA","Date: 18819.86<br />Weight: 0.09993688<br />Asset: PETR4.SA","Date: 18838.35<br />Weight: 0.10156594<br />Asset: PETR4.SA","Date: 18856.85<br />Weight: 0.10343028<br />Asset: PETR4.SA","Date: 18875.34<br />Weight: 0.10544537<br />Asset: PETR4.SA","Date: 18893.84<br />Weight: 0.10752671<br />Asset: PETR4.SA","Date: 18912.33<br />Weight: 0.10958976<br />Asset: PETR4.SA","Date: 18930.82<br />Weight: 0.11155000<br />Asset: PETR4.SA","Date: 18949.32<br />Weight: 0.11332291<br />Asset: PETR4.SA","Date: 18967.81<br />Weight: 0.11489116<br />Asset: PETR4.SA","Date: 18986.30<br />Weight: 0.11687304<br />Asset: PETR4.SA","Date: 19004.80<br />Weight: 0.11931270<br />Asset: PETR4.SA","Date: 19023.29<br />Weight: 0.12205162<br />Asset: PETR4.SA","Date: 19041.78<br />Weight: 0.12493126<br />Asset: PETR4.SA","Date: 19060.28<br />Weight: 0.12779310<br />Asset: PETR4.SA","Date: 19078.77<br />Weight: 0.13047862<br />Asset: PETR4.SA","Date: 19097.27<br />Weight: 0.13282930<br />Asset: PETR4.SA","Date: 19115.76<br />Weight: 0.13468661<br />Asset: PETR4.SA","Date: 19134.25<br />Weight: 0.13589203<br />Asset: PETR4.SA","Date: 19152.75<br />Weight: 0.13631365<br />Asset: PETR4.SA","Date: 19171.24<br />Weight: 0.13604221<br />Asset: PETR4.SA","Date: 19189.73<br />Weight: 0.13520241<br />Asset: PETR4.SA","Date: 19208.23<br />Weight: 0.13390764<br />Asset: PETR4.SA","Date: 19226.72<br />Weight: 0.13227131<br />Asset: PETR4.SA","Date: 19245.22<br />Weight: 0.13040680<br />Asset: PETR4.SA","Date: 19263.71<br />Weight: 0.12842751<br />Asset: PETR4.SA","Date: 19282.20<br />Weight: 0.12644684<br />Asset: PETR4.SA","Date: 19300.70<br />Weight: 0.12457819<br />Asset: PETR4.SA","Date: 19319.19<br />Weight: 0.12293493<br />Asset: PETR4.SA","Date: 19337.68<br />Weight: 0.12146168<br />Asset: PETR4.SA","Date: 19356.18<br />Weight: 0.11964819<br />Asset: PETR4.SA","Date: 19374.67<br />Weight: 0.11754188<br />Asset: PETR4.SA","Date: 19393.16<br />Weight: 0.11524734<br />Asset: PETR4.SA","Date: 19411.66<br />Weight: 0.11286915<br />Asset: PETR4.SA","Date: 19430.15<br />Weight: 0.11051188<br />Asset: PETR4.SA","Date: 19448.65<br />Weight: 0.10828013<br />Asset: PETR4.SA","Date: 19467.14<br />Weight: 0.10627846<br />Asset: PETR4.SA","Date: 19485.63<br />Weight: 0.10461146<br />Asset: PETR4.SA","Date: 19504.13<br />Weight: 0.10338371<br />Asset: PETR4.SA","Date: 19522.62<br />Weight: 0.10252494<br />Asset: PETR4.SA","Date: 19541.11<br />Weight: 0.10171882<br />Asset: PETR4.SA","Date: 19559.61<br />Weight: 0.10096764<br />Asset: PETR4.SA","Date: 19578.10<br />Weight: 0.10028529<br />Asset: PETR4.SA","Date: 19596.59<br />Weight: 0.09968565<br />Asset: PETR4.SA","Date: 19615.09<br />Weight: 0.09918262<br />Asset: PETR4.SA","Date: 19633.58<br />Weight: 0.09879008<br />Asset: PETR4.SA","Date: 19652.08<br />Weight: 0.09852193<br />Asset: PETR4.SA","Date: 19670.57<br />Weight: 0.09839206<br />Asset: PETR4.SA","Date: 19689.06<br />Weight: 0.09841435<br />Asset: PETR4.SA","Date: 19707.56<br />Weight: 0.09858444<br />Asset: PETR4.SA","Date: 19726.05<br />Weight: 0.09887914<br />Asset: PETR4.SA","Date: 19744.54<br />Weight: 0.09929546<br />Asset: PETR4.SA","Date: 19763.04<br />Weight: 0.09983058<br />Asset: PETR4.SA","Date: 19781.53<br />Weight: 0.10048172<br />Asset: PETR4.SA","Date: 19800.03<br />Weight: 0.10124606<br />Asset: PETR4.SA","Date: 19818.52<br />Weight: 0.10212081<br />Asset: PETR4.SA","Date: 19837.01<br />Weight: 0.10310318<br />Asset: PETR4.SA","Date: 19855.51<br />Weight: 0.10419036<br />Asset: PETR4.SA","Date: 19874.00<br />Weight: 0.10537955<br />Asset: PETR4.SA"],"type":"scatter","mode":"lines","name":"(PETR4.SA,1)","line":{"width":3.7795275590551185,"color":"rgba(0,176,246,1)","dash":"solid"},"hoveron":"points","legendgroup":"(PETR4.SA,1)","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[18413,18431.493670886077,18449.98734177215,18468.481012658227,18486.974683544304,18505.468354430381,18523.962025316454,18542.455696202531,18560.949367088608,18579.443037974685,18597.936708860758,18616.430379746835,18634.924050632912,18653.417721518988,18671.911392405062,18690.405063291139,18708.898734177215,18727.392405063292,18745.886075949365,18764.379746835442,18782.873417721519,18801.367088607596,18819.860759493669,18838.354430379746,18856.848101265823,18875.3417721519,18893.835443037973,18912.32911392405,18930.822784810127,18949.316455696204,18967.810126582277,18986.303797468354,19004.797468354431,19023.291139240508,19041.784810126581,19060.278481012658,19078.772151898735,19097.265822784811,19115.759493670885,19134.253164556962,19152.746835443038,19171.240506329115,19189.734177215189,19208.227848101265,19226.721518987342,19245.215189873419,19263.708860759492,19282.202531645569,19300.696202531646,19319.189873417723,19337.683544303796,19356.177215189873,19374.67088607595,19393.164556962027,19411.6582278481,19430.151898734177,19448.645569620254,19467.139240506331,19485.632911392404,19504.126582278481,19522.620253164558,19541.113924050635,19559.607594936708,19578.101265822785,19596.594936708861,19615.088607594938,19633.582278481012,19652.075949367088,19670.569620253165,19689.063291139242,19707.556962025315,19726.050632911392,19744.544303797469,19763.037974683546,19781.531645569619,19800.025316455696,19818.518987341773,19837.012658227846,19855.506329113923,19874],"y":[0.23559251727721728,0.23120826577475911,0.22699485314713008,0.22295267826975307,0.21908214001805357,0.21538363726745613,0.211857568893386,0.20850433377126634,0.20532433077652248,0.20231795878457898,0.19948576133905785,0.19684286292803715,0.19439623446406062,0.19214165676625897,0.19007491065376333,0.1881917769457036,0.18648803646121087,0.18495947001941587,0.18360185843944959,0.18241098254044219,0.18138021796061507,0.18046311356271225,0.17965665492101193,0.17897860118550646,0.17844671150618868,0.17807874503305132,0.1778924609160871,0.17790561830528867,0.17813597635064871,0.17860129420215992,0.179372843061782,0.18097803400424492,0.1833869297939629,0.18639746702724744,0.18980758230040939,0.19341521220976174,0.19701829335161525,0.2004147623222815,0.20340255571807145,0.20577961013529791,0.20745282746439989,0.20888905050656772,0.21017472871520698,0.21131633303949221,0.21232033442859732,0.21319320383169649,0.21394141219796359,0.21457143047657304,0.21508972961669889,0.21550278056751523,0.21578753818188473,0.21585929507141355,0.21575234028658816,0.21551186612182724,0.2151830648715497,0.21481112883017431,0.2144412502921198,0.21411862155180508,0.21388843490364898,0.21379588264207011,0.21381310621491081,0.21380756431812808,0.21377819034200699,0.21372874222212132,0.21366297789404473,0.21358465529335091,0.2134975323556137,0.21340536701640661,0.21331191721130358,0.21322094087587812,0.21313249329026784,0.21304208933764426,0.21294883907201637,0.21285189479096597,0.21275040879207485,0.21264353337292477,0.21253042083109763,0.21241022346417524,0.21228209356973937,0.21214518344537189],"text":["Date: 18413.00<br />Weight: 0.23559252<br />Asset: VALE3.SA","Date: 18431.49<br />Weight: 0.23120827<br />Asset: VALE3.SA","Date: 18449.99<br />Weight: 0.22699485<br />Asset: VALE3.SA","Date: 18468.48<br />Weight: 0.22295268<br />Asset: VALE3.SA","Date: 18486.97<br />Weight: 0.21908214<br />Asset: VALE3.SA","Date: 18505.47<br />Weight: 0.21538364<br />Asset: VALE3.SA","Date: 18523.96<br />Weight: 0.21185757<br />Asset: VALE3.SA","Date: 18542.46<br />Weight: 0.20850433<br />Asset: VALE3.SA","Date: 18560.95<br />Weight: 0.20532433<br />Asset: VALE3.SA","Date: 18579.44<br />Weight: 0.20231796<br />Asset: VALE3.SA","Date: 18597.94<br />Weight: 0.19948576<br />Asset: VALE3.SA","Date: 18616.43<br />Weight: 0.19684286<br />Asset: VALE3.SA","Date: 18634.92<br />Weight: 0.19439623<br />Asset: VALE3.SA","Date: 18653.42<br />Weight: 0.19214166<br />Asset: VALE3.SA","Date: 18671.91<br />Weight: 0.19007491<br />Asset: VALE3.SA","Date: 18690.41<br />Weight: 0.18819178<br />Asset: VALE3.SA","Date: 18708.90<br />Weight: 0.18648804<br />Asset: VALE3.SA","Date: 18727.39<br />Weight: 0.18495947<br />Asset: VALE3.SA","Date: 18745.89<br />Weight: 0.18360186<br />Asset: VALE3.SA","Date: 18764.38<br />Weight: 0.18241098<br />Asset: VALE3.SA","Date: 18782.87<br />Weight: 0.18138022<br />Asset: VALE3.SA","Date: 18801.37<br />Weight: 0.18046311<br />Asset: VALE3.SA","Date: 18819.86<br />Weight: 0.17965665<br />Asset: VALE3.SA","Date: 18838.35<br />Weight: 0.17897860<br />Asset: VALE3.SA","Date: 18856.85<br />Weight: 0.17844671<br />Asset: VALE3.SA","Date: 18875.34<br />Weight: 0.17807875<br />Asset: VALE3.SA","Date: 18893.84<br />Weight: 0.17789246<br />Asset: VALE3.SA","Date: 18912.33<br />Weight: 0.17790562<br />Asset: VALE3.SA","Date: 18930.82<br />Weight: 0.17813598<br />Asset: VALE3.SA","Date: 18949.32<br />Weight: 0.17860129<br />Asset: VALE3.SA","Date: 18967.81<br />Weight: 0.17937284<br />Asset: VALE3.SA","Date: 18986.30<br />Weight: 0.18097803<br />Asset: VALE3.SA","Date: 19004.80<br />Weight: 0.18338693<br />Asset: VALE3.SA","Date: 19023.29<br />Weight: 0.18639747<br />Asset: VALE3.SA","Date: 19041.78<br />Weight: 0.18980758<br />Asset: VALE3.SA","Date: 19060.28<br />Weight: 0.19341521<br />Asset: VALE3.SA","Date: 19078.77<br />Weight: 0.19701829<br />Asset: VALE3.SA","Date: 19097.27<br />Weight: 0.20041476<br />Asset: VALE3.SA","Date: 19115.76<br />Weight: 0.20340256<br />Asset: VALE3.SA","Date: 19134.25<br />Weight: 0.20577961<br />Asset: VALE3.SA","Date: 19152.75<br />Weight: 0.20745283<br />Asset: VALE3.SA","Date: 19171.24<br />Weight: 0.20888905<br />Asset: VALE3.SA","Date: 19189.73<br />Weight: 0.21017473<br />Asset: VALE3.SA","Date: 19208.23<br />Weight: 0.21131633<br />Asset: VALE3.SA","Date: 19226.72<br />Weight: 0.21232033<br />Asset: VALE3.SA","Date: 19245.22<br />Weight: 0.21319320<br />Asset: VALE3.SA","Date: 19263.71<br />Weight: 0.21394141<br />Asset: VALE3.SA","Date: 19282.20<br />Weight: 0.21457143<br />Asset: VALE3.SA","Date: 19300.70<br />Weight: 0.21508973<br />Asset: VALE3.SA","Date: 19319.19<br />Weight: 0.21550278<br />Asset: VALE3.SA","Date: 19337.68<br />Weight: 0.21578754<br />Asset: VALE3.SA","Date: 19356.18<br />Weight: 0.21585930<br />Asset: VALE3.SA","Date: 19374.67<br />Weight: 0.21575234<br />Asset: VALE3.SA","Date: 19393.16<br />Weight: 0.21551187<br />Asset: VALE3.SA","Date: 19411.66<br />Weight: 0.21518306<br />Asset: VALE3.SA","Date: 19430.15<br />Weight: 0.21481113<br />Asset: VALE3.SA","Date: 19448.65<br />Weight: 0.21444125<br />Asset: VALE3.SA","Date: 19467.14<br />Weight: 0.21411862<br />Asset: VALE3.SA","Date: 19485.63<br />Weight: 0.21388843<br />Asset: VALE3.SA","Date: 19504.13<br />Weight: 0.21379588<br />Asset: VALE3.SA","Date: 19522.62<br />Weight: 0.21381311<br />Asset: VALE3.SA","Date: 19541.11<br />Weight: 0.21380756<br />Asset: VALE3.SA","Date: 19559.61<br />Weight: 0.21377819<br />Asset: VALE3.SA","Date: 19578.10<br />Weight: 0.21372874<br />Asset: VALE3.SA","Date: 19596.59<br />Weight: 0.21366298<br />Asset: VALE3.SA","Date: 19615.09<br />Weight: 0.21358466<br />Asset: VALE3.SA","Date: 19633.58<br />Weight: 0.21349753<br />Asset: VALE3.SA","Date: 19652.08<br />Weight: 0.21340537<br />Asset: VALE3.SA","Date: 19670.57<br />Weight: 0.21331192<br />Asset: VALE3.SA","Date: 19689.06<br />Weight: 0.21322094<br />Asset: VALE3.SA","Date: 19707.56<br />Weight: 0.21313249<br />Asset: VALE3.SA","Date: 19726.05<br />Weight: 0.21304209<br />Asset: VALE3.SA","Date: 19744.54<br />Weight: 0.21294884<br />Asset: VALE3.SA","Date: 19763.04<br />Weight: 0.21285189<br />Asset: VALE3.SA","Date: 19781.53<br />Weight: 0.21275041<br />Asset: VALE3.SA","Date: 19800.03<br />Weight: 0.21264353<br />Asset: VALE3.SA","Date: 19818.52<br />Weight: 0.21253042<br />Asset: VALE3.SA","Date: 19837.01<br />Weight: 0.21241022<br />Asset: VALE3.SA","Date: 19855.51<br />Weight: 0.21228209<br />Asset: VALE3.SA","Date: 19874.00<br />Weight: 0.21214518<br />Asset: VALE3.SA"],"type":"scatter","mode":"lines","name":"(VALE3.SA,1)","line":{"width":3.7795275590551185,"color":"rgba(231,107,243,1)","dash":"solid"},"hoveron":"points","legendgroup":"(VALE3.SA,1)","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null}],"layout":{"margin":{"t":47.481942714819425,"r":7.3059360730593621,"b":40.182648401826491,"l":43.105022831050235},"font":{"color":"rgba(0,0,0,1)","family":"","size":14.611872146118724},"title":{"text":"<b> Peso dos ativos rebalanceados ao longo do tempo <\/b>","font":{"color":"rgba(0,0,0,1)","family":"","size":21.253632212536321},"x":0.5,"xref":"paper"},"xaxis":{"domain":[0,1],"automargin":true,"type":"linear","autorange":false,"range":[18339.950000000001,19947.049999999999],"tickmode":"array","ticktext":["2021","2022","2023","2024"],"tickvals":[18628,18993,19358,19723],"categoryorder":"array","categoryarray":["2021","2022","2023","2024"],"nticks":null,"ticks":"","tickcolor":null,"ticklen":3.6529680365296811,"tickwidth":0,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.68949771689498},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"gridcolor":"rgba(235,235,235,1)","gridwidth":0.66417600664176002,"zeroline":false,"anchor":"y","title":{"text":"Data","font":{"color":"rgba(0,0,0,1)","family":"","size":14.611872146118724}},"hoverformat":".2f"},"yaxis":{"domain":[0,1],"automargin":true,"type":"linear","autorange":false,"range":[0.052255958389893692,0.45821844450306248],"tickmode":"array","ticktext":["0.1","0.2","0.3","0.4"],"tickvals":[0.10000000000000001,0.20000000000000001,0.30000000000000004,0.40000000000000002],"categoryorder":"array","categoryarray":["0.1","0.2","0.3","0.4"],"nticks":null,"ticks":"","tickcolor":null,"ticklen":3.6529680365296811,"tickwidth":0,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.68949771689498},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"gridcolor":"rgba(235,235,235,1)","gridwidth":0.66417600664176002,"zeroline":false,"anchor":"x","title":{"text":"Peso","font":{"color":"rgba(0,0,0,1)","family":"","size":14.611872146118724}},"hoverformat":".2f"},"shapes":[{"type":"rect","fillcolor":null,"line":{"color":null,"width":0,"linetype":[]},"yref":"paper","xref":"paper","x0":0,"x1":1,"y0":0,"y1":1}],"showlegend":true,"legend":{"bgcolor":null,"bordercolor":null,"borderwidth":0,"font":{"color":"rgba(0,0,0,1)","family":"","size":11.68949771689498},"title":{"text":"Ativos","font":{"color":"rgba(0,0,0,1)","family":"","size":14.611872146118724}}},"hovermode":"closest","barmode":"relative"},"config":{"doubleClick":"reset","modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"source":"A","attrs":{"65545f457c01":{"x":{},"y":{},"colour":{},"type":"scatter"}},"cur_data":"65545f457c01","visdat":{"65545f457c01":["function (y) ","x"]},"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</section>
<section id="plotando-o-retorno-do-portfólio-ao-longo-do-tempo" class="level2">
<h2 class="anchored" data-anchor-id="plotando-o-retorno-do-portfólio-ao-longo-do-tempo">Plotando o retorno do portfólio ao longo do tempo</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculando o retorno do portfólio otimizado e adicionando o retorno do IBOV</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>opt_returns_long_df <span class="ot">&lt;-</span> <span class="fu">Return.portfolio</span>(<span class="at">R =</span> asset_returns_xts, <span class="at">weights =</span> <span class="fu">extractWeights</span>(opt_rebal)) <span class="sc">%&gt;%</span></span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tk_tbl</span>(<span class="at">preserve_index =</span> <span class="cn">TRUE</span>, <span class="at">rename_index =</span> <span class="st">"Date"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(ibov_returns_xts <span class="sc">%&gt;%</span> <span class="fu">tk_tbl</span>(<span class="at">preserve_index =</span> <span class="cn">TRUE</span>, <span class="at">rename_index =</span> <span class="st">"Date"</span>), <span class="at">by =</span> <span class="st">"Date"</span>, <span class="at">suffix =</span> <span class="fu">c</span>(<span class="st">"_Portfolio"</span>, <span class="st">"_IBOV"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="sc">-</span>Date, <span class="at">names_to =</span> <span class="st">"Portfolio"</span>, <span class="at">values_to =</span> <span class="st">"Return"</span>)</span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a>plotly<span class="sc">::</span><span class="fu">ggplotly</span>(<span class="fu">ggplot</span>(opt_returns_long_df) <span class="sc">+</span></span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x =</span> Date, <span class="at">y =</span> Return, <span class="at">colour =</span> Portfolio) <span class="sc">+</span></span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb48-10"><a href="#cb48-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_hue</span>(<span class="at">direction =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb48-11"><a href="#cb48-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb48-12"><a href="#cb48-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Data"</span>,</span>
<span id="cb48-13"><a href="#cb48-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Retorno"</span>,</span>
<span id="cb48-14"><a href="#cb48-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Retorno do portifólio vs IBOV ao longo do tempo"</span>,</span>
<span id="cb48-15"><a href="#cb48-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">colour =</span> <span class="st">"Portfólio"</span></span>
<span id="cb48-16"><a href="#cb48-16" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb48-17"><a href="#cb48-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb48-18"><a href="#cb48-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb48-19"><a href="#cb48-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">16</span>L,</span>
<span id="cb48-20"><a href="#cb48-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">face =</span> <span class="st">"bold"</span>,</span>
<span id="cb48-21"><a href="#cb48-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">hjust =</span> <span class="fl">0.5</span>)</span>
<span id="cb48-22"><a href="#cb48-22" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb48-23"><a href="#cb48-23" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="plotly html-widget html-fill-item" id="htmlwidget-eeed6385b17fea5aeadd" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-eeed6385b17fea5aeadd">{"x":{"data":[{"x":[18443,18474,18505,18535,18566,18596,18627,18658,18686,18717,18747,18778,18808,18839,18870,18900,18931,18961,18992,19023,19051,19082,19112,19143,19173,19204,19235,19265,19296,19326,19357,19388,19416,19447,19477,19508,19538,19569,19600,19630,19661,19691,19722,19753,19782,19813,19843,19874],"y":[0.087559923572417375,0.082646019188688857,-0.034427472014925353,-0.047962644285441169,-0.0068813885394755081,0.1589747956403269,0.095676291235030408,-0.027651584999916157,-0.051479652089960082,0.059971827145908208,0.019376854090573881,0.061584268339865744,0.0046428345059263965,-0.039439441018280452,-0.024794541916733026,-0.065683905675150034,-0.067382117337514313,-0.015323523444217946,0.028523769808173505,0.072179504302531949,0.0067089013061891745,0.060605257110533772,-0.10102584188201569,0.032212911120174992,-0.11503264452048023,0.046914006210549752,0.061629428585276091,0.0046930781662299914,0.054527113607241162,-0.030602307884554092,-0.021824938214533351,0.031818305750197728,-0.075749568403621903,-0.029066443029771682,0.02502895506566416,0.037373601961084635,0.090017076660358963,0.032653890775445227,-0.050851627399686739,0.0071106426362081976,-0.029348432205207442,0.12538888496075806,0.053828211511729229,-0.047941275105265135,0.0099254806186988009,-0.0070841729964347122,-0.017032769737561071,-0.025547155427082968],"text":["Date: 2020-06-30<br />Return:  0.087559924<br />Portfolio: IBOV","Date: 2020-07-31<br />Return:  0.082646019<br />Portfolio: IBOV","Date: 2020-08-31<br />Return: -0.034427472<br />Portfolio: IBOV","Date: 2020-09-30<br />Return: -0.047962644<br />Portfolio: IBOV","Date: 2020-10-31<br />Return: -0.006881389<br />Portfolio: IBOV","Date: 2020-11-30<br />Return:  0.158974796<br />Portfolio: IBOV","Date: 2020-12-31<br />Return:  0.095676291<br />Portfolio: IBOV","Date: 2021-01-31<br />Return: -0.027651585<br />Portfolio: IBOV","Date: 2021-02-28<br />Return: -0.051479652<br />Portfolio: IBOV","Date: 2021-03-31<br />Return:  0.059971827<br />Portfolio: IBOV","Date: 2021-04-30<br />Return:  0.019376854<br />Portfolio: IBOV","Date: 2021-05-31<br />Return:  0.061584268<br />Portfolio: IBOV","Date: 2021-06-30<br />Return:  0.004642835<br />Portfolio: IBOV","Date: 2021-07-31<br />Return: -0.039439441<br />Portfolio: IBOV","Date: 2021-08-31<br />Return: -0.024794542<br />Portfolio: IBOV","Date: 2021-09-30<br />Return: -0.065683906<br />Portfolio: IBOV","Date: 2021-10-31<br />Return: -0.067382117<br />Portfolio: IBOV","Date: 2021-11-30<br />Return: -0.015323523<br />Portfolio: IBOV","Date: 2021-12-31<br />Return:  0.028523770<br />Portfolio: IBOV","Date: 2022-01-31<br />Return:  0.072179504<br />Portfolio: IBOV","Date: 2022-02-28<br />Return:  0.006708901<br />Portfolio: IBOV","Date: 2022-03-31<br />Return:  0.060605257<br />Portfolio: IBOV","Date: 2022-04-30<br />Return: -0.101025842<br />Portfolio: IBOV","Date: 2022-05-31<br />Return:  0.032212911<br />Portfolio: IBOV","Date: 2022-06-30<br />Return: -0.115032645<br />Portfolio: IBOV","Date: 2022-07-31<br />Return:  0.046914006<br />Portfolio: IBOV","Date: 2022-08-31<br />Return:  0.061629429<br />Portfolio: IBOV","Date: 2022-09-30<br />Return:  0.004693078<br />Portfolio: IBOV","Date: 2022-10-31<br />Return:  0.054527114<br />Portfolio: IBOV","Date: 2022-11-30<br />Return: -0.030602308<br />Portfolio: IBOV","Date: 2022-12-31<br />Return: -0.021824938<br />Portfolio: IBOV","Date: 2023-01-31<br />Return:  0.031818306<br />Portfolio: IBOV","Date: 2023-02-28<br />Return: -0.075749568<br />Portfolio: IBOV","Date: 2023-03-31<br />Return: -0.029066443<br />Portfolio: IBOV","Date: 2023-04-30<br />Return:  0.025028955<br />Portfolio: IBOV","Date: 2023-05-31<br />Return:  0.037373602<br />Portfolio: IBOV","Date: 2023-06-30<br />Return:  0.090017077<br />Portfolio: IBOV","Date: 2023-07-31<br />Return:  0.032653891<br />Portfolio: IBOV","Date: 2023-08-31<br />Return: -0.050851627<br />Portfolio: IBOV","Date: 2023-09-30<br />Return:  0.007110643<br />Portfolio: IBOV","Date: 2023-10-31<br />Return: -0.029348432<br />Portfolio: IBOV","Date: 2023-11-30<br />Return:  0.125388885<br />Portfolio: IBOV","Date: 2023-12-31<br />Return:  0.053828212<br />Portfolio: IBOV","Date: 2024-01-31<br />Return: -0.047941275<br />Portfolio: IBOV","Date: 2024-02-29<br />Return:  0.009925481<br />Portfolio: IBOV","Date: 2024-03-31<br />Return: -0.007084173<br />Portfolio: IBOV","Date: 2024-04-30<br />Return: -0.017032770<br />Portfolio: IBOV","Date: 2024-05-31<br />Return: -0.025547155<br />Portfolio: IBOV"],"type":"scatter","mode":"lines","line":{"width":1.8897637795275593,"color":"rgba(248,118,109,1)","dash":"solid"},"hoveron":"points","name":"(IBOV,1)","legendgroup":"(IBOV,1)","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[18443,18474,18505,18535,18566,18596,18627,18658,18686,18717,18747,18778,18808,18839,18870,18900,18931,18961,18992,19023,19051,19082,19112,19143,19173,19204,19235,19265,19296,19326,19357,19388,19416,19447,19477,19508,19538,19569,19600,19630,19661,19691,19722,19753,19782,19813,19843,19874],"y":[0.085684034781469798,0.080934727590222355,0.0031526506656889275,-0.015727599303149931,0.018216352204989406,0.24908893568594248,0.11842909169273441,-0.016696010593991395,-0.060466433596484737,0.029187639712729085,0.051154300048034118,0.097905666835416127,-0.02223728802768743,-0.050430540728838125,-0.018163318268032302,-0.085473905055913568,-0.188402116998862,-0.041088280620954154,0.041684724509914561,0.087059690550622237,-0.011798378402736232,0.13579738086715265,-0.10497520917445968,-0.025411063905937725,-0.22793407574247437,0.033398992531566307,0.2702071020253809,-0.026660989009025249,0.017684851481244213,-0.0046688356739531534,-0.039994538860160578,0.14463101595110084,-0.13066081712525335,0.083963337869491061,0.022266423368342725,0.040848527948454505,0.080404358986959634,-0.0034974606329737368,-0.058401594612799146,-0.013531257933825369,-0.091620540197121292,0.048575954470104321,0.059182600181124867,-0.035588862946295374,0.016858784388165349,-0.0042157460771294897,-0.025892886325471043,-0.016528844098973816],"text":["Date: 2020-06-30<br />Return:  0.085684035<br />Portfolio: portfolio.returns","Date: 2020-07-31<br />Return:  0.080934728<br />Portfolio: portfolio.returns","Date: 2020-08-31<br />Return:  0.003152651<br />Portfolio: portfolio.returns","Date: 2020-09-30<br />Return: -0.015727599<br />Portfolio: portfolio.returns","Date: 2020-10-31<br />Return:  0.018216352<br />Portfolio: portfolio.returns","Date: 2020-11-30<br />Return:  0.249088936<br />Portfolio: portfolio.returns","Date: 2020-12-31<br />Return:  0.118429092<br />Portfolio: portfolio.returns","Date: 2021-01-31<br />Return: -0.016696011<br />Portfolio: portfolio.returns","Date: 2021-02-28<br />Return: -0.060466434<br />Portfolio: portfolio.returns","Date: 2021-03-31<br />Return:  0.029187640<br />Portfolio: portfolio.returns","Date: 2021-04-30<br />Return:  0.051154300<br />Portfolio: portfolio.returns","Date: 2021-05-31<br />Return:  0.097905667<br />Portfolio: portfolio.returns","Date: 2021-06-30<br />Return: -0.022237288<br />Portfolio: portfolio.returns","Date: 2021-07-31<br />Return: -0.050430541<br />Portfolio: portfolio.returns","Date: 2021-08-31<br />Return: -0.018163318<br />Portfolio: portfolio.returns","Date: 2021-09-30<br />Return: -0.085473905<br />Portfolio: portfolio.returns","Date: 2021-10-31<br />Return: -0.188402117<br />Portfolio: portfolio.returns","Date: 2021-11-30<br />Return: -0.041088281<br />Portfolio: portfolio.returns","Date: 2021-12-31<br />Return:  0.041684725<br />Portfolio: portfolio.returns","Date: 2022-01-31<br />Return:  0.087059691<br />Portfolio: portfolio.returns","Date: 2022-02-28<br />Return: -0.011798378<br />Portfolio: portfolio.returns","Date: 2022-03-31<br />Return:  0.135797381<br />Portfolio: portfolio.returns","Date: 2022-04-30<br />Return: -0.104975209<br />Portfolio: portfolio.returns","Date: 2022-05-31<br />Return: -0.025411064<br />Portfolio: portfolio.returns","Date: 2022-06-30<br />Return: -0.227934076<br />Portfolio: portfolio.returns","Date: 2022-07-31<br />Return:  0.033398993<br />Portfolio: portfolio.returns","Date: 2022-08-31<br />Return:  0.270207102<br />Portfolio: portfolio.returns","Date: 2022-09-30<br />Return: -0.026660989<br />Portfolio: portfolio.returns","Date: 2022-10-31<br />Return:  0.017684851<br />Portfolio: portfolio.returns","Date: 2022-11-30<br />Return: -0.004668836<br />Portfolio: portfolio.returns","Date: 2022-12-31<br />Return: -0.039994539<br />Portfolio: portfolio.returns","Date: 2023-01-31<br />Return:  0.144631016<br />Portfolio: portfolio.returns","Date: 2023-02-28<br />Return: -0.130660817<br />Portfolio: portfolio.returns","Date: 2023-03-31<br />Return:  0.083963338<br />Portfolio: portfolio.returns","Date: 2023-04-30<br />Return:  0.022266423<br />Portfolio: portfolio.returns","Date: 2023-05-31<br />Return:  0.040848528<br />Portfolio: portfolio.returns","Date: 2023-06-30<br />Return:  0.080404359<br />Portfolio: portfolio.returns","Date: 2023-07-31<br />Return: -0.003497461<br />Portfolio: portfolio.returns","Date: 2023-08-31<br />Return: -0.058401595<br />Portfolio: portfolio.returns","Date: 2023-09-30<br />Return: -0.013531258<br />Portfolio: portfolio.returns","Date: 2023-10-31<br />Return: -0.091620540<br />Portfolio: portfolio.returns","Date: 2023-11-30<br />Return:  0.048575954<br />Portfolio: portfolio.returns","Date: 2023-12-31<br />Return:  0.059182600<br />Portfolio: portfolio.returns","Date: 2024-01-31<br />Return: -0.035588863<br />Portfolio: portfolio.returns","Date: 2024-02-29<br />Return:  0.016858784<br />Portfolio: portfolio.returns","Date: 2024-03-31<br />Return: -0.004215746<br />Portfolio: portfolio.returns","Date: 2024-04-30<br />Return: -0.025892886<br />Portfolio: portfolio.returns","Date: 2024-05-31<br />Return: -0.016528844<br />Portfolio: portfolio.returns"],"type":"scatter","mode":"lines","line":{"width":1.8897637795275593,"color":"rgba(0,191,196,1)","dash":"solid"},"hoveron":"points","name":"(portfolio.returns,1)","legendgroup":"(portfolio.returns,1)","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null}],"layout":{"margin":{"t":47.481942714819425,"r":7.3059360730593621,"b":40.182648401826491,"l":48.949771689497723},"font":{"color":"rgba(0,0,0,1)","family":"","size":14.611872146118724},"title":{"text":"<b> Retorno do portifólio vs IBOV ao longo do tempo <\/b>","font":{"color":"rgba(0,0,0,1)","family":"","size":21.253632212536321},"x":0.5,"xref":"paper"},"xaxis":{"domain":[0,1],"automargin":true,"type":"linear","autorange":false,"range":[18371.450000000001,19945.549999999999],"tickmode":"array","ticktext":["2021","2022","2023","2024"],"tickvals":[18628,18993,19358,19723],"categoryorder":"array","categoryarray":["2021","2022","2023","2024"],"nticks":null,"ticks":"","tickcolor":null,"ticklen":3.6529680365296811,"tickwidth":0,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.68949771689498},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"gridcolor":"rgba(235,235,235,1)","gridwidth":0.66417600664176002,"zeroline":false,"anchor":"y","title":{"text":"Data","font":{"color":"rgba(0,0,0,1)","family":"","size":14.611872146118724}},"hoverformat":".2f"},"yaxis":{"domain":[0,1],"automargin":true,"type":"linear","autorange":false,"range":[-0.25284113463086716,0.29511416091377368],"tickmode":"array","ticktext":["-0.2","-0.1","0.0","0.1","0.2"],"tickvals":[-0.20000000000000001,-0.10000000000000001,0,0.10000000000000003,0.20000000000000001],"categoryorder":"array","categoryarray":["-0.2","-0.1","0.0","0.1","0.2"],"nticks":null,"ticks":"","tickcolor":null,"ticklen":3.6529680365296811,"tickwidth":0,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.68949771689498},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"gridcolor":"rgba(235,235,235,1)","gridwidth":0.66417600664176002,"zeroline":false,"anchor":"x","title":{"text":"Retorno","font":{"color":"rgba(0,0,0,1)","family":"","size":14.611872146118724}},"hoverformat":".2f"},"shapes":[{"type":"rect","fillcolor":null,"line":{"color":null,"width":0,"linetype":[]},"yref":"paper","xref":"paper","x0":0,"x1":1,"y0":0,"y1":1}],"showlegend":true,"legend":{"bgcolor":null,"bordercolor":null,"borderwidth":0,"font":{"color":"rgba(0,0,0,1)","family":"","size":11.68949771689498},"title":{"text":"Portfólio","font":{"color":"rgba(0,0,0,1)","family":"","size":14.611872146118724}}},"hovermode":"closest","barmode":"relative"},"config":{"doubleClick":"reset","modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"source":"A","attrs":{"655454a63619":{"x":{},"y":{},"colour":{},"type":"scatter"}},"cur_data":"655454a63619","visdat":{"655454a63619":["function (y) ","x"]},"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</section>
<section id="bonus-plotando-a-fronteira-eficiente" class="level2">
<h2 class="anchored" data-anchor-id="bonus-plotando-a-fronteira-eficiente">Bonus: Plotando a fronteira eficiente</h2>
<p>A fronteira eficiente é uma curva que mostra a combinação ótima de ativos em uma carteira que maximiza o retorno esperado para um determinado nível de risco. Note que o indice de Sharpe é a inclinação da linha tangente a fronteira eficiente, o intercepto com o eixo y é o retorno livre de risco e o ponto de tangência é o ponto com o maior indice de Sharpe.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculando a fronteira eficiente</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>frontier <span class="ot">&lt;-</span> <span class="fu">create.EfficientFrontier</span>(<span class="at">R =</span> asset_returns_xts, <span class="at">portfolio =</span> port_spec, <span class="at">type =</span> <span class="st">"mean-StdDev"</span>)</span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Plotando a fronteira eficiente</span></span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a><span class="fu">chart.EfficientFrontier</span>(frontier, <span class="at">match.col =</span> <span class="st">"StdDev"</span>,<span class="at">n.portfolios =</span> <span class="dv">30</span>, <span class="at">main =</span> <span class="st">"Fronteira eficiente"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="aula_2_files/figure-html/unnamed-chunk-23-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="dashboards-interativos-com-quarto" class="level2">
<h2 class="anchored" data-anchor-id="dashboards-interativos-com-quarto">Dashboards interativos com QUARTO</h2>
<p><a href="https://quarto.org/docs/dashboards/">Clique aqui!!</a></p>
</section>
<section id="exercício" class="level2">
<h2 class="anchored" data-anchor-id="exercício">Exercício</h2>
<ul>
<li>Crie uma carteira com 5 ativos de sua escolha</li>
<li>Baixe os preços dos ativos</li>
<li>Calcule os retornos mensais</li>
<li>Crie um vetor de pesos para a carteira</li>
<li>Calcule o retorno da carteira</li>
<li>Faça a otimização da carteira com o objetivo de maximizar o retorno esperado e minimizar o risco</li>
<li>Opcionalmente faça a otimização com rebalanceamento</li>
<li>Visualize o retorno da carteira e dos ativos</li>
<li>Compare o retorno da carteira com o índice do mercado</li>
<li>Salve o seu dashboard e compartilhe com o professor</li>
</ul>
</section>
<section id="dica-use-o-arquivo-das-aulas-anteriores-como-referência-para-criar-o-seu-dashboard" class="level2">
<h2 class="anchored" data-anchor-id="dica-use-o-arquivo-das-aulas-anteriores-como-referência-para-criar-o-seu-dashboard">Dica: Use o arquivo das aulas anteriores como referência para criar o seu dashboard</h2>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>